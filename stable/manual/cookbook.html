<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cookbook &mdash; MNE 0.12.dev0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.12.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="MNE 0.12.dev0 documentation" href="../index.html" />
    <link rel="up" title="User Manual" href="index.html" />
    <link rel="next" title="Importing MEG data" href="io.html" />
    <link rel="prev" title="User Manual" href="index.html" />

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="http://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/mne_logo_small.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.12.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Get started</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../auto_examples/index.html">Gallery</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="index.html">Manual</a></li>
                <li><a href="../faq.html">FAQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Examples Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribute to MNE</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python_reference.html">Python API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What&#8217;s new</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cite.html">How to cite MNE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Related publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cited.html">Publications from MNE users</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Cookbook</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#preprocessing">Preprocessing</a><ul>
<li><a class="reference internal" href="#marking-bad-channels">Marking bad channels</a></li>
<li><a class="reference internal" href="#artifact-suppression">Artifact suppression</a><ul>
<li><a class="reference internal" href="#ssp">SSP</a></li>
<li><a class="reference internal" href="#ica">ICA</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#epoching-and-evoked-data">Epoching and evoked data</a></li>
<li><a class="reference internal" href="#source-localization">Source localization</a><ul>
<li><a class="reference internal" href="#anatomical-information">Anatomical information</a><ul>
<li><a class="reference internal" href="#cortical-surface-reconstruction-with-freesurfer">Cortical surface reconstruction with FreeSurfer</a></li>
<li><a class="reference internal" href="#setting-up-the-source-space">Setting up the source space</a></li>
<li><a class="reference internal" href="#creating-the-bem-model-meshes">Creating the BEM model meshes</a></li>
<li><a class="reference internal" href="#setting-up-the-head-surface-triangulation-files">Setting up the head surface triangulation files</a></li>
<li><a class="reference internal" href="#setting-up-the-boundary-element-model">Setting up the boundary-element model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aligning-coordinate-frames">Aligning coordinate frames</a></li>
<li><a class="reference internal" href="#computing-the-forward-solution">Computing the forward solution</a></li>
<li><a class="reference internal" href="#computing-the-noise-covariance-matrix">Computing the noise-covariance matrix</a></li>
<li><a class="reference internal" href="#calculating-the-inverse-operator">Calculating the inverse operator</a></li>
<li><a class="reference internal" href="#creating-source-estimates">Creating source estimates</a></li>
<li><a class="reference internal" href="#group-analyses">Group analyses</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Cookbook</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#preprocessing">Preprocessing</a><ul>
<li><a class="reference internal" href="#marking-bad-channels">Marking bad channels</a></li>
<li><a class="reference internal" href="#artifact-suppression">Artifact suppression</a><ul>
<li><a class="reference internal" href="#ssp">SSP</a></li>
<li><a class="reference internal" href="#ica">ICA</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#epoching-and-evoked-data">Epoching and evoked data</a></li>
<li><a class="reference internal" href="#source-localization">Source localization</a><ul>
<li><a class="reference internal" href="#anatomical-information">Anatomical information</a><ul>
<li><a class="reference internal" href="#cortical-surface-reconstruction-with-freesurfer">Cortical surface reconstruction with FreeSurfer</a></li>
<li><a class="reference internal" href="#setting-up-the-source-space">Setting up the source space</a></li>
<li><a class="reference internal" href="#creating-the-bem-model-meshes">Creating the BEM model meshes</a></li>
<li><a class="reference internal" href="#setting-up-the-head-surface-triangulation-files">Setting up the head surface triangulation files</a></li>
<li><a class="reference internal" href="#setting-up-the-boundary-element-model">Setting up the boundary-element model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aligning-coordinate-frames">Aligning coordinate frames</a></li>
<li><a class="reference internal" href="#computing-the-forward-solution">Computing the forward solution</a></li>
<li><a class="reference internal" href="#computing-the-noise-covariance-matrix">Computing the noise-covariance matrix</a></li>
<li><a class="reference internal" href="#calculating-the-inverse-operator">Calculating the inverse operator</a></li>
<li><a class="reference internal" href="#creating-source-estimates">Creating source estimates</a></li>
<li><a class="reference internal" href="#group-analyses">Group analyses</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <li>
    <a href="index.html" title="Previous Chapter: User Manual"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; User Manual</span>
    </a>
  </li>
  <li>
    <a href="io.html" title="Next Chapter: Importing MEG data"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Importing MEG... &raquo;</span>
    </a>
  </li>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12">
      
  <div class="section" id="cookbook">
<span id="id1"></span><h1>Cookbook<a class="headerlink" href="#cookbook" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#preprocessing" id="id3">Preprocessing</a><ul>
<li><a class="reference internal" href="#marking-bad-channels" id="id4">Marking bad channels</a></li>
<li><a class="reference internal" href="#artifact-suppression" id="id5">Artifact suppression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#epoching-and-evoked-data" id="id6">Epoching and evoked data</a></li>
<li><a class="reference internal" href="#source-localization" id="id7">Source localization</a><ul>
<li><a class="reference internal" href="#anatomical-information" id="id8">Anatomical information</a></li>
<li><a class="reference internal" href="#aligning-coordinate-frames" id="id9">Aligning coordinate frames</a></li>
<li><a class="reference internal" href="#computing-the-forward-solution" id="id10">Computing the forward solution</a></li>
<li><a class="reference internal" href="#computing-the-noise-covariance-matrix" id="id11">Computing the noise-covariance matrix</a></li>
<li><a class="reference internal" href="#calculating-the-inverse-operator" id="id12">Calculating the inverse operator</a></li>
<li><a class="reference internal" href="#creating-source-estimates" id="id13">Creating source estimates</a></li>
<li><a class="reference internal" href="#group-analyses" id="id14">Group analyses</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section describes a typical MEG/EEG workflow, eventually up to source
reconstruction. The workflow is summarized in <a class="reference internal" href="#flow-diagram"><em>Workflow of the MNE software</em></a>.
References below refer to Python functions and objects.</p>
<div class="figure align-center" id="flow-diagram">
<img alt="MNE Workflow Flowchart" src="../_images/flow_diagram.svg" /><p class="caption"><strong>Workflow of the MNE software</strong></p>
</div>
</div>
<div class="section" id="preprocessing">
<h2><a class="toc-backref" href="#id3">Preprocessing</a><a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h2>
<p>The following MEG and EEG data preprocessing steps are recommended:</p>
<ul class="simple">
<li>Bad channels in the MEG and EEG data must be identified, see <a class="reference internal" href="#babbhcfg"><em>Marking bad channels</em></a>.</li>
<li>The data has to be filtered to the desired passband.</li>
<li>Artifacts should be suppressed (e.g., using ICA or SSP).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For older systems, coding problems on the trigger channel
STI 014 and EEG/MEG information may need to be fixed, see
<a class="reference internal" href="appendix/c_misc.html#babcdbdi"><em>Cleaning the digital trigger channel</em></a> and <a class="reference internal" href="appendix/c_misc.html#babcdfjh"><em>Fixing channel information</em></a>.</p>
</div>
<div class="section" id="marking-bad-channels">
<span id="babbhcfg"></span><h3><a class="toc-backref" href="#id4">Marking bad channels</a><a class="headerlink" href="#marking-bad-channels" title="Permalink to this headline">¶</a></h3>
<p>Sometimes some MEG or EEG channels are not functioning properly
for various reasons. These channels should be excluded from
analysis by marking them bad as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MEG2443&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Especially if a channel does not show
a signal at all (flat) it is important to exclude it from the
analysis, since its noise estimate will be unrealistically low and
thus the current estimate calculations will give a strong weight
to the zero signal on the flat channels and will essentially vanish.
It is also important to exclude noisy channels because they can
possibly affect others when signal-space projections or EEG average electrode
reference is employed. Noisy bad channels can also adversely affect
averaging and noise-covariance matrix estimation by causing
unnecessary rejections of epochs.</p>
<p>Recommended ways to identify bad channels are:</p>
<ul class="simple">
<li>Observe the quality of data during data
acquisition and make notes of observed malfunctioning channels to
your measurement protocol sheet.</li>
<li>View the on-line averages and check the condition of the channels.</li>
<li>Compute preliminary off-line averages with artefact rejection,
SSP/ICA, and EEG average electrode reference computation
off and check the condition of the channels.</li>
<li>View raw data with <a class="reference internal" href="../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot"><tt class="xref py py-func docutils literal"><span class="pre">mne.io.Raw.plot()</span></tt></a> without SSP/ICA
enabled and identify bad channels.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is strongly recommended that bad channels are identified and
marked in the original raw data files. If present in the raw data
files, the bad channel selections will be automatically transferred
to averaged files, noise-covariance matrices, forward solution
files, and inverse operator decompositions.</p>
</div>
</div>
<div class="section" id="artifact-suppression">
<h3><a class="toc-backref" href="#id5">Artifact suppression</a><a class="headerlink" href="#artifact-suppression" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ssp">
<h4>SSP<a class="headerlink" href="#ssp" title="Permalink to this headline">¶</a></h4>
<p>The Signal-Space Projection (SSP) is one approach to rejection
of external disturbances in software. Unlike many other
noise-cancellation approaches, SSP does
not require additional reference sensors to record the disturbance
fields. Instead, SSP relies on the fact that the magnetic field
distributions generated by the sources in the brain have spatial
distributions sufficiently different from those generated by external
noise sources. Furthermore, it is implicitly assumed that the linear
space spanned by the significant external noise patters has a low
dimension.</p>
<p>SSP-based rejection is often done using the
<a class="reference internal" href="../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><tt class="xref py py-func docutils literal"><span class="pre">mne.preprocessing.compute_proj_ecg()</span></tt></a> and
<a class="reference internal" href="../generated/mne.preprocessing.compute_proj_eog.html#mne.preprocessing.compute_proj_eog" title="mne.preprocessing.compute_proj_eog"><tt class="xref py py-func docutils literal"><span class="pre">mne.preprocessing.compute_proj_eog()</span></tt></a> methods, see <a class="reference internal" href="preprocessing/ssp.html#ssp"><em>Projections</em></a>
section for more information.</p>
</div>
<div class="section" id="ica">
<h4>ICA<a class="headerlink" href="#ica" title="Permalink to this headline">¶</a></h4>
<p>Many M/EEG signals including biological artifacts reflect non-Gaussian
processes. Therefore PCA-based artifact rejection will likely perform worse at
separating the signal from noise sources.</p>
<p>ICA-based artifact rejection is done using the <a class="reference internal" href="../generated/mne.preprocessing.ICA.html#mne.preprocessing.ICA" title="mne.preprocessing.ICA"><tt class="xref py py-class docutils literal"><span class="pre">mne.preprocessing.ICA</span></tt></a>
class, see the <a class="reference internal" href="preprocessing/ica.html#ica"><em>Independent Component Analysis (ICA)</em></a> section for more information.</p>
</div>
</div>
</div>
<div class="section" id="epoching-and-evoked-data">
<h2><a class="toc-backref" href="#id6">Epoching and evoked data</a><a class="headerlink" href="#epoching-and-evoked-data" title="Permalink to this headline">¶</a></h2>
<p>Epoching of raw data is done using events, which define a <tt class="docutils literal"><span class="pre">t=0</span></tt> for your
data chunks. Event times stamped to the acquisition software can be extracted
using <a class="reference internal" href="../generated/mne.find_events.html#mne.find_events" title="mne.find_events"><tt class="xref py py-func docutils literal"><span class="pre">mne.find_events()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">find_events</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">events</span></tt> array can then be modified, extended, or changed if necessary.
If the original trigger codes and trigger times are correct for the analysis
of interest, <a class="reference internal" href="../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><tt class="xref py py-class docutils literal"><span class="pre">mne.Epochs</span></tt></a> for the first event type (<tt class="docutils literal"><span class="pre">1</span></tt>) can be
constructed using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">reject</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="mf">4e-12</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="mf">150e-6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">epochs</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">proj</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">preload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">)</span>
</pre></div>
</div>
<p>Once the <a class="reference internal" href="../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><tt class="xref py py-class docutils literal"><span class="pre">mne.Epochs</span></tt></a> are constructed, they can be averaged to obtain
<a class="reference internal" href="../generated/mne.Evoked.html#mne.Evoked" title="mne.Evoked"><tt class="xref py py-class docutils literal"><span class="pre">mne.Evoked</span></tt></a> data as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">evoked</span> <span class="o">=</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="source-localization">
<h2><a class="toc-backref" href="#id7">Source localization</a><a class="headerlink" href="#source-localization" title="Permalink to this headline">¶</a></h2>
<p>MNE makes extensive use of the FreeSurfer file structure for analysis.
Before starting data analysis, we recommend setting up the environment
variable <tt class="docutils literal"><span class="pre">SUBJECTS_DIR</span></tt> (or set it permanently using <a class="reference internal" href="../generated/mne.set_config.html#mne.set_config" title="mne.set_config"><tt class="xref py py-func docutils literal"><span class="pre">mne.set_config()</span></tt></a>)
to select the directory under which the anatomical MRI data are stored.
This makes it so that the <tt class="docutils literal"><span class="pre">subjects_dir</span></tt> argument does not need to
be passed to many functions.</p>
<div class="section" id="anatomical-information">
<h3><a class="toc-backref" href="#id8">Anatomical information</a><a class="headerlink" href="#anatomical-information" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cortical-surface-reconstruction-with-freesurfer">
<span id="chdbbcej"></span><h4>Cortical surface reconstruction with FreeSurfer<a class="headerlink" href="#cortical-surface-reconstruction-with-freesurfer" title="Permalink to this headline">¶</a></h4>
<p>The first processing stage is the creation of various surface
reconstructions with FreeSurfer. The recommended FreeSurfer workflow
is summarized on the <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/RecommendedReconstruction">FreeSurfer wiki pages</a>.</p>
</div>
<div class="section" id="setting-up-the-source-space">
<span id="cihchdae"></span><h4>Setting up the source space<a class="headerlink" href="#setting-up-the-source-space" title="Permalink to this headline">¶</a></h4>
<p>This stage consists of the following:</p>
<ul class="simple">
<li>Creating a suitable decimated dipole grid on the white matter surface.</li>
<li>Creating the source space file in fif format.</li>
</ul>
<p>This is accomplished with using <a class="reference internal" href="../generated/mne.setup_source_space.html#mne.setup_source_space" title="mne.setup_source_space"><tt class="xref py py-func docutils literal"><span class="pre">mne.setup_source_space()</span></tt></a> and
<a class="reference internal" href="../generated/mne.write_source_spaces.html#mne.write_source_spaces" title="mne.write_source_spaces"><tt class="xref py py-func docutils literal"><span class="pre">mne.write_source_spaces()</span></tt></a>. These assume that the anatomical MRI processing
has been completed as described in <a class="reference internal" href="#chdbbcej"><em>Cortical surface reconstruction with FreeSurfer</em></a>.</p>
<table border="1" class="docutils" id="babgcdha">
<caption>Recommended subdivisions of an icosahedron and an octahedron for
       the creation of source spaces. The approximate source spacing and
       corresponding surface area have been calculated assuming a
       1000-cm2 surface area per hemisphere.</caption>
<colgroup>
<col width="14%" />
<col width="27%" />
<col width="23%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><tt class="docutils literal"><span class="pre">spacing</span></tt></th>
<th class="head">Sources per hemisphere</th>
<th class="head">Source spacing / mm</th>
<th class="head">Surface area per source / mm2</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'oct5'</span></tt></td>
<td>1026</td>
<td>9.9</td>
<td>97</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'ico4'</span></tt></td>
<td>2562</td>
<td>6.2</td>
<td>39</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'oct6'</span></tt></td>
<td>4098</td>
<td>4.9</td>
<td>24</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'ico5'</span></tt></td>
<td>10242</td>
<td>3.1</td>
<td>9.8</td>
</tr>
</tbody>
</table>
<p>For example, to create the reconstruction geometry for <tt class="docutils literal"><span class="pre">subject='sample'</span></tt>
with a ~5-mm spacing between the grid points, say:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">setup_source_space</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;oct6&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_source_spaces</span><span class="p">(</span><span class="s1">&#39;sample-oct6-src.fif&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates the source spaces and writes them to disk.</p>
</div>
<div class="section" id="creating-the-bem-model-meshes">
<span id="chdbjcia"></span><h4>Creating the BEM model meshes<a class="headerlink" href="#creating-the-bem-model-meshes" title="Permalink to this headline">¶</a></h4>
<p>Calculation of the forward solution using the boundary-element
model (BEM) requires that the surfaces separating regions of different
electrical conductivities are tessellated with suitable surface
elements. Our BEM software employs triangular tessellations. Therefore,
prerequisites for BEM calculations are the segmentation of the MRI
data and the triangulation of the relevant surfaces.</p>
<p>For MEG computations, a reasonably accurate solution can
be obtained by using a single-compartment BEM assuming the shape
of the intracranial volume. For EEG, the standard model contains
the intracranial space, the skull, and the scalp.</p>
<p>At present, no bulletproof method exists for creating the
triangulations. Feasible approaches are described in <a class="reference internal" href="appendix/bem_model.html#create-bem-model"><em>Creating the BEM meshes</em></a>.</p>
</div>
<div class="section" id="setting-up-the-head-surface-triangulation-files">
<span id="babdbbfc"></span><h4>Setting up the head surface triangulation files<a class="headerlink" href="#setting-up-the-head-surface-triangulation-files" title="Permalink to this headline">¶</a></h4>
<p>The segmentation algorithms described in <a class="reference internal" href="appendix/bem_model.html#create-bem-model"><em>Creating the BEM meshes</em></a> produce
either FreeSurfer surfaces or triangulation
data in text. Before proceeding to the creation of the boundary
element model, standard files for FreeSurfer surfaces must be present:</p>
<ol class="arabic simple">
<li><strong>inner_skull.surf</strong> contains the inner skull triangulation.</li>
<li><strong>outer_skull.surf</strong> contains the outer skull triangulation.</li>
<li><strong>outer_skin.surf</strong> contains the head surface triangulation.</li>
</ol>
</div>
<div class="section" id="setting-up-the-boundary-element-model">
<span id="cihdbfeg"></span><h4>Setting up the boundary-element model<a class="headerlink" href="#setting-up-the-boundary-element-model" title="Permalink to this headline">¶</a></h4>
<p>This stage sets up the subject-dependent data for computing
the forward solutions:&#8221;</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">make_bem_model</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_bem_surfaces</span><span class="p">(</span><span class="s1">&#39;sample-5120-5120-5120-bem.fif&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>Where <tt class="docutils literal"><span class="pre">surfaces</span></tt> is a list of BEM surfaces that have each been read using
<a class="reference internal" href="../generated/mne.read_surface.html#mne.read_surface" title="mne.read_surface"><tt class="xref py py-func docutils literal"><span class="pre">mne.read_surface()</span></tt></a>. This step also checks that the input surfaces
are complete and that they are topologically correct, <em>i.e.</em>,
that the surfaces do not intersect and that the surfaces are correctly
ordered (outer skull surface inside the scalp and inner skull surface
inside the outer skull).</p>
<p>This step assigns the conductivity values to the BEM compartments.
For the scalp and the brain compartments, the default is 0.3 S/m.
The default skull conductivity is 50 times smaller, <em>i.e.</em>,
0.006 S/m. Recent publications, see <a class="reference internal" href="../references.html#cegegdei"><em>Forward modeling</em></a>, report
a range of skull conductivity ratios ranging from 1:15 (Oostendorp <em>et
al.</em>, 2000) to 1:25 - 1:50 (Slew <em>et al.</em>,
2009, Conçalves <em>et al.</em>, 2003). The
MNE default ratio 1:50 is based on the typical values reported in
(Conçalves <em>et al.</em>, 2003), since their
approach is based comparison of SEF/SEP measurements in a BEM model.
The variability across publications may depend on individual variations
but, more importantly, on the precision of the skull compartment
segmentation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To produce single layer BEM models (&#8211;homog flag in the C command
line tools) pass a list with one single conductivity value,
e.g. <tt class="docutils literal"><span class="pre">conductivities=[0.3]</span></tt>.</p>
</div>
<p>Using this model, the BEM solution can be computed using
<tt class="xref py py-func docutils literal"><span class="pre">mne.make_bem_solution`()</span></tt> as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bem_sol</span> <span class="o">=</span> <span class="n">make_bem_solution</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_bem_solution</span><span class="p">(</span><span class="s1">&#39;sample-5120-5120-5120-bem-sol.fif&#39;</span><span class="p">,</span> <span class="n">bem_sol</span><span class="p">)</span>
</pre></div>
</div>
<p>After the BEM is set up it is advisable to check that the
BEM model meshes are correctly positioned using <em>e.g.</em>, <tt class="xref py py-class docutils literal"><span class="pre">mne.Report</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Up to this point all processing stages depend on the
anatomical (geometrical) information only and thus remain
identical across different MEG studies.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use custom head models you might need to set the <tt class="docutils literal"><span class="pre">ico=None</span></tt>
parameter to <tt class="docutils literal"><span class="pre">None</span></tt> and skip subsampling of the surface.</p>
</div>
</div>
</div>
<div class="section" id="aligning-coordinate-frames">
<span id="chdbehdc"></span><h3><a class="toc-backref" href="#id9">Aligning coordinate frames</a><a class="headerlink" href="#aligning-coordinate-frames" title="Permalink to this headline">¶</a></h3>
<p>The calculation of the forward solution requires knowledge
of the relative location and orientation of the MEG/EEG and MRI
coordinate systems (see <a class="reference internal" href="source_localization/forward.html#bjebibai"><em>The head and device coordinate systems</em></a>). The head coordinate
frame is defined by identifying the fiducial landmark locations,
making the origin and orientation of the head coordinate system
slightly user dependent. As a result, it is safest to reestablish
the definition of the coordinate transformation computation
for each experimental session, <em>i.e.</em>, each time when new head
digitization data are employed.</p>
<p>The interactive source analysis software <a class="reference internal" href="c_reference.html#mne-analyze"><em>mne_analyze</em></a> provides
tools for coordinate frame alignment, see <a class="reference internal" href="gui/analyze.html#ch-interactive-analysis"><em>Interactive analysis with mne_analyze</em></a>.
<a class="reference internal" href="sample_dataset.html#chdijbig"><em>MEG-MRI coordinate system alignment</em></a> also contains tips for using <a class="reference internal" href="c_reference.html#mne-analyze"><em>mne_analyze</em></a> for
this purpose.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This step is important. If the alignment of the
coordinate frames is inaccurate all subsequent processing
steps suffer from the error. Therefore, this step should be
performed by the person in charge of the study or by a trained
technician. Written or photographic documentation of the alignment
points employed during the MEG/EEG acquisition can also be
helpful.</p>
</div>
</div>
<div class="section" id="computing-the-forward-solution">
<span id="babchejd"></span><h3><a class="toc-backref" href="#id10">Computing the forward solution</a><a class="headerlink" href="#computing-the-forward-solution" title="Permalink to this headline">¶</a></h3>
<p>After the MRI-MEG/EEG alignment has been set, the forward
solution, <em>i.e.</em>, the magnetic fields and electric
potentials at the measurement sensors and electrodes due to dipole
sources located on the cortex, can be calculated with help of
<a class="reference internal" href="../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><tt class="xref py py-func docutils literal"><span class="pre">mne.make_forward_solution()</span></tt></a> as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fwd</span> <span class="o">=</span> <span class="n">make_forward_solution</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">fname_trans</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">bem_sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="computing-the-noise-covariance-matrix">
<span id="babdeeeb"></span><h3><a class="toc-backref" href="#id11">Computing the noise-covariance matrix</a><a class="headerlink" href="#computing-the-noise-covariance-matrix" title="Permalink to this headline">¶</a></h3>
<p>The MNE software employs an estimate of the noise-covariance
matrix to weight the channels correctly in the calculations. The
noise-covariance matrix provides information about field and potential
patterns representing uninteresting noise sources of either human
or environmental origin.</p>
<p>The noise covariance matrix can be calculated in several
ways:</p>
<ul>
<li><p class="first">Employ the individual epochs during
off-line averaging to calculate the full noise covariance matrix.
This is the recommended approach for evoked responses, <em>e.g.</em> using
<a class="reference internal" href="../generated/mne.compute_covariance.html#mne.compute_covariance" title="mne.compute_covariance"><tt class="xref py py-func docutils literal"><span class="pre">mne.compute_covariance()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_covariance</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Employ empty room data (collected without the subject) to
calculate the full noise covariance matrix. This is recommended
for analyzing ongoing spontaneous activity. This can be done using
<a class="reference internal" href="../generated/mne.compute_raw_covariance.html#mne.compute_raw_covariance" title="mne.compute_raw_covariance"><tt class="xref py py-func docutils literal"><span class="pre">mne.compute_raw_covariance()</span></tt></a> as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_raw_covariance</span><span class="p">(</span><span class="n">raw_erm</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Employ a section of continuous raw data collected in the presence
of the subject to calculate the full noise covariance matrix. This
is the recommended approach for analyzing epileptic activity. The
data used for this purpose should be free of technical artifacts
and epileptic activity of interest. The length of the data segment
employed should be at least 20 seconds. One can also use a long
(<tt class="docutils literal"><span class="pre">*&gt;</span> <span class="pre">200</span> <span class="pre">s</span></tt>) segment of data with epileptic spikes present provided
that the spikes occur infrequently and that the segment is apparently
stationary with respect to background brain activity. This can also
use <a class="reference internal" href="../generated/mne.compute_raw_covariance.html#mne.compute_raw_covariance" title="mne.compute_raw_covariance"><tt class="xref py py-func docutils literal"><span class="pre">mne.compute_raw_covariance()</span></tt></a>.</p>
</li>
</ul>
<p>See <a class="reference internal" href="source_localization/covariance.html#covariance"><em>Covariance</em></a> for more information.</p>
</div>
<div class="section" id="calculating-the-inverse-operator">
<span id="cihcfjei"></span><h3><a class="toc-backref" href="#id12">Calculating the inverse operator</a><a class="headerlink" href="#calculating-the-inverse-operator" title="Permalink to this headline">¶</a></h3>
<p>The MNE software doesn&#8217;t calculate the inverse operator
explicitly but rather computes an SVD of a matrix composed of the
noise-covariance matrix, the result of the forward calculation,
and the source covariance matrix. This approach has the benefit
that the regularization parameter (&#8216;SNR&#8217;) can
be adjusted easily when the final source estimates or dSPMs are
computed. For mathematical details of this approach,
please consult <a class="reference internal" href="source_localization/inverse.html#cbbdjfbj"><em>Minimum-norm estimates</em></a>.</p>
<p>This computation stage can be done by using
<a class="reference internal" href="../generated/mne.minimum_norm.make_inverse_operator.html#mne.minimum_norm.make_inverse_operator" title="mne.minimum_norm.make_inverse_operator"><tt class="xref py py-func docutils literal"><span class="pre">mne.minimum_norm.make_inverse_operator()</span></tt></a> as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">inv</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">make_inverse_operator</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">fwd</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">loose</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-source-estimates">
<h3><a class="toc-backref" href="#id13">Creating source estimates</a><a class="headerlink" href="#creating-source-estimates" title="Permalink to this headline">¶</a></h3>
<p>Once all the preprocessing steps described above have been
completed, the inverse operator computed can be applied to the MEG
and EEG data as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stc</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">apply_inverse</span><span class="p">(</span><span class="n">evoked</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">9.</span><span class="p">)</span>
</pre></div>
</div>
<p>And the results can be viewed as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>The interactive analysis tool <a class="reference internal" href="c_reference.html#mne-analyze"><em>mne_analyze</em></a> can also
be used to explore the data and to produce quantitative analysis
results, screen snapshots, and QuickTime (TM) movie files,
see <a class="reference internal" href="gui/analyze.html#ch-interactive-analysis"><em>Interactive analysis with mne_analyze</em></a>.</p>
</div>
<div class="section" id="group-analyses">
<h3><a class="toc-backref" href="#id14">Group analyses</a><a class="headerlink" href="#group-analyses" title="Permalink to this headline">¶</a></h3>
<p>Group analysis is facilitated by morphing source estimates, which can be
done <em>e.g.</em>, to <tt class="docutils literal"><span class="pre">subject='fsaverage'</span></tt> as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stc_fsaverage</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">morph</span><span class="p">(</span><span class="s1">&#39;fsaverage&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="source_localization/morph.html#ch-morph"><em>Morphing and averaging</em></a> for more information.</p>
</div>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2012-2016, MNE Developers.<br/>
    </p>
  </div>
</footer>
  </body>
</html>