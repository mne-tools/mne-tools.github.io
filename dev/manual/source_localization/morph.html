<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Morphing and averaging &#8212; MNE 0.14.dev0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.3.6/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.14.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body role="document">

<div class="row devbar alert alert-danger">
This documentation is for the <strong>development version (0.14.dev0)</strong> - <a href="http://martinos.org/mne/stable">switch to Stable</a>
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.14.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../getting_started.html">Get started</a></li>
                <li><a href="../../tutorials.html">Tutorials</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../index.html">Manual</a></li>
                <li><a href="../../contributing.html">Contribute</a></li>
                <li><a href="../../faq.html">FAQ</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Morphing and averaging</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#the-morphing-maps">The morphing maps</a></li>
<li><a class="reference internal" href="#about-smoothing">About smoothing</a></li>
<li><a class="reference internal" href="#precomputing-the-morphing-maps">Precomputing the morphing maps</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12 content">
      
  <div class="section" id="morphing-and-averaging">
<span id="ch-morph"></span><h1>Morphing and averaging<a class="headerlink" href="#morphing-and-averaging" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#the-morphing-maps" id="id2">The morphing maps</a></li>
<li><a class="reference internal" href="#about-smoothing" id="id3">About smoothing</a></li>
<li><a class="reference internal" href="#precomputing-the-morphing-maps" id="id4">Precomputing the morphing maps</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The spherical morphing of the surfaces accomplished by FreeSurfer can be
employed to bring data from different subjects into a common anatomical
frame. This chapter describes utilities which make use of the spherical morphing
procedure. mne_morph_labels morphs
label files between subjects allowing the definition of labels in
a one brain and transforming them to anatomically analogous labels
in another. mne_average_estimates offers
the capability to compute averages of data computed with the MNE software
across subjects.</p>
</div>
<div class="section" id="the-morphing-maps">
<span id="chdjdhii"></span><h2><a class="toc-backref" href="#id2">The morphing maps</a><a class="headerlink" href="#the-morphing-maps" title="Permalink to this headline">¶</a></h2>
<p>The MNE software accomplishes morphing with help of morphing
maps which can be either computed on demand or precomputed using mne_make_morph_maps ,
see <a class="reference internal" href="#chdbbhdh"><span class="std std-ref">Precomputing the morphing maps</span></a>. The morphing is performed with help
of the registered spherical surfaces (<code class="docutils literal"><span class="pre">lh.sphere.reg</span></code> and <code class="docutils literal"><span class="pre">rh.sphere.reg</span></code> )
which must be produced in FreeSurfer .
A morphing map is a linear mapping from cortical surface values
in subject A (<span class="math">\(x^{(A)}\)</span>) to those in another
subject B (<span class="math">\(x^{(B)}\)</span>)</p>
<div class="math">
\[x^{(B)} = M^{(AB)} x^{(A)}\ ,\]</div>
<p>where <span class="math">\(M^{(AB)}\)</span> is a sparse matrix
with at most three nonzero elements on each row. These elements
are determined as follows. First, using the aligned spherical surfaces,
for each vertex <span class="math">\(x_j^{(B)}\)</span>, find the triangle <span class="math">\(T_j^{(A)}\)</span> on the
spherical surface of subject A which contains the location <span class="math">\(x_j^{(B)}\)</span>.
Next, find the numbers of the vertices of this triangle and set
the corresponding elements on the <em>j</em> th row of <span class="math">\(M^{(AB)}\)</span> so that <span class="math">\(x_j^{(B)}\)</span> will
be a linear interpolation between the triangle vertex values reflecting
the location <span class="math">\(x_j^{(B)}\)</span> within the triangle <span class="math">\(T_j^{(A)}\)</span>.</p>
<p>It follows from the above definition that in general</p>
<div class="math">
\[M^{(AB)} \neq (M^{(BA)})^{-1}\ ,\]</div>
<p><em>i.e.</em>,</p>
<div class="math">
\[x_{(A)} \neq M^{(BA)} M^{(AB)} x^{(A)}\ ,\]</div>
<p>even if</p>
<div class="math">
\[x^{(A)} \approx M^{(BA)} M^{(AB)} x^{(A)}\ ,\]</div>
<p><em>i.e.</em>, the mapping is <em>almost</em> a
bijection.</p>
</div>
<div class="section" id="about-smoothing">
<span id="chdebahh"></span><h2><a class="toc-backref" href="#id3">About smoothing</a><a class="headerlink" href="#about-smoothing" title="Permalink to this headline">¶</a></h2>
<p>The current estimates are normally defined only in a decimated
grid which is a sparse subset of the vertices in the triangular
tessellation of the cortical surface. Therefore, any sparse set
of values is distributed to neighboring vertices to make the visualized
results easily understandable. This procedure has been traditionally
called smoothing but a more appropriate name
might be smudging or blurring in
accordance with similar operations in image processing programs.</p>
<p>In MNE software terms, smoothing of the vertex data is an
iterative procedure, which produces a blurred image <span class="math">\(x^{(N)}\)</span> from
the original sparse image <span class="math">\(x^{(0)}\)</span> by applying
in each iteration step a sparse blurring matrix:</p>
<div class="math">
\[x^{(p)} = S^{(p)} x^{(p - 1)}\ .\]</div>
<p>On each row <span class="math">\(j\)</span> of the matrix <span class="math">\(S^{(p)}\)</span> there
are <span class="math">\(N_j^{(p - 1)}\)</span> nonzero entries whose values
equal <span class="math">\(1/N_j^{(p - 1)}\)</span>. Here <span class="math">\(N_j^{(p - 1)}\)</span> is
the number of immediate neighbors of vertex <span class="math">\(j\)</span> which
had non-zero values at iteration step <span class="math">\(p - 1\)</span>.
Matrix <span class="math">\(S^{(p)}\)</span> thus assigns the average
of the non-zero neighbors as the new value for vertex <span class="math">\(j\)</span>.
One important feature of this procedure is that it tends to preserve
the amplitudes while blurring the surface image.</p>
<p>Once the indices non-zero vertices in <span class="math">\(x^{(0)}\)</span> and
the topology of the triangulation are fixed the matrices <span class="math">\(S^{(p)}\)</span> are
fixed and independent of the data. Therefore, it would be in principle
possible to construct a composite blurring matrix</p>
<div class="math">
\[S^{(N)} = \prod_{p = 1}^N {S^{(p)}}\ .\]</div>
<p>However, it turns out to be computationally more effective
to do blurring with an iteration. The above formula for <span class="math">\(S^{(N)}\)</span> also
shows that the smudging (smoothing) operation is linear.</p>
</div>
<div class="section" id="precomputing-the-morphing-maps">
<span id="chdbbhdh"></span><h2><a class="toc-backref" href="#id4">Precomputing the morphing maps</a><a class="headerlink" href="#precomputing-the-morphing-maps" title="Permalink to this headline">¶</a></h2>
<p>The utility mne_make_morph_maps was
created to assist mne_analyze and mne_make_movie in
morphing. Since the morphing maps described above take a while to
compute, it is beneficial to construct all necessary maps in advance
before using mne_make_movie .
The precomputed morphing maps are located in <code class="docutils literal"><span class="pre">$SUBJECTS_DIR/morph-maps</span></code> . mne_make_morph_maps creates
this directory automatically if it does not exist. If this directory
exists when mne_analyze or mne_make_movie is run
and morphing is requested, the software first looks for already
existing morphing maps there. Also, if mne_analyze or mne_make_movie have
to recompute any morphing maps, they will be saved to <code class="docutils literal"><span class="pre">$SUBJECTS_DIR/morph-maps</span></code> if
this directory exists.</p>
<p>The names of the files in <code class="docutils literal"><span class="pre">$SUBJECTS_DIR/morph-maps</span></code> are
of the form:</p>
<blockquote>
<div>&lt;<em>A</em>&gt; - &lt;<em>B</em>&gt; -<code class="docutils literal"><span class="pre">morph.fif</span></code> ,</div></blockquote>
<p>where &lt;<em>A</em>&gt; and &lt;<em>B</em>&gt; are
names of subjects. These files contain the maps for both hemispheres,
and in both directions, <em>i.e.</em>, both <span class="math">\(M^{(AB)}\)</span> and <span class="math">\(M^{(BA)}\)</span>, as
defined above. Thus the files &lt;<em>A</em>&gt; - &lt;<em>B</em>&gt; -<code class="docutils literal"><span class="pre">morph.fif</span></code> or &lt;<em>B</em>&gt; - &lt;<em>A</em>&gt; -<code class="docutils literal"><span class="pre">morph.fif</span></code> are
functionally equivalent. The name of the file produced by mne_analyze or mne_make_movie depends
on the role of &lt;<em>A</em>&gt; and &lt;<em>B</em>&gt; in
the analysis.</p>
<p>If you choose to compute the morphing maps in batch in advance,
use <a class="reference internal" href="../c_reference.html#mne-make-morph-maps"><span class="std std-ref">mne_make_morph_maps</span></a>.</p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2016, MNE Developers. Last updated on 2016-12-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>