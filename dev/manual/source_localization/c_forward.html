<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The forward solution &#8212; MNE 0.18.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/reset-syntax.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.18.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.18.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../getting_started.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.18.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.17 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">The forward solution</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#meg-eeg-and-mri-coordinate-systems">MEG/EEG and MRI coordinate systems</a></li>
<li><a class="reference internal" href="#the-head-and-device-coordinate-systems">The head and device coordinate systems</a></li>
<li><a class="reference internal" href="#creating-a-surface-based-source-space">Creating a surface-based source space</a></li>
<li><a class="reference internal" href="#creating-a-volumetric-or-discrete-source-space">Creating a volumetric or discrete source space</a></li>
<li><a class="reference internal" href="#creating-the-bem-meshes">Creating the BEM meshes</a><ul>
<li><a class="reference internal" href="#tessellation-file-format">Tessellation file format</a></li>
<li><a class="reference internal" href="#topology-checks">Topology checks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computing-the-bem-geometry-data">Computing the BEM geometry data</a></li>
<li><a class="reference internal" href="#coil-geometry-information">Coil geometry information</a><ul>
<li><a class="reference internal" href="#the-sensor-coordinate-system">The sensor coordinate system</a></li>
<li><a class="reference internal" href="#calculation-of-the-magnetic-field">Calculation of the magnetic field</a></li>
<li><a class="reference internal" href="#implemented-coil-geometries">Implemented coil geometries</a></li>
<li><a class="reference internal" href="#the-coil-definition-file">The coil definition file</a></li>
<li><a class="reference internal" href="#creating-the-coil-definition-file">Creating the coil definition file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computing-the-forward-solution">Computing the forward solution</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
<li><a class="reference internal" href="#implementation-of-software-gradient-compensation">Implementation of software gradient compensation</a></li>
<li><a class="reference internal" href="#the-eeg-sphere-model-definition-file">The EEG sphere model definition file</a></li>
<li><a class="reference internal" href="#eeg-forward-solution-in-the-sphere-model">EEG forward solution in the sphere model</a></li>
<li><a class="reference internal" href="#field-derivatives">Field derivatives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#averaging-forward-solutions">Averaging forward solutions</a><ul>
<li><a class="reference internal" href="#id1">Purpose</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12 content">
      
  <div class="section" id="the-forward-solution">
<span id="c-legacy-ch-forward"></span><h1>The forward solution<a class="headerlink" href="#the-forward-solution" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id10">Overview</a></li>
<li><a class="reference internal" href="#meg-eeg-and-mri-coordinate-systems" id="id11">MEG/EEG and MRI coordinate systems</a></li>
<li><a class="reference internal" href="#the-head-and-device-coordinate-systems" id="id12">The head and device coordinate systems</a></li>
<li><a class="reference internal" href="#creating-a-surface-based-source-space" id="id13">Creating a surface-based source space</a></li>
<li><a class="reference internal" href="#creating-a-volumetric-or-discrete-source-space" id="id14">Creating a volumetric or discrete source space</a></li>
<li><a class="reference internal" href="#creating-the-bem-meshes" id="id15">Creating the BEM meshes</a><ul>
<li><a class="reference internal" href="#tessellation-file-format" id="id16">Tessellation file format</a></li>
<li><a class="reference internal" href="#topology-checks" id="id17">Topology checks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computing-the-bem-geometry-data" id="id18">Computing the BEM geometry data</a></li>
<li><a class="reference internal" href="#coil-geometry-information" id="id19">Coil geometry information</a><ul>
<li><a class="reference internal" href="#the-sensor-coordinate-system" id="id20">The sensor coordinate system</a></li>
<li><a class="reference internal" href="#calculation-of-the-magnetic-field" id="id21">Calculation of the magnetic field</a></li>
<li><a class="reference internal" href="#implemented-coil-geometries" id="id22">Implemented coil geometries</a></li>
<li><a class="reference internal" href="#the-coil-definition-file" id="id23">The coil definition file</a></li>
<li><a class="reference internal" href="#creating-the-coil-definition-file" id="id24">Creating the coil definition file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computing-the-forward-solution" id="id25">Computing the forward solution</a><ul>
<li><a class="reference internal" href="#purpose" id="id26">Purpose</a></li>
<li><a class="reference internal" href="#implementation-of-software-gradient-compensation" id="id27">Implementation of software gradient compensation</a></li>
<li><a class="reference internal" href="#the-eeg-sphere-model-definition-file" id="id28">The EEG sphere model definition file</a></li>
<li><a class="reference internal" href="#eeg-forward-solution-in-the-sphere-model" id="id29">EEG forward solution in the sphere model</a></li>
<li><a class="reference internal" href="#field-derivatives" id="id30">Field derivatives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#averaging-forward-solutions" id="id31">Averaging forward solutions</a><ul>
<li><a class="reference internal" href="#id1" id="id32">Purpose</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id10">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This Chapter covers the definitions of different coordinate
systems employed in MNE software and FreeSurfer, the details of
the computation of the forward solutions, and the associated low-level
utilities.</p>
</div>
<div class="section" id="meg-eeg-and-mri-coordinate-systems">
<span id="c-legacy-chdedfib"></span><h2><a class="toc-backref" href="#id11">MEG/EEG and MRI coordinate systems</a><a class="headerlink" href="#meg-eeg-and-mri-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p>The coordinate systems used in MNE software (and FreeSurfer)
and their relationships are depicted in <a class="reference internal" href="#c-legacy-chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>.
Except for the <em>Sensor coordinates</em>, all of the
coordinate systems are Cartesian and have the “RAS” (Right-Anterior-Superior)
orientation, <em>i.e.</em>, the <span class="math notranslate nohighlight">\(x\)</span> axis
points to the right, the <span class="math notranslate nohighlight">\(y\)</span> axis
to the front, and the <span class="math notranslate nohighlight">\(z\)</span> axis up.</p>
<div class="figure" id="id2">
<span id="c-legacy-chdffjij"></span><img alt="MEG/EEG and MRI coordinate systems" src="../../_images/CoordinateSystems.png" />
<p class="caption"><span class="caption-text">MEG/EEG and MRI coordinate systems</span></p>
<div class="legend">
The coordinate transforms present in the fif files in MNE and the FreeSurfer files as well as those set to fixed values are indicated with <span class="math notranslate nohighlight">\(T_x\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> identifies the transformation.</div>
</div>
<p>The coordinate systems related
to MEG/EEG data are:</p>
<p><strong>Head coordinates</strong></p>
<blockquote>
<div>This is a coordinate system defined with help of the fiducial landmarks
(nasion and the two auricular points). In fif files, EEG electrode
locations are given in this coordinate system. In addition, the head
digitization data acquired in the beginning of an MEG, MEG/EEG,
or EEG acquisition are expressed in head coordinates. For details,
see <a class="reference internal" href="#c-legacy-chdedfib"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>.</div></blockquote>
<p><strong>Device coordinates</strong></p>
<blockquote>
<div>This is a coordinate system tied to the MEG device. The relationship
of the Device and Head coordinates is determined during an MEG measurement
by feeding current to three to five head-position
indicator (HPI) coils and by determining their locations with respect
to the MEG sensor array from the magnetic fields they generate.</div></blockquote>
<p><strong>Sensor coordinates</strong></p>
<blockquote>
<div>Each MEG sensor has a local coordinate system defining the orientation
and location of the sensor. With help of this coordinate system,
the numerical integration data needed for the computation of the
magnetic field can be expressed conveniently as discussed in <a class="reference internal" href="#c-legacy-bjeiaeie"><span class="std std-ref">Coil geometry information</span></a>. The channel information data in the fif files
contain the information to specify the coordinate transformation
between the coordinates of each sensor and the MEG device coordinates.</div></blockquote>
<p>The coordinate systems related
to MRI data are:</p>
<p><strong>Surface RAS coordinates</strong></p>
<blockquote>
<div>The FreeSurfer surface data are expressed in this coordinate system. The
origin of this coordinate system is at the center of the conformed
FreeSurfer MRI volumes (usually 256 x 256 x 256 isotropic 1-mm3  voxels)
and the axes are oriented along the axes of this volume. The BEM
surface and the locations of the sources in the source space are
usually expressed in this coordinate system in the fif files. In
this manual, the <em>Surface RAS coordinates</em> are
usually referred to as <em>MRI coordinates</em> unless
there is need to specifically discuss the different MRI-related
coordinate systems.</div></blockquote>
<p><strong>RAS coordinates</strong></p>
<blockquote>
<div>This coordinate system has axes identical to the Surface RAS coordinates but the location of the origin
is different and defined by the original MRI data, i.e. ,
the origin is in a scanner-dependent location. There is hardly any
need to refer to this coordinate system explicitly in the analysis
with the MNE software. However, since the Talairach coordinates,
discussed below, are defined with respect to <em>RAS coordinates</em> rather
than the <em>Surface RAS coordinates</em>, the RAS coordinate
system is implicitly involved in the transformation between Surface RAS coordinates and the two <em>Talairach</em> coordinate
systems.</div></blockquote>
<p><strong>MNI Talairach coordinates</strong></p>
<blockquote>
<div>The definition of this coordinate system is discussed, e.g. ,
in  <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach">http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach</a>. This
transformation is determined during the FreeSurfer reconstruction
process.</div></blockquote>
<p><strong>FreeSurfer Talairach coordinates</strong></p>
<blockquote>
<div>The problem with the MNI Talairach coordinates is that the linear MNI
Talairach transform does matched the brains completely to the Talairach
brain. This is probably because the Talairach atlas brain is a rather
odd shape, and as a result, it is difficult to match a standard brain
to the atlas brain using an affine transform. As a result, the MNI
brains are slightly larger (in particular higher, deeper and longer)
than the Talairach brain. The differences are larger as you get
further from the middle of the brain, towards the outside. The FreeSurfer
Talairach coordinates mitigate this problem by additing a an additional
transformation, defined separately for negatice and positive MNI
Talairach <span class="math notranslate nohighlight">\(z\)</span> coordinates. These two
transformations, denoted by <span class="math notranslate nohighlight">\(T_-\)</span> and <span class="math notranslate nohighlight">\(T_+\)</span> in <a class="reference internal" href="#c-legacy-chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>, are fixed as discussed in <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach">http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach</a>
(<em>Approach 2</em>).</div></blockquote>
<p>The different coordinate systems are related by coordinate
transformations depicted in <a class="reference internal" href="#c-legacy-chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>. The arrows and
coordinate transformation symbols (<span class="math notranslate nohighlight">\(T_x\)</span>)
indicate the transformations actually present in the FreeSurfer
files. Generally,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
x_2 \\
y_2 \\
z_2 \\
1
\end{bmatrix} = T_{12} \begin{bmatrix}
x_1 \\
y_1 \\
z_1 \\
1
\end{bmatrix} = \begin{bmatrix}
R_{11} &amp; R_{12} &amp; R_{13} &amp; x_0 \\
R_{13} &amp; R_{13} &amp; R_{13} &amp; y_0 \\
R_{13} &amp; R_{13} &amp; R_{13} &amp; z_0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x_1 \\
y_1 \\
z_1 \\
1
\end{bmatrix}\ ,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_k\)</span>,:math:<em class="xref py py-obj">y_k</em>,and <span class="math notranslate nohighlight">\(z_k\)</span> are the location
coordinates in two coordinate systems, <span class="math notranslate nohighlight">\(T_{12}\)</span> is
the coordinate transformation from coordinate system “1” to “2”,
<span class="math notranslate nohighlight">\(x_0\)</span>, <span class="math notranslate nohighlight">\(y_0\)</span>,and <span class="math notranslate nohighlight">\(z_0\)</span> is the location of the origin
of coordinate system “1” in coordinate system “2”,
and <span class="math notranslate nohighlight">\(R_{jk}\)</span> are the elements of the rotation
matrix relating the two coordinate systems. The coordinate transformations
are present in different files produced by FreeSurfer and MNE as
summarized in <a class="reference internal" href="#c-legacy-chdjdedj"><span class="std std-ref">Coordinate transformations in FreeSurfer and MNE software packages.</span></a>. The fixed transformations <span class="math notranslate nohighlight">\(T_-\)</span> and <span class="math notranslate nohighlight">\(T_+\)</span> are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}T_{-} = \begin{bmatrix}
0.99 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0.9688 &amp; 0.042 &amp; 0 \\
0 &amp; -0.0485 &amp; 0.839 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}T_{+} = \begin{bmatrix}
0.99 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0.9688 &amp; 0.046 &amp; 0 \\
0 &amp; -0.0485 &amp; 0.9189 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section does not discuss the transformation    between the MRI voxel indices and the different MRI coordinates.    However, it is important to note that in FreeSurfer, MNE, as well    as in Neuromag software an integer voxel coordinate corresponds    to the location of the center of a voxel. Detailed information on    the FreeSurfer MRI systems can be found at  <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems">https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems</a>.</p>
</div>
<span id="c-legacy-chdjdedj"></span><table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Coordinate transformations in FreeSurfer and MNE software packages.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="30%" />
<col width="31%" />
<col width="38%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Transformation</td>
<td>FreeSurfer</td>
<td>MNE</td>
</tr>
<tr class="row-even"><td><span class="math notranslate nohighlight">\(T_1\)</span></td>
<td>Not present</td>
<td><div class="first last line-block">
<div class="line">Measurement data files</div>
<div class="line">Forward solution files (<em class="xref py py-obj">*fwd.fif</em>)</div>
<div class="line">Inverse operator files (<em class="xref py py-obj">*inv.fif</em>)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><span class="math notranslate nohighlight">\(T_{s_1}\dots T_{s_n}\)</span></td>
<td>Not present</td>
<td>Channel information in files
containing <span class="math notranslate nohighlight">\(T_1\)</span>.</td>
</tr>
<tr class="row-even"><td><span class="math notranslate nohighlight">\(T_2\)</span></td>
<td>Not present</td>
<td><div class="first last line-block">
<div class="line">MRI description files Separate</div>
<div class="line">coordinate transformation files</div>
<div class="line">saved from mne_analyze</div>
<div class="line">Forward solution files</div>
<div class="line">Inverse operator files</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><span class="math notranslate nohighlight">\(T_3\)</span></td>
<td><em class="xref py py-obj">mri/*mgz</em> files</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
<tr class="row-even"><td><span class="math notranslate nohighlight">\(T_4\)</span></td>
<td>mri/transforms/talairach.xfm</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
<tr class="row-odd"><td><span class="math notranslate nohighlight">\(T_-\)</span></td>
<td>Hardcoded in software</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
<tr class="row-even"><td><span class="math notranslate nohighlight">\(T_+\)</span></td>
<td>Hardcoded in software</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The symbols <span class="math notranslate nohighlight">\(T_x\)</span> are defined in <a class="reference internal" href="#c-legacy-chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>. mne_make_cor_set /mne_setup_mri prior to release 2.6 did not include transformations <span class="math notranslate nohighlight">\(T_3\)</span>, <span class="math notranslate nohighlight">\(T_4\)</span>, <span class="math notranslate nohighlight">\(T_-\)</span>, and <span class="math notranslate nohighlight">\(T_+\)</span> in the fif files produced.</p>
</div>
</div>
<div class="section" id="the-head-and-device-coordinate-systems">
<span id="c-legacy-bjebibai"></span><h2><a class="toc-backref" href="#id12">The head and device coordinate systems</a><a class="headerlink" href="#the-head-and-device-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<div class="figure" id="id4">
<img alt="Head coordinate system" src="../../_images/HeadCS.png" />
<p class="caption"><span class="caption-text">The head coordinate system</span></p>
</div>
<p>The MEG/EEG head coordinate system employed in the MNE software
is a right-handed Cartesian coordinate system. The direction of <span class="math notranslate nohighlight">\(x\)</span> axis
is from left to right, that of <span class="math notranslate nohighlight">\(y\)</span> axis
to the front, and the <span class="math notranslate nohighlight">\(z\)</span> axis thus
points up.</p>
<p>The <span class="math notranslate nohighlight">\(x\)</span> axis of the head coordinate
system passes through the two periauricular or preauricular points
digitized before acquiring the data with positive direction to the
right. The <span class="math notranslate nohighlight">\(y\)</span> axis passes through
the nasion and is normal to the <span class="math notranslate nohighlight">\(x\)</span> axis.
The <span class="math notranslate nohighlight">\(z\)</span> axis points up according to
the right-hand rule and is normal to the <span class="math notranslate nohighlight">\(xy\)</span> plane.</p>
<p>The origin of the MEG device coordinate system is device
dependent. Its origin is located approximately at the center of
a sphere which fits the occipital section of the MEG helmet best
with <span class="math notranslate nohighlight">\(x\)</span> axis axis going from left to right
and <span class="math notranslate nohighlight">\(y\)</span> axis pointing front. The <span class="math notranslate nohighlight">\(z\)</span> axis
is, again, normal to the <span class="math notranslate nohighlight">\(xy\)</span> plane
with positive direction up.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above definition is identical to that    of the Neuromag MEG/EEG (head) coordinate system. However, in 4-D    Neuroimaging and CTF MEG systems the head coordinate frame definition    is different. The origin of the coordinate system is at the midpoint    of the left and right auricular points. The <span class="math notranslate nohighlight">\(x\)</span> axis    passes through the nasion and the origin with positive direction    to the front. The <span class="math notranslate nohighlight">\(y\)</span> axis is perpendicular    to the <span class="math notranslate nohighlight">\(x\)</span> axis on the and lies in    the plane defined by the three fiducial landmarks, positive direction    from right to left. The <span class="math notranslate nohighlight">\(z\)</span> axis is    normal to the plane of the landmarks, pointing up. Note that in    this convention the auricular points are not necessarily located    on <span class="math notranslate nohighlight">\(y\)</span> coordinate axis. The file conversion utilities take care of these idiosyncrasies and convert all coordinate information    to the MNE software head coordinate frame.</p>
</div>
</div>
<div class="section" id="creating-a-surface-based-source-space">
<span id="c-legacy-behcgjdd"></span><h2><a class="toc-backref" href="#id13">Creating a surface-based source space</a><a class="headerlink" href="#creating-a-surface-based-source-space" title="Permalink to this headline">¶</a></h2>
<p>The fif format source space files containing the dipole locations
and orientations are created with the utility <a class="reference internal" href="../c_reference.html#mne-make-source-space"><span class="std std-ref">mne_make_source_space</span></a>.
This utility is usually invoked by the convenience script <a class="reference internal" href="../c_reference.html#mne-setup-source-space"><span class="std std-ref">mne_setup_source_space</span></a>,
see <a class="reference internal" href="../cookbook.html#setting-up-source-space"><span class="std std-ref">Setting up the source space</span></a>.</p>
</div>
<div class="section" id="creating-a-volumetric-or-discrete-source-space">
<span id="c-legacy-bjefehji"></span><h2><a class="toc-backref" href="#id14">Creating a volumetric or discrete source space</a><a class="headerlink" href="#creating-a-volumetric-or-discrete-source-space" title="Permalink to this headline">¶</a></h2>
<p>In addition to source spaces confined to a surface, the MNE
software provides some support for three-dimensional source spaces
bounded by a surface as well as source spaces comprised of discrete,
arbitrarily located source points. The <a class="reference internal" href="../c_reference.html#mne-volume-source-space"><span class="std std-ref">mne_volume_source_space</span></a> utility
assists in generating such source spaces.</p>
</div>
<div class="section" id="creating-the-bem-meshes">
<span id="c-legacy-behcaccj"></span><h2><a class="toc-backref" href="#id15">Creating the BEM meshes</a><a class="headerlink" href="#creating-the-bem-meshes" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../c_reference.html#mne-surf2bem"><span class="std std-ref">mne_surf2bem</span></a> utility
converts surface triangle meshes from ASCII and FreeSurfer binary
file formats to the fif format. The resulting fiff file also contains
conductivity information so that it can be employed in the BEM calculations.
See command-line options in <a class="reference internal" href="../c_reference.html#mne-surf2bem"><span class="std std-ref">mne_surf2bem</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The utility <code class="docutils literal notranslate"><span class="pre">mne_tri2fiff</span></code> previously used for this task has been replaced by <a class="reference internal" href="../c_reference.html#mne-surf2bem"><span class="std std-ref">mne_surf2bem</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The convenience script <a class="reference internal" href="../c_reference.html#mne-setup-forward-model"><span class="std std-ref">mne_setup_forward_model</span></a> described in <a class="reference internal" href="../cookbook.html#cihdbfeg"><span class="std std-ref">Setting up the boundary-element model</span></a> calls <a class="reference internal" href="../c_reference.html#mne-surf2bem"><span class="std std-ref">mne_surf2bem</span></a> with the appropriate options.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The vertices of all surfaces should be given in the MRI coordinate system.</p>
</div>
<div class="section" id="tessellation-file-format">
<span id="c-legacy-behdefcd"></span><h3><a class="toc-backref" href="#id16">Tessellation file format</a><a class="headerlink" href="#tessellation-file-format" title="Permalink to this headline">¶</a></h3>
<p>The format of the text format surface files is the following:</p>
<blockquote>
<div><div class="line-block">
<div class="line">&lt;<em>nvert</em>&gt;</div>
<div class="line">&lt;<em>vertex 1</em>&gt;</div>
<div class="line">&lt;<em>vertex 2</em>&gt;</div>
<div class="line">…</div>
<div class="line">&lt;<em>vertex nvert</em>&gt;</div>
<div class="line">&lt;<em>ntri</em>&gt;</div>
<div class="line">&lt;<em>triangle 1</em>&gt;</div>
<div class="line">&lt;<em>triangle 2</em>&gt;</div>
<div class="line">…</div>
<div class="line">&lt;<em>triangle ntri</em>&gt; ,</div>
</div>
</div></blockquote>
<p>where &lt;<em>nvert</em>&gt; and &lt;<em>ntri</em>&gt; are
the number of vertices and number of triangles in the tessellation,
respectively.</p>
<p>The format of a vertex entry is
one of the following:</p>
<p><strong>x y z</strong></p>
<blockquote>
<div>The x, y, and z coordinates of the vertex location are given in
mm.</div></blockquote>
<p><strong>number x y z</strong></p>
<blockquote>
<div>A running number and the x, y, and z coordinates are given. The running
number is not considered by mne_tri2fiff. The nodes must be thus
listed in the correct consecutive order.</div></blockquote>
<p><strong>x y z nx ny nz</strong></p>
<blockquote>
<div>The x, y, and z coordinates as well as the approximate vertex normal direction
cosines are given.</div></blockquote>
<p><strong>number x y z nx ny nz</strong></p>
<blockquote>
<div>A running number is given in addition to the vertex location and vertex
normal.</div></blockquote>
<p>Each triangle entry consists of the numbers of the vertices
belonging to a triangle. The vertex numbering starts from one. The
triangle list may also contain running numbers on each line describing
a triangle.</p>
</div>
<div class="section" id="topology-checks">
<span id="c-legacy-behcbdde"></span><h3><a class="toc-backref" href="#id17">Topology checks</a><a class="headerlink" href="#topology-checks" title="Permalink to this headline">¶</a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">--check</span></code> option is specified, the following
topology checks are performed:</p>
<ul class="simple">
<li>The completeness of each surface is
confirmed by calculating the total solid angle subtended by all
triangles from a point inside the triangulation. The result should
be very close to <span class="math notranslate nohighlight">\(4 \pi\)</span>. If the result
is <span class="math notranslate nohighlight">\(-4 \pi\)</span> instead, it is conceivable
that the ordering of the triangle vertices is incorrect and the
<code class="docutils literal notranslate"><span class="pre">--swap</span></code> option should be specified.</li>
<li>The correct ordering of the surfaces is verified by checking
that the surfaces are inside each other as expected. This is accomplished
by checking that the sum solid angles subtended by triangles of
a surface <span class="math notranslate nohighlight">\(S_k\)</span> at all vertices of another
surface <span class="math notranslate nohighlight">\(S_p\)</span> which is supposed to be
inside it equals <span class="math notranslate nohighlight">\(4 \pi\)</span>. Naturally, this
check is applied only if the model has more than one surface. Since
the surface relations are transitive, it is enough to check that
the outer skull surface is inside the skin surface and that the
inner skull surface is inside the outer skull one.</li>
<li>The extent of each of the triangulated volumes is checked.
If the extent is smaller than 50mm, an error is reported. This
may indicate that the vertex coordinates have been specified in
meters instead of millimeters.</li>
</ul>
</div>
</div>
<div class="section" id="computing-the-bem-geometry-data">
<span id="c-legacy-chdjfheb"></span><h2><a class="toc-backref" href="#id18">Computing the BEM geometry data</a><a class="headerlink" href="#computing-the-bem-geometry-data" title="Permalink to this headline">¶</a></h2>
<p>The utility <a class="reference internal" href="../c_reference.html#mne-prepare-bem-model"><span class="std std-ref">mne_prepare_bem_model</span></a> computes
the geometry information for BEM. This utility is usually invoked
by the convenience script <a class="reference internal" href="../c_reference.html#mne-setup-forward-model"><span class="std std-ref">mne_setup_forward_model</span></a>,
see <a class="reference internal" href="../cookbook.html#cihdbfeg"><span class="std std-ref">Setting up the boundary-element model</span></a>. The command-line options are listed under
<a class="reference internal" href="../c_reference.html#mne-prepare-bem-model"><span class="std std-ref">mne_prepare_bem_model</span></a>.</p>
</div>
<div class="section" id="coil-geometry-information">
<span id="c-legacy-bjeiaeie"></span><h2><a class="toc-backref" href="#id19">Coil geometry information</a><a class="headerlink" href="#coil-geometry-information" title="Permalink to this headline">¶</a></h2>
<p>This Section explains the presentation of MEG detection coil
geometry information the approximations used for different detection
coils in MNE software. Two pieces of information are needed to characterize
the detectors:</p>
<ul class="simple">
<li>The location and orientation a local
coordinate system for each detector.</li>
<li>A unique identifier, which has an one-to-one correspondence
to the geometrical description of the coil.</li>
</ul>
<div class="section" id="the-sensor-coordinate-system">
<h3><a class="toc-backref" href="#id20">The sensor coordinate system</a><a class="headerlink" href="#the-sensor-coordinate-system" title="Permalink to this headline">¶</a></h3>
<p>The sensor coordinate system is completely characterized
by the location of its origin and the direction cosines of three
orthogonal unit vectors pointing to the directions of the x, y,
and z axis. In fact, the unit vectors contain redundant information
because the orientation can be uniquely defined with three angles.
The measurement fif files list these data in MEG device coordinates.
Transformation to the MEG head coordinate frame can be easily accomplished
by applying the device-to-head coordinate transformation matrix
available in the data files provided that the head-position indicator
was used. Optionally, the MNE software forward calculation applies
another coordinate transformation to the head-coordinate data to
bring the coil locations and orientations to the MRI coordinate system.</p>
<p>If <span class="math notranslate nohighlight">\(r_0\)</span> is a row vector for
the origin of the local sensor coordinate system and <span class="math notranslate nohighlight">\(e_x\)</span>, <span class="math notranslate nohighlight">\(e_y\)</span>, and <span class="math notranslate nohighlight">\(e_z\)</span> are the row vectors for the
three orthogonal unit vectors, all given in device coordinates,
a location of a point <span class="math notranslate nohighlight">\(r_C\)</span> in sensor coordinates
is transformed to device coordinates (<span class="math notranslate nohighlight">\(r_D\)</span>)
by</p>
<div class="math notranslate nohighlight">
\[[r_D 1] = [r_C 1] T_{CD}\ ,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}T = \begin{bmatrix}
e_x &amp; 0 \\
e_y &amp; 0 \\
e_z &amp; 0 \\
r_{0D} &amp; 1
\end{bmatrix}\ .\end{split}\]</div>
</div>
<div class="section" id="calculation-of-the-magnetic-field">
<h3><a class="toc-backref" href="#id21">Calculation of the magnetic field</a><a class="headerlink" href="#calculation-of-the-magnetic-field" title="Permalink to this headline">¶</a></h3>
<p>The forward calculation in the MNE software computes the
signals detected by each MEG sensor for three orthogonal dipoles
at each source space location. This requires specification of the
conductor model, the location and orientation of the dipoles, and
the location and orientation of each MEG sensor as well as its coil
geometry.</p>
<p>The output of each SQUID sensor is a weighted sum of the
magnetic fluxes threading the loops comprising the detection coil.
Since the flux threading a coil loop is an integral of the magnetic
field component normal to the coil plane, the output of the k <sup>th</sup>
MEG channel, <span class="math notranslate nohighlight">\(b_k\)</span> can be approximated by:</p>
<div class="math notranslate nohighlight">
\[b_k = \sum_{p = 1}^{N_k} {w_{kp} B(r_{kp}) \cdot n_{kp}}\]</div>
<p>where <span class="math notranslate nohighlight">\(r_{kp}\)</span> are a set of <span class="math notranslate nohighlight">\(N_k\)</span> integration
points covering the pickup coil loops of the sensor, <span class="math notranslate nohighlight">\(B(r_{kp})\)</span> is
the magnetic field due to the current sources calculated at <span class="math notranslate nohighlight">\(r_{kp}\)</span>, <span class="math notranslate nohighlight">\(n_{kp}\)</span> are
the coil normal directions at these points, and <span class="math notranslate nohighlight">\(w_{kp}\)</span> are
the weights associated to the integration points. This formula essentially
presents numerical integration of the magnetic field over the pickup
loops of sensor <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>There are three accuracy levels for the numerical integration
expressed above. The <em>simple</em> accuracy means
the simplest description of the coil. This accuracy is not used
in the MNE forward calculations. The <em>normal</em> or <em>recommended</em> accuracy typically uses
two integration points for planar gradiometers, one in each half
of the pickup coil and four evenly distributed integration points
for magnetometers. This is the default accuracy used by MNE. If
the <code class="docutils literal notranslate"><span class="pre">--accurate</span></code> option is specified, the forward calculation typically employs
a total of eight integration points for planar gradiometers and
sixteen for magnetometers. Detailed information about the integration
points is given in the next section.</p>
</div>
<div class="section" id="implemented-coil-geometries">
<h3><a class="toc-backref" href="#id22">Implemented coil geometries</a><a class="headerlink" href="#implemented-coil-geometries" title="Permalink to this headline">¶</a></h3>
<p>This section describes the coil geometries currently implemented
in Neuromag software. The coil types fall in two general categories:</p>
<ul class="simple">
<li>Axial gradiometers and planar gradiometers
and</li>
<li>Planar magnetometers.</li>
</ul>
<p>For axial sensors, the <em>z</em> axis of the
local coordinate system is parallel to the field component detected, <em>i.e.</em>,
normal to the coil plane.For circular coils, the orientation of
the <em>x</em> and <em>y</em> axes on the
plane normal to the z axis is irrelevant. In the square coils employed
in the Vectorview (TM) system the <em>x</em> axis
is chosen to be parallel to one of the sides of the magnetometer
coil. For planar sensors, the <em>z</em> axis is likewise
normal to the coil plane and the x axis passes through the centerpoints
of the two coil loops so that the detector gives a positive signal
when the normal field component increases along the <em>x</em> axis.</p>
<p><a class="reference internal" href="#c-legacy-bgbbhgec"><span class="std std-ref">Normal coil descriptions.</span></a> lists the parameters of the <em>normal</em> coil
geometry descriptions <a class="reference internal" href="#c-legacy-chdbdfje"><span class="std std-ref">Accurate coil descriptions</span></a> lists the <em>accurate</em> descriptions. For simple accuracy,
please consult the coil definition file, see <a class="reference internal" href="#c-legacy-bjecigeb"><span class="std std-ref">The coil definition file</span></a>.
The columns of the tables contain the following data:</p>
<ul class="simple">
<li>The number identifying the coil id.
This number is used in the coil descriptions found in the FIF files.</li>
<li>Description of the coil.</li>
<li>Number of integration points used</li>
<li>The locations of the integration points in sensor coordinates.</li>
<li>Weights assigned to the field values at the integration points.
Some formulas are listed instead of the numerical values to demonstrate
the principle of the calculation. For example, in the normal coil
descriptions of the planar gradiometers the weights are inverses
of the baseline of the gradiometer to show that the output is in
T/m.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The coil geometry information is stored in the file $MNE_ROOT/share/mne/coil_def.dat, which is automatically created by the utility mne_list_coil_def , see <a class="reference internal" href="#c-legacy-bjehhjij"><span class="std std-ref">Creating the coil definition file</span></a>.</p>
</div>
<span id="c-legacy-bgbbhgec"></span><table border="1" class="docutils" id="id5">
<caption><span class="caption-text">Normal coil descriptions.</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="7%" />
<col width="27%" />
<col width="4%" />
<col width="37%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Id</th>
<th class="head">Description</th>
<th class="head">n</th>
<th class="head">r/mm</th>
<th class="head">w</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2</td>
<td>Neuromag-122
planar gradiometer</td>
<td>2</td>
<td>(+/-8.1, 0, 0) mm</td>
<td>+/-1 ⁄ 16.2mm</td>
</tr>
<tr class="row-odd"><td>2000</td>
<td>A point magnetometer</td>
<td>1</td>
<td>(0, 0, 0)mm</td>
<td>1</td>
</tr>
<tr class="row-even"><td>3012</td>
<td>Vectorview type 1
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-odd"><td>3013</td>
<td>Vectorview type 2
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-even"><td>3022</td>
<td>Vectorview type 1
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>3023</td>
<td>Vectorview type 2
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-even"><td>3024</td>
<td>Vectorview type 3
magnetometer</td>
<td>4</td>
<td>(+/-5.25, +/-5.25, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>2000</td>
<td>An ideal point
magnetometer</td>
<td>1</td>
<td>(0.0, 0.0, 0.0)mm</td>
<td>1</td>
</tr>
<tr class="row-even"><td>4001</td>
<td>Magnes WH
magnetometer</td>
<td>4</td>
<td>(+/-5.75, +/-5.75, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>4002</td>
<td>Magnes WH 3600
axial gradiometer</td>
<td>8</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 50.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>4003</td>
<td>Magnes reference
magnetometer</td>
<td>4</td>
<td>(+/-7.5, +/-7.5, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>4004</td>
<td>Magnes reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-20, +/-20, 0.0)mm
(+/-20, +/-20, 135)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>4005</td>
<td>Magnes reference
gradiometer measuring
off-diagonal gradients</td>
<td>8</td>
<td>(87.5, +/-20, 0.0)mm
(47.5, +/-20, 0.0)mm
(-87.5, +/-20, 0.0)mm
(-47.5, +/-20, 0.0)mm</td>
<td>1/4
-1/4
1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>5001</td>
<td>CTF 275 axial
gradiometer</td>
<td>8</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 50.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>5002</td>
<td>CTF reference
magnetometer</td>
<td>4</td>
<td>(+/-4, +/-4, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>5003</td>
<td>CTF reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-8.6, +/-8.6, 0.0)mm
(+/-8.6, +/-8.6, 78.6)mm</td>
<td>1/4
-1/4</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</p>
</div>
<span id="c-legacy-chdbdfje"></span><table border="1" class="docutils" id="id6">
<caption><span class="caption-text">Accurate coil descriptions</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="7%" />
<col width="27%" />
<col width="4%" />
<col width="37%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Id</th>
<th class="head">Description</th>
<th class="head">n</th>
<th class="head">r/mm</th>
<th class="head">w</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2</td>
<td>Neuromag-122 planar
gradiometer</td>
<td>8</td>
<td>+/-(8.1, 0, 0) mm</td>
<td>+/-1 ⁄ 16.2mm</td>
</tr>
<tr class="row-odd"><td>2000</td>
<td>A point magnetometer</td>
<td>1</td>
<td>(0, 0, 0) mm</td>
<td>1</td>
</tr>
<tr class="row-even"><td>3012</td>
<td>Vectorview type 1
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-odd"><td>3013</td>
<td>Vectorview type 2
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-even"><td>3022</td>
<td>Vectorview type 1
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>3023</td>
<td>Vectorview type 2
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-even"><td>3024</td>
<td>Vectorview type 3
magnetometer</td>
<td>4</td>
<td>(+/-5.25, +/-5.25, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>4001</td>
<td>Magnes WH magnetometer</td>
<td>4</td>
<td>(+/-5.75, +/-5.75, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-even"><td>4002</td>
<td>Magnes WH 3600
axial gradiometer</td>
<td>4</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 0.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>4004</td>
<td>Magnes reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-20, +/-20, 0.0)mm
(+/-20, +/-20, 135)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>4005</td>
<td>Magnes reference
gradiometer measuring
off-diagonal gradients</td>
<td>8</td>
<td>(87.5, +/-20, 0.0)mm
(47.5, +/-20, 0.0)mm
(-87.5, +/-20, 0.0)mm
(-47.5, +/-20, 0.0)mm</td>
<td>1/4
-1/4
1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>5001</td>
<td>CTF 275 axial
gradiometer</td>
<td>8</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 50.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>5002</td>
<td>CTF reference
magnetometer</td>
<td>4</td>
<td>(+/-4, +/-4, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>5003</td>
<td>CTF 275 reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-8.6, +/-8.6, 0.0)mm
(+/-8.6, +/-8.6, 78.6)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>5004</td>
<td>CTF 275 reference
gradiometer measuring
off-diagonal gradients</td>
<td>8</td>
<td>(47.8, +/-8.5, 0.0)mm
(30.8, +/-8.5, 0.0)mm
(-47.8, +/-8.5, 0.0)mm
(-30.8, +/-8.5, 0.0)mm</td>
<td>1/4
-1/4
1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>6001</td>
<td>MIT KIT system axial
gradiometer</td>
<td>8</td>
<td>(+/-3.875, +/-3.875, 0.0)mm
(+/-3.875, +/-3.875, 0.0)mm</td>
<td>1/4
-1/4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-coil-definition-file">
<span id="c-legacy-bjecigeb"></span><h3><a class="toc-backref" href="#id23">The coil definition file</a><a class="headerlink" href="#the-coil-definition-file" title="Permalink to this headline">¶</a></h3>
<p>The coil geometry information is stored in the text file
$MNE_ROOT/share/mne/coil_def.dat. In this file, any lines starting
with the pound sign (#) are comments. A coil definition starts with
a description line containing the following fields:</p>
<p>** &lt;<em>class</em>&gt;**</p>
<blockquote>
<div>This is a number indicating class of this coil. Possible values
are listed in <a class="reference internal" href="#c-legacy-bjefabha"><span class="std std-ref">Coil class values</span></a>.</div></blockquote>
<p>** &lt;<em>id</em>&gt;**</p>
<blockquote>
<div>Coil id value. This value is listed in the first column of Tables <a class="reference internal" href="#c-legacy-bgbbhgec"><span class="std std-ref">Normal coil descriptions.</span></a> and <a class="reference internal" href="#c-legacy-chdbdfje"><span class="std std-ref">Accurate coil descriptions</span></a>.</div></blockquote>
<p>** &lt;<em>accuracy</em>&gt;**</p>
<blockquote>
<div>The coil representation accuracy. Possible values and their meanings
are listed in <a class="reference internal" href="#c-legacy-bjehibjc"><span class="std std-ref">Coil representation accuracies.</span></a>.</div></blockquote>
<p>** &lt;<em>np</em>&gt;**</p>
<blockquote>
<div>Number of integration points in this representation.</div></blockquote>
<p>** &lt;<em>size/m</em>&gt;**</p>
<blockquote>
<div>The size of the coil. For circular coils this is the diameter of
the coil and for square ones the side length of the square. This
information is mainly included to facilitate drawing of the coil
geometry. It should not be employed to infer a coil approximation
for the forward calculations.</div></blockquote>
<p>** &lt;<em>baseline/m</em>&gt;**</p>
<blockquote>
<div>The baseline of a this kind of a coil. This will be zero for magnetometer
coils. This information is mainly included to facilitate drawing
of the coil geometry. It should not be employed to infer a coil
approximation for the forward calculations.</div></blockquote>
<p>** &lt;<em>description</em>&gt;**</p>
<blockquote>
<div>Short description of this kind of a coil. If the description contains several
words, it is enclosed in quotes.</div></blockquote>
<span id="c-legacy-bjefabha"></span><table border="1" class="docutils" id="id7">
<caption><span class="caption-text">Coil class values</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>magnetometer</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>first-order axial gradiometer</td>
</tr>
<tr class="row-even"><td>3</td>
<td>planar gradiometer</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>second-order axial gradiometer</td>
</tr>
<tr class="row-even"><td>1000</td>
<td>an EEG electrode (used internally in software only).</td>
</tr>
</tbody>
</table>
<span id="c-legacy-bjehibjc"></span><table border="1" class="docutils" id="id8">
<caption><span class="caption-text">Coil representation accuracies.</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>The simplest representation available</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>The standard or <em>normal</em> representation (see <a class="reference internal" href="#c-legacy-bgbbhgec"><span class="std std-ref">Normal coil descriptions.</span></a>)</td>
</tr>
<tr class="row-even"><td>3</td>
<td>The most <em>accurate</em> representation available (see <a class="reference internal" href="#c-legacy-chdbdfje"><span class="std std-ref">Accurate coil descriptions</span></a>)</td>
</tr>
</tbody>
</table>
<p>Each coil description line is followed by one or more integration
point lines, consisting of seven numbers:</p>
<p>** &lt;<em>weight</em>&gt;**</p>
<blockquote>
<div>Gives the weight for this integration point (last column in Tables <a class="reference internal" href="#c-legacy-bgbbhgec"><span class="std std-ref">Normal coil descriptions.</span></a> and <a class="reference internal" href="#c-legacy-chdbdfje"><span class="std std-ref">Accurate coil descriptions</span></a>).</div></blockquote>
<p>** &lt;<em>x/m</em>&gt; &lt;<em>y/m</em>&gt; &lt;<em>z/m</em>&gt;**</p>
<blockquote>
<div>Indicates the location of the integration point (fourth column in Tables <a class="reference internal" href="#c-legacy-bgbbhgec"><span class="std std-ref">Normal coil descriptions.</span></a> and <a class="reference internal" href="#c-legacy-chdbdfje"><span class="std std-ref">Accurate coil descriptions</span></a>).</div></blockquote>
<p>** &lt;<em>nx</em>&gt; &lt;<em>ny</em>&gt; &lt;<em>nz</em>&gt;**</p>
<blockquote>
<div>Components of a unit vector indicating the field component to be selected.
Note that listing a separate unit vector for each integration points
allows the implementation of curved coils and coils with the gradiometer
loops tilted with respect to each other.</div></blockquote>
</div>
<div class="section" id="creating-the-coil-definition-file">
<span id="c-legacy-bjehhjij"></span><h3><a class="toc-backref" href="#id24">Creating the coil definition file</a><a class="headerlink" href="#creating-the-coil-definition-file" title="Permalink to this headline">¶</a></h3>
<p>The standard coil definition file $MNE_ROOT/share/mne/coil_def.dat
is included with the MNE software package. The coil definition file
can be recreated with the utility mne_list_coil_def
as follows:</p>
<p>mne_list_coil_def –out $MNE_ROOT/share/mne/coil_def.dat</p>
</div>
</div>
<div class="section" id="computing-the-forward-solution">
<span id="c-legacy-chddibah"></span><h2><a class="toc-backref" href="#id25">Computing the forward solution</a><a class="headerlink" href="#computing-the-forward-solution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="purpose">
<h3><a class="toc-backref" href="#id26">Purpose</a><a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h3>
<p>Instead of using the convenience script <a class="reference internal" href="../c_reference.html#mne-do-forward-solution"><span class="std std-ref">mne_do_forward_solution</span></a> it
is also possible to invoke the forward solution computation program <a class="reference internal" href="../c_reference.html#mne-forward-solution"><span class="std std-ref">mne_forward_solution</span></a> directly.
In this approach, the convenience of the automatic file naming conventions
present in <a class="reference internal" href="../c_reference.html#mne-do-forward-solution"><span class="std std-ref">mne_do_forward_solution</span></a> are
lost. However, there are some special-purpose options available
in <a class="reference internal" href="../c_reference.html#mne-forward-solution"><span class="std std-ref">mne_forward_solution</span></a> only.
Please refer to <a class="reference internal" href="../cookbook.html#babchejd"><span class="std std-ref">Computing the forward solution</span></a> for information on <a class="reference internal" href="../c_reference.html#mne-do-forward-solution"><span class="std std-ref">mne_do_forward_solution</span></a>.
See <a class="reference internal" href="../c_reference.html#mne-forward-solution"><span class="std std-ref">mne_forward_solution</span></a> for command-line options.</p>
</div>
<div class="section" id="implementation-of-software-gradient-compensation">
<h3><a class="toc-backref" href="#id27">Implementation of software gradient compensation</a><a class="headerlink" href="#implementation-of-software-gradient-compensation" title="Permalink to this headline">¶</a></h3>
<p>As described in <a class="reference internal" href="../io.html#behddfbi"><span class="std std-ref">Applying software gradient compensation</span></a> the CTF and 4D Neuroimaging
data may have been subjected to noise cancellation employing the
data from the reference sensor array. Even though these sensor are
rather far away from the brain sources, mne_forward_solution takes
them into account in the computations. If the data file specified
with the <code class="docutils literal notranslate"><span class="pre">--meas</span></code> option has software gradient compensation
activated, mne_forward_solution computes
the field of at the reference sensors in addition to the main MEG
sensor array and computes a compensated forward solution using the
methods described in <a class="reference internal" href="../io.html#behddfbi"><span class="std std-ref">Applying software gradient compensation</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If a data file specified with the <code class="docutils literal notranslate"><span class="pre">--meas</span></code> option    and that used in the actual inverse computations with mne_analyze and mne_make_movie have    different software gradient compensation states., the forward solution    will be in mismatch with the data to be analyzed and the current    estimates will be slightly erroneous.</p>
</div>
</div>
<div class="section" id="the-eeg-sphere-model-definition-file">
<span id="c-legacy-chdiafig"></span><h3><a class="toc-backref" href="#id28">The EEG sphere model definition file</a><a class="headerlink" href="#the-eeg-sphere-model-definition-file" title="Permalink to this headline">¶</a></h3>
<p>For the computation of the electric potential distribution
on the surface of the head (EEG) it is necessary to define the conductivities
(<span class="math notranslate nohighlight">\(\sigma\)</span>) and radiuses of the spherically
symmetric layers. Different sphere models can be specified with
the <code class="docutils literal notranslate"><span class="pre">--eegmodels</span></code> option.</p>
<p>The EEG sphere model definition files may contain comment
lines starting with a # and model
definition lines in the following format:</p>
<blockquote>
<div>&lt;<em>name</em>&gt;: &lt;<em>radius1</em>&gt;: &lt;<em>conductivity1</em>&gt;: &lt;<em>radius2</em>&gt;: &lt;<em>conductivity2</em>&gt;:…</div></blockquote>
<p>When the file is loaded the layers are sorted so that the
radiuses will be in ascending order and the radius of the outermost
layer is scaled to 1.0. The scalp radius specified with the <code class="docutils literal notranslate"><span class="pre">--eegrad</span></code> option
is then consulted to scale the model to the correct dimensions.
Even if the model setup file is not present, a model called Default is
always provided. This model has the structure given in <a class="reference internal" href="#c-legacy-babebgda"><span class="std std-ref">Structure of the default EEG model</span></a></p>
<span id="c-legacy-babebgda"></span><table border="1" class="docutils" id="id9">
<caption><span class="caption-text">Structure of the default EEG model</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="43%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Layer</th>
<th class="head">Relative outer radius</th>
<th class="head"><span class="math notranslate nohighlight">\(\sigma\)</span> (S/m)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Head</td>
<td>1.0</td>
<td>0.33</td>
</tr>
<tr class="row-odd"><td>Skull</td>
<td>0.97</td>
<td>0.04</td>
</tr>
<tr class="row-even"><td>CSF</td>
<td>0.92</td>
<td>1.0</td>
</tr>
<tr class="row-odd"><td>Brain</td>
<td>0.90</td>
<td>0.33</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="eeg-forward-solution-in-the-sphere-model">
<h3><a class="toc-backref" href="#id29">EEG forward solution in the sphere model</a><a class="headerlink" href="#eeg-forward-solution-in-the-sphere-model" title="Permalink to this headline">¶</a></h3>
<p>When the sphere model is employed, the computation of the
EEG solution can be substantially accelerated by using approximation
methods described by Mosher, Zhang, and Berg, see <a class="reference internal" href="../../references.html#cegegdei"><span class="std std-ref">Forward modeling</span></a> (Mosher <em>et
al.</em> and references therein). mne_forward_solution approximates
the solution with three dipoles in a homogeneous sphere whose locations
and amplitudes are determined by minimizing the cost function:</p>
<div class="math notranslate nohighlight">
\[S(r_1,\dotsc,r_m\ ,\ \mu_1,\dotsc,\mu_m) = \int_{scalp} {(V_{true} - V_{approx})}\,dS\]</div>
<p>where <span class="math notranslate nohighlight">\(r_1,\dotsc,r_m\)</span> and <span class="math notranslate nohighlight">\(\mu_1,\dotsc,\mu_m\)</span> are
the locations and amplitudes of the approximating dipoles and <span class="math notranslate nohighlight">\(V_{true}\)</span> and <span class="math notranslate nohighlight">\(V_{approx}\)</span> are
the potential distributions given by the true and approximative
formulas, respectively. It can be shown that this integral can be
expressed in closed form using an expansion of the potentials in
spherical harmonics. The formula is evaluated for the most superficial
dipoles, <em>i.e.</em>, those lying just inside the
inner skull surface.</p>
</div>
<div class="section" id="field-derivatives">
<span id="c-legacy-bjefejjg"></span><h3><a class="toc-backref" href="#id30">Field derivatives</a><a class="headerlink" href="#field-derivatives" title="Permalink to this headline">¶</a></h3>
<p>If the <code class="docutils literal notranslate"><span class="pre">--grad</span></code> option is specified, mne_forward_solution includes
the derivatives of the forward solution with respect to the dipole
location coordinates to the output file. Let</p>
<div class="math notranslate nohighlight">
\[G_k = [g_{xk} g_{yk} g_{zk}]\]</div>
<p>be the <span class="math notranslate nohighlight">\(N_{chan} \times 3\)</span> matrix containing
the signals produced by three orthogonal dipoles at location <span class="math notranslate nohighlight">\(r_k\)</span> making
up <span class="math notranslate nohighlight">\(N_{chan} \times 3N_{source}\)</span> the gain matrix</p>
<div class="math notranslate nohighlight">
\[G = [G_1 \dotso G_{N_{source}}]\ .\]</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">--grad</span></code> option, the output from mne_forward_solution also
contains the <span class="math notranslate nohighlight">\(N_{chan} \times 9N_{source}\)</span> derivative matrix</p>
<div class="math notranslate nohighlight">
\[D = [D_1 \dotso D_{N_{source}}]\ ,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[D_k = [\frac{\delta g_{xk}}{\delta x_k} \frac{\delta g_{xk}}{\delta y_k} \frac{\delta g_{xk}}{\delta z_k} \frac{\delta g_{yk}}{\delta x_k} \frac{\delta g_{yk}}{\delta y_k} \frac{\delta g_{yk}}{\delta z_k} \frac{\delta g_{zk}}{\delta x_k} \frac{\delta g_{zk}}{\delta y_k} \frac{\delta g_{zk}}{\delta z_k}]\ ,\]</div>
<p>where <span class="math notranslate nohighlight">\(x_k\)</span>, <span class="math notranslate nohighlight">\(y_k\)</span>, and <span class="math notranslate nohighlight">\(z_k\)</span> are the location
coordinates of the <span class="math notranslate nohighlight">\(k^{th}\)</span> dipole. If
the dipole orientations are to the cortical normal with the <code class="docutils literal notranslate"><span class="pre">--fixed</span></code>
option, the dimensions of <span class="math notranslate nohighlight">\(G\)</span> and <span class="math notranslate nohighlight">\(D\)</span> are <span class="math notranslate nohighlight">\(N_{chan} \times N_{source}\)</span> and <span class="math notranslate nohighlight">\(N_{chan} \times 3N_{source}\)</span>,
respectively. Both <span class="math notranslate nohighlight">\(G\)</span> and <span class="math notranslate nohighlight">\(D\)</span> can
be read with the mne_read_forward_solution Matlab
function, see Table 10.1.</p>
</div>
</div>
<div class="section" id="averaging-forward-solutions">
<span id="c-legacy-chdbbfca"></span><h2><a class="toc-backref" href="#id31">Averaging forward solutions</a><a class="headerlink" href="#averaging-forward-solutions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id32">Purpose</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>One possibility to make a grand average over several runs
of a experiment is to average the data across runs and average the
forward solutions accordingly. For this purpose, <a class="reference internal" href="../c_reference.html#mne-average-forward-solutions"><span class="std std-ref">mne_average_forward_solutions</span></a> computes a
weighted average of several forward solutions. The program averages both
MEG and EEG forward solutions. Usually the EEG forward solution is
identical across runs because the electrode locations do not change.</p>
</div>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><img src="../../_static/institutions.png" alt="Institutions"></div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-02-02.</p>
  </div>
</footer>
  </body>
</html>