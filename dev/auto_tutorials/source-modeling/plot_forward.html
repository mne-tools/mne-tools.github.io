<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Head model and forward computation &#8212; MNE 0.19.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-code-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-sans-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.19.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.19.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install/index.html">Install</a></li>
                <li><a href="../../overview/index.html">Overview</a></li>
                <li><a href="../index.html">Tutorials</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../install/contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.19.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Head model and forward computation</a><ul>
<li><a class="reference internal" href="#computing-the-forward-operator">Computing the forward operator</a></li>
<li><a class="reference internal" href="#compute-and-visualize-bem-surfaces">Compute and visualize BEM surfaces</a></li>
<li><a class="reference internal" href="#visualization-the-coregistration">Visualization the coregistration</a></li>
<li><a class="reference internal" href="#compute-source-space">Compute Source Space</a></li>
<li><a class="reference internal" href="#compute-forward-solution">Compute forward solution</a></li>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-source-modeling-plot-forward-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="head-model-and-forward-computation">
<span id="tut-forward"></span><span id="sphx-glr-auto-tutorials-source-modeling-plot-forward-py"></span><h1>Head model and forward computation<a class="headerlink" href="#head-model-and-forward-computation" title="Permalink to this headline">¶</a></h1>
<p>The aim of this tutorial is to be a getting started for forward
computation.</p>
<p>For more extensive details and presentation of the general
concepts for forward modeling. See <a class="reference internal" href="../../manual/source_localization/c_forward.html#c-legacy-ch-forward"><span class="std std-ref">The forward solution</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="k">import</span> <span class="n">sample</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">data_path</span></a> <span class="o">=</span> <a href="../../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path" title="View documentation for mne.datasets.sample.data_path"><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>

<span class="c1"># the raw file containing the channel location + types</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">raw_fname</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">data_path</span></a> <span class="o">+</span> <span class="s1">&#39;/MEG/sample/sample_audvis_raw.fif&#39;</span>
<span class="c1"># The paths to Freesurfer reconstructions</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">data_path</span></a> <span class="o">+</span> <span class="s1">&#39;/subjects&#39;</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>
</pre></div>
</div>
<div class="section" id="computing-the-forward-operator">
<h2>Computing the forward operator<a class="headerlink" href="#computing-the-forward-operator" title="Permalink to this headline">¶</a></h2>
<p>To compute a forward operator we need:</p>
<blockquote>
<div><ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">-trans.fif</span></code> file that contains the coregistration info.</p></li>
<li><p>a source space</p></li>
<li><p>the <a class="reference internal" href="../../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> surfaces</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="compute-and-visualize-bem-surfaces">
<h2>Compute and visualize BEM surfaces<a class="headerlink" href="#compute-and-visualize-bem-surfaces" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> surfaces are the triangulations of the interfaces between
different tissues needed for forward computation. These surfaces are for
example the inner skull surface, the outer skull surface and the outer skin
surface, a.k.a. scalp surface.</p>
<p>Computing the BEM surfaces requires FreeSurfer and makes use of either of
the two following command line tools:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../../generated/commands.html#gen-mne-watershed-bem"><span class="std std-ref">mne watershed_bem</span></a></p></li>
<li><p><a class="reference internal" href="../../generated/commands.html#gen-mne-flash-bem"><span class="std std-ref">mne flash_bem</span></a></p></li>
</ul>
</div></blockquote>
<p>Or by calling in a Python script one of the functions
<a class="reference internal" href="../../generated/mne.bem.make_watershed_bem.html#mne.bem.make_watershed_bem" title="mne.bem.make_watershed_bem"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.bem.make_watershed_bem()</span></code></a> or <a class="reference internal" href="../../generated/mne.bem.make_flash_bem.html#mne.bem.make_flash_bem" title="mne.bem.make_flash_bem"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.bem.make_flash_bem()</span></code></a>.</p>
<p>Here we’ll assume it’s already computed. It takes a few minutes per subject.</p>
<p>For EEG we use 3 layers (inner skull, outer skull, and skin) while for
MEG 1 layer (inner skull) is enough.</p>
<p>Let’s look at these surfaces. The function <a class="reference internal" href="../../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="mne.viz.plot_bem"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_bem()</span></code></a>
assumes that you have the the <em>bem</em> folder of your subject FreeSurfer
reconstruction the necessary files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_forward_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_forward_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/inner_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skin.surf
</pre></div>
</div>
</div>
<div class="section" id="visualization-the-coregistration">
<h2>Visualization the coregistration<a class="headerlink" href="#visualization-the-coregistration" title="Permalink to this headline">¶</a></h2>
<p>The coregistration is operation that allows to position the head and the
sensors in a common coordinate system. In the MNE software the transformation
to align the head and the sensors in stored in a so-called <strong>trans file</strong>.
It is a FIF file that ends with <code class="docutils literal notranslate"><span class="pre">-trans.fif</span></code>. It can be obtained with
<a class="reference internal" href="../../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a> (or its convenient command line
equivalent <a class="reference internal" href="../../generated/commands.html#gen-mne-coreg"><span class="std std-ref">mne coreg</span></a>), or mrilab if you’re using a Neuromag
system.</p>
<p>For the Python version see <a class="reference internal" href="../../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a></p>
<p>Here we assume the coregistration is done, so we just visually check the
alignment with the following code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The transformation file obtained by coregistration</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">trans</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">data_path</span></a> <span class="o">+</span> <span class="s1">&#39;/MEG/sample/sample_audvis_raw-trans.fif&#39;</span>

<a href="../../generated/mne.Info.html#mne.Info" title="View documentation for mne.Info"><span class="n">info</span></a> <span class="o">=</span> <a href="../../generated/mne.io.read_info.html#mne.io.read_info" title="View documentation for mne.io.read_info"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_info</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">raw_fname</span></a><span class="p">)</span>
<span class="c1"># Here we look at the dense head, which isn&#39;t used for BEM computations but</span>
<span class="c1"># is useful for coregistration.</span>
<a href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><a href="../../generated/mne.Info.html#mne.Info" title="View documentation for mne.Info"><span class="n">info</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">trans</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <span class="n">dig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">meg</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;helmet&#39;</span><span class="p">,</span> <span class="s1">&#39;sensors&#39;</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                       <span class="n">surfaces</span><span class="o">=</span><span class="s1">&#39;head-dense&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_forward_002.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_forward_002.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    Read a total of 3 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
Using lh.seghead for head surface.
Getting helmet for system 306m
</pre></div>
</div>
</div>
<div class="section" id="compute-source-space">
<span id="plot-forward-source-space"></span><h2>Compute Source Space<a class="headerlink" href="#compute-source-space" title="Permalink to this headline">¶</a></h2>
<p>The source space defines the position and orientation of the candidate source
locations. There are two types of source spaces:</p>
<ul class="simple">
<li><p><strong>source-based</strong> source space when the candidates are confined to a
surface.</p></li>
<li><p><strong>volumetric or discrete</strong> source space when the candidates are discrete,
arbitrarily located source points bounded by the surface.</p></li>
</ul>
<p><strong>Source-based</strong> source space is computed using
<a class="reference internal" href="../../generated/mne.setup_source_space.html#mne.setup_source_space" title="mne.setup_source_space"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.setup_source_space()</span></code></a>, while <strong>volumetric</strong> source space is computed
using <a class="reference internal" href="../../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="mne.setup_volume_source_space"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.setup_volume_source_space()</span></code></a>.</p>
<p>We will now compute a source-based source space with an OCT-6 resolution.
See <a class="reference internal" href="../../manual/cookbook.html#setting-up-source-space"><span class="std std-ref">Setting up the source space</span></a> for details on source space definition
and spacing parameter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a> <span class="o">=</span> <a href="../../generated/mne.setup_source_space.html#mne.setup_source_space" title="View documentation for mne.setup_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_source_space</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;oct6&#39;</span><span class="p">,</span>
                             <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span> <span class="n">add_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up the source space with the following parameters:

SUBJECTS_DIR = /home/circleci/mne_data/MNE-sample-data/subjects
Subject      = sample
Surface      = white
Octahedron subdivision grade 6

&gt;&gt;&gt; 1. Creating the source space...

Doing the octahedral vertex picking...
Loading /home/circleci/mne_data/MNE-sample-data/subjects/sample/surf/lh.white...
Mapping lh sample -&gt; oct (6) ...
    Triangle neighbors and vertex normals...
Loading geometry from /home/circleci/mne_data/MNE-sample-data/subjects/sample/surf/lh.sphere...
Setting up the triangulation for the decimated surface...
loaded lh.white 4098/155407 selected to source space (oct = 6)

Loading /home/circleci/mne_data/MNE-sample-data/subjects/sample/surf/rh.white...
Mapping rh sample -&gt; oct (6) ...
    Triangle neighbors and vertex normals...
Loading geometry from /home/circleci/mne_data/MNE-sample-data/subjects/sample/surf/rh.sphere...
Setting up the triangulation for the decimated surface...
loaded rh.white 4098/156866 selected to source space (oct = 6)

You are now one step closer to computing the gain matrix
&lt;SourceSpaces: [&lt;surface (lh), n_vertices=155407, n_used=4098, coordinate_frame=MRI (surface RAS)&gt;, &lt;surface (rh), n_vertices=156866, n_used=4098, coordinate_frame=MRI (surface RAS)&gt;]&gt;
</pre></div>
</div>
<p>The surface based source space <code class="docutils literal notranslate"><span class="pre">src</span></code> contains two parts, one for the left
hemisphere (4098 locations) and one for the right hemisphere
(4098 locations). Sources can be visualized on top of the BEM surfaces
in purple.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="o">=</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_forward_003.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_forward_003.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/inner_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skin.surf
</pre></div>
</div>
<p>To compute a volume based source space defined with a grid of candidate
dipoles inside a sphere of radius 90mm centered at (0.0, 0.0, 40.0)
you can use the following code.
Obviously here, the sphere is not perfect. It is not restricted to the
brain and it can miss some parts of the cortex.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="View documentation for builtins.tuple"><span class="n">sphere</span></a> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">)</span>
<a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">vol_src</span></a> <span class="o">=</span> <a href="../../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="View documentation for mne.setup_volume_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_volume_source_space</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                                        <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="View documentation for builtins.tuple"><span class="n">sphere</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="View documentation for builtins.tuple"><span class="n">sphere</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">vol_src</span></a><span class="p">)</span>

<a href="../../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="o">=</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">vol_src</span></a><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_forward_004.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_forward_004.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Sphere                : origin at (0.0 0.0 40.0) mm
              radius  : 90.0 mm
grid                  : 5.0 mm
mindist               : 5.0 mm
MRI volume            : /home/circleci/mne_data/MNE-sample-data/subjects/sample/mri/T1.mgz

Setting up the sphere...
Surface CM = (   0.0    0.0   40.0) mm
Surface fits inside a sphere with radius   90.0 mm
Surface extent:
    x =  -90.0 ...   90.0 mm
    y =  -90.0 ...   90.0 mm
    z =  -50.0 ...  130.0 mm
Grid extent:
    x =  -95.0 ...   95.0 mm
    y =  -95.0 ...   95.0 mm
    z =  -50.0 ...  135.0 mm
57798 sources before omitting any.
24365 sources after omitting infeasible sources not within 0.0 - 90.0 mm.
20377 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Adjusting the neighborhood info.
Reading /home/circleci/mne_data/MNE-sample-data/subjects/sample/mri/T1.mgz...
Source space : MRI voxel -&gt; MRI (surface RAS)
     0.005000  0.000000  0.000000     -95.00 mm
     0.000000  0.005000  0.000000     -95.00 mm
     0.000000  0.000000  0.005000     -50.00 mm
     0.000000  0.000000  0.000000       1.00
MRI volume : MRI voxel -&gt; MRI (surface RAS)
    -0.001000  0.000000  0.000000     128.00 mm
     0.000000  0.000000  0.001000    -128.00 mm
     0.000000 -0.001000  0.000000     128.00 mm
     0.000000  0.000000  0.000000       1.00
MRI volume : MRI (surface RAS) -&gt; RAS (non-zero origin)
     1.000000 -0.000000 -0.000000      -5.27 mm
    -0.000000  1.000000 -0.000000       9.04 mm
    -0.000000  0.000000  1.000000     -27.29 mm
     0.000000  0.000000  0.000000       1.00
Setting up interpolation for the whole brain...
 22953600/16777216 nonzero values [done]
&lt;SourceSpaces: [&lt;volume, shape=[39 39 38], n_used=20377, coordinate_frame=MRI (surface RAS)&gt;]&gt;
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/inner_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skin.surf
</pre></div>
</div>
<p>To compute a volume based source space defined with a grid of candidate
dipoles inside the brain (requires the <a class="reference internal" href="../../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> surfaces) you can use the
following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">surface</span></a> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <span class="s1">&#39;bem&#39;</span><span class="p">,</span> <span class="s1">&#39;inner_skull.surf&#39;</span><span class="p">)</span>
<a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">vol_src</span></a> <span class="o">=</span> <a href="../../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="View documentation for mne.setup_volume_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_volume_source_space</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                                        <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">surface</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">surface</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">vol_src</span></a><span class="p">)</span>

<a href="../../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="o">=</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">vol_src</span></a><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_forward_005.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_forward_005.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Boundary surface file : /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/inner_skull.surf
grid                  : 5.0 mm
mindist               : 5.0 mm
MRI volume            : /home/circleci/mne_data/MNE-sample-data/subjects/sample/mri/T1.mgz

Loaded bounding surface from /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/inner_skull.surf (2562 nodes)
Surface CM = (   0.7  -10.0   44.3) mm
Surface fits inside a sphere with radius   91.8 mm
Surface extent:
    x =  -66.7 ...   68.8 mm
    y =  -88.0 ...   79.0 mm
    z =  -44.5 ...  105.8 mm
Grid extent:
    x =  -70.0 ...   70.0 mm
    y =  -90.0 ...   80.0 mm
    z =  -45.0 ...  110.0 mm
32480 sources before omitting any.
22941 sources after omitting infeasible sources not within 0.0 - 91.8 mm.
Source spaces are in MRI coordinates.
Checking that the sources are inside the surface and at least    5.0 mm away (will take a few...)
    Skipping interior check for 2787 sources that fit inside a sphere of radius   43.6 mm
    Skipping solid angle check for 9357 points using Qhull
    10203 source space points omitted because they are outside the inner skull surface.
    2362 source space points omitted because of the    5.0-mm distance limit.
10376 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Adjusting the neighborhood info.
Reading /home/circleci/mne_data/MNE-sample-data/subjects/sample/mri/T1.mgz...
Source space : MRI voxel -&gt; MRI (surface RAS)
     0.005000  0.000000  0.000000     -70.00 mm
     0.000000  0.005000  0.000000     -90.00 mm
     0.000000  0.000000  0.005000     -45.00 mm
     0.000000  0.000000  0.000000       1.00
MRI volume : MRI voxel -&gt; MRI (surface RAS)
    -0.001000  0.000000  0.000000     128.00 mm
     0.000000  0.000000  0.001000    -128.00 mm
     0.000000 -0.001000  0.000000     128.00 mm
     0.000000  0.000000  0.000000       1.00
MRI volume : MRI (surface RAS) -&gt; RAS (non-zero origin)
     1.000000 -0.000000 -0.000000      -5.27 mm
    -0.000000  1.000000 -0.000000       9.04 mm
    -0.000000  0.000000  1.000000     -27.29 mm
     0.000000  0.000000  0.000000       1.00
Setting up interpolation for the whole brain...
 12219600/16777216 nonzero values [done]
&lt;SourceSpaces: [&lt;volume, shape=[29 35 32], n_used=10376, coordinate_frame=MRI (surface RAS)&gt;]&gt;
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/inner_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skull.surf
Using surface: /home/circleci/mne_data/MNE-sample-data/subjects/sample/bem/outer_skin.surf
</pre></div>
</div>
<p>With the surface-based source space only sources that lie in the plotted MRI
slices are shown. Let’s see how to view all sources in 3D.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <a href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">,</span>
                             <span class="n">surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">coord_frame</span><span class="o">=</span><span class="s1">&#39;head&#39;</span><span class="p">,</span>
                             <a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="o">=</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="p">)</span>
<a href="../../generated/mne.viz.set_3d_view.html#mne.viz.set_3d_view" title="View documentation for mne.viz.set_3d_view"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">set_3d_view</span></a><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mf">173.78</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span><span class="mf">101.75</span><span class="p">,</span>
                    <span class="n">distance</span><span class="o">=</span><span class="mf">0.30</span><span class="p">,</span> <span class="n">focalpoint</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_forward_006.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_forward_006.png" />
</div>
<div class="section" id="compute-forward-solution">
<span id="plot-forward-compute-forward-solution"></span><h2>Compute forward solution<a class="headerlink" href="#compute-forward-solution" title="Permalink to this headline">¶</a></h2>
<p>We can now compute the forward solution.
To reduce computation we’ll just compute a single layer BEM (just inner
skull) that can then be used for MEG (not EEG).</p>
<p>We specify if we want a one-layer or a three-layer BEM using the
conductivity parameter.</p>
<p>The BEM solution requires a BEM model which describes the geometry
of the head the conductivities of the different tissues.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="View documentation for builtins.tuple"><span class="n">conductivity</span></a> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,)</span>  <span class="c1"># for single layer</span>
<span class="c1"># conductivity = (0.3, 0.006, 0.3)  # for three layers</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="View documentation for builtins.list"><span class="n">model</span></a> <span class="o">=</span> <a href="../../generated/mne.make_bem_model.html#mne.make_bem_model" title="View documentation for mne.make_bem_model"><span class="n">mne</span><span class="o">.</span><span class="n">make_bem_model</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subject</span></a><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ico</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                           <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="View documentation for builtins.tuple"><span class="n">conductivity</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="View documentation for builtins.tuple"><span class="n">conductivity</span></a><span class="p">,</span>
                           <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">subjects_dir</span></a><span class="p">)</span>
<a href="../../generated/mne.bem.ConductorModel.html#mne.bem.ConductorModel" title="View documentation for mne.bem.ConductorModel"><span class="n">bem</span></a> <span class="o">=</span> <a href="../../generated/mne.make_bem_solution.html#mne.make_bem_solution" title="View documentation for mne.make_bem_solution"><span class="n">mne</span><span class="o">.</span><span class="n">make_bem_solution</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="View documentation for builtins.list"><span class="n">model</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Creating the BEM geometry...
Going from 4th to 4th subdivision of an icosahedron (n_tri: 5120 -&gt; 5120)
inner skull CM is   0.67 -10.01  44.26 mm
Surfaces passed the basic topology checks.
Complete.

Approximation method : Linear collocation

Homogeneous model surface loaded.
Computing the linear collocation solution...
    Matrix coefficients...
        inner skull (2562) -&gt; inner skull (2562) ...
    Inverting the coefficient matrix...
Solution ready.
BEM geometry computations complete.
</pre></div>
</div>
<p>Note that the <a class="reference internal" href="../../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> does not involve any use of the trans file. The BEM
only depends on the head geometry and conductivities.
It is therefore independent from the MEG data and the head position.</p>
<p>Let’s now compute the forward operator, commonly referred to as the
gain or leadfield matrix.</p>
<p>See <a class="reference internal" href="../../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_forward_solution()</span></code></a> for details on parameters meaning.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd</span></a> <span class="o">=</span> <a href="../../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="View documentation for mne.make_forward_solution"><span class="n">mne</span><span class="o">.</span><span class="n">make_forward_solution</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">raw_fname</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">trans</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="View documentation for builtins.str"><span class="n">trans</span></a><span class="p">,</span> <a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="o">=</span><a href="../../generated/mne.SourceSpaces.html#mne.SourceSpaces" title="View documentation for mne.SourceSpaces"><span class="n">src</span></a><span class="p">,</span> <a href="../../generated/mne.bem.ConductorModel.html#mne.bem.ConductorModel" title="View documentation for mne.bem.ConductorModel"><span class="n">bem</span></a><span class="o">=</span><a href="../../generated/mne.bem.ConductorModel.html#mne.bem.ConductorModel" title="View documentation for mne.bem.ConductorModel"><span class="n">bem</span></a><span class="p">,</span>
                                <span class="n">meg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mindist</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Source space          : &lt;SourceSpaces: [&lt;surface (lh), n_vertices=155407, n_used=4098, coordinate_frame=MRI (surface RAS)&gt;, &lt;surface (rh), n_vertices=156866, n_used=4098, coordinate_frame=MRI (surface RAS)&gt;]&gt;
MRI -&gt; head transform : /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw-trans.fif
Measurement data      : sample_audvis_raw.fif
Conductor model   : instance of ConductorModel
Accurate field computations
Do computations in head coordinates
Free source orientations

Read 2 source spaces a total of 8196 active source locations

Coordinate transformation: MRI (surface RAS) -&gt; head
     0.999310  0.009985 -0.035787      -3.17 mm
     0.012759  0.812405  0.582954       6.86 mm
     0.034894 -0.583008  0.811716      28.88 mm
     0.000000  0.000000  0.000000       1.00

Read 306 MEG channels from info
86 coil definitions read
Coordinate transformation: MEG device -&gt; head
     0.991420 -0.039936 -0.124467      -6.13 mm
     0.060661  0.984012  0.167456       0.06 mm
     0.115790 -0.173570  0.977991      64.74 mm
     0.000000  0.000000  0.000000       1.00
MEG coil definitions created in head coordinates.
Source spaces are now in head coordinates.

Employing the head-&gt;MRI coordinate transform with the BEM model.
BEM model instance of ConductorModel is now set up

Source spaces are in head coordinates.
Checking that the sources are inside the surface and at least    5.0 mm away (will take a few...)
    Skipping interior check for 846 sources that fit inside a sphere of radius   43.6 mm
    Skipping solid angle check for 2 points using Qhull
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    3.2s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    3.2s finished
    2 source space points omitted because they are outside the inner skull surface.
    364 source space points omitted because of the    5.0-mm distance limit.
    Skipping interior check for 875 sources that fit inside a sphere of radius   43.6 mm
    Skipping solid angle check for 0 points using Qhull
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    1.8s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    1.8s finished
    1 source space point omitted because it is outside the inner skull surface.
    331 source space point omitted because of the    5.0-mm distance limit.

Setting up compensation data...
    No compensation set. Nothing more to do.

Composing the field computation matrix...
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.8s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.8s finished
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.8s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.8s finished
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.8s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.8s finished
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.2s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    0.2s finished
Computing MEG at 7498 source locations (free orientations)...
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    1.2s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    1.2s finished
[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    1.1s remaining:    0.0s
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    1.1s finished

Finished.
&lt;Forward | MEG channels: 306 | EEG channels: 0 | Source space: Surface with 7498 vertices | Source orientation: Free&gt;
</pre></div>
</div>
<p>We can explore the content of fwd to access the numpy array that contains
the gain matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="View documentation for numpy.ndarray"><span class="n">leadfield</span></a> <span class="o">=</span> <a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd</span></a><span class="p">[</span><span class="s1">&#39;sol&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Leadfield size : </span><span class="si">%d</span><span class="s2"> sensors x </span><span class="si">%d</span><span class="s2"> dipoles&quot;</span> <span class="o">%</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.shape.html#numpy.ndarray.shape" title="View documentation for numpy.ndarray.shape"><span class="n">leadfield</span><span class="o">.</span><span class="n">shape</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Leadfield size : 306 sensors x 22494 dipoles
</pre></div>
</div>
<p>To extract the numpy array containing the forward operator corresponding to
the source space <em class="xref py py-obj">fwd[‘src’]</em> with cortical orientation constraint
we can use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd_fixed</span></a> <span class="o">=</span> <a href="../../generated/mne.convert_forward_solution.html#mne.convert_forward_solution" title="View documentation for mne.convert_forward_solution"><span class="n">mne</span><span class="o">.</span><span class="n">convert_forward_solution</span></a><span class="p">(</span><a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd</span></a><span class="p">,</span> <span class="n">surf_ori</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">use_cps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="View documentation for numpy.ndarray"><span class="n">leadfield</span></a> <span class="o">=</span> <a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd_fixed</span></a><span class="p">[</span><span class="s1">&#39;sol&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Leadfield size : </span><span class="si">%d</span><span class="s2"> sensors x </span><span class="si">%d</span><span class="s2"> dipoles&quot;</span> <span class="o">%</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.shape.html#numpy.ndarray.shape" title="View documentation for numpy.ndarray.shape"><span class="n">leadfield</span><span class="o">.</span><span class="n">shape</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    No patch info available. The standard source space normals will be employed in the rotation to the local surface coordinates....
    Changing to fixed-orientation forward solution with surface-based source orientations...
    [done]
Leadfield size : 306 sensors x 7498 dipoles
</pre></div>
</div>
<p>This is equivalent to the following code that explicitly applies the
forward operator to a source estimate composed of the identity operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># noqa</span>

<a href="https://docs.python.org/3/library/functions.html#int" title="View documentation for builtins.int"><span class="n">n_dipoles</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.shape.html#numpy.ndarray.shape" title="View documentation for numpy.ndarray.shape"><span class="n">leadfield</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="View documentation for builtins.list"><span class="n">vertices</span></a> <span class="o">=</span> <span class="p">[</span><span class="n">src_hemi</span><span class="p">[</span><span class="s1">&#39;vertno&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">src_hemi</span> <span class="ow">in</span> <a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd_fixed</span></a><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]]</span>
<a href="../../generated/mne.SourceEstimate.html#mne.SourceEstimate" title="View documentation for mne.SourceEstimate"><span class="n">stc</span></a> <span class="o">=</span> <a href="../../generated/mne.SourceEstimate.html#mne.SourceEstimate" title="View documentation for mne.SourceEstimate"><span class="n">mne</span><span class="o">.</span><span class="n">SourceEstimate</span></a><span class="p">(</span><span class="mf">1e-9</span> <span class="o">*</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.eye.html#numpy.eye" title="View documentation for numpy.eye"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="View documentation for builtins.int"><span class="n">n_dipoles</span></a><span class="p">),</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="View documentation for builtins.list"><span class="n">vertices</span></a><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tstep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="View documentation for numpy.ndarray"><span class="n">leadfield</span></a> <span class="o">=</span> <a href="../../generated/mne.apply_forward.html#mne.apply_forward" title="View documentation for mne.apply_forward"><span class="n">mne</span><span class="o">.</span><span class="n">apply_forward</span></a><span class="p">(</span><a href="../../generated/mne.Forward.html#mne.Forward" title="View documentation for mne.Forward"><span class="n">fwd_fixed</span></a><span class="p">,</span> <a href="../../generated/mne.SourceEstimate.html#mne.SourceEstimate" title="View documentation for mne.SourceEstimate"><span class="n">stc</span></a><span class="p">,</span> <a href="../../generated/mne.Info.html#mne.Info" title="View documentation for mne.Info"><span class="n">info</span></a><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mf">1e-9</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Projecting source estimate to sensor space...
[done]
</pre></div>
</div>
<p>To save to disk a forward solution you can use
<a class="reference internal" href="../../generated/mne.write_forward_solution.html#mne.write_forward_solution" title="mne.write_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.write_forward_solution()</span></code></a> and to read it back from disk
<a class="reference internal" href="../../generated/mne.read_forward_solution.html#mne.read_forward_solution" title="mne.read_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.read_forward_solution()</span></code></a>. Don’t forget that FIF files containing
forward solution should end with <em>-fwd.fif</em>.</p>
<p>To get a fixed-orientation forward solution, use
<a class="reference internal" href="../../generated/mne.convert_forward_solution.html#mne.convert_forward_solution" title="mne.convert_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.convert_forward_solution()</span></code></a> to convert the free-orientation
solution to (surface-oriented) fixed orientation.</p>
</div>
<div class="section" id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h2>
<p>By looking at
<a class="reference internal" href="../../auto_examples/forward/plot_forward_sensitivity_maps.html#sphx-glr-auto-examples-forward-plot-forward-sensitivity-maps-py"><span class="std std-ref">Display sensitivity maps for EEG and MEG sensors</span></a>
plot the sensitivity maps for EEG and compare it with the MEG, can you
justify the claims that:</p>
<blockquote>
<div><ul class="simple">
<li><p>MEG is not sensitive to radial sources</p></li>
<li><p>EEG is more sensitive to deep sources</p></li>
</ul>
</div></blockquote>
<p>How will the MEG sensitivity maps and histograms change if you use a free
instead if a fixed/surface oriented orientation?</p>
<p>Try this changing the mode parameter in <a class="reference internal" href="../../generated/mne.sensitivity_map.html#mne.sensitivity_map" title="mne.sensitivity_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.sensitivity_map()</span></code></a>
accordingly. Why don’t we see any dipoles on the gyri?</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  14.446 seconds)</p>
<p><strong>Estimated memory usage:</strong>  1167 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-source-modeling-plot-forward-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/bd434692997df3673512e1b5d850a809/plot_forward.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_forward.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/e6e21719275dd1fe5b070e9c49c33bc5/plot_forward.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_forward.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container institutions">
    <a href="https://www.massgeneral.org/"><img class="institution_lg" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a>
    <a href="https://martinos.org/"><img class="institution_lg" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a>
    <a href="https://hms.harvard.edu/"><img class="institution_lg" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a>
    <a href="https://web.mit.edu/"><img class="institution_sm" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a>
    <a href="https://www.nyu.edu/"><img class="institution_md" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a>
    <a href="http://www.cea.fr/"><img class="institution_md" src="../../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a>
    <a href="https://sci.aalto.fi/"><img class="institution_md" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a>
    <a href="https://www.telecom-paris.fr/"><img class="institution_md" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a>
    <a href="https://www.washington.edu/"><img class="institution_sm" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a>
    <a href="https://icm-institute.org/"><img class="institution_lg" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a>
    <a href="https://www.bu.edu/"><img class="institution_sm" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a>
    <a href="https://www.inserm.fr/"><img class="institution_xs" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a>
    <a href="https://www.fz-juelich.de/"><img class="institution_sm" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a>
    <a href="https://www.tu-ilmenau.de/"><img class="institution_sm" src="../../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a>
    <a href="https://bids.berkeley.edu/"><img class="institution_md" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a>
    <a href="https://www.inria.fr/"><img class="institution_sm" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a>
    <a href="https://www.au.dk/"><img class="institution_sm" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a>
    <a href="https://www.uni-graz.at/"><img class="institution_md" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a>
  </div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-09-12.</p>
  </div>
</footer>
  </body>
</html>