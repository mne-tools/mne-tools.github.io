<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Source alignment and coordinate frames &#8212; MNE 0.19.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.19.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.19.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install/index.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../index.html">Tutorials</a></li>
                <li><a href="../../install/contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.19.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Source alignment and coordinate frames</a><ul>
<li><a class="reference internal" href="#understanding-coordinate-frames">Understanding coordinate frames</a><ul>
<li><a class="reference internal" href="#coordinate-frame-definitions">Coordinate frame definitions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-bad-example">A bad example</a></li>
<li><a class="reference internal" href="#a-good-example">A good example</a></li>
<li><a class="reference internal" href="#defining-the-headmri-trans-using-the-gui">Defining the head↔MRI <code class="docutils literal notranslate"><span class="pre">trans</span></code> using the GUI</a></li>
<li><a class="reference internal" href="#alignment-without-mri">Alignment without MRI</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-source-modeling-plot-source-alignment-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="source-alignment-and-coordinate-frames">
<span id="plot-source-alignment"></span><span id="sphx-glr-auto-tutorials-source-modeling-plot-source-alignment-py"></span><h1>Source alignment and coordinate frames<a class="headerlink" href="#source-alignment-and-coordinate-frames" title="Permalink to this headline">¶</a></h1>
<p>The aim of this tutorial is to show how to visually assess that the data are
well aligned in space for computing the forward solution, and understand
the different coordinate frames involved in this process.</p>
<div class="contents local topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#understanding-coordinate-frames" id="id1">Understanding coordinate frames</a></p>
<ul>
<li><p><a class="reference internal" href="#coordinate-frame-definitions" id="id2">Coordinate frame definitions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#a-bad-example" id="id3">A bad example</a></p></li>
<li><p><a class="reference internal" href="#a-good-example" id="id4">A good example</a></p></li>
<li><p><a class="reference internal" href="#defining-the-headmri-trans-using-the-gui" id="id5">Defining the head↔MRI <code class="docutils literal notranslate"><span class="pre">trans</span></code> using the GUI</a></p></li>
<li><p><a class="reference internal" href="#alignment-without-mri" id="id6">Alignment without MRI</a></p></li>
</ul>
</div>
<p>Let’s start out by loading some data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mayavi</span> <span class="k">import</span> <span class="n">mlab</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="k">import</span> <span class="n">sample</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>

<span class="n">data_path</span> <span class="o">=</span> <a href="../../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path" title="View documentation for mne.datasets.sample.data_path"><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<span class="n">subjects_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;subjects&#39;</span><span class="p">)</span>
<span class="n">raw_fname</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_audvis_raw.fif&#39;</span><span class="p">)</span>
<span class="n">trans_fname</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sample_audvis_raw-trans.fif&#39;</span><span class="p">)</span>
<span class="n">raw</span> <span class="o">=</span> <a href="../../generated/mne.io.read_raw_fif.html#mne.io.read_raw_fif" title="View documentation for mne.io.read_raw_fif"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span></a><span class="p">(</span><span class="n">raw_fname</span><span class="p">)</span>
<span class="n">trans</span> <span class="o">=</span> <a href="../../generated/mne.read_trans.html#mne.read_trans" title="View documentation for mne.read_trans"><span class="n">mne</span><span class="o">.</span><span class="n">read_trans</span></a><span class="p">(</span><span class="n">trans_fname</span><span class="p">)</span>
<span class="n">src</span> <span class="o">=</span> <a href="../../generated/mne.read_source_spaces.html#mne.read_source_spaces" title="View documentation for mne.read_source_spaces"><span class="n">mne</span><span class="o">.</span><span class="n">read_source_spaces</span></a><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;bem&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;sample-oct-6-src.fif&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Opening raw data file /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
    Read a total of 3 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
    Range : 25800 ... 192599 =     42.956 ...   320.670 secs
Ready.
Current compensation grade : 0
    Reading a source space...
    Computing patch statistics...
    Patch information added...
    Distance information added...
    [done]
    Reading a source space...
    Computing patch statistics...
    Patch information added...
    Distance information added...
    [done]
    2 source spaces read
</pre></div>
</div>
<div class="section" id="understanding-coordinate-frames">
<h2><a class="toc-backref" href="#id1">Understanding coordinate frames</a><a class="headerlink" href="#understanding-coordinate-frames" title="Permalink to this headline">¶</a></h2>
<p>For M/EEG source imaging, there are three <strong>coordinate frames</strong> that we must
bring into alignment using two 3D
<a class="reference external" href="https://en.wikipedia.org/wiki/Transformation_matrix">transformation matrices</a>
that define how to rotate and translate points in one coordinate frame
to their equivalent locations in another.</p>
<p><a class="reference internal" href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="mne.viz.plot_alignment"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_alignment()</span></code></a> is a very useful function for inspecting
these transformations, and the resulting alignment of EEG sensors, MEG
sensors, brain sources, and conductor models. If the <code class="docutils literal notranslate"><span class="pre">subjects_dir</span></code> and
<code class="docutils literal notranslate"><span class="pre">subject</span></code> parameters are provided, the function automatically looks for the
Freesurfer MRI surfaces to show from the subject’s folder.</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">show_axes</span></code> argument to see the various coordinate frames
given our transformation matrices. These are shown by axis arrows for each
coordinate frame:</p>
<ul class="simple">
<li><p>shortest arrow is (<strong>R</strong>)ight/X</p></li>
<li><p>medium is forward/(<strong>A</strong>)nterior/Y</p></li>
<li><p>longest is up/(<strong>S</strong>)uperior/Z</p></li>
</ul>
<p>i.e., a <strong>RAS</strong> coordinate system in each case. We can also set
the <code class="docutils literal notranslate"><span class="pre">coord_frame</span></code> argument to choose which coordinate
frame the camera should initially be aligned with.</p>
<p>Let’s take a look:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                       <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">surfaces</span><span class="o">=</span><span class="s1">&#39;head-dense&#39;</span><span class="p">,</span>
                       <span class="n">show_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="p">[],</span> <span class="n">meg</span><span class="o">=</span><span class="s1">&#39;sensors&#39;</span><span class="p">,</span>
                       <span class="n">coord_frame</span><span class="o">=</span><span class="s1">&#39;meg&#39;</span><span class="p">)</span>
<a href="http://docs.enthought.com/mayavi/mayavi/auto/mlab_camera.html#mayavi.mlab.view" title="View documentation for mayavi.mlab.view"><span class="n">mlab</span><span class="o">.</span><span class="n">view</span></a><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">focalpoint</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distance from head origin to MEG origin: </span><span class="si">%0.1f</span><span class="s1"> mm&#39;</span>
      <span class="o">%</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.linalg.norm.html#numpy.linalg.norm" title="View documentation for numpy.linalg.norm"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span></a><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;dev_head_t&#39;</span><span class="p">][</span><span class="s1">&#39;trans&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distance from head origin to MRI origin: </span><span class="si">%0.1f</span><span class="s1"> mm&#39;</span>
      <span class="o">%</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.linalg.norm.html#numpy.linalg.norm" title="View documentation for numpy.linalg.norm"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span></a><span class="p">(</span><span class="n">trans</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])))</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_source_alignment_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_source_alignment_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using lh.seghead for head surface.
Distance from head origin to MEG origin: 65.0 mm
Distance from head origin to MRI origin: 29.9 mm
</pre></div>
</div>
<div class="section" id="coordinate-frame-definitions">
<h3><a class="toc-backref" href="#id2">Coordinate frame definitions</a><a class="headerlink" href="#coordinate-frame-definitions" title="Permalink to this headline">¶</a></h3>
<style>
.pink {color:DarkSalmon; font-weight:bold}
.blue {color:DeepSkyBlue; font-weight:bold}
.gray {color:Gray; font-weight:bold}
.magenta {color:Magenta; font-weight:bold}
.purple {color:Indigo; font-weight:bold}
.green {color:LimeGreen; font-weight:bold}
.red {color:Red; font-weight:bold}
</style><ol class="arabic">
<li><dl>
<dt>Neuromag head coordinate frame (“head”, <span class="pink">pink axes</span>)</dt><dd><p>Defined by the intersection of 1) the line between the LPA
(<span class="red">red sphere</span>) and RPA (<span class="purple">purple sphere</span>), and
2) the line perpendicular to this LPA-RPA line one that goes through
the Nasion (<span class="green">green sphere</span>).
The axes are oriented as <strong>X</strong> origin→RPA, <strong>Y</strong> origin→Nasion,
<strong>Z</strong> origin→upward (orthogonal to X and Y).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This gets defined during the head digitization stage during
acquisition, often by use of a Polhemus or other digitizer.</p>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>MEG device coordinate frame (“meg”, <span class="blue">blue axes</span>)</dt><dd><p>This is defined by the MEG manufacturers. From the Elekta user manual:</p>
<blockquote>
<div><p>The origin of the device coordinate system is located at the center
of the posterior spherical section of the helmet with axis going
from left to right and axis pointing front. The axis is, again
normal to the plane with positive direction up.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The device is coregistered with the head coordinate frame
during acquisition via emission of sinusoidal currents in
head position indicator (HPI) coils
(<span class="magenta">magenta spheres</span>) at the beginning of the
recording. This is stored in <code class="docutils literal notranslate"><span class="pre">raw.info['dev_head_t']</span></code>.</p>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>MRI coordinate frame (“mri”, <span class="gray">gray axes</span>)</dt><dd><p>Defined by Freesurfer, the MRI (surface RAS) origin is at the
center of a 256×256×256 1mm anisotropic volume (may not be in the center
of the head).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is aligned to the head coordinate frame that we
typically refer to in MNE as <code class="docutils literal notranslate"><span class="pre">trans</span></code>.</p>
</div>
</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="a-bad-example">
<h2><a class="toc-backref" href="#id3">A bad example</a><a class="headerlink" href="#a-bad-example" title="Permalink to this headline">¶</a></h2>
<p>Let’s try using <code class="docutils literal notranslate"><span class="pre">trans=None</span></code>, which (incorrectly!) equates the MRI
and head coordinate frames.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span>
                       <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">dig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">surfaces</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;head-dense&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">],</span> <span class="n">coord_frame</span><span class="o">=</span><span class="s1">&#39;meg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_source_alignment_002.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_source_alignment_002.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using lh.seghead for head surface.
Getting helmet for system 306m
</pre></div>
</div>
<p>It is quite clear that the MRI surfaces (head, brain) are not well aligned
to the head digitization points (dots).</p>
</div>
<div class="section" id="a-good-example">
<h2><a class="toc-backref" href="#id4">A good example</a><a class="headerlink" href="#a-good-example" title="Permalink to this headline">¶</a></h2>
<p>Here is the same plot, this time with the <code class="docutils literal notranslate"><span class="pre">trans</span></code> properly defined
(using a precomputed matrix).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                       <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">dig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">surfaces</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;head-dense&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">],</span> <span class="n">coord_frame</span><span class="o">=</span><span class="s1">&#39;meg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_source_alignment_003.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_source_alignment_003.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using lh.seghead for head surface.
Getting helmet for system 306m
</pre></div>
</div>
</div>
<div class="section" id="defining-the-headmri-trans-using-the-gui">
<h2><a class="toc-backref" href="#id5">Defining the head↔MRI <code class="docutils literal notranslate"><span class="pre">trans</span></code> using the GUI</a><a class="headerlink" href="#defining-the-headmri-trans-using-the-gui" title="Permalink to this headline">¶</a></h2>
<p>You can try creating the head↔MRI transform yourself using
<a class="reference internal" href="../../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a>.</p>
<ul>
<li><p>First you must load the digitization data from the raw file
(<code class="docutils literal notranslate"><span class="pre">Head</span> <span class="pre">Shape</span> <span class="pre">Source</span></code>). The MRI data is already loaded if you provide the
<code class="docutils literal notranslate"><span class="pre">subject</span></code> and <code class="docutils literal notranslate"><span class="pre">subjects_dir</span></code>. Toggle <code class="docutils literal notranslate"><span class="pre">Always</span> <span class="pre">Show</span> <span class="pre">Head</span> <span class="pre">Points</span></code> to see
the digitization points.</p></li>
<li><p>To set the landmarks, toggle <code class="docutils literal notranslate"><span class="pre">Edit</span></code> radio button in <code class="docutils literal notranslate"><span class="pre">MRI</span> <span class="pre">Fiducials</span></code>.</p></li>
<li><p>Set the landmarks by clicking the radio button (LPA, Nasion, RPA) and then
clicking the corresponding point in the image.</p></li>
<li><p>After doing this for all the landmarks, toggle <code class="docutils literal notranslate"><span class="pre">Lock</span></code> radio button. You
can omit outlier points, so that they don’t interfere with the finetuning.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can save the fiducials to a file and pass
<code class="docutils literal notranslate"><span class="pre">mri_fiducials=True</span></code> to plot them in
<a class="reference internal" href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="mne.viz.plot_alignment"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_alignment()</span></code></a>. The fiducials are saved to the
subject’s bem folder by default.</p>
</div>
</li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Fit</span> <span class="pre">Head</span> <span class="pre">Shape</span></code>. This will align the digitization points to the
head surface. Sometimes the fitting algorithm doesn’t find the correct
alignment immediately. You can try first fitting using LPA/RPA or fiducials
and then align according to the digitization. You can also finetune
manually with the controls on the right side of the panel.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">As...</span></code> (lower right corner of the panel), set the filename
and read it with <a class="reference internal" href="../../generated/mne.read_trans.html#mne.read_trans" title="mne.read_trans"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.read_trans()</span></code></a>.</p></li>
</ul>
<p>For more information, see step by step instructions
<a class="reference external" href="https://www.slideshare.net/mne-python/mnepython-coregistration">in these slides</a>.
Uncomment the following line to align the data yourself.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mne.gui.coregistration(subject=&#39;sample&#39;, subjects_dir=subjects_dir)</span>
</pre></div>
</div>
</div>
<div class="section" id="alignment-without-mri">
<span id="plot-source-alignment-without-mri"></span><h2><a class="toc-backref" href="#id6">Alignment without MRI</a><a class="headerlink" href="#alignment-without-mri" title="Permalink to this headline">¶</a></h2>
<p>The surface alignments above are possible if you have the surfaces available
from Freesurfer. <a class="reference internal" href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="mne.viz.plot_alignment"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_alignment()</span></code></a> automatically searches for
the correct surfaces from the provided <code class="docutils literal notranslate"><span class="pre">subjects_dir</span></code>. Another option is
to use a <a class="reference internal" href="../../manual/source_localization/forward.html#ch-forward-spherical-model"><span class="std std-ref">spherical conductor model</span></a>. It is
passed through <code class="docutils literal notranslate"><span class="pre">bem</span></code> parameter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sphere</span> <span class="o">=</span> <a href="../../generated/mne.make_sphere_model.html#mne.make_sphere_model" title="View documentation for mne.make_sphere_model"><span class="n">mne</span><span class="o">.</span><span class="n">make_sphere_model</span></a><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">r0</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">head_radius</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">src</span> <span class="o">=</span> <a href="../../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="View documentation for mne.setup_volume_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_volume_source_space</span></a><span class="p">(</span><span class="n">sphere</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span>
    <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="s1">&#39;projected&#39;</span><span class="p">,</span> <span class="n">bem</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">dig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">surfaces</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;brain&#39;</span><span class="p">,</span> <span class="s1">&#39;outer_skin&#39;</span><span class="p">],</span> <span class="n">coord_frame</span><span class="o">=</span><span class="s1">&#39;meg&#39;</span><span class="p">,</span> <span class="n">show_axes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_source_alignment_004.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_source_alignment_004.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fitted sphere radius:         91.0 mm
Origin head coordinates:      -4.1 16.0 51.7 mm
Origin device coordinates:    1.4 17.8 -10.3 mm

Equiv. model fitting -&gt; RV = 0.0034856 %
mu1 = 0.944754    lambda1 = 0.137089
mu2 = 0.667504    lambda2 = 0.683819
mu3 = -0.26966    lambda3 = -0.0105378
Set up EEG sphere model with scalp radius    91.0 mm

Sphere                : origin at (-4.1 16.0 51.7) mm
              radius  : 81.9 mm
grid                  : 10.0 mm
mindist               : 5.0 mm

Setting up the sphere...
Surface CM = (  -4.1   16.0   51.7) mm
Surface fits inside a sphere with radius   81.9 mm
Surface extent:
    x =  -86.0 ...   77.8 mm
    y =  -65.9 ...   97.9 mm
    z =  -30.2 ...  133.7 mm
Grid extent:
    x =  -90.0 ...   80.0 mm
    y =  -70.0 ...  100.0 mm
    z =  -40.0 ...  140.0 mm
6156 sources before omitting any.
2300 sources after omitting infeasible sources.
1904 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Adjusting the neighborhood info...
Getting helmet for system 306m
    Triangle neighbors and vertex normals...
</pre></div>
</div>
<p>It is also possible to use <a class="reference internal" href="../../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a>
to warp a subject (usually <code class="docutils literal notranslate"><span class="pre">fsaverage</span></code>) to subject digitization data, see
<a class="reference external" href="https://www.slideshare.net/mne-python/mnepython-scale-mri">these slides</a>.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  21.638 seconds)</p>
<p><strong>Estimated memory usage:</strong>  9 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-source-modeling-plot-source-alignment-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/eb0227c3ab1de2b54936408ce99b7c6e/plot_source_alignment.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_source_alignment.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/71cfddd254cf5ed46db1e09ba59a76f2/plot_source_alignment.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_source_alignment.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><img src="../../_static/institutions.png" alt="Institutions"></div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-06-04.</p>
  </div>
</footer>
  </body>
</html>