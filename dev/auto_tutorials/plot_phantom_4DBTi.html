<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4D Neuroimaging/BTi phantom dataset tutorial &#8212; MNE 0.18.dev0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/reset-syntax.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <script type="text/javascript" src="../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.18.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.18.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Install</a></li>
                <li><a href="../documentation.html">Documentation</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="../glossary.html">Glossary</a></li>
                <li><a href="../auto_examples/index.html">Examples</a></li>
                <li><a href="../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.18.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.17 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">4D Neuroimaging/BTi phantom dataset tutorial</a></li>
</ul>

<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12 content">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-plot-phantom-4dbti-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="d-neuroimaging-bti-phantom-dataset-tutorial">
<span id="sphx-glr-auto-tutorials-plot-phantom-4dbti-py"></span><h1>4D Neuroimaging/BTi phantom dataset tutorial<a class="headerlink" href="#d-neuroimaging-bti-phantom-dataset-tutorial" title="Permalink to this headline">¶</a></h1>
<p>Here we read 4DBTi epochs data obtained with a spherical phantom
using four different dipole locations. For each condition we
compute evoked data and compute dipole fits.</p>
<p>Data are provided by Jean-Michel Badier from MEG center in Marseille, France.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Alex Gramfort &lt;alexandre.gramfort@inria.fr&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="kn">import</span> <span class="n">phantom_4dbti</span>
<span class="kn">import</span> <span class="nn">mne</span>
</pre></div>
</div>
<p>Read data and compute a dipole fit at the peak of the evoked response</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <a href="../generated/mne.datasets.phantom_4dbti.data_path.html#mne.datasets.phantom_4dbti.data_path" title="View documentation for mne.datasets.phantom_4dbti.data_path"><span class="n">phantom_4dbti</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<span class="n">raw_fname</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/e,rfhp1.0Hz&#39;</span><span class="p">)</span>

<span class="n">dipoles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">sphere</span> <span class="o">=</span> <a href="../generated/mne.make_sphere_model.html#mne.make_sphere_model" title="View documentation for mne.make_sphere_model"><span class="n">mne</span><span class="o">.</span><span class="n">make_sphere_model</span></a><span class="p">(</span><span class="n">r0</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">head_radius</span><span class="o">=</span><span class="mf">0.080</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.07</span>  <span class="c1"># peak of the response</span>

<span class="n">pos</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.empty.html#numpy.empty" title="View documentation for numpy.empty"><span class="n">np</span><span class="o">.</span><span class="n">empty</span></a><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">raw</span> <span class="o">=</span> <a href="../generated/mne.io.read_raw_bti.html#mne.io.read_raw_bti" title="View documentation for mne.io.read_raw_bti"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_bti</span></a><span class="p">(</span><span class="n">raw_fname</span> <span class="o">%</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,),</span>
                              <span class="n">rename_channels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A173&#39;</span><span class="p">,</span> <span class="s1">&#39;A213&#39;</span><span class="p">,</span> <span class="s1">&#39;A232&#39;</span><span class="p">]</span>
    <span class="n">events</span> <span class="o">=</span> <a href="../generated/mne.find_events.html#mne.find_events" title="View documentation for mne.find_events"><span class="n">mne</span><span class="o">.</span><span class="n">find_events</span></a><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s1">&#39;TRIGGER&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="mi">4350</span><span class="p">,</span> <span class="n">mask_type</span><span class="o">=</span><span class="s1">&#39;not_and&#39;</span><span class="p">)</span>
    <span class="n">epochs</span> <span class="o">=</span> <a href="../generated/mne.Epochs.html#mne.Epochs" title="View documentation for mne.Epochs"><span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span></a><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="mi">8192</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                        <span class="n">preload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">evoked</span> <span class="o">=</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
    <span class="n">evoked</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">cov</span> <span class="o">=</span> <a href="../generated/mne.compute_covariance.html#mne.compute_covariance" title="View documentation for mne.compute_covariance"><span class="n">mne</span><span class="o">.</span><span class="n">compute_covariance</span></a><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">dip</span> <span class="o">=</span> <a href="../generated/mne.fit_dipole.html#mne.fit_dipole" title="View documentation for mne.fit_dipole"><span class="n">mne</span><span class="o">.</span><span class="n">fit_dipole</span></a><span class="p">(</span><span class="n">evoked</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="p">),</span> <span class="n">cov</span><span class="p">,</span> <span class="n">sphere</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pos</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">dip</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="../_images/sphx_glr_plot_phantom_4DBTi_001.png" class="sphx-glr-multi-img first" src="../_images/sphx_glr_plot_phantom_4DBTi_001.png" />
</li>
<li><img alt="../_images/sphx_glr_plot_phantom_4DBTi_002.png" class="sphx-glr-multi-img first" src="../_images/sphx_glr_plot_phantom_4DBTi_002.png" />
</li>
<li><img alt="../_images/sphx_glr_plot_phantom_4DBTi_003.png" class="sphx-glr-multi-img first" src="../_images/sphx_glr_plot_phantom_4DBTi_003.png" />
</li>
<li><img alt="../_images/sphx_glr_plot_phantom_4DBTi_004.png" class="sphx-glr-multi-img first" src="../_images/sphx_glr_plot_phantom_4DBTi_004.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Equiv. model fitting -&gt; RV = 0.0037285 %
mu1 = 0.943943    lambda1 = 0.139085
mu2 = 0.665517    lambda2 = 0.684836
mu3 = -0.0972643    lambda3 = -0.0135513
Set up EEG sphere model with scalp radius    80.0 mm

Reading 4D PDF file /home/circleci/mne_data/MNE-phantom-4DBTi/1/e,rfhp1.0Hz...
Creating Neuromag info structure ...
... Setting channel info structure.
... putting coil transforms in Neuromag coordinates
... Reading digitization points from /home/circleci/mne_data/MNE-phantom-4DBTi/1/hs_file
... putting digitization points in Neuromag coordinates
... Computing new device to head transform.
Done.
Currently direct inclusion of 4D weight tables is not supported. For critical use cases please take into account the MNE command &quot;mne_create_comp_data&quot; to include weights as printed out by the 4D &quot;print_table&quot; routine.
Current compensation grade : 0
Reading 0 ... 13599  =      0.000 ...    20.052 secs...
Trigger channel has a non-zero initial value of 4350 (consider using initial_event=True to detect this event)
50 events found
Event IDs: [8192]
50 matching events found
Applying baseline correction (mode: mean)
Not setting metadata
0 projection items activated
Loading data for 50 events and 408 original time points ...
2 bad epochs dropped
Creating RawArray with float64 data, n_channels=245, n_times=6576
Current compensation grade : 0
    Range : 0 ... 6575 =      0.000 ...     9.695 secs
Ready.
Using tolerance 3.7e-09 (2.2e-16 eps * 245 dim * 6.9e+04 max  singular value)
Estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
Reducing data rank from 245 -&gt; 245
Estimating covariance using EMPIRICAL
Done.
Number of samples used : 6576
[done]
BEM               : &lt;ConductorModel  |  Sphere (3 layers): r0=[0.0, 0.0, 0.0] R=80 mm&gt;
MRI transform     : identity
Sphere model      : origin at (   0.00    0.00    0.00) mm, rad =    0.1 mm
Guess grid        :   20.0 mm
Guess mindist     :    5.0 mm
Guess exclude     :   20.0 mm
Using standard MEG coil definitions.

Coordinate transformation: MRI (surface RAS) -&gt; head
     1.000000  0.000000  0.000000       0.00 mm
     0.000000  1.000000  0.000000       0.00 mm
     0.000000  0.000000  1.000000       0.00 mm
     0.000000  0.000000  0.000000       1.00
Coordinate transformation: MEG device -&gt; head
     0.975564 -0.033891 -0.217085      -1.50 mm
     0.044586  0.998011  0.044560     -34.72 mm
     0.215143 -0.053150  0.975135      -6.31 mm
     0.000000  0.000000  0.000000       1.00
3 bad channels total
Read 245 MEG channels from info
Read  23 MEG compensation channels from info
84 coil definitions read
Coordinate transformation: MEG device -&gt; head
     0.975564 -0.033891 -0.217085      -1.50 mm
     0.044586  0.998011  0.044560     -34.72 mm
     0.215143 -0.053150  0.975135      -6.31 mm
     0.000000  0.000000  0.000000       1.00
0 compensation data sets in info
MEG coil definitions created in head coordinates.
Decomposing the sensor noise covariance matrix...
Using tolerance 3.9e-14 (2.2e-16 eps * 245 dim * 0.72 max  singular value)
estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
    Created the whitener using a noise covariance matrix with rank 245 (0 small eigenvalues omitted)

---- Computing the forward solution for the guesses...
Making a spherical guess space with radius    72.0 mm...
Filtering (grid =     20 mm)...
Surface CM = (   0.0    0.0    0.0) mm
Surface fits inside a sphere with radius   72.0 mm
Surface extent:
    x =  -72.0 ...   72.0 mm
    y =  -72.0 ...   72.0 mm
    z =  -72.0 ...   72.0 mm
Grid extent:
    x =  -80.0 ...   80.0 mm
    y =  -80.0 ...   80.0 mm
    z =  -80.0 ...   80.0 mm
729 sources before omitting any.
178 sources after omitting infeasible sources.
170 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Go through all guess source locations...
[done 170 sources]
---- Fitted :    69.3 ms
No projector specified for this dataset. Please consider the method self.add_proj.
1 time points fitted
Reading 4D PDF file /home/circleci/mne_data/MNE-phantom-4DBTi/2/e,rfhp1.0Hz...
Creating Neuromag info structure ...
... Setting channel info structure.
... putting coil transforms in Neuromag coordinates
... Reading digitization points from /home/circleci/mne_data/MNE-phantom-4DBTi/2/hs_file
... putting digitization points in Neuromag coordinates
... Computing new device to head transform.
Done.
Currently direct inclusion of 4D weight tables is not supported. For critical use cases please take into account the MNE command &quot;mne_create_comp_data&quot; to include weights as printed out by the 4D &quot;print_table&quot; routine.
Current compensation grade : 0
Reading 0 ... 13599  =      0.000 ...    20.052 secs...
Trigger channel has a non-zero initial value of 4350 (consider using initial_event=True to detect this event)
50 events found
Event IDs: [8192]
50 matching events found
Applying baseline correction (mode: mean)
Not setting metadata
0 projection items activated
Loading data for 50 events and 408 original time points ...
2 bad epochs dropped
Creating RawArray with float64 data, n_channels=245, n_times=6576
Current compensation grade : 0
    Range : 0 ... 6575 =      0.000 ...     9.695 secs
Ready.
Using tolerance 3.5e-09 (2.2e-16 eps * 245 dim * 6.4e+04 max  singular value)
Estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
Reducing data rank from 245 -&gt; 245
Estimating covariance using EMPIRICAL
Done.
Number of samples used : 6576
[done]
BEM               : &lt;ConductorModel  |  Sphere (3 layers): r0=[0.0, 0.0, 0.0] R=80 mm&gt;
MRI transform     : identity
Sphere model      : origin at (   0.00    0.00    0.00) mm, rad =    0.1 mm
Guess grid        :   20.0 mm
Guess mindist     :    5.0 mm
Guess exclude     :   20.0 mm
Using standard MEG coil definitions.

Coordinate transformation: MRI (surface RAS) -&gt; head
     1.000000  0.000000  0.000000       0.00 mm
     0.000000  1.000000  0.000000       0.00 mm
     0.000000  0.000000  1.000000       0.00 mm
     0.000000  0.000000  0.000000       1.00
Coordinate transformation: MEG device -&gt; head
     0.975554 -0.034041 -0.217109      -1.51 mm
     0.044503  0.998063  0.043482     -34.64 mm
     0.215208 -0.052081  0.975178      -6.31 mm
     0.000000  0.000000  0.000000       1.00
3 bad channels total
Read 245 MEG channels from info
Read  23 MEG compensation channels from info
84 coil definitions read
Coordinate transformation: MEG device -&gt; head
     0.975554 -0.034041 -0.217109      -1.51 mm
     0.044503  0.998063  0.043482     -34.64 mm
     0.215208 -0.052081  0.975178      -6.31 mm
     0.000000  0.000000  0.000000       1.00
0 compensation data sets in info
MEG coil definitions created in head coordinates.
Decomposing the sensor noise covariance matrix...
Using tolerance 3.4e-14 (2.2e-16 eps * 245 dim * 0.63 max  singular value)
estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
    Created the whitener using a noise covariance matrix with rank 245 (0 small eigenvalues omitted)

---- Computing the forward solution for the guesses...
Making a spherical guess space with radius    72.0 mm...
Filtering (grid =     20 mm)...
Surface CM = (   0.0    0.0    0.0) mm
Surface fits inside a sphere with radius   72.0 mm
Surface extent:
    x =  -72.0 ...   72.0 mm
    y =  -72.0 ...   72.0 mm
    z =  -72.0 ...   72.0 mm
Grid extent:
    x =  -80.0 ...   80.0 mm
    y =  -80.0 ...   80.0 mm
    z =  -80.0 ...   80.0 mm
729 sources before omitting any.
178 sources after omitting infeasible sources.
170 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Go through all guess source locations...
[done 170 sources]
---- Fitted :    69.3 ms
No projector specified for this dataset. Please consider the method self.add_proj.
1 time points fitted
Reading 4D PDF file /home/circleci/mne_data/MNE-phantom-4DBTi/3/e,rfhp1.0Hz...
Creating Neuromag info structure ...
... Setting channel info structure.
... putting coil transforms in Neuromag coordinates
... Reading digitization points from /home/circleci/mne_data/MNE-phantom-4DBTi/3/hs_file
... putting digitization points in Neuromag coordinates
... Computing new device to head transform.
Done.
Currently direct inclusion of 4D weight tables is not supported. For critical use cases please take into account the MNE command &quot;mne_create_comp_data&quot; to include weights as printed out by the 4D &quot;print_table&quot; routine.
Current compensation grade : 0
Reading 0 ... 13599  =      0.000 ...    20.052 secs...
Trigger channel has a non-zero initial value of 4350 (consider using initial_event=True to detect this event)
50 events found
Event IDs: [8192]
50 matching events found
Applying baseline correction (mode: mean)
Not setting metadata
0 projection items activated
Loading data for 50 events and 408 original time points ...
2 bad epochs dropped
Creating RawArray with float64 data, n_channels=245, n_times=6576
Current compensation grade : 0
    Range : 0 ... 6575 =      0.000 ...     9.695 secs
Ready.
Using tolerance 2.6e-09 (2.2e-16 eps * 245 dim * 4.7e+04 max  singular value)
Estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
Reducing data rank from 245 -&gt; 245
Estimating covariance using EMPIRICAL
Done.
Number of samples used : 6576
[done]
BEM               : &lt;ConductorModel  |  Sphere (3 layers): r0=[0.0, 0.0, 0.0] R=80 mm&gt;
MRI transform     : identity
Sphere model      : origin at (   0.00    0.00    0.00) mm, rad =    0.1 mm
Guess grid        :   20.0 mm
Guess mindist     :    5.0 mm
Guess exclude     :   20.0 mm
Using standard MEG coil definitions.

Coordinate transformation: MRI (surface RAS) -&gt; head
     1.000000  0.000000  0.000000       0.00 mm
     0.000000  1.000000  0.000000       0.00 mm
     0.000000  0.000000  1.000000       0.00 mm
     0.000000  0.000000  0.000000       1.00
Coordinate transformation: MEG device -&gt; head
     0.975577 -0.033678 -0.217061      -1.49 mm
     0.044611  0.997960  0.045666     -34.78 mm
     0.215080 -0.054233  0.975089      -6.31 mm
     0.000000  0.000000  0.000000       1.00
3 bad channels total
Read 245 MEG channels from info
Read  23 MEG compensation channels from info
84 coil definitions read
Coordinate transformation: MEG device -&gt; head
     0.975577 -0.033678 -0.217061      -1.49 mm
     0.044611  0.997960  0.045666     -34.78 mm
     0.215080 -0.054233  0.975089      -6.31 mm
     0.000000  0.000000  0.000000       1.00
0 compensation data sets in info
MEG coil definitions created in head coordinates.
Decomposing the sensor noise covariance matrix...
Using tolerance 1.9e-14 (2.2e-16 eps * 245 dim * 0.34 max  singular value)
estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
    Created the whitener using a noise covariance matrix with rank 245 (0 small eigenvalues omitted)

---- Computing the forward solution for the guesses...
Making a spherical guess space with radius    72.0 mm...
Filtering (grid =     20 mm)...
Surface CM = (   0.0    0.0    0.0) mm
Surface fits inside a sphere with radius   72.0 mm
Surface extent:
    x =  -72.0 ...   72.0 mm
    y =  -72.0 ...   72.0 mm
    z =  -72.0 ...   72.0 mm
Grid extent:
    x =  -80.0 ...   80.0 mm
    y =  -80.0 ...   80.0 mm
    z =  -80.0 ...   80.0 mm
729 sources before omitting any.
178 sources after omitting infeasible sources.
170 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Go through all guess source locations...
[done 170 sources]
---- Fitted :    69.3 ms
No projector specified for this dataset. Please consider the method self.add_proj.
1 time points fitted
Reading 4D PDF file /home/circleci/mne_data/MNE-phantom-4DBTi/4/e,rfhp1.0Hz...
Creating Neuromag info structure ...
... Setting channel info structure.
... putting coil transforms in Neuromag coordinates
... Reading digitization points from /home/circleci/mne_data/MNE-phantom-4DBTi/4/hs_file
... putting digitization points in Neuromag coordinates
... Computing new device to head transform.
Done.
Currently direct inclusion of 4D weight tables is not supported. For critical use cases please take into account the MNE command &quot;mne_create_comp_data&quot; to include weights as printed out by the 4D &quot;print_table&quot; routine.
Current compensation grade : 0
Reading 0 ... 13599  =      0.000 ...    20.052 secs...
Trigger channel has a non-zero initial value of 4350 (consider using initial_event=True to detect this event)
50 events found
Event IDs: [8192]
50 matching events found
Applying baseline correction (mode: mean)
Not setting metadata
0 projection items activated
Loading data for 50 events and 408 original time points ...
2 bad epochs dropped
Creating RawArray with float64 data, n_channels=245, n_times=6576
Current compensation grade : 0
    Range : 0 ... 6575 =      0.000 ...     9.695 secs
Ready.
Using tolerance 2.8e-09 (2.2e-16 eps * 245 dim * 5.1e+04 max  singular value)
Estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
Reducing data rank from 245 -&gt; 245
Estimating covariance using EMPIRICAL
Done.
Number of samples used : 6576
[done]
BEM               : &lt;ConductorModel  |  Sphere (3 layers): r0=[0.0, 0.0, 0.0] R=80 mm&gt;
MRI transform     : identity
Sphere model      : origin at (   0.00    0.00    0.00) mm, rad =    0.1 mm
Guess grid        :   20.0 mm
Guess mindist     :    5.0 mm
Guess exclude     :   20.0 mm
Using standard MEG coil definitions.

Coordinate transformation: MRI (surface RAS) -&gt; head
     1.000000  0.000000  0.000000       0.00 mm
     0.000000  1.000000  0.000000       0.00 mm
     0.000000  0.000000  1.000000       0.00 mm
     0.000000  0.000000  0.000000       1.00
Coordinate transformation: MEG device -&gt; head
     0.975557 -0.033946 -0.217110      -1.50 mm
     0.044391  0.998071  0.043409     -34.60 mm
     0.215218 -0.051986  0.975181      -6.32 mm
     0.000000  0.000000  0.000000       1.00
3 bad channels total
Read 245 MEG channels from info
Read  23 MEG compensation channels from info
84 coil definitions read
Coordinate transformation: MEG device -&gt; head
     0.975557 -0.033946 -0.217110      -1.50 mm
     0.044391  0.998071  0.043409     -34.60 mm
     0.215218 -0.051986  0.975181      -6.32 mm
     0.000000  0.000000  0.000000       1.00
0 compensation data sets in info
MEG coil definitions created in head coordinates.
Decomposing the sensor noise covariance matrix...
Using tolerance 2.1e-14 (2.2e-16 eps * 245 dim * 0.39 max  singular value)
estimated rank (mag): 245
Setting small MAG eigenvalues to zero.
Not doing PCA for MAG.
    Created the whitener using a noise covariance matrix with rank 245 (0 small eigenvalues omitted)

---- Computing the forward solution for the guesses...
Making a spherical guess space with radius    72.0 mm...
Filtering (grid =     20 mm)...
Surface CM = (   0.0    0.0    0.0) mm
Surface fits inside a sphere with radius   72.0 mm
Surface extent:
    x =  -72.0 ...   72.0 mm
    y =  -72.0 ...   72.0 mm
    z =  -72.0 ...   72.0 mm
Grid extent:
    x =  -80.0 ...   80.0 mm
    y =  -80.0 ...   80.0 mm
    z =  -80.0 ...   80.0 mm
729 sources before omitting any.
178 sources after omitting infeasible sources.
170 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
Go through all guess source locations...
[done 170 sources]
---- Fitted :    69.3 ms
No projector specified for this dataset. Please consider the method self.add_proj.
1 time points fitted
</pre></div>
</div>
<p>Compute localisation errors</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">actual_pos</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.array.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">5.13</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="mf">4.15</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">3.19</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">2.26</span><span class="p">]])</span>
<span class="n">actual_pos</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.dot.html#numpy.dot" title="View documentation for numpy.dot"><span class="n">np</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">actual_pos</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="n">errors</span> <span class="o">=</span> <span class="mf">1e3</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.linalg.norm.html#numpy.linalg.norm" title="View documentation for numpy.linalg.norm"><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span></a><span class="p">(</span><span class="n">actual_pos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;errors (mm) : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>errors (mm) : [1.423016 1.38235  1.257026 1.176165]
</pre></div>
</div>
<p>Plot the dipoles in 3D</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
    <a href="http://docs.enthought.com/mayavi/mayavi/auto/mlab_helper_functions.html#mayavi.mlab.points3d" title="View documentation for mayavi.mlab.points3d"><span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span></a><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>


<a href="../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><span class="n">evoked</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">bem</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">surfaces</span><span class="o">=</span><span class="p">[])</span>
<span class="c1"># Plot the position of the actual dipole</span>
<span class="n">plot_pos</span><span class="p">(</span><span class="n">actual_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
<span class="c1"># Plot the position of the estimated dipole</span>
<span class="n">plot_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_phantom_4DBTi_005.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_phantom_4DBTi_005.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Getting helmet for system Magnes_3600wh
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  11.268 seconds)</p>
<p><strong>Estimated memory usage:</strong>  8 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-plot-phantom-4dbti-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/96bd8d8c8196a1769ef86d1ea07a5539/plot_phantom_4DBTi.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_phantom_4DBTi.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/f416186dd76330f25a927d0cb57dfc12/plot_phantom_4DBTi.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_phantom_4DBTi.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><img src="../_static/institutions.png" alt="Institutions"></div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-02-20.</p>
  </div>
</footer>
  </body>
</html>