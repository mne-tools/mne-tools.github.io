<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Background on projectors and projections &#8212; MNE 0.19.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-code-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-sans-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.19.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.19.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install/index.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../index.html">Tutorials</a></li>
                <li><a href="../../install/contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.19.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Background on projectors and projections</a><ul>
<li><a class="reference internal" href="#what-is-a-projection">What is a projection?</a><ul>
<li><a class="reference internal" href="#example-projection-as-noise-reduction">Example: projection as noise reduction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#signal-space-projection-ssp">Signal-space projection (SSP)</a></li>
<li><a class="reference internal" href="#projectors-in-mne-python">Projectors in MNE-Python</a><ul>
<li><a class="reference internal" href="#visualizing-the-effect-of-projectors">Visualizing the effect of projectors</a></li>
<li><a class="reference internal" href="#loading-and-saving-projectors">Loading and saving projectors</a></li>
<li><a class="reference internal" href="#adding-and-removing-projectors">Adding and removing projectors</a></li>
<li><a class="reference internal" href="#when-are-projectors-applied">When are projectors “applied”?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-intro-plot-40-projectors-background-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="background-on-projectors-and-projections">
<span id="tut-projectors-background"></span><span id="sphx-glr-auto-tutorials-intro-plot-40-projectors-background-py"></span><h1>Background on projectors and projections<a class="headerlink" href="#background-on-projectors-and-projections" title="Permalink to this headline">¶</a></h1>
<p>This tutorial provides background information on projectors and Signal Space
Projection (SSP), and covers loading and saving projectors, adding and removing
projectors from Raw objects, the difference between “applied” and “unapplied”
projectors, and at what stages MNE-Python applies projectors automatically.</p>
<div class="contents local topic" id="page-contents">
<p class="topic-title first">Page contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-is-a-projection" id="id3">What is a projection?</a></p>
<ul>
<li><p><a class="reference internal" href="#example-projection-as-noise-reduction" id="id4">Example: projection as noise reduction</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#signal-space-projection-ssp" id="id5">Signal-space projection (SSP)</a></p></li>
<li><p><a class="reference internal" href="#projectors-in-mne-python" id="id6">Projectors in MNE-Python</a></p>
<ul>
<li><p><a class="reference internal" href="#visualizing-the-effect-of-projectors" id="id7">Visualizing the effect of projectors</a></p></li>
<li><p><a class="reference internal" href="#loading-and-saving-projectors" id="id8">Loading and saving projectors</a></p></li>
<li><p><a class="reference internal" href="#adding-and-removing-projectors" id="id9">Adding and removing projectors</a></p></li>
<li><p><a class="reference internal" href="#when-are-projectors-applied" id="id10">When are projectors “applied”?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id11">References</a></p></li>
</ul>
</div>
<p>We’ll start by importing the Python modules we need; we’ll also define a short
function to make it easier to make several plots that look similar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="k">import</span> <a href="https://scipy.github.io/devdocs/generated/scipy.linalg.svd.html#scipy.linalg.svd" title="View documentation for scipy.linalg.svd"><span class="n">svd</span></a>
<span class="kn">import</span> <span class="nn">mne</span>


<span class="k">def</span> <span class="nf">setup_3d_axes</span><span class="p">():</span>
    <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.axes.html#matplotlib.pyplot.axes" title="View documentation for matplotlib.pyplot.axes"><span class="n">plt</span><span class="o">.</span><span class="n">axes</span></a><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=-</span><span class="mi">105</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>
</div>
<div class="section" id="what-is-a-projection">
<h2><a class="toc-backref" href="#id3">What is a projection?</a><a class="headerlink" href="#what-is-a-projection" title="Permalink to this headline">¶</a></h2>
<p>In the most basic terms, a <em>projection</em> is an operation that converts one set
of points into another set of points, where repeating the projection
operation on the resulting points has no effect. To give a simple geometric
example, imagine the point <span class="math notranslate nohighlight">\((3, 2, 5)\)</span> in 3-dimensional space. A
projection of that point onto the <span class="math notranslate nohighlight">\(x, y\)</span> plane looks a lot like a
shadow cast by that point if the sun were directly above it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">setup_3d_axes</span><span class="p">()</span>

<span class="c1"># plot the vector (3, 2, 5)</span>
<span class="n">origin</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.zeros.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">point</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.array.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
<span class="n">vector</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.hstack.html#numpy.hstack" title="View documentation for numpy.hstack"><span class="n">np</span><span class="o">.</span><span class="n">hstack</span></a><span class="p">([</span><span class="n">origin</span><span class="p">,</span> <span class="n">point</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">vector</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># project the vector onto the x,y plane and plot it</span>
<span class="n">xy_projection_matrix</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.array.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">projected_point</span> <span class="o">=</span> <span class="n">xy_projection_matrix</span> <span class="o">@</span> <span class="n">point</span>
<span class="n">projected_vector</span> <span class="o">=</span> <span class="n">xy_projection_matrix</span> <span class="o">@</span> <span class="n">vector</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">projected_vector</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">projected_point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># add dashed arrow showing projection</span>
<span class="n">arrow_coords</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.concatenate.html#numpy.concatenate" title="View documentation for numpy.concatenate"><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span></a><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="n">projected_point</span> <span class="o">-</span> <span class="n">point</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">quiver3D</span><span class="p">(</span><span class="o">*</span><span class="n">arrow_coords</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_40_projectors_background_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_40_projectors_background_001.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol indicates matrix multiplication on NumPy arrays, and was
introduced in Python 3.5 / NumPy 1.10. The notation <code class="docutils literal notranslate"><span class="pre">plot(*point)</span></code> uses
Python <a class="reference external" href="https://docs.python.org/3/tutorial/controlflow.html#tut-unpacking-arguments">argument expansion</a> to “unpack” the elements of <code class="docutils literal notranslate"><span class="pre">point</span></code> into
separate positional arguments to the function. In other words,
<code class="docutils literal notranslate"><span class="pre">plot(*point)</span></code> expands to <code class="docutils literal notranslate"><span class="pre">plot(3,</span> <span class="pre">2,</span> <span class="pre">5)</span></code>.</p>
</div>
<p>Notice that we used matrix multiplication to compute the projection of our
point <span class="math notranslate nohighlight">\((3, 2, 5)\)</span> plane:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left[
  \begin{matrix} 1 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{matrix}
\right]
\left[ \begin{matrix} 3 \\ 2 \\ 5 \end{matrix} \right] =
\left[ \begin{matrix} 3 \\ 2 \\ 0 \end{matrix} \right]\end{split}\]</div>
<p>…and that applying the projection again to the result just gives back the
result again:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left[
  \begin{matrix} 1 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{matrix}
\right]
\left[ \begin{matrix} 3 \\ 2 \\ 0 \end{matrix} \right] =
\left[ \begin{matrix} 3 \\ 2 \\ 0 \end{matrix} \right]\end{split}\]</div>
<p>From an information perspective, this projection has taken the point
<span class="math notranslate nohighlight">\(x, y, z\)</span> and removed the information about how far in the <span class="math notranslate nohighlight">\(z\)</span>
direction our point was located; all we know now is its position in the
<span class="math notranslate nohighlight">\(x, y\)</span> plane. Moreover, applying our projection matrix to <em>any point</em>
in <span class="math notranslate nohighlight">\(x, y, z\)</span> space will reduce it to a corresponding point on the
<span class="math notranslate nohighlight">\(x, y\)</span> plane. The term for this is a <em>subspace</em>: the projection matrix
projects points in the original space into a <em>subspace</em> of lower dimension
than the original. The reason our subspace is the <span class="math notranslate nohighlight">\(x,y\)</span> plane (instead
of, say, the <span class="math notranslate nohighlight">\(y,z\)</span> plane) is a direct result of the particular values
in our projection matrix.</p>
<div class="section" id="example-projection-as-noise-reduction">
<h3><a class="toc-backref" href="#id4">Example: projection as noise reduction</a><a class="headerlink" href="#example-projection-as-noise-reduction" title="Permalink to this headline">¶</a></h3>
<p>Another way to describe this “loss of information” or “projection into a
subspace” is to say that projection reduces the rank (or “degrees of
freedom”) of the measurement — here, from 3 dimensions down to 2. On the
other hand, if you know that measurement component in the <span class="math notranslate nohighlight">\(z\)</span> direction
is just noise due to your measurement method, and all you care about are the
<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> components, then projecting your 3-dimensional
measurement into the <span class="math notranslate nohighlight">\(x, y\)</span> plane could be seen as a form of noise
reduction.</p>
<p>Of course, it would be very lucky indeed if all the measurement noise were
concentrated in the <span class="math notranslate nohighlight">\(z\)</span> direction; you could just discard the <span class="math notranslate nohighlight">\(z\)</span>
component without bothering to construct a projection matrix or do the matrix
multiplication. Suppose instead that in order to take that measurement you
had to pull a trigger on a measurement device, and the act of pulling the
trigger causes the device to move a little. If you measure how
trigger-pulling affects measurement device position, you could then “correct”
your real measurements to “project out” the effect of the trigger pulling.
Here we’ll suppose that the average effect of the trigger is to move the
measurement device by <span class="math notranslate nohighlight">\((3, -1, 1)\)</span>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trigger_effect</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.array.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>Knowing that, we can compute a plane that is orthogonal to the effect of the
trigger (using the fact that a plane through the origin has equation
<span class="math notranslate nohighlight">\(Ax + By + Cz = 0\)</span> given a normal vector <span class="math notranslate nohighlight">\((A, B, C)\)</span>), and
project our real measurements onto that plane.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute the plane orthogonal to trigger_effect</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.meshgrid.html#numpy.meshgrid" title="View documentation for numpy.meshgrid"><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.linspace.html#numpy.linspace" title="View documentation for numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">61</span><span class="p">),</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.linspace.html#numpy.linspace" title="View documentation for numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
<span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">trigger_effect</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">A</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">B</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">C</span>
<span class="c1"># cut off the plane below z=0 (just to make the plot nicer)</span>
<span class="n">mask</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="View documentation for numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
<p>Computing the projection matrix from the <code class="docutils literal notranslate"><span class="pre">trigger_effect</span></code> vector is done
using <a class="reference external" href="https://en.wikipedia.org/wiki/Singular_value_decomposition">singular value decomposition</a> (SVD); interested readers may
consult the internet or a linear algebra textbook for details on this method.
With the projection matrix in place, we can project our original vector
<span class="math notranslate nohighlight">\((3, 2, 5)\)</span> to remove the effect of the trigger, and then plot it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_number = 2</span>
<span class="c1"># compute the projection matrix</span>
<span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.linalg.svd.html#scipy.linalg.svd" title="View documentation for scipy.linalg.svd"><span class="n">svd</span></a><span class="p">(</span><span class="n">trigger_effect</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">trigger_projection_matrix</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.eye.html#numpy.eye" title="View documentation for numpy.eye"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span> <span class="o">@</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># project the vector onto the orthogonal plane</span>
<span class="n">projected_point</span> <span class="o">=</span> <span class="n">trigger_projection_matrix</span> <span class="o">@</span> <span class="n">point</span>
<span class="n">projected_vector</span> <span class="o">=</span> <span class="n">trigger_projection_matrix</span> <span class="o">@</span> <span class="n">vector</span>

<span class="c1"># plot the trigger effect and its orthogonal plane</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">setup_3d_axes</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">quiver3D</span><span class="p">(</span><span class="o">*</span><a href="https://numpy.org/devdocs/reference/generated/numpy.concatenate.html#numpy.concatenate" title="View documentation for numpy.concatenate"><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span></a><span class="p">([</span><span class="n">origin</span><span class="p">,</span> <span class="n">trigger_effect</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># plot the original vector</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">vector</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.full.html#numpy.full" title="View documentation for numpy.full"><span class="n">np</span><span class="o">.</span><span class="n">full</span></a><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">point</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="o">.</span><span class="n">flat</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># plot the projected vector</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">projected_vector</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">projected_point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.full.html#numpy.full" title="View documentation for numpy.full"><span class="n">np</span><span class="o">.</span><span class="n">full</span></a><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">projected_point</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span>
        <span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">projected_point</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># add dashed arrow showing projection</span>
<span class="n">arrow_coords</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.concatenate.html#numpy.concatenate" title="View documentation for numpy.concatenate"><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span></a><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="n">projected_point</span> <span class="o">-</span> <span class="n">point</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">quiver3D</span><span class="p">(</span><span class="o">*</span><span class="n">arrow_coords</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">arrow_length_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_40_projectors_background_002.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_40_projectors_background_002.png" />
<p>Just as before, the projection matrix will map <em>any point</em> in <span class="math notranslate nohighlight">\(x, y, z\)</span>
space onto that plane, and once a point has been projected onto that plane,
applying the projection again will have no effect. For that reason, it should
be clear that although the projected points vary in all three <span class="math notranslate nohighlight">\(x\)</span>,
<span class="math notranslate nohighlight">\(y\)</span>, and <span class="math notranslate nohighlight">\(z\)</span> directions, the set of projected points have only
two <em>effective</em> dimensions (i.e., they are constrained to a plane).</p>
<div class="sidebar">
<p class="sidebar-title">Terminology</p>
<p>In MNE-Python, the matrix used to project a raw signal into a subspace is
usually called a <a class="reference internal" href="../../glossary.html#term-projector"><span class="xref std std-term">projector</span></a> or a <em>projection
operator</em> — these terms are interchangeable with the term <em>projection
matrix</em> used above.</p>
</div>
<p>Projections of EEG or MEG signals work in very much the same way: the point
<span class="math notranslate nohighlight">\(x, y, z\)</span> corresponds to the value of each sensor at a single time
point, and the projection matrix varies depending on what aspects of the
signal (i.e., what kind of noise) you are trying to project out. The only
real difference is that instead of a single 3-dimensional point <span class="math notranslate nohighlight">\((x, y,
z)\)</span> you’re dealing with a time series of <span class="math notranslate nohighlight">\(N\)</span>-dimensional “points” (one
at each sampling time), where <span class="math notranslate nohighlight">\(N\)</span> is usually in the tens or hundreds
(depending on how many sensors your EEG/MEG system has). Fortunately, because
projection is a matrix operation, it can be done very quickly even on signals
with hundreds of dimensions and tens of thousands of time points.</p>
</div>
</div>
<div class="section" id="signal-space-projection-ssp">
<span id="ssp-tutorial"></span><h2><a class="toc-backref" href="#id5">Signal-space projection (SSP)</a><a class="headerlink" href="#signal-space-projection-ssp" title="Permalink to this headline">¶</a></h2>
<p>We mentioned above that the projection matrix will vary depending on what
kind of noise you are trying to project away. Signal-space projection (SSP)
<a class="footnote-reference brackets" href="#id2" id="id1">1</a> is a way of estimating what that projection matrix should be, by
comparing measurements with and without the signal of interest. For example,
you can take additional “empty room” measurements that record activity at the
sensors when no subject is present. By looking at the spatial pattern of
activity across MEG sensors in an empty room measurement, you can create one
or more <span class="math notranslate nohighlight">\(N\)</span>-dimensional vector(s) giving the “direction(s)” of
environmental noise in sensor space (analogous to the vector for “effect of
the trigger” in our example above). SSP is also often used for removing
heartbeat and eye movement artifacts — in those cases, instead of empty room
recordings the direction of the noise is estimated by detecting the
artifacts, extracting epochs around them, and averaging.</p>
<p>Once you know the noise vectors, you can create a hyperplane that is
orthogonal
to them, and construct a projection matrix to project your experimental
recordings onto that hyperplane. In that way, the component of your
measurements associated with environmental noise can be removed. Again, it
should be clear that the projection reduces the dimensionality of your data —
you’ll still have the same number of sensor signals, but they won’t all be
<em>linearly independent</em> — but typically there are tens or hundreds of sensors
and the noise subspace that you are eliminating has only 3-5 dimensions, so
the loss of degrees of freedom is usually not problematic.</p>
</div>
<div class="section" id="projectors-in-mne-python">
<h2><a class="toc-backref" href="#id6">Projectors in MNE-Python</a><a class="headerlink" href="#projectors-in-mne-python" title="Permalink to this headline">¶</a></h2>
<p>In our example data, <a class="reference internal" href="#ssp-tutorial"><span class="std std-ref">SSP</span></a> has already been performed
using empty room recordings, but the <a class="reference internal" href="../../glossary.html#term-projector"><span class="xref std std-term">projectors</span></a> are
stored alongside the raw data and have not been <em>applied</em> yet (or,
synonymously, the projectors are not <em>active</em> yet). Here we’ll load
the <a class="reference internal" href="../../manual/datasets_index.html#sample-dataset"><span class="std std-ref">sample data</span></a> and crop it to 60 seconds; you can
see the projectors in the output of <a class="reference internal" href="../../generated/mne.io.read_raw_fif.html#mne.io.read_raw_fif" title="mne.io.read_raw_fif"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_raw_fif()</span></code></a> below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample_data_folder</span> <span class="o">=</span> <a href="../../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path" title="View documentation for mne.datasets.sample.data_path"><span class="n">mne</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<span class="n">sample_data_raw_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sample_data_folder</span><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;sample_audvis_raw.fif&#39;</span><span class="p">)</span>
<span class="n">raw</span> <span class="o">=</span> <a href="../../generated/mne.io.read_raw_fif.html#mne.io.read_raw_fif" title="View documentation for mne.io.read_raw_fif"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span></a><span class="p">(</span><span class="n">sample_data_raw_file</span><span class="p">)</span>
<span class="n">raw</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Opening raw data file /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
    Read a total of 3 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
    Range : 25800 ... 192599 =     42.956 ...   320.670 secs
Ready.
Current compensation grade : 0
Reading 0 ... 36037  =      0.000 ...    60.000 secs...
</pre></div>
</div>
<p>In MNE-Python, the environmental noise vectors are computed using <a class="reference external" href="https://en.wikipedia.org/wiki/Principal_component_analysis">principal
component analysis</a>, usually abbreviated “PCA”, which is why the SSP
projectors usually have names like “PCA-v1”. (Incidentally, since the process
of performing PCA uses <a class="reference external" href="https://en.wikipedia.org/wiki/Singular_value_decomposition">singular value decomposition</a> under the hood,
it is also common to see phrases like “projectors were computed using SVD” in
published papers.) The projectors are stored in the <code class="docutils literal notranslate"><span class="pre">projs</span></code> field of
<code class="docutils literal notranslate"><span class="pre">raw.info</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;projs&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;Projection  |  PCA-v1, active : False, n_channels : 102&gt;, &lt;Projection  |  PCA-v2, active : False, n_channels : 102&gt;, &lt;Projection  |  PCA-v3, active : False, n_channels : 102&gt;]
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">raw.info['projs']</span></code> is an ordinary Python <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of
<a class="reference internal" href="../../generated/mne.Projection.html#mne.Projection" title="mne.Projection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Projection</span></code></a> objects, so you can access individual projectors by
indexing into it. The <a class="reference internal" href="../../generated/mne.Projection.html#mne.Projection" title="mne.Projection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Projection</span></code></a> object itself is similar to a
Python <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, so you can use its <code class="docutils literal notranslate"><span class="pre">.keys()</span></code> method to see what
fields it contains (normally you don’t need to access its properties
directly, but you can if necessary):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">first_projector</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;projs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_projector</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_projector</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Projection  |  PCA-v1, active : False, n_channels : 102&gt;
dict_keys([&#39;kind&#39;, &#39;active&#39;, &#39;desc&#39;, &#39;data&#39;, &#39;explained_var&#39;])
</pre></div>
</div>
<p>The <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-class docutils literal notranslate"><span class="pre">Raw</span></code></a>, <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">Epochs</span></code></a>, and <a class="reference internal" href="../../generated/mne.Evoked.html#mne.Evoked" title="mne.Evoked"><code class="xref py py-class docutils literal notranslate"><span class="pre">Evoked</span></code></a>
objects all have a boolean <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.proj" title="mne.io.Raw.proj"><code class="xref py py-attr docutils literal notranslate"><span class="pre">proj</span></code></a> attribute that indicates
whether there are any unapplied / inactive projectors stored in the object,
and each individual projector also has a boolean <code class="docutils literal notranslate"><span class="pre">active</span></code> field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">proj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_projector</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>False
False
</pre></div>
</div>
<div class="section" id="visualizing-the-effect-of-projectors">
<h3><a class="toc-backref" href="#id7">Visualizing the effect of projectors</a><a class="headerlink" href="#visualizing-the-effect-of-projectors" title="Permalink to this headline">¶</a></h3>
<p>You can see the effect the projectors are having on the measured signal by
comparing plots with and without the projectors applied. By default,
<code class="docutils literal notranslate"><span class="pre">raw.plot()</span></code> will apply the projectors in the background before plotting
(without modifying the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-class docutils literal notranslate"><span class="pre">Raw</span></code></a> object); you can control this
with the boolean <code class="docutils literal notranslate"><span class="pre">proj</span></code> parameter as shown below, or you can turn them on
and off interactively with the projectors interface, accessed via the
<kbd class="kbd docutils literal notranslate">Proj</kbd> button in the lower right corner of the plot window. Here we’ll
look at just the magnetometers, and a 2-second sample from the beginning of
the file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">meg</span><span class="o">=</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">mags</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">butterfly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mags</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">butterfly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="../../_images/sphx_glr_plot_40_projectors_background_003.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_40_projectors_background_003.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_40_projectors_background_004.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_40_projectors_background_004.png" />
</li>
</ul>
<p>Additional ways of visualizing projectors are covered in the tutorial
<a class="reference internal" href="../preprocessing/plot_50_artifact_correction_ssp.html#tut-artifact-ssp"><span class="std std-ref">Artifact Correction with SSP</span></a>.</p>
</div>
<div class="section" id="loading-and-saving-projectors">
<h3><a class="toc-backref" href="#id8">Loading and saving projectors</a><a class="headerlink" href="#loading-and-saving-projectors" title="Permalink to this headline">¶</a></h3>
<p>SSP can be used for other types of signal cleaning besides just reduction of
environmental noise. You probably noticed two large deflections in the
magnetometer signals in the previous plot that were not removed by the
empty-room projectors — those are artifacts of the subject’s heartbeat. SSP
can be used to remove those artifacts as well. The sample data includes
projectors for heartbeat noise reduction that were saved in a separate file
from the raw data, which can be loaded with the <a class="reference internal" href="../../generated/mne.read_proj.html#mne.read_proj" title="mne.read_proj"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.read_proj()</span></code></a>
function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecg_proj_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sample_data_folder</span><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;sample_audvis_ecg-proj.fif&#39;</span><span class="p">)</span>
<span class="n">ecg_projs</span> <span class="o">=</span> <a href="../../generated/mne.read_proj.html#mne.read_proj" title="View documentation for mne.read_proj"><span class="n">mne</span><span class="o">.</span><span class="n">read_proj</span></a><span class="p">(</span><span class="n">ecg_proj_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ecg_projs</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    Read a total of 6 projection items:
        ECG-planar-999--0.200-0.400-PCA-01 (1 x 203)  idle
        ECG-planar-999--0.200-0.400-PCA-02 (1 x 203)  idle
        ECG-axial-999--0.200-0.400-PCA-01 (1 x 102)  idle
        ECG-axial-999--0.200-0.400-PCA-02 (1 x 102)  idle
        ECG-eeg-999--0.200-0.400-PCA-01 (1 x 59)  idle
        ECG-eeg-999--0.200-0.400-PCA-02 (1 x 59)  idle
[&lt;Projection  |  ECG-planar-999--0.200-0.400-PCA-01, active : False, n_channels : 203&gt;, &lt;Projection  |  ECG-planar-999--0.200-0.400-PCA-02, active : False, n_channels : 203&gt;, &lt;Projection  |  ECG-axial-999--0.200-0.400-PCA-01, active : False, n_channels : 102&gt;, &lt;Projection  |  ECG-axial-999--0.200-0.400-PCA-02, active : False, n_channels : 102&gt;, &lt;Projection  |  ECG-eeg-999--0.200-0.400-PCA-01, active : False, n_channels : 59&gt;, &lt;Projection  |  ECG-eeg-999--0.200-0.400-PCA-02, active : False, n_channels : 59&gt;]
</pre></div>
</div>
<p>There is a corresponding <a class="reference internal" href="../../generated/mne.write_proj.html#mne.write_proj" title="mne.write_proj"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.write_proj()</span></code></a> function that can be used to
save projectors to disk in <code class="docutils literal notranslate"><span class="pre">.fif</span></code> format:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.write_proj.html#mne.write_proj" title="View documentation for mne.write_proj"><span class="n">mne</span><span class="o">.</span><span class="n">write_proj</span></a><span class="p">(</span><span class="s1">&#39;heartbeat-proj.fif&#39;</span><span class="p">,</span> <span class="n">ecg_projs</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By convention, MNE-Python expects projectors to be saved with a filename
ending in <code class="docutils literal notranslate"><span class="pre">-proj.fif</span></code> (or <code class="docutils literal notranslate"><span class="pre">-proj.fif.gz</span></code>), and will issue a warning
if you forgo this recommendation.</p>
</div>
</div>
<div class="section" id="adding-and-removing-projectors">
<h3><a class="toc-backref" href="#id9">Adding and removing projectors</a><a class="headerlink" href="#adding-and-removing-projectors" title="Permalink to this headline">¶</a></h3>
<p>Above, when we printed the <code class="docutils literal notranslate"><span class="pre">ecg_projs</span></code> list that we loaded from a file, it
showed two projectors for gradiometers (the first two, marked “planar”), two
for magnetometers (the middle two, marked “axial”), and two for EEG sensors
(the last two, marked “eeg”). We can add them to the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-class docutils literal notranslate"><span class="pre">Raw</span></code></a>
object using the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.add_proj" title="mne.io.Raw.add_proj"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_proj()</span></code></a> method (note that there is a
corresponding method <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.del_proj" title="mne.io.Raw.del_proj"><code class="xref py py-meth docutils literal notranslate"><span class="pre">del_proj()</span></code></a> that will remove projectors
based on their index within <code class="docutils literal notranslate"><span class="pre">raw.info['projs']</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">add_proj</span><span class="p">(</span><span class="n">ecg_projs</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>6 projection items deactivated
</pre></div>
</div>
<p>To see how the ECG projectors affect the measured signal, we can once again
plot the data with and without the projectors applied (though remember that
the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code></a> method only <em>temporarily</em> applies the projectors
for visualization, and does not permanently change the underlying data).
We’ll compare the <code class="docutils literal notranslate"><span class="pre">mags</span></code> variable we created above, which had only the
empty room SSP projectors, to the data with both empty room and ECG
projectors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mags_ecg</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">meg</span><span class="o">=</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">mags</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">butterfly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mags_ecg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">butterfly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="../../_images/sphx_glr_plot_40_projectors_background_005.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_40_projectors_background_005.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_40_projectors_background_006.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_40_projectors_background_006.png" />
</li>
</ul>
</div>
<div class="section" id="when-are-projectors-applied">
<h3><a class="toc-backref" href="#id10">When are projectors “applied”?</a><a class="headerlink" href="#when-are-projectors-applied" title="Permalink to this headline">¶</a></h3>
<p>By default, projectors are applied when creating <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">epoched</span></code></a> data from <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-class docutils literal notranslate"><span class="pre">Raw</span></code></a> data, though application of the
projectors can be <em>delayed</em> by passing <code class="docutils literal notranslate"><span class="pre">proj=False</span></code> to the
<a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">Epochs</span></code></a> constructor. However, even when projectors have not been
applied, the <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs.get_data" title="mne.Epochs.get_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mne.Epochs.get_data()</span></code></a> method will return data <em>as if the
projectors had been applied</em> (though the <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">Epochs</span></code></a> object will be
unchanged). Additionally, when performing inverse imaging (i.e., with
<a class="reference internal" href="../../generated/mne.minimum_norm.apply_inverse.html#mne.minimum_norm.apply_inverse" title="mne.minimum_norm.apply_inverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">apply_inverse()</span></code></a>), the projectors will be
automatically applied. It is also possible to apply projectors manually when
working with <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-class docutils literal notranslate"><span class="pre">Raw</span></code></a>, <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">Epochs</span></code></a> or
<a class="reference internal" href="../../generated/mne.Evoked.html#mne.Evoked" title="mne.Evoked"><code class="xref py py-class docutils literal notranslate"><span class="pre">Evoked</span></code></a> objects via the object’s <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.apply_proj" title="mne.io.Raw.apply_proj"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_proj()</span></code></a>
method. For all instance types, you can always copy the contents of
<code class="samp docutils literal notranslate"><em><span class="pre">&lt;instance&gt;</span></em><span class="pre">.info['projs']</span></code> into a separate <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> variable,
use <code class="samp docutils literal notranslate"><em><span class="pre">&lt;instance&gt;</span></em><span class="pre">.del_proj(</span><em><span class="pre">&lt;index</span> <span class="pre">of</span> <span class="pre">proj(s)</span> <span class="pre">to</span> <span class="pre">remove&gt;</span></em><span class="pre">)</span></code> to remove
one or more projectors, and then add them back later with
<code class="samp docutils literal notranslate"><em><span class="pre">&lt;instance&gt;</span></em><span class="pre">.add_proj(</span><em><span class="pre">&lt;list</span> <span class="pre">containing</span> <span class="pre">projs&gt;</span></em><span class="pre">)</span></code> if desired.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember that once a projector is applied, it can’t be un-applied, so
during interactive / exploratory analysis it’s a good idea to use the
object’s <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.copy" title="mne.io.Raw.copy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">copy()</span></code></a> method before applying projectors.</p>
</div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id11">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Uusitalo MA and Ilmoniemi RJ. (1997). Signal-space projection method
for separating MEG or EEG into components. <em>Med Biol Eng Comput</em>
35(2), 135–140. doi:10.1007/BF02534144</p>
</dd>
</dl>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  8.186 seconds)</p>
<p><strong>Estimated memory usage:</strong>  74 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-intro-plot-40-projectors-background-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/2d621ba6879dfab19fb0a272b45c9770/plot_40_projectors_background.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_40_projectors_background.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/eb4e656a41004c0f70f9feb6a646a919/plot_40_projectors_background.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_40_projectors_background.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container institutions">
    <a href="https://www.massgeneral.org/"><img class="institution_lg" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a>
    <a href="https://martinos.org/"><img class="institution_lg" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a>
    <a href="https://hms.harvard.edu/"><img class="institution_lg" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a>
    <a href="https://web.mit.edu/"><img class="institution_sm" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a>
    <a href="https://www.nyu.edu/"><img class="institution_md" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a>
    <a href="http://www.cea.fr/"><img class="institution_md" src="../../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a>
    <a href="https://sci.aalto.fi/"><img class="institution_md" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a>
    <a href="https://www.telecom-paris.fr/"><img class="institution_md" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a>
    <a href="https://www.washington.edu/"><img class="institution_sm" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a>
    <a href="https://icm-institute.org/"><img class="institution_lg" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a>
    <a href="https://www.bu.edu/"><img class="institution_sm" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a>
    <a href="https://www.inserm.fr/"><img class="institution_xs" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a>
    <a href="https://www.fz-juelich.de/"><img class="institution_sm" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a>
    <a href="https://www.tu-ilmenau.de/"><img class="institution_sm" src="../../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a>
    <a href="https://bids.berkeley.edu/"><img class="institution_md" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a>
    <a href="https://www.inria.fr/"><img class="institution_sm" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a>
    <a href="https://www.au.dk/"><img class="institution_sm" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a>
    <a href="https://www.uni-graz.at/"><img class="institution_md" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a>
  </div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-07-18.</p>
  </div>
</footer>
  </body>
</html>