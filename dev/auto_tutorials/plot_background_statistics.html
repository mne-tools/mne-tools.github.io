<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Statistical inference &#8212; MNE 0.16.dev0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.16.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <script type="text/javascript" src="../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.16.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.16.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Install</a></li>
                <li><a href="../documentation.html">Documentation</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="../auto_examples/index.html">Examples</a></li>
                <li><a href="../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.16.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.15 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Statistical inference</a><ul>
<li><a class="reference internal" href="#hypothesis-testing">Hypothesis testing</a><ul>
<li><a class="reference internal" href="#null-hypothesis">Null hypothesis</a></li>
<li><a class="reference internal" href="#parametric-tests">Parametric tests</a><ul>
<li><a class="reference internal" href="#hat-variance-adjustment">“hat” variance adjustment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#non-parametric-tests">Non-parametric tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiple-comparisons">Multiple comparisons</a><ul>
<li><a class="reference internal" href="#bonferroni-correction">Bonferroni correction</a></li>
<li><a class="reference internal" href="#false-discovery-rate-fdr-correction">False discovery rate (FDR) correction</a></li>
<li><a class="reference internal" href="#non-parametric-resampling-test-with-a-maximum-statistic">Non-parametric resampling test with a maximum statistic</a></li>
<li><a class="reference internal" href="#clustering">Clustering</a><ul>
<li><a class="reference internal" href="#defining-the-connectivity-neighbor-adjacency-matrix">Defining the connectivity/neighbor/adjacency matrix</a></li>
<li><a class="reference internal" href="#standard-clustering">Standard clustering</a></li>
<li><a class="reference internal" href="#id4">“hat” variance adjustment</a></li>
<li><a class="reference internal" href="#threshold-free-cluster-enhancement-tfce">Threshold-free cluster enhancement (TFCE)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#visualize-and-compare-methods">Visualize and compare methods</a></li>
<li><a class="reference internal" href="#statistical-functions-in-mne">Statistical functions in MNE</a><ul>
<li><a class="reference internal" href="#parametric-methods-provided-by-mne">Parametric methods provided by MNE</a></li>
<li><a class="reference internal" href="#non-parametric-methods">Non-parametric methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12 content">
      
  <div class="section" id="statistical-inference">
<span id="sphx-glr-auto-tutorials-plot-background-statistics-py"></span><h1>Statistical inference<a class="headerlink" href="#statistical-inference" title="Permalink to this headline">¶</a></h1>
<p>Here we will briefly cover multiple concepts of inferential statistics in an
introductory manner, and demonstrate how to use some MNE statistical functions.</p>
<div class="contents local topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="#hypothesis-testing" id="id9">Hypothesis testing</a><ul>
<li><a class="reference internal" href="#null-hypothesis" id="id10">Null hypothesis</a></li>
<li><a class="reference internal" href="#parametric-tests" id="id11">Parametric tests</a><ul>
<li><a class="reference internal" href="#hat-variance-adjustment" id="id12">“hat” variance adjustment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#non-parametric-tests" id="id13">Non-parametric tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiple-comparisons" id="id14">Multiple comparisons</a><ul>
<li><a class="reference internal" href="#bonferroni-correction" id="id15">Bonferroni correction</a></li>
<li><a class="reference internal" href="#false-discovery-rate-fdr-correction" id="id16">False discovery rate (FDR) correction</a></li>
<li><a class="reference internal" href="#non-parametric-resampling-test-with-a-maximum-statistic" id="id17">Non-parametric resampling test with a maximum statistic</a></li>
<li><a class="reference internal" href="#clustering" id="id18">Clustering</a><ul>
<li><a class="reference internal" href="#defining-the-connectivity-neighbor-adjacency-matrix" id="id19">Defining the connectivity/neighbor/adjacency matrix</a></li>
<li><a class="reference internal" href="#standard-clustering" id="id20">Standard clustering</a></li>
<li><a class="reference internal" href="#id4" id="id21">“hat” variance adjustment</a></li>
<li><a class="reference internal" href="#threshold-free-cluster-enhancement-tfce" id="id22">Threshold-free cluster enhancement (TFCE)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#visualize-and-compare-methods" id="id23">Visualize and compare methods</a></li>
<li><a class="reference internal" href="#statistical-functions-in-mne" id="id24">Statistical functions in MNE</a><ul>
<li><a class="reference internal" href="#parametric-methods-provided-by-mne" id="id25">Parametric methods provided by MNE</a></li>
<li><a class="reference internal" href="#non-parametric-methods" id="id26">Non-parametric methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id27">References</a></li>
</ul>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Authors: Eric Larson &lt;larson.eric.d@gmail.com&gt;</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa, analysis:ignore</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.stats</span> <span class="kn">import</span> <span class="p">(</span><a href="../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="View documentation for mne.stats.ttest_1samp_no_p"><span class="n">ttest_1samp_no_p</span></a><span class="p">,</span> <a href="../generated/mne.stats.bonferroni_correction.html#mne.stats.bonferroni_correction" title="View documentation for mne.stats.bonferroni_correction"><span class="n">bonferroni_correction</span></a><span class="p">,</span> <a href="../generated/mne.stats.fdr_correction.html#mne.stats.fdr_correction" title="View documentation for mne.stats.fdr_correction"><span class="n">fdr_correction</span></a><span class="p">,</span>
                       <a href="../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="View documentation for mne.stats.permutation_t_test"><span class="n">permutation_t_test</span></a><span class="p">,</span> <a href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="View documentation for mne.stats.permutation_cluster_1samp_test"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="hypothesis-testing">
<h2><a class="toc-backref" href="#id9">Hypothesis testing</a><a class="headerlink" href="#hypothesis-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="null-hypothesis">
<h3><a class="toc-backref" href="#id10">Null hypothesis</a><a class="headerlink" href="#null-hypothesis" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/Null_hypothesis">Wikipedia</a>:</p>
<blockquote>
<div>In inferential statistics, a general statement or default position that
there is no relationship between two measured phenomena, or no
association among groups.</div></blockquote>
<p>We typically want to reject a <strong>null hypothesis</strong> with
some probability level (e.g., p &lt; 0.05).
To think about what this means, let’s follow the illustrative example from
<a class="footnote-reference" href="#id7" id="id1">[1]</a> and construct a toy dataset consisting of a 40 x 40 square with a
“signal” present in the center (at pixel [20, 20]) with white noise
added and a 5-pixel-SD normal smoothing kernel applied.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">width</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">n_subjects</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">signal_mean</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">signal_sd</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">noise_sd</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">gaussian_sd</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># sigma for the &quot;hat&quot; method</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">n_subjects</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">n_permutations</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>  <span class="c1"># run an exact test</span>
<span class="n">n_src</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">width</span>

<span class="c1"># For each &quot;subject&quot;, make a smoothed noisy signal with a centered peak</span>
<span class="n">rng</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.random.RandomState.html#numpy.random.RandomState" title="View documentation for numpy.random.RandomState"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span></a><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">noise_sd</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_subjects</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="c1"># Add a signal at the dead center</span>
<span class="n">X</span><span class="p">[:,</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal_mean</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_subjects</span><span class="p">)</span> <span class="o">*</span> <span class="n">signal_sd</span>
<span class="c1"># Spatially smooth with a 2D Gaussian kernel</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">gaussian</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.exp.html#numpy.exp" title="View documentation for numpy.exp"><span class="n">np</span><span class="o">.</span><span class="n">exp</span></a><span class="p">(</span><span class="o">-</span><span class="p">(</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">gaussian_sd</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="p">:],</span> <span class="n">gaussian</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ci</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">si</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ci</span><span class="p">],</span> <span class="n">gaussian</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, a null hypothesis we could test for each voxel is:</p>
<blockquote>
<div>There is no difference between the mean value and zero
(<span class="math">\(H_0: \mu = 0\)</span>).</div></blockquote>
<p>The alternative hypothesis, then, is that the voxel has a non-zero mean.
This is a <em>two-tailed test</em> because the mean could be less than
or greater than zero (whereas a <em>one-tailed test</em> would test only one of
these possibilities, i.e. <span class="math">\(H_0: \mu \geq 0\)</span> or
<span class="math">\(H_0: \mu \leq 0\)</span>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here we will refer to each spatial location as a “voxel”.
In general, though, it could be any sort of data value
(e.g., cortical vertex at a specific time, pixel in a
time-frequency decomposition, etc.).</p>
</div>
</div>
<div class="section" id="parametric-tests">
<h3><a class="toc-backref" href="#id11">Parametric tests</a><a class="headerlink" href="#parametric-tests" title="Permalink to this headline">¶</a></h3>
<p>Let’s start with a <strong>1-sample t-test</strong>, which is a standard test
for differences in paired sample means. This test is <strong>parametric</strong>,
as it assumes that the underlying sample distribution is Gaussian, and is
only valid in this case. (This happens to be satisfied by our toy dataset,
but is not always satisfied for neuroimaging data.)</p>
<p>In the context of our toy dataset, which has many voxels, applying the
1-sample t-test is called a <em>mass-univariate</em> approach as it treats
each voxel independently.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t-statistic&#39;</span><span class="p">]</span>
<span class="n">out</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.stats.ttest_1samp.html#scipy.stats.ttest_1samp" title="View documentation for scipy.stats.ttest_1samp"><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span></a><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">mccs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span>  <span class="c1"># these are not multiple-comparisons corrected</span>


<span class="c1"># let&#39;s make a plotting function</span>
<span class="k">def</span> <span class="nf">plot_t_p</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">mcc</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)]</span>
        <span class="n">show</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">show</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">p_lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
    <span class="n">t_lims</span> <span class="o">=</span> <span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p_lims</span><span class="p">,</span> <span class="n">n_subjects</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p_lims</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.log10.html#numpy.log10" title="View documentation for numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="o">-</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.log10.html#numpy.log10" title="View documentation for numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><span class="mf">0.001</span><span class="p">)]</span>
    <span class="c1"># t plot</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.mgrid.html#numpy.mgrid" title="View documentation for numpy.mgrid"><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span></a><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">width</span><span class="p">]</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.reshape.html#numpy.reshape" title="View documentation for numpy.reshape"><span class="n">np</span><span class="o">.</span><span class="n">reshape</span></a><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)),</span>
                                <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="n">t_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">t_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">zticks</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="View documentation for matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                        <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">mappable</span><span class="o">=</span><span class="n">surf</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">t_lims</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t_lim</span> <span class="k">for</span> <span class="n">t_lim</span> <span class="ow">in</span> <span class="n">t_lims</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;t-value&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mcc</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># p plot</span>
    <span class="n">use_p</span> <span class="o">=</span> <span class="o">-</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.log10.html#numpy.log10" title="View documentation for numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.reshape.html#numpy.reshape" title="View documentation for numpy.reshape"><span class="n">np</span><span class="o">.</span><span class="n">reshape</span></a><span class="p">(</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.maximum.html#numpy.maximum" title="View documentation for numpy.maximum"><span class="n">np</span><span class="o">.</span><span class="n">maximum</span></a><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)))</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">use_p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">p_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">p_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">cbar</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="View documentation for matplotlib.pyplot.colorbar"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                        <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">mappable</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">p_lims</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p_lim</span> <span class="k">for</span> <span class="n">p_lim</span> <span class="ow">in</span> <span class="n">p_lims</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$-\log_{10}(p)$&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mcc</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots_adjust.html#matplotlib.pyplot.subplots_adjust" title="View documentation for matplotlib.pyplot.subplots_adjust"><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plt_show</span><span class="p">()</span>


<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_001.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_001.png" />
<div class="section" id="hat-variance-adjustment">
<h4><a class="toc-backref" href="#id12">“hat” variance adjustment</a><a class="headerlink" href="#hat-variance-adjustment" title="Permalink to this headline">¶</a></h4>
<p>The “hat” technique regularizes the variance values used in the t-test
calculation <a class="footnote-reference" href="#id7" id="id2">[1]</a> to compensate for implausibly small variances.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="View documentation for mne.stats.ttest_1samp_no_p"><span class="n">ttest_1samp_no_p</span></a><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">))</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$\mathrm{t_{hat}}$&#39;</span><span class="p">)</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_002.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_002.png" />
</div>
</div>
<div class="section" id="non-parametric-tests">
<h3><a class="toc-backref" href="#id13">Non-parametric tests</a><a class="headerlink" href="#non-parametric-tests" title="Permalink to this headline">¶</a></h3>
<p>Instead of assuming an underlying Gaussian distribution, we could instead
use a <strong>non-parametric resampling</strong> method. Under the null hypothesis,
we have the principle of <strong>exchangeability</strong>, which means that, if the null
is true, we should be able to exchange conditions and not change the
distribution of the test statistic.</p>
<p>In the case of a 2-tailed paired t-test against 0 (or between two conditions
where you have already subtracted them), exchangeability means that we can
flip the signs of our data. Therefore, we can construct the
<strong>null distribution</strong> values by taking random subsets of samples (subjects),
flipping the sign of their data, and recording the resulting statistic
absolute value. The absolute value of the statistic evaluated on the
veridical data can then be compared to this distribution, and the p-value
is simply the proportion of null distribution values that were smaller.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the case where <code class="docutils literal"><span class="pre">n_permutations</span></code> is large enough (or “all”) so
that the complete set of unique resampling exchanges can be done
(which is <span class="math">\(2^{N_{samp}}-1=1023\)</span> for the one-tailed paired
test here, not counting the veridical distribution),
instead of randomly exchanging conditions the null is formed
from using all possible exchanges. This is known as a permutation
test (or exact test) form of a non-parametric resampling test.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here we have to do a bit of gymnastics to get our function to do</span>
<span class="c1"># a permutation test without correcting for multiple comparisons:</span>

<span class="c1"># Let&#39;s flatten the array for simplicity</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_subjects</span><span class="p">,</span> <span class="n">n_src</span><span class="p">)</span>
<span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Permutation&#39;</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.zeros.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">width</span><span class="p">))</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.zeros.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">width</span><span class="p">))</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_src</span><span class="p">):</span>
    <span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> \
        <a href="../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="View documentation for mne.stats.permutation_t_test"><span class="n">permutation_t_test</span></a><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="p">[</span><span class="n">ii</span><span class="p">]],</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span> <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">False</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_003.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_003.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Permuting</span> <span class="mi">511</span> <span class="n">times</span> <span class="p">(</span><span class="n">exact</span> <span class="n">test</span><span class="p">)</span><span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-comparisons">
<h2><a class="toc-backref" href="#id14">Multiple comparisons</a><a class="headerlink" href="#multiple-comparisons" title="Permalink to this headline">¶</a></h2>
<p>So far, we have done no correction for multiple comparisons. This is
potentially problematic for these data because there are
<span class="math">\(40 \times 40 = 1600\)</span> tests being performed. If we just use
a threshold <code class="docutils literal"><span class="pre">p</span> <span class="pre">&lt;</span> <span class="pre">0.05</span></code> for all of our tests, we would expect many
voxels to be declared significant even if there were no true effect.
In other words, we would make many <strong>type I errors</strong> (adapted from
<a class="reference external" href="https://en.wikipedia.org/wiki/Type_I_and_type_II_errors">here</a>):</p>
<table border="1" class="skinnytable docutils">
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2" rowspan="2">&#160;</th>
<th class="head" colspan="2">Null hypothesis</th>
</tr>
<tr class="row-even"><th class="head">True</th>
<th class="head">False</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td rowspan="2">Reject</td>
<td>Yes</td>
<td><dl class="first last docutils">
<dt>Type I error</dt>
<dd>False positive</dd>
</dl>
</td>
<td><dl class="first last docutils">
<dt>Correct</dt>
<dd>True positive</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td>No</td>
<td><dl class="first last docutils">
<dt>Correct</dt>
<dd>True Negative</dd>
</dl>
</td>
<td><dl class="first last docutils">
<dt>Type II error</dt>
<dd>False negative</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>To see why, consider a standard <span class="math">\(\alpha = 0.05\)</span>.
For a single test, our probability of making a type I error is 0.05.
The probability of making at least one type I error in
<span class="math">\(N_{\mathrm{test}}\)</span> independent tests is then given by
<span class="math">\(1 - (1 - \alpha)^{N_{\mathrm{test}}}\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">p_type_I</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">**</span> <span class="n">N</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">p_type_I</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">N</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$N_{\mathrm{test}}$&#39;</span><span class="p">,</span>
       <span class="n">ylabel</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;Probability of ≥ 1</span><span class="se">\n</span><span class="s1">type I error&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plt_show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_004.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_004.png" />
<p>To combat this problem, multiple methods exist. Typically these
provide control over either the:</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt><a class="reference external" href="fwer">Familywise error rate (FWER)</a></dt>
<dd><p class="first">The probability of making one or more type I errors:</p>
<div class="last math">
\[\mathrm{P}(N_{\mathrm{type\ I}} &gt;= 1 | H_0)\]</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="fdr">False discovery rate (FDR)</a></dt>
<dd><p class="first">The expected proportion of rejected null hypotheses that are
actually true:</p>
<div class="last math">
\[\mathrm{E}(N_{\mathrm{type\ I}} / N_{\mathrm{reject}}
| N_{\mathrm{reject}} &gt; 0)
\mathrm{P}(N_{\mathrm{reject}} &gt; 0 | H_0)\]</div>
</dd>
</dl>
</li>
</ol>
<p>We cover some techniques that control FWER and FDR below.</p>
<div class="section" id="bonferroni-correction">
<h3><a class="toc-backref" href="#id15">Bonferroni correction</a><a class="headerlink" href="#bonferroni-correction" title="Permalink to this headline">¶</a></h3>
<p>Perhaps the simplest way to deal with multiple comparisons, <a class="reference external" href="https://en.wikipedia.org/wiki/Bonferroni_correction">Bonferroni
correction</a>
conservatively multiplies the p-values by the number of comparisons to
control the FWER.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Bonferroni&#39;</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../generated/mne.stats.bonferroni_correction.html#mne.stats.bonferroni_correction" title="View documentation for mne.stats.bonferroni_correction"><span class="n">bonferroni_correction</span></a><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_005.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_005.png" />
</div>
<div class="section" id="false-discovery-rate-fdr-correction">
<h3><a class="toc-backref" href="#id16">False discovery rate (FDR) correction</a><a class="headerlink" href="#false-discovery-rate-fdr-correction" title="Permalink to this headline">¶</a></h3>
<p>Typically FDR is performed with the Benjamini/Hochberg procedure, which
is less restrictive than Bonferroni correction for large numbers of
comparisons (fewer type II errors) but provides less strict control of
errors (more type I errors).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FDR&#39;</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../generated/mne.stats.fdr_correction.html#mne.stats.fdr_correction" title="View documentation for mne.stats.fdr_correction"><span class="n">fdr_correction</span></a><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_006.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_006.png" />
</div>
<div class="section" id="non-parametric-resampling-test-with-a-maximum-statistic">
<h3><a class="toc-backref" href="#id17">Non-parametric resampling test with a maximum statistic</a><a class="headerlink" href="#non-parametric-resampling-test-with-a-maximum-statistic" title="Permalink to this headline">¶</a></h3>
<p><strong>Non-parametric resampling tests</strong> can also be used to correct for multiple
comparisons. In its simplest form, we again do permutations using
exchangeability under the null hypothesis, but this time we take the
<em>maximum statistic across all tests</em> in each permutation to form the
null distribution. The p-value for each voxel from the veridical data
is then given by the proportion of null distribtion values
that were smaller.</p>
<p>This method has two important features:</p>
<ol class="arabic simple">
<li>It controls FWER.</li>
<li>It is non-parametric. Even though our initial test statistic
(here a 1-sample t-test) for clustering is parametric, the null
distribution for the null hypothesis rejection (cluster size
distribution is indistinguishable from zero) is obtained by
permutations. This means that it makes no assumptions of Gaussianity
(which do hold for this example but do not in general for some types
of processed neuroimaging data).</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$\mathbf{Perm_{max}}$&#39;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <a href="../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="View documentation for mne.stats.permutation_t_test"><span class="n">permutation_t_test</span></a><span class="p">(</span><span class="n">X</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_007.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_007.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Permuting</span> <span class="mi">511</span> <span class="n">times</span> <span class="p">(</span><span class="n">exact</span> <span class="n">test</span><span class="p">)</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="clustering">
<h3><a class="toc-backref" href="#id18">Clustering</a><a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h3>
<p>Each of the aforementioned multiple comparisons corrections have the
disadvantage of not fully incorporating the correlation structure of the
data, i.e., that points close to one another (e.g., in space or time) tend
to be correlated. However, by defining the connectivity/adjacency/neighbor
structure in our data, we can use <strong>clustering</strong> to compensate.</p>
<p>To use this, we need to rethink our null hypothesis. Instead
of thinking about a null hypothesis about means per voxel (with one
independent test per voxel), we consider a null hypothesis about sizes
of clusters in our data, which could be stated like:</p>
<blockquote>
<div>The distribution of spatial cluster sizes observed in two experimental
conditions are drawn from the same probability distribution.</div></blockquote>
<p>Here we only have a single condition and we contrast to zero, which can
be thought of as:</p>
<blockquote>
<div>The distribution of spatial cluster sizes is independent of the sign
of the data.</div></blockquote>
<p>In this case, we again do permutations with a maximum statistic, but, under
each permutation, we:</p>
<ol class="arabic simple">
<li>Threshold the computed statistic with some <strong>initial</strong>
<code class="docutils literal"><span class="pre">threshold</span></code> value.</li>
<li>Cluster points that exceed this threshold (with the same sign)
based on adjacency.</li>
<li>Record the <em>size</em> of each cluster (measured, e.g., by a simple voxel
count, or by the sum of voxel t-values within the cluster).</li>
</ol>
<p>After doing these permutations, the cluster sizes in our veridical data
are compared to this null distribution. The p-value associated with each
cluster is again given by the proportion of smaller null distribution
values. This can then be subjected to a standard p-value threshold
(e.g., <code class="docutils literal"><span class="pre">p</span> <span class="pre">&lt;</span> <span class="pre">0.05</span></code>) to reject the null hypothesis (i.e., find an effect
of interest).</p>
<p>This reframing to consider <em>cluster sizes</em> rather than <em>individual means</em>
maintains the advantages of the standard non-parametric permutation
test – namely controlling FWER and making no assumptions of parametric
data distribution.
Cricitally, though, it also accounts for the correlation structure in the
data – which in this toy case is spatial but
in general can be multidimensional (e.g., spatio-temporal) – because the
null distribution will be derived from data in a way that preserves these
correlations.</p>
<p>However, there is a drawback. If a cluster significantly deviates from
the null, no further inference on the cluster (e.g., peak location) can be
made, as the entire cluster as a whole is used to reject the null.
Moreover, because the test statistic concerns the full data, the null
hypothesis (and our rejection of it) refers to the structure of the full
data. For more information, see also the
<a class="reference external" href="ft_cluster">excellent FieldTrip cluster interpretation tutorial</a>.</p>
<div class="section" id="defining-the-connectivity-neighbor-adjacency-matrix">
<h4><a class="toc-backref" href="#id19">Defining the connectivity/neighbor/adjacency matrix</a><a class="headerlink" href="#defining-the-connectivity-neighbor-adjacency-matrix" title="Permalink to this headline">¶</a></h4>
<p>First we need to define our connectivity/neighbor/adjacency matrix.
This is a square array (or sparse matrix) of shape <code class="docutils literal"><span class="pre">(n_src,</span> <span class="pre">n_src)</span></code> that
contains zeros and ones to define which spatial points are connected, i.e.,
which voxels are adjacent to each other. In our case this
is quite simple, as our data are aligned on a rectangular grid.</p>
<p>Let’s pretend that our data were smaller – a 3x3 grid. Thinking about
each voxel as being connected to the other voxels it touches, we would
need a 9x9 connectivity matrix. The first row should contain the elements
in the <code class="docutils literal"><span class="pre">.ravel()</span></code>’ed data that it touches. Since it touches the
second element in the first row and the first element in the second row
(and is also a neighbor to itself), this would be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p><a class="reference external" href="http://scikit-learn.org/stable/modules/classes.html#module-sklearn.feature_extraction" title="(in scikit-learn v0.19.1)"><code class="xref py py-mod docutils literal"><span class="pre">sklearn.feature_extraction</span></code></a> provides a convenient function for this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.image</span> <span class="kn">import</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.image.grid_to_graph.html#sklearn.feature_extraction.image.grid_to_graph" title="View documentation for sklearn.feature_extraction.image.grid_to_graph"><span class="n">grid_to_graph</span></a>  <span class="c1"># noqa: E402</span>
<span class="n">mini_connectivity</span> <span class="o">=</span> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.image.grid_to_graph.html#sklearn.feature_extraction.image.grid_to_graph" title="View documentation for sklearn.feature_extraction.image.grid_to_graph"><span class="n">grid_to_graph</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">mini_connectivity</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">mini_connectivity</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">del</span> <span class="n">mini_connectivity</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>In general the connectivity between voxels can be more complex, such as
those between sensors in 3D space, or time-varying activation at brain
vertices on a cortical surface. MNE provides several convenience functions
for computing connectivity/neighbor/adjacency matrices, see the
<a class="reference internal" href="../python_reference.html#api-reference-statistics"><span class="std std-ref">Statistics API</span></a>.</p>
</div>
<div class="section" id="standard-clustering">
<h4><a class="toc-backref" href="#id20">Standard clustering</a><a class="headerlink" href="#standard-clustering" title="Permalink to this headline">¶</a></h4>
<p>Here, since our data are on a grid, we can use <code class="docutils literal"><span class="pre">connectivity=None</span></code> to
trigger optimized grid-based code, and run the clustering algorithm.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Reshape data to what is equivalent to (n_samples, n_space, n_time)</span>
<span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Clustering&#39;</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_subjects</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<span class="n">t_clust</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> <a href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="View documentation for mne.stats.permutation_cluster_1samp_test"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">)</span>
<span class="c1"># Put the cluster data in a viewable format</span>
<span class="n">p_clust</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">):</span>
    <span class="n">p_clust</span><span class="p">[</span><span class="n">cl</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_clust</span><span class="p">)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_clust</span><span class="p">)</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_008.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_008.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">stat_fun</span><span class="p">(</span><span class="n">H1</span><span class="p">):</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">2.676791</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5.182156</span>
<span class="n">Running</span> <span class="n">initial</span> <span class="n">clustering</span>
<span class="n">Found</span> <span class="mi">1</span> <span class="n">clusters</span>
<span class="n">Permuting</span> <span class="mi">1022</span> <span class="n">times</span><span class="o">...</span>

<span class="p">[</span>                                        <span class="p">]</span> <span class="mf">0.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.</span>                                       <span class="p">]</span> <span class="mf">3.13112</span> <span class="o">/</span>
<span class="p">[</span><span class="o">..</span>                                      <span class="p">]</span> <span class="mf">6.26223</span> <span class="o">-</span>
<span class="p">[</span><span class="o">...</span>                                     <span class="p">]</span> <span class="mf">9.39335</span> \
<span class="p">[</span><span class="o">.....</span>                                   <span class="p">]</span> <span class="mf">12.52446</span> <span class="o">|</span>
<span class="p">[</span><span class="o">......</span>                                  <span class="p">]</span> <span class="mf">15.65558</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.......</span>                                 <span class="p">]</span> <span class="mf">18.78669</span> <span class="o">-</span>
<span class="p">[</span><span class="o">........</span>                                <span class="p">]</span> <span class="mf">21.91781</span> \
<span class="p">[</span><span class="o">..........</span>                              <span class="p">]</span> <span class="mf">25.04892</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...........</span>                             <span class="p">]</span> <span class="mf">28.18004</span> <span class="o">/</span>
<span class="p">[</span><span class="o">............</span>                            <span class="p">]</span> <span class="mf">31.31115</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.............</span>                           <span class="p">]</span> <span class="mf">34.44227</span> \
<span class="p">[</span><span class="o">...............</span>                         <span class="p">]</span> <span class="mf">37.57339</span> <span class="o">|</span>
<span class="p">[</span><span class="o">................</span>                        <span class="p">]</span> <span class="mf">40.70450</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.................</span>                       <span class="p">]</span> <span class="mf">43.83562</span> <span class="o">-</span>
<span class="p">[</span><span class="o">..................</span>                      <span class="p">]</span> <span class="mf">46.96673</span> \
<span class="p">[</span><span class="o">....................</span>                    <span class="p">]</span> <span class="mf">50.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.....................</span>                   <span class="p">]</span> <span class="mf">53.22896</span> <span class="o">/</span>
<span class="p">[</span><span class="o">......................</span>                  <span class="p">]</span> <span class="mf">56.36008</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.......................</span>                 <span class="p">]</span> <span class="mf">59.49119</span> \
<span class="p">[</span><span class="o">.........................</span>               <span class="p">]</span> <span class="mf">62.62231</span> <span class="o">|</span>
<span class="p">[</span><span class="o">..........................</span>              <span class="p">]</span> <span class="mf">65.75342</span> <span class="o">/</span>
<span class="p">[</span><span class="o">...........................</span>             <span class="p">]</span> <span class="mf">68.88454</span> <span class="o">-</span>
<span class="p">[</span><span class="o">............................</span>            <span class="p">]</span> <span class="mf">72.01566</span> \
<span class="p">[</span><span class="o">..............................</span>          <span class="p">]</span> <span class="mf">75.14677</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...............................</span>         <span class="p">]</span> <span class="mf">78.27789</span> <span class="o">/</span>
<span class="p">[</span><span class="o">................................</span>        <span class="p">]</span> <span class="mf">81.40900</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.................................</span>       <span class="p">]</span> <span class="mf">84.54012</span> \
<span class="p">[</span><span class="o">...................................</span>     <span class="p">]</span> <span class="mf">87.67123</span> <span class="o">|</span>
<span class="p">[</span><span class="o">....................................</span>    <span class="p">]</span> <span class="mf">90.80235</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.....................................</span>   <span class="p">]</span> <span class="mf">93.93346</span> <span class="o">-</span>
<span class="p">[</span><span class="o">......................................</span>  <span class="p">]</span> <span class="mf">97.06458</span> \    <span class="n">Computing</span> <span class="n">cluster</span> <span class="n">p</span><span class="o">-</span><span class="n">values</span>
<span class="n">Done</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id21">“hat” variance adjustment</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>This method can also be used in this context to correct for small
variances <a class="footnote-reference" href="#id7" id="id5">[1]</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{C_{hat}}$&#39;</span><span class="p">)</span>
<span class="n">stat_fun_hat</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><a href="../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="View documentation for mne.stats.ttest_1samp_no_p"><span class="n">ttest_1samp_no_p</span></a><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">t_hat</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> <a href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="View documentation for mne.stats.permutation_cluster_1samp_test"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">,</span> <span class="n">stat_fun</span><span class="o">=</span><span class="n">stat_fun_hat</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">p_hat</span> <span class="o">=</span> <a href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">p_values</span><span class="p">):</span>
    <span class="n">p_hat</span><span class="p">[</span><span class="n">cl</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_hat</span><span class="p">)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_hat</span><span class="p">)</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_009.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_009.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">stat_fun</span><span class="p">(</span><span class="n">H1</span><span class="p">):</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.044294</span> <span class="nb">max</span><span class="o">=</span><span class="mf">4.600984</span>
<span class="n">Running</span> <span class="n">initial</span> <span class="n">clustering</span>
<span class="n">Found</span> <span class="mi">1</span> <span class="n">clusters</span>
<span class="n">Permuting</span> <span class="mi">1022</span> <span class="n">times</span><span class="o">...</span>

<span class="p">[</span>                                        <span class="p">]</span> <span class="mf">0.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.</span>                                       <span class="p">]</span> <span class="mf">3.13112</span> <span class="o">/</span>
<span class="p">[</span><span class="o">..</span>                                      <span class="p">]</span> <span class="mf">6.26223</span> <span class="o">-</span>
<span class="p">[</span><span class="o">...</span>                                     <span class="p">]</span> <span class="mf">9.39335</span> \
<span class="p">[</span><span class="o">.....</span>                                   <span class="p">]</span> <span class="mf">12.52446</span> <span class="o">|</span>
<span class="p">[</span><span class="o">......</span>                                  <span class="p">]</span> <span class="mf">15.65558</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.......</span>                                 <span class="p">]</span> <span class="mf">18.78669</span> <span class="o">-</span>
<span class="p">[</span><span class="o">........</span>                                <span class="p">]</span> <span class="mf">21.91781</span> \
<span class="p">[</span><span class="o">..........</span>                              <span class="p">]</span> <span class="mf">25.04892</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...........</span>                             <span class="p">]</span> <span class="mf">28.18004</span> <span class="o">/</span>
<span class="p">[</span><span class="o">............</span>                            <span class="p">]</span> <span class="mf">31.31115</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.............</span>                           <span class="p">]</span> <span class="mf">34.44227</span> \
<span class="p">[</span><span class="o">...............</span>                         <span class="p">]</span> <span class="mf">37.57339</span> <span class="o">|</span>
<span class="p">[</span><span class="o">................</span>                        <span class="p">]</span> <span class="mf">40.70450</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.................</span>                       <span class="p">]</span> <span class="mf">43.83562</span> <span class="o">-</span>
<span class="p">[</span><span class="o">..................</span>                      <span class="p">]</span> <span class="mf">46.96673</span> \
<span class="p">[</span><span class="o">....................</span>                    <span class="p">]</span> <span class="mf">50.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.....................</span>                   <span class="p">]</span> <span class="mf">53.22896</span> <span class="o">/</span>
<span class="p">[</span><span class="o">......................</span>                  <span class="p">]</span> <span class="mf">56.36008</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.......................</span>                 <span class="p">]</span> <span class="mf">59.49119</span> \
<span class="p">[</span><span class="o">.........................</span>               <span class="p">]</span> <span class="mf">62.62231</span> <span class="o">|</span>
<span class="p">[</span><span class="o">..........................</span>              <span class="p">]</span> <span class="mf">65.75342</span> <span class="o">/</span>
<span class="p">[</span><span class="o">...........................</span>             <span class="p">]</span> <span class="mf">68.88454</span> <span class="o">-</span>
<span class="p">[</span><span class="o">............................</span>            <span class="p">]</span> <span class="mf">72.01566</span> \
<span class="p">[</span><span class="o">..............................</span>          <span class="p">]</span> <span class="mf">75.14677</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...............................</span>         <span class="p">]</span> <span class="mf">78.27789</span> <span class="o">/</span>
<span class="p">[</span><span class="o">................................</span>        <span class="p">]</span> <span class="mf">81.40900</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.................................</span>       <span class="p">]</span> <span class="mf">84.54012</span> \
<span class="p">[</span><span class="o">...................................</span>     <span class="p">]</span> <span class="mf">87.67123</span> <span class="o">|</span>
<span class="p">[</span><span class="o">....................................</span>    <span class="p">]</span> <span class="mf">90.80235</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.....................................</span>   <span class="p">]</span> <span class="mf">93.93346</span> <span class="o">-</span>
<span class="p">[</span><span class="o">......................................</span>  <span class="p">]</span> <span class="mf">97.06458</span> \    <span class="n">Computing</span> <span class="n">cluster</span> <span class="n">p</span><span class="o">-</span><span class="n">values</span>
<span class="n">Done</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="threshold-free-cluster-enhancement-tfce">
<span id="tfce-example"></span><h4><a class="toc-backref" href="#id22">Threshold-free cluster enhancement (TFCE)</a><a class="headerlink" href="#threshold-free-cluster-enhancement-tfce" title="Permalink to this headline">¶</a></h4>
<p>TFCE eliminates the free parameter initial <code class="docutils literal"><span class="pre">threshold</span></code> value that
determines which points are included in clustering by approximating
a continuous integration across possible threshold values with a standard
<a class="reference external" href="https://en.wikipedia.org/wiki/Riemann_sum">Riemann sum</a> <a class="footnote-reference" href="#id8" id="id6">[2]</a>.
This requires giving a starting threshold <code class="docutils literal"><span class="pre">'start'</span></code> and a step
size <code class="docutils literal"><span class="pre">'step'</span></code>, which in MNE is supplied as a dict.
The smaller the <code class="docutils literal"><span class="pre">'step'</span></code> and closer to 0 the <code class="docutils literal"><span class="pre">'start'</span></code> value,
the better the approximation, but the longer it takes).</p>
<p>A significant advantage of TFCE is that, rather than modifying the
statistical null hypothesis under test (from one about individual voxels
to one about the distribution of clusters in the data), it modifies the <em>data
under test</em> while still controlling for multiple comparisons.
The statistical test is then done at the level of individual voxels rather
than clusters. This allows for evaluation of each point
independently for significance rather than only as cluster groups.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{C_{TFCE}}$&#39;</span><span class="p">)</span>
<span class="n">threshold_tfce</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">t_tfce</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p_tfce</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> <a href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="View documentation for mne.stats.permutation_cluster_1samp_test"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_tfce</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_tfce</span><span class="p">)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_tfce</span><span class="p">)</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_010.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_010.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">stat_fun</span><span class="p">(</span><span class="n">H1</span><span class="p">):</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">2.676791</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5.182156</span>
<span class="n">Running</span> <span class="n">initial</span> <span class="n">clustering</span>
<span class="n">Using</span> <span class="mi">26</span> <span class="n">thresholds</span> <span class="kn">from</span> <span class="mf">0.00</span> <span class="n">to</span> <span class="mf">5.00</span> <span class="k">for</span> <span class="n">TFCE</span> <span class="n">computation</span> <span class="p">(</span><span class="n">h_power</span><span class="o">=</span><span class="mf">2.00</span><span class="p">,</span> <span class="n">e_power</span><span class="o">=</span><span class="mf">0.50</span><span class="p">)</span>
<span class="n">Found</span> <span class="mi">1600</span> <span class="n">clusters</span>
<span class="n">Permuting</span> <span class="mi">1022</span> <span class="n">times</span><span class="o">...</span>

<span class="p">[</span>                                        <span class="p">]</span> <span class="mf">0.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.</span>                                       <span class="p">]</span> <span class="mf">3.13112</span> <span class="o">/</span>
<span class="p">[</span><span class="o">..</span>                                      <span class="p">]</span> <span class="mf">6.26223</span> <span class="o">-</span>
<span class="p">[</span><span class="o">...</span>                                     <span class="p">]</span> <span class="mf">9.39335</span> \
<span class="p">[</span><span class="o">.....</span>                                   <span class="p">]</span> <span class="mf">12.52446</span> <span class="o">|</span>
<span class="p">[</span><span class="o">......</span>                                  <span class="p">]</span> <span class="mf">15.65558</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.......</span>                                 <span class="p">]</span> <span class="mf">18.78669</span> <span class="o">-</span>
<span class="p">[</span><span class="o">........</span>                                <span class="p">]</span> <span class="mf">21.91781</span> \
<span class="p">[</span><span class="o">..........</span>                              <span class="p">]</span> <span class="mf">25.04892</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...........</span>                             <span class="p">]</span> <span class="mf">28.18004</span> <span class="o">/</span>
<span class="p">[</span><span class="o">............</span>                            <span class="p">]</span> <span class="mf">31.31115</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.............</span>                           <span class="p">]</span> <span class="mf">34.44227</span> \
<span class="p">[</span><span class="o">...............</span>                         <span class="p">]</span> <span class="mf">37.57339</span> <span class="o">|</span>
<span class="p">[</span><span class="o">................</span>                        <span class="p">]</span> <span class="mf">40.70450</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.................</span>                       <span class="p">]</span> <span class="mf">43.83562</span> <span class="o">-</span>
<span class="p">[</span><span class="o">..................</span>                      <span class="p">]</span> <span class="mf">46.96673</span> \
<span class="p">[</span><span class="o">....................</span>                    <span class="p">]</span> <span class="mf">50.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.....................</span>                   <span class="p">]</span> <span class="mf">53.22896</span> <span class="o">/</span>
<span class="p">[</span><span class="o">......................</span>                  <span class="p">]</span> <span class="mf">56.36008</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.......................</span>                 <span class="p">]</span> <span class="mf">59.49119</span> \
<span class="p">[</span><span class="o">.........................</span>               <span class="p">]</span> <span class="mf">62.62231</span> <span class="o">|</span>
<span class="p">[</span><span class="o">..........................</span>              <span class="p">]</span> <span class="mf">65.75342</span> <span class="o">/</span>
<span class="p">[</span><span class="o">...........................</span>             <span class="p">]</span> <span class="mf">68.88454</span> <span class="o">-</span>
<span class="p">[</span><span class="o">............................</span>            <span class="p">]</span> <span class="mf">72.01566</span> \
<span class="p">[</span><span class="o">..............................</span>          <span class="p">]</span> <span class="mf">75.14677</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...............................</span>         <span class="p">]</span> <span class="mf">78.27789</span> <span class="o">/</span>
<span class="p">[</span><span class="o">................................</span>        <span class="p">]</span> <span class="mf">81.40900</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.................................</span>       <span class="p">]</span> <span class="mf">84.54012</span> \
<span class="p">[</span><span class="o">...................................</span>     <span class="p">]</span> <span class="mf">87.67123</span> <span class="o">|</span>
<span class="p">[</span><span class="o">....................................</span>    <span class="p">]</span> <span class="mf">90.80235</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.....................................</span>   <span class="p">]</span> <span class="mf">93.93346</span> <span class="o">-</span>
<span class="p">[</span><span class="o">......................................</span>  <span class="p">]</span> <span class="mf">97.06458</span> \    <span class="n">Computing</span> <span class="n">cluster</span> <span class="n">p</span><span class="o">-</span><span class="n">values</span>
<span class="n">Done</span><span class="o">.</span>
</pre></div>
</div>
<p>We can also combine TFCE and the “hat” correction:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{C_{hat,TFCE}}$&#39;</span><span class="p">)</span>
<span class="n">t_tfce_hat</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p_tfce_hat</span><span class="p">,</span> <span class="n">H0</span> <span class="o">=</span> <a href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="View documentation for mne.stats.permutation_cluster_1samp_test"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold_tfce</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_permutations</span><span class="o">=</span><span class="n">n_permutations</span><span class="p">,</span> <span class="n">stat_fun</span><span class="o">=</span><span class="n">stat_fun_hat</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_tfce_hat</span><span class="p">)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_tfce_hat</span><span class="p">)</span>
<span class="n">mccs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_011.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_011.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">stat_fun</span><span class="p">(</span><span class="n">H1</span><span class="p">):</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">0.044294</span> <span class="nb">max</span><span class="o">=</span><span class="mf">4.600984</span>
<span class="n">Running</span> <span class="n">initial</span> <span class="n">clustering</span>
<span class="n">Using</span> <span class="mi">24</span> <span class="n">thresholds</span> <span class="kn">from</span> <span class="mf">0.00</span> <span class="n">to</span> <span class="mf">4.60</span> <span class="k">for</span> <span class="n">TFCE</span> <span class="n">computation</span> <span class="p">(</span><span class="n">h_power</span><span class="o">=</span><span class="mf">2.00</span><span class="p">,</span> <span class="n">e_power</span><span class="o">=</span><span class="mf">0.50</span><span class="p">)</span>
<span class="n">Found</span> <span class="mi">1600</span> <span class="n">clusters</span>
<span class="n">Permuting</span> <span class="mi">1022</span> <span class="n">times</span><span class="o">...</span>

<span class="p">[</span>                                        <span class="p">]</span> <span class="mf">0.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.</span>                                       <span class="p">]</span> <span class="mf">3.13112</span> <span class="o">/</span>
<span class="p">[</span><span class="o">..</span>                                      <span class="p">]</span> <span class="mf">6.26223</span> <span class="o">-</span>
<span class="p">[</span><span class="o">...</span>                                     <span class="p">]</span> <span class="mf">9.39335</span> \
<span class="p">[</span><span class="o">.....</span>                                   <span class="p">]</span> <span class="mf">12.52446</span> <span class="o">|</span>
<span class="p">[</span><span class="o">......</span>                                  <span class="p">]</span> <span class="mf">15.65558</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.......</span>                                 <span class="p">]</span> <span class="mf">18.78669</span> <span class="o">-</span>
<span class="p">[</span><span class="o">........</span>                                <span class="p">]</span> <span class="mf">21.91781</span> \
<span class="p">[</span><span class="o">..........</span>                              <span class="p">]</span> <span class="mf">25.04892</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...........</span>                             <span class="p">]</span> <span class="mf">28.18004</span> <span class="o">/</span>
<span class="p">[</span><span class="o">............</span>                            <span class="p">]</span> <span class="mf">31.31115</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.............</span>                           <span class="p">]</span> <span class="mf">34.44227</span> \
<span class="p">[</span><span class="o">...............</span>                         <span class="p">]</span> <span class="mf">37.57339</span> <span class="o">|</span>
<span class="p">[</span><span class="o">................</span>                        <span class="p">]</span> <span class="mf">40.70450</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.................</span>                       <span class="p">]</span> <span class="mf">43.83562</span> <span class="o">-</span>
<span class="p">[</span><span class="o">..................</span>                      <span class="p">]</span> <span class="mf">46.96673</span> \
<span class="p">[</span><span class="o">....................</span>                    <span class="p">]</span> <span class="mf">50.09785</span> <span class="o">|</span>
<span class="p">[</span><span class="o">.....................</span>                   <span class="p">]</span> <span class="mf">53.22896</span> <span class="o">/</span>
<span class="p">[</span><span class="o">......................</span>                  <span class="p">]</span> <span class="mf">56.36008</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.......................</span>                 <span class="p">]</span> <span class="mf">59.49119</span> \
<span class="p">[</span><span class="o">.........................</span>               <span class="p">]</span> <span class="mf">62.62231</span> <span class="o">|</span>
<span class="p">[</span><span class="o">..........................</span>              <span class="p">]</span> <span class="mf">65.75342</span> <span class="o">/</span>
<span class="p">[</span><span class="o">...........................</span>             <span class="p">]</span> <span class="mf">68.88454</span> <span class="o">-</span>
<span class="p">[</span><span class="o">............................</span>            <span class="p">]</span> <span class="mf">72.01566</span> \
<span class="p">[</span><span class="o">..............................</span>          <span class="p">]</span> <span class="mf">75.14677</span> <span class="o">|</span>
<span class="p">[</span><span class="o">...............................</span>         <span class="p">]</span> <span class="mf">78.27789</span> <span class="o">/</span>
<span class="p">[</span><span class="o">................................</span>        <span class="p">]</span> <span class="mf">81.40900</span> <span class="o">-</span>
<span class="p">[</span><span class="o">.................................</span>       <span class="p">]</span> <span class="mf">84.54012</span> \
<span class="p">[</span><span class="o">...................................</span>     <span class="p">]</span> <span class="mf">87.67123</span> <span class="o">|</span>
<span class="p">[</span><span class="o">....................................</span>    <span class="p">]</span> <span class="mf">90.80235</span> <span class="o">/</span>
<span class="p">[</span><span class="o">.....................................</span>   <span class="p">]</span> <span class="mf">93.93346</span> <span class="o">-</span>
<span class="p">[</span><span class="o">......................................</span>  <span class="p">]</span> <span class="mf">97.06458</span> \    <span class="n">Computing</span> <span class="n">cluster</span> <span class="n">p</span><span class="o">-</span><span class="n">values</span>
<span class="n">Done</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-and-compare-methods">
<h2><a class="toc-backref" href="#id23">Visualize and compare methods</a><a class="headerlink" href="#visualize-and-compare-methods" title="Permalink to this headline">¶</a></h2>
<p>Let’s take a look at these statistics. The top row shows each test statistic,
and the bottom shows p-values for various statistical tests, with the ones
with proper control over FWER or FDR with bold titles.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span>
          <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span> <span class="o">+</span> <span class="n">ii</span><span class="p">)]</span>
    <span class="n">plot_t_p</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">titles</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">mccs</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_background_statistics_012.png" class="align-center" src="../_images/sphx_glr_plot_background_statistics_012.png" />
<p>The first three columns show the parametric and non-parametric statistics
that are not corrected for multiple comparisons:</p>
<ul class="simple">
<li><strong>t-test</strong> has jagged edges.</li>
<li><strong>“hat” variance correction</strong> of the t-test has reduced peaky edges,
correcting for sharpness in the statistic driven by low-variance voxels.</li>
<li><strong>non-parametric resampling test</strong> is very similar to the t-test. This
is to be expected: the data are drawn from a Gaussian distribution, and
thus satisfy parametric assumptions.</li>
</ul>
<p>The next three columns show multiple comparison corrections of the
mass univariate tests (parametric and non-parametric). These
too conservatively correct for multiple comparisons because neighboring
voxels in our data are correlated:</p>
<ul class="simple">
<li><strong>Bonferroni correction</strong> eliminates any significant activity.</li>
<li><strong>FDR correction</strong> is less conservative than Bonferroni.</li>
<li><strong>Permutation test with a maximum statistic</strong> also eliminates any
significant activity.</li>
</ul>
<p>The final four columns show the non-parametric, cluster-based permutation
tests with a maximum statistic:</p>
<ul class="simple">
<li><strong>Standard clustering</strong> identifies the correct region. However, the whole
area must be declared significant, so no peak analysis can be done.
Also, the peak is broad.</li>
<li><strong>Clustering with “hat”</strong> tightens the estimate of significant activity.</li>
<li><strong>Clustering with TFCE</strong> allows analyzing each significant point
independently, but still has a broadened estimate.</li>
<li><strong>Clustering with TFCE and “hat”</strong> tightens the area declared
significant (again FWER corrected).</li>
</ul>
</div>
<div class="section" id="statistical-functions-in-mne">
<h2><a class="toc-backref" href="#id24">Statistical functions in MNE</a><a class="headerlink" href="#statistical-functions-in-mne" title="Permalink to this headline">¶</a></h2>
<p>The complete listing of statistical functions provided by MNE are in
the <a class="reference internal" href="../python_reference.html#api-reference-statistics"><span class="std std-ref">Statistics API list</span></a>, but we will give
a brief overview here.</p>
<p>MNE provides several convenience parametric testing functions that can be
used in conjunction with the non-parametric clustering methods. However,
the set of functions we provide is not meant to be exhaustive.</p>
<p>If the univariate statistical contrast of interest to you is not listed
here (e.g., interaction term in an unbalanced ANOVA), consider checking
out the <a class="reference external" href="http://www.statsmodels.org/stable/about.html#module-statsmodels" title="(in statsmodels v0.8.0)"><code class="xref py py-mod docutils literal"><span class="pre">statsmodels</span></code></a> package. It offers many functions for computing
statistical contrasts, e.g., <a class="reference external" href="http://www.statsmodels.org/stable/generated/statsmodels.stats.anova.anova_lm.html#statsmodels.stats.anova.anova_lm" title="(in statsmodels v0.8.0)"><code class="xref py py-func docutils literal"><span class="pre">statsmodels.stats.anova.anova_lm()</span></code></a>.
To use these functions in clustering:</p>
<ol class="arabic simple">
<li>Determine which test statistic (e.g., t-value, F-value) you would compute
in a univariate context to compute your contrast of interest. In other
words, if there were only a single output such as reaction times, what
test statistic might you compute on the data?</li>
<li>Wrap the call to that function within a function that takes an input of
the same shape that is expected by your clustering function,
and returns an array of the same shape without the “samples” dimension
(e.g., <a class="reference internal" href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.permutation_cluster_1samp_test()</span></code></a> takes an array
of shape <code class="docutils literal"><span class="pre">(n_samples,</span> <span class="pre">p,</span> <span class="pre">q)</span></code> and returns an array of shape <code class="docutils literal"><span class="pre">(p,</span> <span class="pre">q)</span></code>).</li>
<li>Pass this wrapped function to the <code class="docutils literal"><span class="pre">stat_fun</span></code> argument to the clustering
function.</li>
<li>Set an appropriate <code class="docutils literal"><span class="pre">threshold</span></code> value (float or dict) based on the
values your statistical contrast function returns.</li>
</ol>
<div class="section" id="parametric-methods-provided-by-mne">
<h3><a class="toc-backref" href="#id25">Parametric methods provided by MNE</a><a class="headerlink" href="#parametric-methods-provided-by-mne" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="mne.stats.ttest_1samp_no_p"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.ttest_1samp_no_p()</span></code></a></dt>
<dd>Paired t-test, optionally with hat adjustment.
This is used by default for contrast enhancement in paired cluster tests.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.f_oneway.html#mne.stats.f_oneway" title="mne.stats.f_oneway"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.f_oneway()</span></code></a></dt>
<dd>One-way ANOVA for independent samples.
This can be used to compute various F-contrasts. It is used by default
for contrast enhancement in non-paired cluster tests.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.f_mway_rm.html#mne.stats.f_mway_rm" title="mne.stats.f_mway_rm"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.f_mway_rm()</span></code></a></dt>
<dd>M-way ANOVA for repeated measures and balanced designs.
This returns F-statistics and p-values. The associated helper function
<a class="reference internal" href="../generated/mne.stats.f_threshold_mway_rm.html#mne.stats.f_threshold_mway_rm" title="mne.stats.f_threshold_mway_rm"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.f_threshold_mway_rm()</span></code></a> can be used to determine the
F-threshold at a given significance level.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.linear_regression.html#mne.stats.linear_regression" title="mne.stats.linear_regression"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.linear_regression()</span></code></a></dt>
<dd>Compute ordinary least square regressions on multiple targets, e.g.,
sensors, time points across trials (samples).
For each regressor it returns the beta value, t-statistic, and
uncorrected p-value. While it can be used as a test, it is
particularly useful to compute weighted averages or deal with
continuous predictors.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="non-parametric-methods">
<h3><a class="toc-backref" href="#id26">Non-parametric methods</a><a class="headerlink" href="#non-parametric-methods" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.permutation_cluster_test.html#mne.stats.permutation_cluster_test" title="mne.stats.permutation_cluster_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.permutation_cluster_test()</span></code></a></dt>
<dd>Unpaired contrasts with connectivity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.spatio_temporal_cluster_test.html#mne.stats.spatio_temporal_cluster_test" title="mne.stats.spatio_temporal_cluster_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.spatio_temporal_cluster_test()</span></code></a></dt>
<dd>Unpaired contrasts with spatio-temporal connectivity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="mne.stats.permutation_t_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.permutation_t_test()</span></code></a></dt>
<dd>Paired contrast with no connectivity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.permutation_cluster_1samp_test()</span></code></a></dt>
<dd>Paired contrasts with connectivity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference internal" href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test" title="mne.stats.spatio_temporal_cluster_1samp_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.spatio_temporal_cluster_1samp_test()</span></code></a></dt>
<dd>Paired contrasts with spatio-temporal connectivity.</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In most MNE functions, data has shape
<code class="docutils literal"><span class="pre">(...,</span> <span class="pre">n_space,</span> <span class="pre">n_time)</span></code>, where the spatial dimension can
be e.g. sensors or source vertices. But for our spatio-temporal
clustering functions, the spatial dimensions need to be <strong>last</strong>
for computational efficiency reasons. For example, for
<a class="reference internal" href="../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test" title="mne.stats.spatio_temporal_cluster_1samp_test"><code class="xref py py-func docutils literal"><span class="pre">mne.stats.spatio_temporal_cluster_1samp_test()</span></code></a>, <code class="docutils literal"><span class="pre">X</span></code>
needs to be of shape <code class="docutils literal"><span class="pre">(n_samples,</span> <span class="pre">n_time,</span> <span class="pre">n_space)</span></code>. You can
use <a class="reference external" href="https://docs.scipy.org/doc/numpy-dev/reference/generated/numpy.transpose.html#numpy.transpose" title="(in NumPy v1.13.dev0)"><code class="xref py py-func docutils literal"><span class="pre">numpy.transpose()</span></code></a> to transpose axes if necessary.</p>
</div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id27">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>, <a class="fn-backref" href="#id5">3</a>)</em> Ridgway et al. 2012, “The problem of low variance voxels in
statistical parametric mapping; a new hat avoids a ‘haircut’”,
NeuroImage. 2012 Feb 1;59(3):2131-41.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[2]</a></td><td>Smith and Nichols 2009, “Threshold-free cluster enhancement:
addressing problems of smoothing, threshold dependence, and
localisation in cluster inference”, NeuroImage 44 (2009) 83-98.</td></tr>
</tbody>
</table>
<p><strong>Total running time of the script:</strong> ( 0 minutes  27.825 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_background_statistics.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_background_statistics.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_background_statistics.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_background_statistics.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><img src="../_static/institutions.png" alt="Institutions"></div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2017, MNE Developers. Last updated on 2017-11-29.</p>
  </div>
</footer>
  </body>
</html>