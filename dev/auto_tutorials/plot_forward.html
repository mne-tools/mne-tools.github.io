<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Head model and forward computation &#8212; MNE 0.18.dev0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/reset-syntax.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <script type="text/javascript" src="../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.18.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.18.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Install</a></li>
                <li><a href="../documentation.html">Documentation</a></li>
                <li><a href="../python_reference.html">API</a></li>
                <li><a href="../glossary.html">Glossary</a></li>
                <li><a href="../auto_examples/index.html">Examples</a></li>
                <li><a href="../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.18.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.17 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Head model and forward computation</a><ul>
<li><a class="reference internal" href="#computing-the-forward-operator">Computing the forward operator</a></li>
<li><a class="reference internal" href="#compute-and-visualize-bem-surfaces">Compute and visualize BEM surfaces</a></li>
<li><a class="reference internal" href="#visualization-the-coregistration">Visualization the coregistration</a></li>
<li><a class="reference internal" href="#compute-source-space">Compute Source Space</a></li>
<li><a class="reference internal" href="#compute-forward-solution">Compute forward solution</a></li>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>

<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12 content">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-plot-forward-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="head-model-and-forward-computation">
<span id="tut-forward"></span><span id="sphx-glr-auto-tutorials-plot-forward-py"></span><h1>Head model and forward computation<a class="headerlink" href="#head-model-and-forward-computation" title="Permalink to this headline">¶</a></h1>
<p>The aim of this tutorial is to be a getting started for forward
computation.</p>
<p>For more extensive details and presentation of the general
concepts for forward modeling. See <a class="reference internal" href="../manual/source_localization/forward.html#ch-forward"><span class="std std-ref">The forward solution</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="k">import</span> <span class="n">sample</span>
<span class="n">data_path</span> <span class="o">=</span> <a href="../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path" title="View documentation for mne.datasets.sample.data_path"><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>

<span class="c1"># the raw file containing the channel location + types</span>
<span class="n">raw_fname</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;/MEG/sample/sample_audvis_raw.fif&#39;</span>
<span class="c1"># The paths to Freesurfer reconstructions</span>
<span class="n">subjects_dir</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;/subjects&#39;</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>
</pre></div>
</div>
<div class="section" id="computing-the-forward-operator">
<h2>Computing the forward operator<a class="headerlink" href="#computing-the-forward-operator" title="Permalink to this headline">¶</a></h2>
<p>To compute a forward operator we need:</p>
<blockquote>
<div><ul class="simple">
<li>a <code class="docutils literal notranslate"><span class="pre">-trans.fif</span></code> file that contains the coregistration info.</li>
<li>a source space</li>
<li>the <a class="reference internal" href="../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> surfaces</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="compute-and-visualize-bem-surfaces">
<h2>Compute and visualize BEM surfaces<a class="headerlink" href="#compute-and-visualize-bem-surfaces" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> surfaces are the triangulations of the interfaces between
different tissues needed for forward computation. These surfaces are for
example the inner skull surface, the outer skull surface and the outer skin
surface, a.k.a. scalp surface.</p>
<p>Computing the BEM surfaces requires FreeSurfer and makes use of either of
the two following command line tools:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../generated/commands.html#gen-mne-watershed-bem"><span class="std std-ref">mne watershed_bem</span></a></li>
<li><a class="reference internal" href="../generated/commands.html#gen-mne-flash-bem"><span class="std std-ref">mne flash_bem</span></a></li>
</ul>
</div></blockquote>
<p>Or by calling in a Python script one of the functions
<a class="reference internal" href="../generated/mne.bem.make_watershed_bem.html#mne.bem.make_watershed_bem" title="mne.bem.make_watershed_bem"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.bem.make_watershed_bem()</span></code></a> or <a class="reference internal" href="../generated/mne.bem.make_flash_bem.html#mne.bem.make_flash_bem" title="mne.bem.make_flash_bem"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.bem.make_flash_bem()</span></code></a>.</p>
<p>Here we’ll assume it’s already computed. It takes a few minutes per subject.</p>
<p>For EEG we use 3 layers (inner skull, outer skull, and skin) while for
MEG 1 layer (inner skull) is enough.</p>
<p>Let’s look at these surfaces. The function <a class="reference internal" href="../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="mne.viz.plot_bem"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_bem()</span></code></a>
assumes that you have the the <em>bem</em> folder of your subject FreeSurfer
reconstruction the necessary files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_forward_001.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_forward_001.png" />
</div>
<div class="section" id="visualization-the-coregistration">
<h2>Visualization the coregistration<a class="headerlink" href="#visualization-the-coregistration" title="Permalink to this headline">¶</a></h2>
<p>The coregistration is operation that allows to position the head and the
sensors in a common coordinate system. In the MNE software the transformation
to align the head and the sensors in stored in a so-called <strong>trans file</strong>.
It is a FIF file that ends with <code class="docutils literal notranslate"><span class="pre">-trans.fif</span></code>. It can be obtained with
<a class="reference internal" href="../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a> (or its convenient command line
equivalent <a class="reference internal" href="../generated/commands.html#gen-mne-coreg"><span class="std std-ref">mne coreg</span></a>), or mrilab if you’re using a Neuromag
system.</p>
<p>For the Python version see <a class="reference internal" href="../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a></p>
<p>Here we assume the coregistration is done, so we just visually check the
alignment with the following code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The transformation file obtained by coregistration</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s1">&#39;/MEG/sample/sample_audvis_raw-trans.fif&#39;</span>

<span class="n">info</span> <span class="o">=</span> <a href="../generated/mne.io.read_info.html#mne.io.read_info" title="View documentation for mne.io.read_info"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_info</span></a><span class="p">(</span><span class="n">raw_fname</span><span class="p">)</span>
<span class="c1"># Here we look at the dense head, which isn&#39;t used for BEM computations but</span>
<span class="c1"># is useful for coregistration.</span>
<a href="../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="View documentation for mne.viz.plot_alignment"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_alignment</span></a><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">dig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">meg</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;helmet&#39;</span><span class="p">,</span> <span class="s1">&#39;sensors&#39;</span><span class="p">],</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                       <span class="n">surfaces</span><span class="o">=</span><span class="s1">&#39;head-dense&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_forward_002.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_forward_002.png" />
</div>
<div class="section" id="compute-source-space">
<span id="plot-forward-source-space"></span><h2>Compute Source Space<a class="headerlink" href="#compute-source-space" title="Permalink to this headline">¶</a></h2>
<p>The source space defines the position and orientation of the candidate source
locations. There are two types of source spaces:</p>
<ul class="simple">
<li><strong>source-based</strong> source space when the candidates are confined to a
surface.</li>
<li><strong>volumetric or discrete</strong> source space when the candidates are discrete,
arbitrarily located source points bounded by the surface.</li>
</ul>
<p><strong>Source-based</strong> source space is computed using
<a class="reference internal" href="../generated/mne.setup_source_space.html#mne.setup_source_space" title="mne.setup_source_space"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.setup_source_space()</span></code></a>, while <strong>volumetric</strong> source space is computed
using <a class="reference internal" href="../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="mne.setup_volume_source_space"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.setup_volume_source_space()</span></code></a>.</p>
<p>We will now compute a source-based source space with an OCT-6 resolution.
See <a class="reference internal" href="../manual/cookbook.html#setting-up-source-space"><span class="std std-ref">Setting up the source space</span></a> for details on source space definition
and spacing parameter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span> <span class="o">=</span> <a href="../generated/mne.setup_source_space.html#mne.setup_source_space" title="View documentation for mne.setup_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_source_space</span></a><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;oct6&#39;</span><span class="p">,</span>
                             <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">add_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;SourceSpaces: [&lt;surface (lh), n_vertices=155407, n_used=4098, coordinate_frame=MRI (surface RAS)&gt;, &lt;surface (rh), n_vertices=156866, n_used=4098, coordinate_frame=MRI (surface RAS)&gt;]&gt;
</pre></div>
</div>
<p>The surface based source space <code class="docutils literal notranslate"><span class="pre">src</span></code> contains two parts, one for the left
hemisphere (4098 locations) and one for the right hemisphere
(4098 locations). Sources can be visualized on top of the BEM surfaces
in purple.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_forward_003.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_forward_003.png" />
<p>To compute a volume based source space defined with a grid of candidate
dipoles inside a sphere of radius 90mm centered at (0.0, 0.0, 40.0)
you can use the following code.
Obviously here, the sphere is not perfect. It is not restricted to the
brain and it can miss some parts of the cortex.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sphere</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">)</span>
<span class="n">vol_src</span> <span class="o">=</span> <a href="../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="View documentation for mne.setup_volume_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_volume_source_space</span></a><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                                        <span class="n">sphere</span><span class="o">=</span><span class="n">sphere</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vol_src</span><span class="p">)</span>

<a href="../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">vol_src</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_forward_004.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_forward_004.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;SourceSpaces: [&lt;volume, shape=[39 39 38], n_used=20377, coordinate_frame=MRI (surface RAS)&gt;]&gt;
</pre></div>
</div>
<p>To compute a volume based source space defined with a grid of candidate
dipoles inside the brain (requires the <a class="reference internal" href="../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> surfaces) you can use the
following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">surface</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="s1">&#39;bem&#39;</span><span class="p">,</span> <span class="s1">&#39;inner_skull.surf&#39;</span><span class="p">)</span>
<span class="n">vol_src</span> <span class="o">=</span> <a href="../generated/mne.setup_volume_source_space.html#mne.setup_volume_source_space" title="View documentation for mne.setup_volume_source_space"><span class="n">mne</span><span class="o">.</span><span class="n">setup_volume_source_space</span></a><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                                        <span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vol_src</span><span class="p">)</span>

<a href="../generated/mne.viz.plot_bem.html#mne.viz.plot_bem" title="View documentation for mne.viz.plot_bem"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_bem</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                 <span class="n">brain_surfaces</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">vol_src</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;coronal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_forward_005.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_forward_005.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;SourceSpaces: [&lt;volume, shape=[29 35 32], n_used=10376, coordinate_frame=MRI (surface RAS)&gt;]&gt;
</pre></div>
</div>
<p>With the surface-based source space only sources that lie in the plotted MRI
slices are shown. Let’s write a few lines of mayavi to see all sources in 3D.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">mayavi</span> <span class="k">import</span> <span class="n">mlab</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">surfer</span> <span class="k">import</span> <a href="https://pysurfer.github.io/generated/surfer.Brain.html#surfer.Brain" title="View documentation for surfer.Brain"><span class="n">Brain</span></a>  <span class="c1"># noqa</span>

<span class="n">brain</span> <span class="o">=</span> <a href="https://pysurfer.github.io/generated/surfer.Brain.html#surfer.Brain" title="View documentation for surfer.Brain"><span class="n">Brain</span></a><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;lh&#39;</span><span class="p">,</span> <span class="s1">&#39;inflated&#39;</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">)</span>
<span class="n">surf</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">geo</span><span class="p">[</span><span class="s1">&#39;lh&#39;</span><span class="p">]</span>

<span class="n">vertidx</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="View documentation for numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;inuse&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<a href="http://docs.enthought.com/mayavi/mayavi/auto/mlab_helper_functions.html#mayavi.mlab.points3d" title="View documentation for mayavi.mlab.points3d"><span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span></a><span class="p">(</span><span class="n">surf</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">vertidx</span><span class="p">],</span> <span class="n">surf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">vertidx</span><span class="p">],</span>
              <span class="n">surf</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">vertidx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_forward_006.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_forward_006.png" />
</div>
<div class="section" id="compute-forward-solution">
<span id="plot-forward-compute-forward-solution"></span><h2>Compute forward solution<a class="headerlink" href="#compute-forward-solution" title="Permalink to this headline">¶</a></h2>
<p>We can now compute the forward solution.
To reduce computation we’ll just compute a single layer BEM (just inner
skull) that can then be used for MEG (not EEG).</p>
<p>We specify if we want a one-layer or a three-layer BEM using the
conductivity parameter.</p>
<p>The BEM solution requires a BEM model which describes the geometry
of the head the conductivities of the different tissues.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conductivity</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,)</span>  <span class="c1"># for single layer</span>
<span class="c1"># conductivity = (0.3, 0.006, 0.3)  # for three layers</span>
<span class="n">model</span> <span class="o">=</span> <a href="../generated/mne.make_bem_model.html#mne.make_bem_model" title="View documentation for mne.make_bem_model"><span class="n">mne</span><span class="o">.</span><span class="n">make_bem_model</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ico</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                           <span class="n">conductivity</span><span class="o">=</span><span class="n">conductivity</span><span class="p">,</span>
                           <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">)</span>
<span class="n">bem</span> <span class="o">=</span> <a href="../generated/mne.make_bem_solution.html#mne.make_bem_solution" title="View documentation for mne.make_bem_solution"><span class="n">mne</span><span class="o">.</span><span class="n">make_bem_solution</span></a><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the <a class="reference internal" href="../glossary.html#term-bem"><span class="xref std std-term">BEM</span></a> does not involve any use of the trans file. The BEM
only depends on the head geometry and conductivities.
It is therefore independent from the MEG data and the head position.</p>
<p>Let’s now compute the forward operator, commonly referred to as the
gain or leadfield matrix.</p>
<p>See <a class="reference internal" href="../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_forward_solution()</span></code></a> for details on parameters meaning.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fwd</span> <span class="o">=</span> <a href="../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="View documentation for mne.make_forward_solution"><span class="n">mne</span><span class="o">.</span><span class="n">make_forward_solution</span></a><span class="p">(</span><span class="n">raw_fname</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">bem</span><span class="o">=</span><span class="n">bem</span><span class="p">,</span>
                                <span class="n">meg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mindist</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fwd</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Forward | MEG channels: 306 | EEG channels: 0 | Source space: Surface with 7498 vertices | Source orientation: Free&gt;
</pre></div>
</div>
<p>We can explore the content of fwd to access the numpy array that contains
the gain matrix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">leadfield</span> <span class="o">=</span> <span class="n">fwd</span><span class="p">[</span><span class="s1">&#39;sol&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Leadfield size : </span><span class="si">%d</span><span class="s2"> sensors x </span><span class="si">%d</span><span class="s2"> dipoles&quot;</span> <span class="o">%</span> <span class="n">leadfield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Leadfield size : 306 sensors x 22494 dipoles
</pre></div>
</div>
<p>To extract the numpy array containing the forward operator corresponding to
the source space <em class="xref py py-obj">fwd[‘src’]</em> with cortical orientation constraint
we can use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fwd_fixed</span> <span class="o">=</span> <a href="../generated/mne.convert_forward_solution.html#mne.convert_forward_solution" title="View documentation for mne.convert_forward_solution"><span class="n">mne</span><span class="o">.</span><span class="n">convert_forward_solution</span></a><span class="p">(</span><span class="n">fwd</span><span class="p">,</span> <span class="n">surf_ori</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">use_cps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">leadfield</span> <span class="o">=</span> <span class="n">fwd_fixed</span><span class="p">[</span><span class="s1">&#39;sol&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Leadfield size : </span><span class="si">%d</span><span class="s2"> sensors x </span><span class="si">%d</span><span class="s2"> dipoles&quot;</span> <span class="o">%</span> <span class="n">leadfield</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Leadfield size : 306 sensors x 7498 dipoles
</pre></div>
</div>
<p>This is equivalent to the following code that explicitly applies the
forward operator to a source estimate composed of the identity operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_dipoles</span> <span class="o">=</span> <span class="n">leadfield</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">src_hemi</span><span class="p">[</span><span class="s1">&#39;vertno&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">src_hemi</span> <span class="ow">in</span> <span class="n">fwd_fixed</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]]</span>
<span class="n">stc</span> <span class="o">=</span> <a href="../generated/mne.SourceEstimate.html#mne.SourceEstimate" title="View documentation for mne.SourceEstimate"><span class="n">mne</span><span class="o">.</span><span class="n">SourceEstimate</span></a><span class="p">(</span><span class="mf">1e-9</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.eye.html#numpy.eye" title="View documentation for numpy.eye"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><span class="n">n_dipoles</span><span class="p">),</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tstep</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">leadfield</span> <span class="o">=</span> <a href="../generated/mne.apply_forward.html#mne.apply_forward" title="View documentation for mne.apply_forward"><span class="n">mne</span><span class="o">.</span><span class="n">apply_forward</span></a><span class="p">(</span><span class="n">fwd_fixed</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mf">1e-9</span>
</pre></div>
</div>
<p>To save to disk a forward solution you can use
<a class="reference internal" href="../generated/mne.write_forward_solution.html#mne.write_forward_solution" title="mne.write_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.write_forward_solution()</span></code></a> and to read it back from disk
<a class="reference internal" href="../generated/mne.read_forward_solution.html#mne.read_forward_solution" title="mne.read_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.read_forward_solution()</span></code></a>. Don’t forget that FIF files containing
forward solution should end with <em>-fwd.fif</em>.</p>
<p>To get a fixed-orientation forward solution, use
<a class="reference internal" href="../generated/mne.convert_forward_solution.html#mne.convert_forward_solution" title="mne.convert_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.convert_forward_solution()</span></code></a> to convert the free-orientation
solution to (surface-oriented) fixed orientation.</p>
</div>
<div class="section" id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h2>
<p>By looking at
<a class="reference internal" href="../auto_examples/forward/plot_forward_sensitivity_maps.html#sphx-glr-auto-examples-forward-plot-forward-sensitivity-maps-py"><span class="std std-ref">Display sensitivity maps for EEG and MEG sensors</span></a>
plot the sensitivity maps for EEG and compare it with the MEG, can you
justify the claims that:</p>
<blockquote>
<div><ul class="simple">
<li>MEG is not sensitive to radial sources</li>
<li>EEG is more sensitive to deep sources</li>
</ul>
</div></blockquote>
<p>How will the MEG sensitivity maps and histograms change if you use a free
instead if a fixed/surface oriented orientation?</p>
<p>Try this changing the mode parameter in <a class="reference internal" href="../generated/mne.sensitivity_map.html#mne.sensitivity_map" title="mne.sensitivity_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.sensitivity_map()</span></code></a>
accordingly. Why don’t we see any dipoles on the gyri?</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  24.090 seconds)</p>
<p><strong>Estimated memory usage:</strong>  1034 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-plot-forward-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/a7e7fe438d475130bc2d2f3337432535/plot_forward.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_forward.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/908e04a8b6894ebc76b94910bf9a28cf/plot_forward.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_forward.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><img src="../_static/institutions.png" alt="Institutions"></div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-03-18.</p>
  </div>
</footer>
  </body>
</html>