.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_visualization_plot_channel_epochs_image.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_visualization_plot_channel_epochs_image.py:


=========================================
Visualize channel over epochs as an image
=========================================

This will produce what is sometimes called an event related
potential / field (ERP/ERF) image.

Two images are produced, one with a good channel and one with a channel
that does not show any evoked field.

It is also demonstrated how to reorder the epochs using a 1D spectral
embedding as described in:

Graph-based variability estimation in single-trial event-related neural
responses A. Gramfort, R. Keriven, M. Clerc, 2010,
Biomedical Engineering, IEEE Trans. on, vol. 57 (5), 1051-1061
https://hal.inria.fr/inria-00497023


.. code-block:: python

    # Authors: Alexandre Gramfort <alexandre.gramfort@telecom-paristech.fr>
    #
    # License: BSD (3-clause)

    import numpy as np
    import matplotlib.pyplot as plt

    import mne
    from mne import io
    from mne.datasets import sample

    print(__doc__)

    data_path = sample.data_path()







Set parameters


.. code-block:: python

    raw_fname = data_path + '/MEG/sample/sample_audvis_filt-0-40_raw.fif'
    event_fname = data_path + '/MEG/sample/sample_audvis_filt-0-40_raw-eve.fif'
    event_id, tmin, tmax = 1, -0.2, 0.4

    # Setup for reading the raw data
    raw = io.read_raw_fif(raw_fname)
    events = mne.read_events(event_fname)

    # Set up pick list: EEG + MEG - bad channels (modify to your needs)
    raw.info['bads'] = ['MEG 2443', 'EEG 053']
    picks = mne.pick_types(raw.info, meg='grad', eeg=False, stim=True, eog=True,
                           exclude='bads')

    # Read epochs
    epochs = mne.Epochs(raw, events, event_id, tmin, tmax, proj=True,
                        picks=picks, baseline=(None, 0), preload=True,
                        reject=dict(grad=4000e-13, eog=150e-6))





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Opening raw data file /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis_filt-0-40_raw.fif...
        Read a total of 4 projection items:
            PCA-v1 (1 x 102)  idle
            PCA-v2 (1 x 102)  idle
            PCA-v3 (1 x 102)  idle
            Average EEG reference (1 x 60)  idle
        Range : 6450 ... 48149 =     42.956 ...   320.665 secs
    Ready.
    Current compensation grade : 0
    72 matching events found
    Applying baseline correction (mode: mean)
    Not setting metadata
    4 projection items activated
    Loading data for 72 events and 91 original time points ...
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
        Rejecting  epoch based on EOG : ['EOG 061']
    9 bad epochs dropped


Show event related fields images


.. code-block:: python


    # and order with spectral reordering
    # If you don't have scikit-learn installed set order_func to None
    from sklearn.cluster.spectral import spectral_embedding  # noqa
    from sklearn.metrics.pairwise import rbf_kernel   # noqa


    def order_func(times, data):
        this_data = data[:, (times > 0.0) & (times < 0.350)]
        this_data /= np.sqrt(np.sum(this_data ** 2, axis=1))[:, np.newaxis]
        return np.argsort(spectral_embedding(rbf_kernel(this_data, gamma=1.),
                          n_components=1, random_state=0).ravel())

    good_pick = 97  # channel with a clear evoked response
    bad_pick = 98  # channel with no evoked response

    # We'll also plot a sample time onset for each trial
    plt_times = np.linspace(0, .2, len(epochs))

    plt.close('all')
    mne.viz.plot_epochs_image(epochs, [good_pick, bad_pick], sigma=.5,
                              order=order_func, vmin=-250, vmax=250,
                              overlay_times=plt_times, show=True)



.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/visualization/images/sphx_glr_plot_channel_epochs_image_001.png
            :class: sphx-glr-multi-img

    *

      .. image:: /auto_examples/visualization/images/sphx_glr_plot_channel_epochs_image_002.png
            :class: sphx-glr-multi-img




**Total running time of the script:** ( 0 minutes  2.495 seconds)


.. _sphx_glr_download_auto_examples_visualization_plot_channel_epochs_image.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_channel_epochs_image.py <plot_channel_epochs_image.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_channel_epochs_image.ipynb <plot_channel_epochs_image.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
