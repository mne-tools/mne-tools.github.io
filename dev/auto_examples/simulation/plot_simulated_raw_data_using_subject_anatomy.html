<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Simulate raw data using subject anatomy &#8212; MNE 0.19.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>

<div class="row devbar alert alert-danger">
This documentation is for <strong>development version 0.19.dev0</strong>.
</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.19.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install/index.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../index.html">Examples</a></li>
                <li><a href="../../auto_tutorials/index.html">Tutorials</a></li>
                <li><a href="../../install/contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-danger navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.19.dev0
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Simulate raw data using subject anatomy</a><ul>
<li><a class="reference internal" href="#create-simulated-source-activity">Create simulated source activity</a></li>
<li><a class="reference internal" href="#simulate-raw-data">Simulate raw data</a></li>
<li><a class="reference internal" href="#reconstruct-simulated-source-time-courses-using-dspm-inverse-operator">Reconstruct simulated source time courses using dSPM inverse operator</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-simulation-plot-simulated-raw-data-using-subject-anatomy-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="simulate-raw-data-using-subject-anatomy">
<span id="sphx-glr-auto-examples-simulation-plot-simulated-raw-data-using-subject-anatomy-py"></span><h1>Simulate raw data using subject anatomy<a class="headerlink" href="#simulate-raw-data-using-subject-anatomy" title="Permalink to this headline">¶</a></h1>
<p>This example illustrates how to generate source estimates and simulate raw data
using subject anatomy with the <a class="reference internal" href="../../generated/mne.simulation.SourceSimulator.html#mne.simulation.SourceSimulator" title="mne.simulation.SourceSimulator"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.simulation.SourceSimulator</span></code></a> class.
Once the raw data is simulated, generated source estimates are reconstructed
using dynamic statistical parametric mapping (dSPM) inverse operator.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Author: Ivana Kojcic &lt;ivana.kojcic@gmail.com&gt;</span>
<span class="c1">#         Eric Larson &lt;larson.eric.d@gmail.com&gt;</span>
<span class="c1">#         Kostiantyn Maksymenko &lt;kostiantyn.maksymenko@gmail.com&gt;</span>
<span class="c1">#         Samuel Deslauriers-Gauthier &lt;sam.deslauriers@gmail.com&gt;</span>

<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="k">import</span> <span class="n">sample</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>

<span class="c1"># To simulate the sample dataset, information of the sample subject needs to be</span>
<span class="c1"># loaded. This step will download the data if it not already on your machine.</span>
<span class="c1"># Subjects directory is also set so it doesn&#39;t need to be given to functions.</span>
<span class="n">data_path</span> <span class="o">=</span> <a href="../../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path" title="View documentation for mne.datasets.sample.data_path"><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<span class="n">subjects_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;subjects&#39;</span><span class="p">)</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>
<span class="n">meg_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="n">subject</span><span class="p">)</span>

<span class="c1"># First, we get an info structure from the sample subject.</span>
<span class="n">fname_info</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meg_path</span><span class="p">,</span> <span class="s1">&#39;sample_audvis_raw.fif&#39;</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <a href="../../generated/mne.io.read_info.html#mne.io.read_info" title="View documentation for mne.io.read_info"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_info</span></a><span class="p">(</span><span class="n">fname_info</span><span class="p">)</span>
<span class="n">tstep</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;sfreq&#39;</span><span class="p">]</span>

<span class="c1"># To simulate sources, we also need a source space. It can be obtained from the</span>
<span class="c1"># forward solution of the sample subject.</span>
<span class="n">fwd_fname</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meg_path</span><span class="p">,</span> <span class="s1">&#39;sample_audvis-meg-eeg-oct-6-fwd.fif&#39;</span><span class="p">)</span>
<span class="n">fwd</span> <span class="o">=</span> <a href="../../generated/mne.read_forward_solution.html#mne.read_forward_solution" title="View documentation for mne.read_forward_solution"><span class="n">mne</span><span class="o">.</span><span class="n">read_forward_solution</span></a><span class="p">(</span><span class="n">fwd_fname</span><span class="p">)</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">fwd</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span>

<span class="c1"># To simulate raw data, we need to define when the activity occurs using events</span>
<span class="c1"># matrix and specify the IDs of each event.</span>
<span class="c1"># Noise covariance matrix also needs to be defined.</span>
<span class="c1"># Here, both are loaded from the sample dataset, but they can also be specified</span>
<span class="c1"># by the user.</span>

<span class="n">fname_event</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meg_path</span><span class="p">,</span> <span class="s1">&#39;sample_audvis_raw-eve.fif&#39;</span><span class="p">)</span>
<span class="n">fname_cov</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meg_path</span><span class="p">,</span> <span class="s1">&#39;sample_audvis-cov.fif&#39;</span><span class="p">)</span>

<span class="n">events</span> <span class="o">=</span> <a href="../../generated/mne.read_events.html#mne.read_events" title="View documentation for mne.read_events"><span class="n">mne</span><span class="o">.</span><span class="n">read_events</span></a><span class="p">(</span><span class="n">fname_event</span><span class="p">)</span>
<span class="n">noise_cov</span> <span class="o">=</span> <a href="../../generated/mne.read_cov.html#mne.read_cov" title="View documentation for mne.read_cov"><span class="n">mne</span><span class="o">.</span><span class="n">read_cov</span></a><span class="p">(</span><span class="n">fname_cov</span><span class="p">)</span>

<span class="c1"># Standard sample event IDs. These values will correspond to the third column</span>
<span class="c1"># in the events matrix.</span>
<span class="n">event_id</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;auditory/left&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;auditory/right&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;visual/left&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;visual/right&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;smiley&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;button&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    Read a total of 3 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
Reading forward solution from /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis-meg-eeg-oct-6-fwd.fif...
    Reading a source space...
    Computing patch statistics...
    Patch information added...
    Distance information added...
    [done]
    Reading a source space...
    Computing patch statistics...
    Patch information added...
    Distance information added...
    [done]
    2 source spaces read
    Desired named matrix (kind = 3523) not available
    Read MEG forward solution (7498 sources, 306 channels, free orientations)
    Desired named matrix (kind = 3523) not available
    Read EEG forward solution (7498 sources, 60 channels, free orientations)
    MEG and EEG forward solutions combined
    Source spaces transformed to the forward solution coordinate frame
    366 x 366 full covariance (kind = 1) found.
    Read a total of 4 projection items:
        PCA-v1 (1 x 102) active
        PCA-v2 (1 x 102) active
        PCA-v3 (1 x 102) active
        Average EEG reference (1 x 60) active
</pre></div>
</div>
<p>In order to simulate source time courses, labels of desired active regions
need to be specified for each of the 4 simulation conditions.
Make a dictionary that maps conditions to activation strengths within
aparc.a2009s <a class="footnote-reference brackets" href="#id2" id="id1">1</a> labels. In the aparc.a2009s parcellation:</p>
<ul class="simple">
<li><p>‘G_temp_sup-G_T_transv’ is the label for primary auditory area</p></li>
<li><p>‘S_calcarine’ is the label for primary visual area</p></li>
</ul>
<p>In each of the 4 conditions, only the primary area is activated. This means
that during the activations of auditory areas, there are no activations in
visual areas and vice versa.
Moreover, for each condition, contralateral region is more active (here, 2
times more) than the ipsilateral.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;auditory/left&#39;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s1">&#39;G_temp_sup-G_T_transv-lh&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>          <span class="c1"># label, activation (nAm)</span>
         <span class="p">(</span><span class="s1">&#39;G_temp_sup-G_T_transv-rh&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)],</span>
    <span class="s1">&#39;auditory/right&#39;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s1">&#39;G_temp_sup-G_T_transv-lh&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;G_temp_sup-G_T_transv-rh&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)],</span>
    <span class="s1">&#39;visual/left&#39;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s1">&#39;S_calcarine-lh&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;S_calcarine-rh&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)],</span>
    <span class="s1">&#39;visual/right&#39;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s1">&#39;S_calcarine-lh&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;S_calcarine-rh&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)],</span>
<span class="p">}</span>

<span class="n">annot</span> <span class="o">=</span> <span class="s1">&#39;aparc.a2009s&#39;</span>

<span class="c1"># Load the 4 necessary label names.</span>
<span class="n">label_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">activation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                         <span class="k">for</span> <span class="n">activation_list</span> <span class="ow">in</span> <span class="n">activations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                         <span class="k">for</span> <span class="n">activation</span> <span class="ow">in</span> <span class="n">activation_list</span><span class="p">))</span>
<span class="n">region_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">activations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1">#  Define the time course of the activity for each region to activate. We use a</span>
<span class="c1">#  sine wave and it will be the same for all 4 regions.</span>
<span class="n">source_time_series</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.sin.html#numpy.sin" title="View documentation for numpy.sin"><span class="n">np</span><span class="o">.</span><span class="n">sin</span></a><span class="p">(</span><a href="https://www.numpy.org/devdocs/reference/generated/numpy.linspace.html#numpy.linspace" title="View documentation for numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="o">*</span> <span class="mf">10e-9</span>
</pre></div>
</div>
<div class="section" id="create-simulated-source-activity">
<h2>Create simulated source activity<a class="headerlink" href="#create-simulated-source-activity" title="Permalink to this headline">¶</a></h2>
<p>Here, <a class="reference internal" href="../../generated/mne.simulation.SourceSimulator.html#mne.simulation.SourceSimulator" title="mne.simulation.SourceSimulator"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceSimulator</span></code></a> is used, which allows to
specify where (label), what (source_time_series), and when (events) event
type will occur.</p>
<p>We will add data for 4 areas, each of which contains 2 labels. Since add_data
method accepts 1 label per call, it will be called 2 times per area.
All activations will contain the same waveform, but the amplitude will be 2
times higher in the contralateral label, as explained before.</p>
<p>When the activity occurs is defined using events. In this case, they are
taken from the original raw data. The first column is the sample of the
event, the second is not used. The third one is the event id, which is
different for each of the 4 areas.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source_simulator</span> <span class="o">=</span> <a href="../../generated/mne.simulation.SourceSimulator.html#mne.simulation.SourceSimulator" title="View documentation for mne.simulation.SourceSimulator"><span class="n">mne</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">SourceSimulator</span></a><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tstep</span><span class="o">=</span><span class="n">tstep</span><span class="p">)</span>
<span class="k">for</span> <span class="n">region_id</span><span class="p">,</span> <span class="n">region_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">region_names</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">events_tmp</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><a href="https://www.numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="View documentation for numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">events</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">region_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">label_name</span> <span class="o">=</span> <span class="n">activations</span><span class="p">[</span><span class="n">region_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">label_tmp</span> <span class="o">=</span> <a href="../../generated/mne.read_labels_from_annot.html#mne.read_labels_from_annot" title="View documentation for mne.read_labels_from_annot"><span class="n">mne</span><span class="o">.</span><span class="n">read_labels_from_annot</span></a><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">annot</span><span class="p">,</span>
                                               <span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span>
                                               <span class="n">regexp</span><span class="o">=</span><span class="n">label_name</span><span class="p">,</span>
                                               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">label_tmp</span> <span class="o">=</span> <span class="n">label_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">amplitude_tmp</span> <span class="o">=</span> <span class="n">activations</span><span class="p">[</span><span class="n">region_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">source_simulator</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label_tmp</span><span class="p">,</span>
                                  <span class="n">amplitude_tmp</span> <span class="o">*</span> <span class="n">source_time_series</span><span class="p">,</span>
                                  <span class="n">events_tmp</span><span class="p">)</span>

<span class="c1"># To obtain a SourceEstimate object, we need to use `get_stc()` method of</span>
<span class="c1"># SourceSimulator class.</span>
<span class="n">stc_data</span> <span class="o">=</span> <span class="n">source_simulator</span><span class="o">.</span><span class="n">get_stc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="simulate-raw-data">
<h2>Simulate raw data<a class="headerlink" href="#simulate-raw-data" title="Permalink to this headline">¶</a></h2>
<p>Project the source time series to sensor space. Three types of noise will be
added to the simulated raw data:</p>
<ul class="simple">
<li><p>multivariate Gaussian noise obtained from the noise covariance from the
sample data</p></li>
<li><p>blink (EOG) noise</p></li>
<li><p>ECG noise</p></li>
</ul>
<p>The <a class="reference internal" href="../../generated/mne.simulation.SourceSimulator.html#mne.simulation.SourceSimulator" title="mne.simulation.SourceSimulator"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceSimulator</span></code></a> can be given directly to the
<a class="reference internal" href="../../generated/mne.simulation.simulate_raw.html#mne.simulation.simulate_raw" title="mne.simulation.simulate_raw"><code class="xref py py-func docutils literal notranslate"><span class="pre">simulate_raw()</span></code></a> function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw_sim</span> <span class="o">=</span> <a href="../../generated/mne.simulation.simulate_raw.html#mne.simulation.simulate_raw" title="View documentation for mne.simulation.simulate_raw"><span class="n">mne</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">simulate_raw</span></a><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">source_simulator</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="n">fwd</span><span class="p">,</span>
                                      <span class="n">cov</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">raw_sim</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># for speed</span>

<a href="../../generated/mne.simulation.add_noise.html#mne.simulation.add_noise" title="View documentation for mne.simulation.add_noise"><span class="n">mne</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">add_noise</span></a><span class="p">(</span><span class="n">raw_sim</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">noise_cov</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a href="../../generated/mne.simulation.add_eog.html#mne.simulation.add_eog" title="View documentation for mne.simulation.add_eog"><span class="n">mne</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">add_eog</span></a><span class="p">(</span><span class="n">raw_sim</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a href="../../generated/mne.simulation.add_ecg.html#mne.simulation.add_ecg" title="View documentation for mne.simulation.add_ecg"><span class="n">mne</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">add_ecg</span></a><span class="p">(</span><span class="n">raw_sim</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot original and simulated raw data.</span>
<span class="n">raw_sim</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Simulated raw data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up raw simulation: 1 position, &quot;cos2&quot; interpolation
Event information stored on channel:              STI 014
Setting up forward solutions
Computing gain matrix for transform #1/1
   Simulating data for forward operator 1/0
   Interval 0.000-1.665 sec
   Interval 1.665-3.330 sec
   Interval 3.330-4.995 sec
   Interval 4.995-6.660 sec
   Interval 6.660-8.325 sec
   Interval 8.325-9.990 sec
   Interval 9.990-11.655 sec
   Interval 11.655-13.320 sec
   Interval 13.320-14.985 sec
   Interval 14.985-16.650 sec
   Interval 16.650-18.315 sec
   Interval 18.315-19.980 sec
   Interval 19.980-21.644 sec
   Interval 21.644-23.309 sec
   Interval 23.309-24.974 sec
   Interval 24.974-26.639 sec
   Interval 26.639-28.304 sec
   Interval 28.304-29.969 sec
   Interval 29.969-31.634 sec
   Interval 31.634-33.299 sec
   Interval 33.299-34.964 sec
   Interval 34.964-36.629 sec
   Interval 36.629-38.294 sec
   Interval 38.294-39.959 sec
   Interval 39.959-41.624 sec
   Interval 41.624-43.289 sec
   Interval 43.289-44.954 sec
   Interval 44.954-46.619 sec
   Interval 46.619-48.284 sec
   Interval 48.284-49.949 sec
   Interval 49.949-51.614 sec
   Interval 51.614-53.279 sec
   Interval 53.279-54.944 sec
   Interval 54.944-56.609 sec
   Interval 56.609-58.274 sec
   Interval 58.274-59.939 sec
   Interval 59.939-61.604 sec
   Interval 61.604-63.268 sec
   Interval 63.268-64.933 sec
   Interval 64.933-66.598 sec
   Interval 66.598-68.263 sec
   Interval 68.263-69.928 sec
   Interval 69.928-71.593 sec
   Interval 71.593-73.258 sec
   Interval 73.258-74.923 sec
   Interval 74.923-76.588 sec
   Interval 76.588-78.253 sec
   Interval 78.253-79.918 sec
   Interval 79.918-81.583 sec
   Interval 81.583-83.248 sec
   Interval 83.248-84.913 sec
   Interval 84.913-86.578 sec
   Interval 86.578-88.243 sec
   Interval 88.243-89.908 sec
   Interval 89.908-91.573 sec
   Interval 91.573-93.238 sec
   Interval 93.238-94.903 sec
   Interval 94.903-96.568 sec
   Interval 96.568-98.233 sec
   Interval 98.233-99.898 sec
   Interval 99.898-101.563 sec
   Interval 101.563-103.228 sec
   Interval 103.228-104.892 sec
   Interval 104.892-106.557 sec
   Interval 106.557-108.222 sec
   Interval 108.222-109.887 sec
   Interval 109.887-111.552 sec
   Interval 111.552-113.217 sec
   Interval 113.217-114.882 sec
   Interval 114.882-116.547 sec
   Interval 116.547-118.212 sec
   Interval 118.212-119.877 sec
   Interval 119.877-121.542 sec
   Interval 121.542-123.207 sec
   Interval 123.207-124.872 sec
   Interval 124.872-126.537 sec
   Interval 126.537-128.202 sec
   Interval 128.202-129.867 sec
   Interval 129.867-131.532 sec
   Interval 131.532-133.197 sec
   Interval 133.197-134.862 sec
   Interval 134.862-136.527 sec
   Interval 136.527-138.192 sec
   Interval 138.192-139.857 sec
   Interval 139.857-141.522 sec
   Interval 141.522-143.187 sec
   Interval 143.187-144.852 sec
   Interval 144.852-146.516 sec
   Interval 146.516-148.181 sec
   Interval 148.181-149.846 sec
   Interval 149.846-151.511 sec
   Interval 151.511-153.176 sec
   Interval 153.176-154.841 sec
   Interval 154.841-156.506 sec
   Interval 156.506-158.171 sec
   Interval 158.171-159.836 sec
   Interval 159.836-161.501 sec
   Interval 161.501-163.166 sec
   Interval 163.166-164.831 sec
   Interval 164.831-166.496 sec
   Interval 166.496-168.161 sec
   Interval 168.161-169.826 sec
   Interval 169.826-171.491 sec
   Interval 171.491-173.156 sec
   Interval 173.156-174.821 sec
   Interval 174.821-176.486 sec
   Interval 176.486-178.151 sec
   Interval 178.151-179.816 sec
   Interval 179.816-181.481 sec
   Interval 181.481-183.146 sec
   Interval 183.146-184.811 sec
   Interval 184.811-186.476 sec
   Interval 186.476-188.140 sec
   Interval 188.140-189.805 sec
   Interval 189.805-191.470 sec
   Interval 191.470-193.135 sec
   Interval 193.135-194.800 sec
   Interval 194.800-196.465 sec
   Interval 196.465-198.130 sec
   Interval 198.130-199.795 sec
   Interval 199.795-201.460 sec
   Interval 201.460-203.125 sec
   Interval 203.125-204.790 sec
   Interval 204.790-206.455 sec
   Interval 206.455-208.120 sec
   Interval 208.120-209.785 sec
   Interval 209.785-211.450 sec
   Interval 211.450-213.115 sec
   Interval 213.115-214.780 sec
   Interval 214.780-216.445 sec
   Interval 216.445-218.110 sec
   Interval 218.110-219.775 sec
   Interval 219.775-221.440 sec
   Interval 221.440-223.105 sec
   Interval 223.105-224.770 sec
   Interval 224.770-226.435 sec
   Interval 226.435-228.100 sec
   Interval 228.100-229.764 sec
   Interval 229.764-231.429 sec
   Interval 231.429-233.094 sec
   Interval 233.094-234.759 sec
   Interval 234.759-236.424 sec
   Interval 236.424-238.089 sec
   Interval 238.089-239.754 sec
   Interval 239.754-241.419 sec
   Interval 241.419-243.084 sec
   Interval 243.084-244.749 sec
   Interval 244.749-246.414 sec
   Interval 246.414-248.079 sec
   Interval 248.079-249.744 sec
   Interval 249.744-251.409 sec
   Interval 251.409-253.074 sec
   Interval 253.074-254.739 sec
   Interval 254.739-256.404 sec
   Interval 256.404-257.378 sec
    155 STC iterations provided
Done
Adding average EEG reference projection.
1 projection items deactivated
Average reference projection was added, but has not been applied yet. Use the apply_proj method to apply it.
Adding noise to 366/376 channels (366 channels in cov)
Sphere                : origin at (0.0 0.0 0.0) mm
              radius  : 90.0 mm
Source location file  : dict()
Assuming input in millimeters
Assuming input in MRI coordinates

Positions (in meters) and orientations
2 sources
blink simulated and trace stored on channel:      EOG 061
Setting up forward solutions
Computing gain matrix for transform #1/1
Sphere                : origin at (0.0 0.0 0.0) mm
              radius  : 90.0 mm
Source location file  : dict()
Assuming input in millimeters
Assuming input in MRI coordinates

Positions (in meters) and orientations
1 sources
ecg simulated and trace not stored
Setting up forward solutions
Computing gain matrix for transform #1/1
</pre></div>
</div>
</div>
<div class="section" id="reconstruct-simulated-source-time-courses-using-dspm-inverse-operator">
<h2>Reconstruct simulated source time courses using dSPM inverse operator<a class="headerlink" href="#reconstruct-simulated-source-time-courses-using-dspm-inverse-operator" title="Permalink to this headline">¶</a></h2>
<p>Here, source time courses for auditory and visual areas are reconstructed
separately and their difference is shown. This was done merely for better
visual representation of source reconstruction.
As expected, when high activations appear in primary auditory areas, primary
visual areas will have low activations and vice versa.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">method</span><span class="p">,</span> <span class="n">lambda2</span> <span class="o">=</span> <span class="s1">&#39;dSPM&#39;</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">9.</span>
<span class="n">epochs</span> <span class="o">=</span> <a href="../../generated/mne.Epochs.html#mne.Epochs" title="View documentation for mne.Epochs"><span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span></a><span class="p">(</span><span class="n">raw_sim</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="p">)</span>
<span class="n">inv</span> <span class="o">=</span> <a href="../../generated/mne.minimum_norm.make_inverse_operator.html#mne.minimum_norm.make_inverse_operator" title="View documentation for mne.minimum_norm.make_inverse_operator"><span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">make_inverse_operator</span></a><span class="p">(</span><span class="n">epochs</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">fwd</span><span class="p">,</span> <span class="n">noise_cov</span><span class="p">)</span>
<span class="n">stc_aud</span> <span class="o">=</span> <a href="../../generated/mne.minimum_norm.apply_inverse.html#mne.minimum_norm.apply_inverse" title="View documentation for mne.minimum_norm.apply_inverse"><span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">apply_inverse</span></a><span class="p">(</span>
    <span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;auditory/left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">average</span><span class="p">(),</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
<span class="n">stc_vis</span> <span class="o">=</span> <a href="../../generated/mne.minimum_norm.apply_inverse.html#mne.minimum_norm.apply_inverse" title="View documentation for mne.minimum_norm.apply_inverse"><span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">apply_inverse</span></a><span class="p">(</span>
    <span class="n">epochs</span><span class="p">[</span><span class="s1">&#39;visual/right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">average</span><span class="p">(),</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
<span class="n">stc_diff</span> <span class="o">=</span> <span class="n">stc_aud</span> <span class="o">-</span> <span class="n">stc_vis</span>

<span class="n">brain</span> <span class="o">=</span> <span class="n">stc_diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subjects_dir</span><span class="o">=</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="n">initial_time</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;med&#39;</span><span class="p">])</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_002.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_002.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_003.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_003.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_004.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_004.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_005.png" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_simulated_raw_data_using_subject_anatomy_005.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>320 matching events found
Applying baseline correction (mode: mean)
Not setting metadata
Created an SSP operator (subspace dimension = 4)
4 projection items activated
Converting forward solution to surface orientation
    Average patch normals will be employed in the rotation to the local surface coordinates....
    Converting to surface-based source orientations...
    [done]
Computing inverse operator with 364 channels.
    364 out of 366 channels remain after picking
Selected 364 channels
Creating the depth weighting matrix...
    203 planar channels
    limit = 7262/7498 = 10.020865
    scale = 2.58122e-08 exp = 0.8
Applying loose dipole orientations. Loose value of 0.2.
Whitening the forward solution.
    Created an SSP operator (subspace dimension = 4)
Computing data rank from covariance with rank=None
    Using tolerance 3.3e-13 (2.2e-16 eps * 305 dim * 4.8  max singular value)
    Estimated rank (mag + grad): 302
    MEG: rank 302 computed from 305 data channels with 3 projectors
    Using tolerance 4.7e-14 (2.2e-16 eps * 59 dim * 3.6  max singular value)
    Estimated rank (eeg): 58
    EEG: rank 58 computed from 59 data channels with 1 projector
    Setting small MEG eigenvalues to zero (without PCA)
    Setting small EEG eigenvalues to zero (without PCA)
Creating the source covariance matrix
Adjusting source covariance matrix.
Computing SVD of whitened and weighted lead field matrix.
    largest singular value = 5.49264
    scaling factor to adjust the trace = 1.64e+19
Preparing the inverse operator for use...
    Scaled noise and source covariance from nave = 1 to nave = 5
    Created the regularized inverter
    Created an SSP operator (subspace dimension = 4)
    Created the whitener using a noise covariance matrix with rank 360 (4 small eigenvalues omitted)
    Computing noise-normalization factors (dSPM)...
[done]
Applying inverse operator to &quot;auditory/left&quot;...
    Picked 364 channels from the data
    Computing inverse...
    Eigenleads need to be weighted ...
    Computing residual...
    Explained  99.4% variance
    Combining the current components...
    dSPM...
[done]
Preparing the inverse operator for use...
    Scaled noise and source covariance from nave = 1 to nave = 3
    Created the regularized inverter
    Created an SSP operator (subspace dimension = 4)
    Created the whitener using a noise covariance matrix with rank 360 (4 small eigenvalues omitted)
    Computing noise-normalization factors (dSPM)...
[done]
Applying inverse operator to &quot;visual/right&quot;...
    Picked 364 channels from the data
    Computing inverse...
    Eigenleads need to be weighted ...
    Computing residual...
    Explained  99.5% variance
    Combining the current components...
    dSPM...
[done]
Using control points [ 204.9476386   323.62258808 1588.3393872 ]
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Destrieux C, Fischl B, Dale A, Halgren E (2010). Automatic
parcellation of human cortical gyri and sulci using standard
anatomical nomenclature, vol. 53(1), 1-15, NeuroImage.</p>
</dd>
</dl>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  52.400 seconds)</p>
<p><strong>Estimated memory usage:</strong>  1191 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-simulation-plot-simulated-raw-data-using-subject-anatomy-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/8bfc303385201518aa01301bf16c11e2/plot_simulated_raw_data_using_subject_anatomy.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_simulated_raw_data_using_subject_anatomy.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/925ca2811e0c01ab2f8d558f074c31a3/plot_simulated_raw_data_using_subject_anatomy.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_simulated_raw_data_using_subject_anatomy.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><img src="../../_static/institutions.png" alt="Institutions"></div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-05-27.</p>
  </div>
</footer>
  </body>
</html>