<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Repairing artifacts with SSP &#8212; MNE 0.22.1 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/bootstrap_divs.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <link rel="canonical" href="https://mne.tools/stable/index.html" />
    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-code-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-sans-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />


    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.svg"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.22.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install/index.html">Install</a></li>
                <li><a href="../../overview/index.html">Overview</a></li>
                <li><a href="../index.html">Tutorials</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../python_reference.html">API</a></li>
            
            
            <li class="dropdown globaltoc-container">
              <a role="button" id="dLabelGlobalToc" data-toggle="dropdown" data-target="#" href="#">More<b class="caret"></b></a>
              <ul class="dropdown-menu globaltoc" role="menu" aria-labelledby="dLabelGlobalToc">
                <li><a href="https://github.com/mne-tools/mne-python"><i class="fa fa-github"></i> GitHub</a></li>
                <li><a href="../../overview/get_help.html"><i class="fa fa-question-circle"></i> Get help</a></li>
                <li><a href="../../install/contributing.html"><i class="fa fa-code-fork"></i> Contribute</a></li>
                <li><a href="../../overview/cite.html"><i class="fa fa-book"></i> Cite MNE</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="dLabelMore" data-toggle="dropdown" style="margin-left: 10px">
              v0.22.1
              <span class="caret"></span>
            </button>
              <ul class="dropdown-menu" aria-labelledby="dLabelMore">
                <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
                <li><a href="https://mne-tools.github.io/stable/index.html">v0.22 (stable)</a></li>
                <li><a href="https://mne-tools.github.io/0.21/index.html">v0.21</a></li>
                <li><a href="https://mne-tools.github.io/0.20/index.html">v0.20</a></li>
                <li><a href="https://mne-tools.github.io/0.19/index.html">v0.19</a></li>
                <li><a href="https://mne-tools.github.io/0.18/index.html">v0.18</a></li>
                <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
                <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
                <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
                <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
                <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
                <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
                <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
              </ul>
            </li>

            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-preprocessing-plot-50-artifact-correction-ssp-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="repairing-artifacts-with-ssp">
<span id="tut-artifact-ssp"></span><span id="sphx-glr-auto-tutorials-preprocessing-plot-50-artifact-correction-ssp-py"></span><h1>Repairing artifacts with SSP<a class="headerlink" href="#repairing-artifacts-with-ssp" title="Permalink to this headline">Â¶</a></h1>
<p>This tutorial covers the basics of signal-space projection (SSP) and shows
how SSP can be used for artifact repair; extended examples illustrate use
of SSP for environmental noise reduction, and for repair of ocular and
heartbeat artifacts.</p>
<div class="contents local topic" id="page-contents">
<p class="topic-title">Page contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-is-ssp" id="id2">What is SSP?</a></p></li>
<li><p><a class="reference internal" href="#example-environmental-noise-reduction-from-empty-room-recordings" id="id3">Example: Environmental noise reduction from empty-room recordings</a></p>
<ul>
<li><p><a class="reference internal" href="#visualizing-the-empty-room-noise" id="id4">Visualizing the empty-room noise</a></p></li>
<li><p><a class="reference internal" href="#creating-the-empty-room-projectors" id="id5">Creating the empty-room projectors</a></p></li>
<li><p><a class="reference internal" href="#visualizing-how-projectors-affect-the-signal" id="id6">Visualizing how projectors affect the signal</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-eog-and-ecg-artifact-repair" id="id7">Example: EOG and ECG artifact repair</a></p>
<ul>
<li><p><a class="reference internal" href="#visualizing-the-artifacts" id="id8">Visualizing the artifacts</a></p></li>
<li><p><a class="reference internal" href="#repairing-ecg-artifacts-with-ssp" id="id9">Repairing ECG artifacts with SSP</a></p></li>
<li><p><a class="reference internal" href="#repairing-eog-artifacts-with-ssp" id="id10">Repairing EOG artifacts with SSP</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#choosing-the-number-of-projectors" id="id11">Choosing the number of projectors</a></p></li>
<li><p><a class="reference internal" href="#visualizing-ssp-sensor-space-bias-via-signal-reconstruction" id="id12">Visualizing SSP sensor-space bias via signal reconstruction</a></p></li>
<li><p><a class="reference internal" href="#references" id="id13">References</a></p></li>
</ul>
</div>
<p>We begin as always by importing the necessary Python modules. To save ourselves
from repeatedly typing <code class="docutils literal notranslate"><span class="pre">mne.preprocessing</span></code> weâll directly import a handful of
functions from that submodule:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.preprocessing</span> <span class="kn">import</span> <span class="p">(</span><a href="../../generated/mne.preprocessing.create_eog_epochs.html#mne.preprocessing.create_eog_epochs" title="mne.preprocessing.create_eog_epochs" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">create_eog_epochs</span></a><span class="p">,</span> <a href="../../generated/mne.preprocessing.create_ecg_epochs.html#mne.preprocessing.create_ecg_epochs" title="mne.preprocessing.create_ecg_epochs" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">create_ecg_epochs</span></a><span class="p">,</span>
                               <a href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">compute_proj_ecg</span></a><span class="p">,</span> <a href="../../generated/mne.preprocessing.compute_proj_eog.html#mne.preprocessing.compute_proj_eog" title="mne.preprocessing.compute_proj_eog" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">compute_proj_eog</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before applying SSP (or any artifact repair strategy), be sure to observe
the artifacts in your data to make sure you choose the right repair tool.
Sometimes the right tool is no tool at all â if the artifacts are small
enough you may not even need to repair them to get good analysis results.
See <a class="reference internal" href="plot_10_preprocessing_overview.html#tut-artifact-overview"><span class="std std-ref">Overview of artifact detection</span></a> for guidance on detecting and
visualizing various types of artifact.</p>
</div>
<section id="what-is-ssp">
<h2><a class="toc-backref" href="#id2">What is SSP?</a><a class="headerlink" href="#what-is-ssp" title="Permalink to this headline">Â¶</a></h2>
<p>Signal-space projection (SSP) <a class="footnote-reference brackets" href="#uusitaloilmoniemi1997" id="id1">1</a> is a
technique for removing noise from EEG
and MEG signals by <a class="reference internal" href="../../glossary.html#term-projector"><span class="xref std std-term">projecting</span></a> the signal onto a
lower-dimensional subspace. The subspace is chosen by calculating the average
pattern across sensors when the noise is present, treating that pattern as
a âdirectionâ in the sensor space, and constructing the subspace to be
orthogonal to the noise direction (for a detailed walk-through of projection
see <a class="reference internal" href="plot_45_projectors_background.html#tut-projectors-background"><span class="std std-ref">Background on projectors and projections</span></a>).</p>
<p>The most common use of SSP is to remove noise from MEG signals when the noise
comes from environmental sources (sources outside the subjectâs body and the
MEG system, such as the electromagnetic fields from nearby electrical
equipment) and when that noise is <em>stationary</em> (doesnât change much over the
duration of the recording). However, SSP can also be used to remove
biological artifacts such as heartbeat (ECG) and eye movement (EOG)
artifacts. Examples of each of these are given below.</p>
</section>
<section id="example-environmental-noise-reduction-from-empty-room-recordings">
<h2><a class="toc-backref" href="#id3">Example: Environmental noise reduction from empty-room recordings</a><a class="headerlink" href="#example-environmental-noise-reduction-from-empty-room-recordings" title="Permalink to this headline">Â¶</a></h2>
<p>The <a class="reference internal" href="../../overview/datasets_index.html#sample-dataset"><span class="std std-ref">example data</span></a> was recorded on a Neuromag system,
which stores SSP projectors for environmental noise removal in the system
configuration (so that reasonably clean raw data can be viewed in real-time
during acquisition). For this reason, all the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> data in
the example dataset already includes SSP projectors, which are noted in the
output when loading the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sample_data_folder</span></a> <span class="o">=</span> <a href="../../generated/mne.datasets.sample.data_path.html#mne.datasets.sample.data_path" title="mne.datasets.sample.data_path" class="sphx-glr-backref-module-mne-datasets-sample sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sample_data_raw_file</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sample_data_folder</span></a><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;sample_audvis_raw.fif&#39;</span><span class="p">)</span>
<a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a> <span class="o">=</span> <a href="../../generated/mne.io.read_raw_fif.html#mne.io.read_raw_fif" title="mne.io.read_raw_fif" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sample_data_raw_file</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Opening raw data file /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
    Read a total of 3 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
    Range : 25800 ... 192599 =     42.956 ...   320.670 secs
Ready.
</pre></div>
</div>
<p>The <a class="reference internal" href="../../overview/datasets_index.html#sample-dataset"><span class="std std-ref">example data</span></a> also includes an âempty roomâ
recording taken the same day as the recording of the subject. This will
provide a more accurate estimate of environmental noise than the projectors
stored with the system (which are typically generated during annual
maintenance and tuning). Since we have this subject-specific empty-room
recording, weâll create our own projectors from it and discard the
system-provided SSP projectors (saving them first, for later comparison with
the custom ones):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">system_projs</span></a> <span class="o">=</span> <a href="../../generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">[</span><span class="s1">&#39;projs&#39;</span><span class="p">]</span>
<a href="../../generated/mne.io.Raw.html#mne.io.Raw.del_proj" title="mne.io.Raw.del_proj" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">del_proj</span></a><span class="p">()</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_file</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sample_data_folder</span></a><span class="p">,</span> <span class="s1">&#39;MEG&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;ernoise_raw.fif&#39;</span><span class="p">)</span>
<a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_raw</span></a> <span class="o">=</span> <a href="../../generated/mne.io.read_raw_fif.html#mne.io.read_raw_fif" title="mne.io.read_raw_fif" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_fif</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_file</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Opening raw data file /home/circleci/mne_data/MNE-sample-data/MEG/sample/ernoise_raw.fif...
Isotrak not found
    Read a total of 3 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
    Range : 19800 ... 85867 =     32.966 ...   142.965 secs
Ready.
</pre></div>
</div>
<p>Notice that the empty room recording itself has the system-provided SSP
projectors in it â weâll remove those from the empty room file too.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.io.Raw.html#mne.io.Raw.del_proj" title="mne.io.Raw.del_proj" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">empty_room_raw</span><span class="o">.</span><span class="n">del_proj</span></a><span class="p">()</span>
</pre></div>
</div>
<section id="visualizing-the-empty-room-noise">
<h3><a class="toc-backref" href="#id4">Visualizing the empty-room noise</a><a class="headerlink" href="#visualizing-the-empty-room-noise" title="Permalink to this headline">Â¶</a></h3>
<p>Letâs take a look at the spectrum of the empty room noise. We can view an
individual spectrum for each sensor, or an average (with confidence band)
across sensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">average</span></a> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
    <a href="../../generated/mne.io.Raw.html#mne.io.Raw.plot_psd" title="mne.io.Raw.plot_psd" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">empty_room_raw</span><span class="o">.</span><span class="n">plot_psd</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">average</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">average</span></a><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Gradiometers, Magnetometers" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_001.png" />
</li>
<li><img alt="Gradiometers, Magnetometers" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_002.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Effective window size : 3.410 (s)
Effective window size : 3.410 (s)
Effective window size : 3.410 (s)
Effective window size : 3.410 (s)
</pre></div>
</div>
</section>
<section id="creating-the-empty-room-projectors">
<h3><a class="toc-backref" href="#id5">Creating the empty-room projectors</a><a class="headerlink" href="#creating-the-empty-room-projectors" title="Permalink to this headline">Â¶</a></h3>
<p>We create the SSP vectors using <a class="reference internal" href="../../generated/mne.compute_proj_raw.html#mne.compute_proj_raw" title="mne.compute_proj_raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_raw</span></code></a>, and control
the number of projectors with parameters <code class="docutils literal notranslate"><span class="pre">n_grad</span></code> and <code class="docutils literal notranslate"><span class="pre">n_mag</span></code>. Once
created, the field pattern of the projectors can be easily visualized with
<a class="reference internal" href="../../generated/mne.viz.plot_projs_topomap.html#mne.viz.plot_projs_topomap" title="mne.viz.plot_projs_topomap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_projs_topomap</span></code></a>. We include the parameter
<code class="docutils literal notranslate"><span class="pre">vlim='joint'</span></code> so that the colormap is computed jointly for all projectors
of a given channel type; this makes it easier to compare their relative
smoothness. Note that for the function to know the types of channels in a
projector, you must also provide the corresponding <a class="reference internal" href="../../generated/mne.Info.html#mne.Info" title="mne.Info"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Info</span></code></a> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_projs</span></a> <span class="o">=</span> <a href="../../generated/mne.compute_proj_raw.html#mne.compute_proj_raw" title="mne.compute_proj_raw" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">compute_proj_raw</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_raw</span></a><span class="p">,</span> <span class="n">n_grad</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_mag</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_projs_topomap.html#mne.viz.plot_projs_topomap" title="mne.viz.plot_projs_topomap" class="sphx-glr-backref-module-mne-viz sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_projs_topomap</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_projs</span></a><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vlim</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">,</span>
                           <span class="n">info</span><span class="o">=</span><a href="../../generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">)</span>
</pre></div>
</div>
<img alt="planar-Raw-0.000-110.0 01-PCA-01, planar-Raw-0.000-110.0 01-PCA-02, planar-Raw-0.000-110.0 01-PCA-03, axial-Raw-0.000-110.00 1-PCA-01, axial-Raw-0.000-110.00 1-PCA-02, axial-Raw-0.000-110.00 1-PCA-03" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_003.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Not setting metadata
Not setting metadata
109 matching events found
No baseline correction applied
Adding projection: planar-Raw-0.000-110.001-PCA-01
Adding projection: planar-Raw-0.000-110.001-PCA-02
Adding projection: planar-Raw-0.000-110.001-PCA-03
Adding projection: axial-Raw-0.000-110.001-PCA-01
Adding projection: axial-Raw-0.000-110.001-PCA-02
Adding projection: axial-Raw-0.000-110.001-PCA-03
</pre></div>
</div>
<p>Notice that the gradiometer-based projectors seem to reflect problems with
individual sensor units rather than a global noise source (indeed, planar
gradiometers are much less sensitive to distant sources). This is the reason
that the system-provided noise projectors are computed only for
magnetometers. Comparing the system-provided projectors to the
subject-specific ones, we can see they are reasonably similar (though in a
different order) and the left-right component seems to have changed
polarity.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">idx</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_projs</span></a> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">system_projs</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_projs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">:]]):</span>
    <a href="../../generated/mne.viz.plot_projs_topomap.html#mne.viz.plot_projs_topomap" title="mne.viz.plot_projs_topomap" class="sphx-glr-backref-module-mne-viz sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_projs_topomap</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_projs</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="o">=</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">idx</span></a><span class="p">],</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">vlim</span><span class="o">=</span><span class="s1">&#39;joint&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><a href="../../generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">)</span>
</pre></div>
</div>
<img alt="PCA-v1, PCA-v2, PCA-v3, axial-Raw-0.000-110.00 1-PCA-01, axial-Raw-0.000-110.00 1-PCA-02, axial-Raw-0.000-110.00 1-PCA-03" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_004.png" />
</section>
<section id="visualizing-how-projectors-affect-the-signal">
<h3><a class="toc-backref" href="#id6">Visualizing how projectors affect the signal</a><a class="headerlink" href="#visualizing-how-projectors-affect-the-signal" title="Permalink to this headline">Â¶</a></h3>
<p>We could visualize the different effects these have on the data by applying
each set of projectors to different copies of the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object
using <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.apply_proj" title="mne.io.Raw.apply_proj"><code class="xref py py-obj docutils literal notranslate"><span class="pre">apply_proj</span></code></a>. However, the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot</span></code></a>
method has a <code class="docutils literal notranslate"><span class="pre">proj</span></code> parameter that allows us to <em>temporarily</em> apply
projectors while plotting, so we can use this to visualize the difference
without needing to copy the data. Because the projectors are so similar, we
need to zoom in pretty close on the data to see any differences:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mags</span></a> <span class="o">=</span> <a href="../../generated/mne.pick_types.html#mne.pick_types" title="mne.pick_types" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">pick_types</span></a><span class="p">(</span><a href="../../generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">,</span> <span class="n">meg</span><span class="o">=</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">projs</span></a> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;system&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">system_projs</span></a><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;subject-specific&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_projs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">:])]:</span>
    <a href="../../generated/mne.io.Raw.html#mne.io.Raw.add_proj" title="mne.io.Raw.add_proj" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">add_proj</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">projs</span></a><span class="p">,</span> <span class="n">remove_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="../../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mags</span></a><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure.subplots_adjust" title="matplotlib.figure.Figure.subplots_adjust" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>  <span class="c1"># make room for title</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure.suptitle" title="matplotlib.figure.Figure.suptitle" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span></a><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> projectors&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="system projectors" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_005.png" />
</li>
<li><img alt="subject-specific projectors" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_006.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>3 projection items deactivated
3 projection items deactivated
</pre></div>
</div>
<p>The effect is sometimes easier to see on averaged data. Here we use an
interactive feature of <a class="reference internal" href="../../generated/mne.Evoked.html#mne.Evoked.plot_topomap" title="mne.Evoked.plot_topomap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mne.Evoked.plot_topomap</span></code></a> to turn projectors on
and off to see the effect on the data. Of course, the interactivity wonât
work on the tutorial website, but you can download the tutorial and try it
locally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">events</span></a> <span class="o">=</span> <a href="../../generated/mne.find_events.html#mne.find_events" title="mne.find_events" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">find_events</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a><span class="p">,</span> <span class="n">stim_channel</span><span class="o">=</span><span class="s1">&#39;STI 014&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">event_id</span></a> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;auditory/left&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># NOTE: appropriate rejection criteria are highly data-dependent</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reject</span></a> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span><span class="mf">4000e-15</span><span class="p">,</span>     <span class="c1"># 4000 fT</span>
              <span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">,</span>    <span class="c1"># 4000 fT/cm</span>
              <span class="n">eeg</span><span class="o">=</span><span class="mf">150e-6</span><span class="p">,</span>       <span class="c1"># 150 ÂµV</span>
              <span class="n">eog</span><span class="o">=</span><span class="mf">250e-6</span><span class="p">)</span>       <span class="c1"># 250 ÂµV</span>

<span class="c1"># time range where we expect to see the auditory N100: 50-150 ms post-stimulus</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<a href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs</span></a> <span class="o">=</span> <a href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class"><span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">events</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">event_id</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="o">=</span><span class="s1">&#39;delayed&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reject</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reject</span></a><span class="p">)</span>
<a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="../../generated/mne.Epochs.html#mne.Epochs.average" title="mne.Epochs.average" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">average</span></a><span class="p">()</span><span class="o">.</span><span class="n">plot_topomap</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="o">=</span><span class="s1">&#39;interactive&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="0.050 s, 0.075 s, 0.100 s, 0.125 s, 0.150 s, fT" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_007.png" />
</li>
<li><img alt="Projectors marked with &quot;X&quot; are active" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_008.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>320 events found
Event IDs: [ 1  2  3  4  5 32]
Not setting metadata
Not setting metadata
72 matching events found
Setting baseline interval to [-0.19979521315838786, 0.0] sec
Applying baseline correction (mode: mean)
Entering delayed SSP mode.
Created an SSP operator (subspace dimension = 3)
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 003&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 007&#39;]
    Rejecting  epoch based on MAG : [&#39;MEG 1711&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 008&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 003&#39;, &#39;EEG 007&#39;, &#39;EEG 008&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 003&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 002&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
</pre></div>
</div>
<p>Plotting the ERP/F using <code class="docutils literal notranslate"><span class="pre">evoked.plot()</span></code> or <code class="docutils literal notranslate"><span class="pre">evoked.plot_joint()</span></code> with
and without projectors applied can also be informative, as can plotting with
<code class="docutils literal notranslate"><span class="pre">proj='reconstruct'</span></code>, which can reduce the signal bias introduced by
projections (see <a class="reference internal" href="#tut-artifact-ssp-reconstruction"><span class="std std-ref">Visualizing SSP sensor-space bias via signal reconstruction</span></a> below).</p>
</section>
</section>
<section id="example-eog-and-ecg-artifact-repair">
<h2><a class="toc-backref" href="#id7">Example: EOG and ECG artifact repair</a><a class="headerlink" href="#example-eog-and-ecg-artifact-repair" title="Permalink to this headline">Â¶</a></h2>
<section id="visualizing-the-artifacts">
<h3><a class="toc-backref" href="#id8">Visualizing the artifacts</a><a class="headerlink" href="#visualizing-the-artifacts" title="Permalink to this headline">Â¶</a></h3>
<p>As mentioned in <a class="reference internal" href="plot_40_artifact_correction_ica.html#tut-artifact-ica"><span class="std std-ref">the ICA tutorial</span></a>, an important
first step is visualizing the artifacts you want to repair. Here they are in
the raw data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># pick some channels that clearly show heartbeats and blinks</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">regexp</span></a> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(MEG [12][45][123]1|EEG 00.)&#39;</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a> <span class="o">=</span> <a href="../../generated/mne.pick_channels_regexp.html#mne.pick_channels_regexp" title="mne.pick_channels_regexp" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">pick_channels_regexp</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw.ch_names" title="mne.io.Raw.ch_names" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">ch_names</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">regexp</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">regexp</span></a><span class="p">)</span>
<a href="../../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">order</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a><span class="p">))</span>
</pre></div>
</div>
<img alt="plot 50 artifact correction ssp" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_009.png" />
</section>
<section id="repairing-ecg-artifacts-with-ssp">
<h3><a class="toc-backref" href="#id9">Repairing ECG artifacts with SSP</a><a class="headerlink" href="#repairing-ecg-artifacts-with-ssp" title="Permalink to this headline">Â¶</a></h3>
<p>MNE-Python provides several functions for detecting and removing heartbeats
from EEG and MEG data. As we saw in <a class="reference internal" href="plot_10_preprocessing_overview.html#tut-artifact-overview"><span class="std std-ref">Overview of artifact detection</span></a>,
<a class="reference internal" href="../../generated/mne.preprocessing.create_ecg_epochs.html#mne.preprocessing.create_ecg_epochs" title="mne.preprocessing.create_ecg_epochs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">create_ecg_epochs</span></code></a> can be used to both detect and
extract heartbeat artifacts into an <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Epochs</span></code></a> object, which can
be used to visualize how the heartbeat artifacts manifest across the sensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.EvokedArray.html#mne.EvokedArray" title="mne.EvokedArray" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ecg_evoked</span></a> <span class="o">=</span> <a href="../../generated/mne.preprocessing.create_ecg_epochs.html#mne.preprocessing.create_ecg_epochs" title="mne.preprocessing.create_ecg_epochs" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">create_ecg_epochs</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a><span class="p">)</span><span class="o">.</span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">average</span></a><span class="p">()</span>
<a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.plot_joint" title="mne.EvokedArray.plot_joint" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">ecg_evoked</span><span class="o">.</span><span class="n">plot_joint</span></a><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="0.000 s, 0.373 s, 0.443 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_010.png" />
</li>
<li><img alt="-0.460 s, 0.000 s, 0.256 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_011.png" />
</li>
<li><img alt="-0.157 s, 0.000 s, 0.255 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_012.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reconstructing ECG signal from Magnetometers
Setting up band-pass filter from 8 - 16 Hz

FIR filter parameters
---------------------
Designing a two-pass forward and reverse, zero-phase, non-causal bandpass filter:
- Windowed frequency-domain design (firwin2) method
- Hann window
- Lower passband edge: 8.00
- Lower transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 7.75 Hz)
- Upper passband edge: 16.00 Hz
- Upper transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 16.25 Hz)
- Filter length: 6007 samples (10.001 sec)

Number of ECG events detected : 283 (average pulse 61 / min.)
Not setting metadata
Not setting metadata
283 matching events found
No baseline correction applied
Created an SSP operator (subspace dimension = 3)
Loading data for 283 events and 601 original time points ...
0 bad epochs dropped
Created an SSP operator (subspace dimension = 3)
3 projection items activated
SSP projectors applied...
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-02, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-03, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-02, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-03, active : True, n_channels : 102&gt;
</pre></div>
</div>
<p>Looks like the EEG channels are pretty spread out; letâs baseline-correct and
plot again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.apply_baseline" title="mne.EvokedArray.apply_baseline" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">ecg_evoked</span><span class="o">.</span><span class="n">apply_baseline</span></a><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.plot_joint" title="mne.EvokedArray.plot_joint" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">ecg_evoked</span><span class="o">.</span><span class="n">plot_joint</span></a><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="0.000 s, 0.080 s, 0.261 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_013.png" />
</li>
<li><img alt="-0.453 s, 0.000 s, 0.253 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_014.png" />
</li>
<li><img alt="-0.157 s, 0.000 s, 0.255 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_015.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Applying baseline correction (mode: mean)
Created an SSP operator (subspace dimension = 3)
3 projection items activated
SSP projectors applied...
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-02, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-03, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-02, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-03, active : True, n_channels : 102&gt;
</pre></div>
</div>
<p>To compute SSP projectors for the heartbeat artifact, you can use
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a>, which takes a
<a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object as input and returns the requested number of
projectors for magnetometers, gradiometers, and EEG channels (default is two
projectors for each channel type).
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> also returns an <a class="reference internal" href="../../glossary.html#term-events"><span class="xref std std-term">events</span></a>
array containing the sample numbers corresponding to the peak of the
<a class="reference external" href="https://en.wikipedia.org/wiki/QRS_complex">R wave</a> of each detected
heartbeat.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">projs</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">events</span></a> <span class="o">=</span> <a href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">compute_proj_ecg</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a><span class="p">,</span> <span class="n">n_grad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_mag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_eeg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reject</span></a><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading 0 ... 166799  =      0.000 ...   277.714 secs...
Including 3 SSP projectors from raw file
Running ECG SSP computation
Reconstructing ECG signal from Magnetometers
Setting up band-pass filter from 5 - 35 Hz

FIR filter parameters
---------------------
Designing a two-pass forward and reverse, zero-phase, non-causal bandpass filter:
- Windowed frequency-domain design (firwin2) method
- Hann window
- Lower passband edge: 5.00
- Lower transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 4.75 Hz)
- Upper passband edge: 35.00 Hz
- Upper transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 35.25 Hz)
- Filter length: 6007 samples (10.001 sec)

Number of ECG events detected : 286 (average pulse 61 / min.)
Computing projector
Filtering a subset of channels. The highpass and lowpass values in the measurement info will not be updated.
Filtering raw data in 1 contiguous segment
Setting up band-pass filter from 1 - 35 Hz

FIR filter parameters
---------------------
Designing a two-pass forward and reverse, zero-phase, non-causal bandpass filter:
- Windowed frequency-domain design (firwin2) method
- Hamming window
- Lower passband edge: 1.00
- Lower transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 0.75 Hz)
- Upper passband edge: 35.00 Hz
- Upper transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 35.25 Hz)
- Filter length: 6007 samples (10.001 sec)

Not setting metadata
Not setting metadata
286 matching events found
No baseline correction applied
Created an SSP operator (subspace dimension = 3)
3 projection items activated
Loading data for 286 events and 361 original time points ...
0 bad epochs dropped
Adding projection: planar--0.200-0.400-PCA-01
Adding projection: axial--0.200-0.400-PCA-01
Adding projection: eeg--0.200-0.400-PCA-01
Done.
</pre></div>
</div>
<p>The first line of output tells us that
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> found three existing projectors
already in the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object, and will include those in the
list of projectors that it returns (appending the new ECG projectors to the
end of the list). If you donât want that, you can change that behavior with
the boolean <code class="docutils literal notranslate"><span class="pre">no_proj</span></code> parameter. Since weâve already run the computation,
we can just as easily separate out the ECG projectors by indexing the list of
projectors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ecg_projs</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">projs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ecg_projs</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;Projection | ECG-planar--0.200-0.400-PCA-01, active : False, n_channels : 203&gt;, &lt;Projection | ECG-axial--0.200-0.400-PCA-01, active : False, n_channels : 102&gt;, &lt;Projection | ECG-eeg--0.200-0.400-PCA-01, active : False, n_channels : 59&gt;]
</pre></div>
</div>
<p>Just like with the empty-room projectors, we can visualize the scalp
distribution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_projs_topomap.html#mne.viz.plot_projs_topomap" title="mne.viz.plot_projs_topomap" class="sphx-glr-backref-module-mne-viz sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_projs_topomap</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ecg_projs</span></a><span class="p">,</span> <span class="n">info</span><span class="o">=</span><a href="../../generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">)</span>
</pre></div>
</div>
<img alt="ECG-planar--0.200-0.40 0-PCA-01, ECG-axial--0.200-0.400 -PCA-01, ECG-eeg--0.200-0.400-P CA-01" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_016.png" />
<p>Since no dedicated ECG sensor channel was detected in the
<a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object, by default
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> used the magnetometers to
estimate the ECG signal (as stated on the third line of output, above). You
can also supply the <code class="docutils literal notranslate"><span class="pre">ch_name</span></code> parameter to restrict which channel to use
for ECG artifact detection; this is most useful when you had an ECG sensor
but it is not labeled as such in the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> file.</p>
<p>The next few lines of the output describe the filter used to isolate ECG
events. The default settings are usually adequate, but the filter can be
customized via the parameters <code class="docutils literal notranslate"><span class="pre">ecg_l_freq</span></code>, <code class="docutils literal notranslate"><span class="pre">ecg_h_freq</span></code>, and
<code class="docutils literal notranslate"><span class="pre">filter_length</span></code> (see the documentation of
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> for details).</p>
<p>Once the ECG events have been identified,
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> will also filter the data
channels before extracting epochs around each heartbeat, using the parameter
values given in <code class="docutils literal notranslate"><span class="pre">l_freq</span></code>, <code class="docutils literal notranslate"><span class="pre">h_freq</span></code>, <code class="docutils literal notranslate"><span class="pre">filter_length</span></code>, <code class="docutils literal notranslate"><span class="pre">filter_method</span></code>,
and <code class="docutils literal notranslate"><span class="pre">iir_params</span></code>. Here again, the default parameter values are usually
adequate.</p>
<p>By default, the filtered epochs will be averaged together
before the projection is computed; this can be controlled with the boolean
<code class="docutils literal notranslate"><span class="pre">average</span></code> parameter. In general this improves the signal-to-noise (where
âsignalâ here is our artifact!) ratio because the artifact temporal waveform
is fairly similar across epochs and well time locked to the detected events.</p>
<p>To get a sense of how the heartbeat affects the signal at each sensor, you
can plot the data with and without the ECG projectors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.io.Raw.html#mne.io.Raw.del_proj" title="mne.io.Raw.del_proj" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">del_proj</span></a><span class="p">()</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;Without&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">empty_room_projs</span></a><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;With&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ecg_projs</span></a><span class="p">)]:</span>
    <a href="../../generated/mne.io.Raw.html#mne.io.Raw.add_proj" title="mne.io.Raw.add_proj" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">add_proj</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="p">,</span> <span class="n">remove_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="../../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">order</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a><span class="p">))</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure.subplots_adjust" title="matplotlib.figure.Figure.subplots_adjust" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>  <span class="c1"># make room for title</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure.suptitle" title="matplotlib.figure.Figure.suptitle" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span></a><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> ECG projectors&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
                 <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Without ECG projectors" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_017.png" />
</li>
<li><img alt="With ECG projectors" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_018.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>6 projection items deactivated
3 projection items deactivated
</pre></div>
</div>
<p>Finally, note that above we passed <code class="docutils literal notranslate"><span class="pre">reject=None</span></code> to the
<a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> function, meaning that all
detected ECG epochs would be used when computing the projectors (regardless
of signal quality in the data sensors during those epochs). The default
behavior is to reject epochs based on signal amplitude: epochs with
peak-to-peak amplitudes exceeding 50 ÂµV in EEG channels, 250 ÂµV in EOG
channels, 2000 fT/cm in gradiometer channels, or 3000 fT in magnetometer
channels. You can change these thresholds by passing a dictionary with keys
<code class="docutils literal notranslate"><span class="pre">eeg</span></code>, <code class="docutils literal notranslate"><span class="pre">eog</span></code>, <code class="docutils literal notranslate"><span class="pre">mag</span></code>, and <code class="docutils literal notranslate"><span class="pre">grad</span></code> (though be sure to pass the threshold
values in volts, teslas, or teslas/meter). Generally, it is a good idea to
reject such epochs when computing the ECG projectors (since presumably the
high-amplitude fluctuations in the channels are noise, not reflective of
brain activity); passing <code class="docutils literal notranslate"><span class="pre">reject=None</span></code> above was done simply to avoid the
dozens of extra lines of output (enumerating which sensor(s) were responsible
for each rejected epoch) from cluttering up the tutorial.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> has a similar parameter
<code class="docutils literal notranslate"><span class="pre">flat</span></code> for specifying the <em>minimum</em> acceptable peak-to-peak amplitude
for each channel type.</p>
</div>
<p>While <a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_ecg</span></code></a> conveniently combines
several operations into a single function, MNE-Python also provides functions
for performing each part of the process. Specifically:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../generated/mne.preprocessing.find_ecg_events.html#mne.preprocessing.find_ecg_events" title="mne.preprocessing.find_ecg_events"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mne.preprocessing.find_ecg_events</span></code></a> for detecting heartbeats in a
<a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object and returning a corresponding <a class="reference internal" href="../../glossary.html#term-events"><span class="xref std std-term">events</span></a>
array</p></li>
<li><p><a class="reference internal" href="../../generated/mne.preprocessing.create_ecg_epochs.html#mne.preprocessing.create_ecg_epochs" title="mne.preprocessing.create_ecg_epochs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mne.preprocessing.create_ecg_epochs</span></code></a> for detecting heartbeats in a
<a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object and returning an <a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Epochs</span></code></a> object</p></li>
<li><p><a class="reference internal" href="../../generated/mne.compute_proj_epochs.html#mne.compute_proj_epochs" title="mne.compute_proj_epochs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mne.compute_proj_epochs</span></code></a> for creating projector(s) from any
<a class="reference internal" href="../../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Epochs</span></code></a> object</p></li>
</ul>
<p>See the documentation of each function for further details.</p>
</section>
<section id="repairing-eog-artifacts-with-ssp">
<h3><a class="toc-backref" href="#id10">Repairing EOG artifacts with SSP</a><a class="headerlink" href="#repairing-eog-artifacts-with-ssp" title="Permalink to this headline">Â¶</a></h3>
<p>Once again letâs visualize our artifact before trying to repair it. Weâve
seen above the large deflections in frontal EEG channels in the raw data;
here is how the ocular artifacts manifests across all the sensors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.EvokedArray.html#mne.EvokedArray" title="mne.EvokedArray" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">eog_evoked</span></a> <span class="o">=</span> <a href="../../generated/mne.preprocessing.create_eog_epochs.html#mne.preprocessing.create_eog_epochs" title="mne.preprocessing.create_eog_epochs" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">create_eog_epochs</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a><span class="p">)</span><span class="o">.</span><a href="https://docs.python.org/3/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">average</span></a><span class="p">()</span>
<a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.apply_baseline" title="mne.EvokedArray.apply_baseline" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">eog_evoked</span><span class="o">.</span><span class="n">apply_baseline</span></a><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.plot_joint" title="mne.EvokedArray.plot_joint" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">eog_evoked</span><span class="o">.</span><span class="n">plot_joint</span></a><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="-0.336 s, -0.210 s, 0.000 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_019.png" />
</li>
<li><img alt="-0.266 s, -0.125 s, -0.003 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_020.png" />
</li>
<li><img alt="-0.396 s, -0.127 s, -0.005 s" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_021.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>EOG channel index for this subject is: [375]
Filtering the data to remove DC offset to help distinguish blinks from saccades
Setting up band-pass filter from 1 - 10 Hz

FIR filter parameters
---------------------
Designing a two-pass forward and reverse, zero-phase, non-causal bandpass filter:
- Windowed frequency-domain design (firwin2) method
- Hann window
- Lower passband edge: 1.00
- Lower transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 0.75 Hz)
- Upper passband edge: 10.00 Hz
- Upper transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 10.25 Hz)
- Filter length: 6007 samples (10.001 sec)

Now detecting blinks and generating corresponding events
Found 46 significant peaks
Number of EOG events detected : 46
Not setting metadata
Not setting metadata
46 matching events found
No baseline correction applied
Created an SSP operator (subspace dimension = 9)
Loading data for 46 events and 601 original time points ...
0 bad epochs dropped
Applying baseline correction (mode: mean)
Created an SSP operator (subspace dimension = 9)
9 projection items activated
SSP projectors applied...
Removing projector &lt;Projection | planar-Raw-0.000-110.001-PCA-01, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | planar-Raw-0.000-110.001-PCA-02, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | planar-Raw-0.000-110.001-PCA-03, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-02, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-03, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | ECG-planar--0.200-0.400-PCA-01, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | ECG-axial--0.200-0.400-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-02, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | axial-Raw-0.000-110.001-PCA-03, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | ECG-axial--0.200-0.400-PCA-01, active : True, n_channels : 102&gt;
Removing projector &lt;Projection | ECG-eeg--0.200-0.400-PCA-01, active : True, n_channels : 59&gt;
Removing projector &lt;Projection | planar-Raw-0.000-110.001-PCA-01, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | planar-Raw-0.000-110.001-PCA-02, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | planar-Raw-0.000-110.001-PCA-03, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | ECG-planar--0.200-0.400-PCA-01, active : True, n_channels : 203&gt;
Removing projector &lt;Projection | ECG-eeg--0.200-0.400-PCA-01, active : True, n_channels : 59&gt;
</pre></div>
</div>
<p>Just like we did with the heartbeat artifact, we can compute SSP projectors
for the ocular artifact using <a class="reference internal" href="../../generated/mne.preprocessing.compute_proj_eog.html#mne.preprocessing.compute_proj_eog" title="mne.preprocessing.compute_proj_eog"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compute_proj_eog</span></code></a>,
which again takes a <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object as input and returns the
requested number of projectors for magnetometers, gradiometers, and EEG
channels (default is two projectors for each channel type). This time, weâll
pass <code class="docutils literal notranslate"><span class="pre">no_proj</span></code> parameter (so we get back only the new EOG projectors, not
also the existing projectors in the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Raw</span></code></a> object), and weâll
ignore the events array by assigning it to <code class="docutils literal notranslate"><span class="pre">_</span></code> (the conventional way of
handling unwanted return elements in Python).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">eog_projs</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_</span></a> <span class="o">=</span> <a href="../../generated/mne.preprocessing.compute_proj_eog.html#mne.preprocessing.compute_proj_eog" title="mne.preprocessing.compute_proj_eog" class="sphx-glr-backref-module-mne-preprocessing sphx-glr-backref-type-py-function"><span class="n">compute_proj_eog</span></a><span class="p">(</span><a href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span></a><span class="p">,</span> <span class="n">n_grad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_mag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_eeg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">reject</span></a><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">no_proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reading 0 ... 166799  =      0.000 ...   277.714 secs...
Running EOG SSP computation
EOG channel index for this subject is: [375]
Filtering the data to remove DC offset to help distinguish blinks from saccades
Setting up band-pass filter from 1 - 10 Hz

FIR filter parameters
---------------------
Designing a two-pass forward and reverse, zero-phase, non-causal bandpass filter:
- Windowed frequency-domain design (firwin2) method
- Hann window
- Lower passband edge: 1.00
- Lower transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 0.75 Hz)
- Upper passband edge: 10.00 Hz
- Upper transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 10.25 Hz)
- Filter length: 6007 samples (10.001 sec)

Now detecting blinks and generating corresponding events
Found 46 significant peaks
Number of EOG events detected : 46
Computing projector
Filtering a subset of channels. The highpass and lowpass values in the measurement info will not be updated.
Filtering raw data in 1 contiguous segment
Setting up band-pass filter from 1 - 35 Hz

FIR filter parameters
---------------------
Designing a two-pass forward and reverse, zero-phase, non-causal bandpass filter:
- Windowed frequency-domain design (firwin2) method
- Hamming window
- Lower passband edge: 1.00
- Lower transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 0.75 Hz)
- Upper passband edge: 35.00 Hz
- Upper transition bandwidth: 0.50 Hz (-12 dB cutoff frequency: 35.25 Hz)
- Filter length: 6007 samples (10.001 sec)

Not setting metadata
Not setting metadata
46 matching events found
No baseline correction applied
Created an SSP operator (subspace dimension = 9)
9 projection items activated
Loading data for 46 events and 241 original time points ...
0 bad epochs dropped
Adding projection: planar--0.200-0.200-PCA-01
Adding projection: axial--0.200-0.200-PCA-01
Adding projection: eeg--0.200-0.200-PCA-01
Done.
</pre></div>
</div>
<p>Just like with the empty-room and ECG projectors, we can visualize the scalp
distribution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.viz.plot_projs_topomap.html#mne.viz.plot_projs_topomap" title="mne.viz.plot_projs_topomap" class="sphx-glr-backref-module-mne-viz sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">plot_projs_topomap</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">eog_projs</span></a><span class="p">,</span> <span class="n">info</span><span class="o">=</span><a href="../../generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw</span><span class="o">.</span><span class="n">info</span></a><span class="p">)</span>
</pre></div>
</div>
<img alt="EOG-planar--0.200-0.20 0-PCA-01, EOG-axial--0.200-0.200 -PCA-01, EOG-eeg--0.200-0.200-P CA-01" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_022.png" />
<p>Now we repeat the plot from above (with empty room and ECG projectors) and
compare it to a plot with empty room, ECG, and EOG projectors, to see how
well the ocular artifacts have been repaired:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Without&#39;</span><span class="p">,</span> <span class="s1">&#39;With&#39;</span><span class="p">):</span>
    <span class="k">if</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a> <span class="o">==</span> <span class="s1">&#39;With&#39;</span><span class="p">:</span>
        <a href="../../generated/mne.io.Raw.html#mne.io.Raw.add_proj" title="mne.io.Raw.add_proj" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">add_proj</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">eog_projs</span></a><span class="p">)</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="../../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">order</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">artifact_picks</span></a><span class="p">))</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure.subplots_adjust" title="matplotlib.figure.Figure.subplots_adjust" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>  <span class="c1"># make room for title</span>
    <a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure.suptitle" title="matplotlib.figure.Figure.suptitle" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span></a><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> EOG projectors&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
                 <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Without EOG projectors" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_023.png" />
</li>
<li><img alt="With EOG projectors" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_024.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>3 projection items deactivated
</pre></div>
</div>
<p>Notice that the small peaks in the first to magnetometer channels (<code class="docutils literal notranslate"><span class="pre">MEG</span>
<span class="pre">1411</span></code> and <code class="docutils literal notranslate"><span class="pre">MEG</span> <span class="pre">1421</span></code>) that occur at the same time as the large EEG
deflections have also been removed.</p>
</section>
</section>
<section id="choosing-the-number-of-projectors">
<h2><a class="toc-backref" href="#id11">Choosing the number of projectors</a><a class="headerlink" href="#choosing-the-number-of-projectors" title="Permalink to this headline">Â¶</a></h2>
<p>In the examples above, we used 3 projectors (all magnetometer) to capture
empty room noise, and saw how projectors computed for the gradiometers failed
to capture <em>global</em> patterns (and thus we discarded the gradiometer
projectors). Then we computed 3 projectors (1 for each channel type) to
capture the heartbeat artifact, and 3 more to capture the ocular artifact.
How did we choose these numbers? The short answer is âbased on experienceâ â
knowing how heartbeat artifacts typically manifest across the sensor array
allows us to recognize them when we see them, and recognize when additional
projectors are capturing something else other than a heartbeat artifact (and
thus may be removing brain signal and should be discarded).</p>
</section>
<section id="visualizing-ssp-sensor-space-bias-via-signal-reconstruction">
<span id="tut-artifact-ssp-reconstruction"></span><h2><a class="toc-backref" href="#id12">Visualizing SSP sensor-space bias via signal reconstruction</a><a class="headerlink" href="#visualizing-ssp-sensor-space-bias-via-signal-reconstruction" title="Permalink to this headline">Â¶</a></h2>
<aside class="sidebar">
<p class="sidebar-title">SSP reconstruction</p>
<p>Internally, the reconstruction is performed by effectively using a
minimum-norm source localization to a spherical source space with the
projections accounted for, and then projecting the source-space data
back out to sensor space.</p>
</aside>
<p>Because SSP performs an orthogonal projection, any spatial component in the
data that is not perfectly orthogonal to the SSP spatial direction(s) will
have its overall amplitude reduced by the projection operation. In other
words, SSP typically introduces some amount of amplitude reduction bias in
the sensor space data.</p>
<p>When performing source localization of M/EEG data, these projections are
properly taken into account by being applied not just to the M/EEG data
but also to the forward solution, and hence SSP should not bias the estimated
source amplitudes. However, for sensor space analyses, it can be useful to
visualize the extent to which SSP projection has biased the data. This can be
explored by using <code class="docutils literal notranslate"><span class="pre">proj='reconstruct'</span></code> in evoked plotting functions, for
example via <a class="reference internal" href="../../generated/mne.Evoked.html#mne.Evoked.plot" title="mne.Evoked.plot"><code class="xref py py-obj docutils literal notranslate"><span class="pre">evoked.plot()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne.EvokedArray.html#mne.EvokedArray" title="mne.EvokedArray" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">evoked</span></a> <span class="o">=</span> <a href="../../generated/mne.Epochs.html#mne.Epochs.average" title="mne.Epochs.average" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">average</span></a><span class="p">()</span>
<span class="c1"># Apply the average ref first:</span>
<span class="c1"># It&#39;s how we typically view EEG data, and here we&#39;re really just interested</span>
<span class="c1"># in the effect of the EOG+ECG SSPs</span>
<a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.del_proj" title="mne.EvokedArray.del_proj" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">evoked</span><span class="o">.</span><span class="n">del_proj</span></a><span class="p">()</span><span class="o">.</span><span class="n">set_eeg_reference</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">apply_proj</span><span class="p">()</span>
<a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.add_proj" title="mne.EvokedArray.add_proj" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">evoked</span><span class="o">.</span><span class="n">add_proj</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ecg_projs</span></a><span class="p">)</span><span class="o">.</span><span class="n">add_proj</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">eog_projs</span></a><span class="p">)</span>
<a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_shared_y_axes</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">])</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pi</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;reconstruct&#39;</span><span class="p">)):</span>
    <a href="../../generated/mne.EvokedArray.html#mne.EvokedArray.plot" title="mne.EvokedArray.plot" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">evoked</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="o">=</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[:,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pi</span></a><span class="p">],</span> <span class="n">spatial_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pi</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[:,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pi</span></a><span class="p">]:</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">parts</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.get_title.html#matplotlib.axes.Axes.get_title" title="matplotlib.axes.Axes.get_title" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">get_title</span></a><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <a href="https://matplotlib.org/api/_as_gen/matplotlib.artist.Artist.set.html#matplotlib.artist.Artist.set" title="matplotlib.artist.Artist.set" class="sphx-glr-backref-module-matplotlib-artist sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set</span></a><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">parts</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.get_ylabel.html#matplotlib.axes.Axes.get_ylabel" title="matplotlib.axes.Axes.get_ylabel" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">get_ylabel</span></a><span class="p">()</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span>
                          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">parts</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pi</span></a><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;proj=</span><span class="si">{</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">proj</span></a><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pi</span></a><span class="p">]</span><span class="o">.</span><span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.setp.html#matplotlib.pyplot.setp" title="matplotlib.pyplot.setp" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">setp</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">title</span></a><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.setp.html#matplotlib.pyplot.setp" title="matplotlib.pyplot.setp" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">setp</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.setp.html#matplotlib.pyplot.setp" title="matplotlib.pyplot.setp" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">setp</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axes</span></a><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="proj=False, proj=True, proj=reconstruct" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_50_artifact_correction_ssp_025.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 003&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 007&#39;]
    Rejecting  epoch based on MAG : [&#39;MEG 1711&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 008&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 003&#39;, &#39;EEG 007&#39;, &#39;EEG 008&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 003&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 002&#39;, &#39;EEG 007&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
    Rejecting  epoch based on EEG : [&#39;EEG 001&#39;, &#39;EEG 002&#39;, &#39;EEG 003&#39;, &#39;EEG 004&#39;, &#39;EEG 005&#39;, &#39;EEG 006&#39;, &#39;EEG 007&#39;, &#39;EEG 015&#39;]
Adding average EEG reference projection.
1 projection items deactivated
Average reference projection was added, but has not been applied yet. Use the apply_proj method to apply it.
Created an SSP operator (subspace dimension = 1)
1 projection items activated
SSP projectors applied...
3 projection items deactivated
3 projection items deactivated
Created an SSP operator (subspace dimension = 7)
7 projection items activated
SSP projectors applied...
    Automatic origin fit: head of radius 91.0 mm
    Computing dot products for 305 MEG channels...
    Computing cross products for 305 â 305 MEG channels...
    Preparing the mapping matrix...
    Truncating at 81/305 components to omit less than 0.0001 (9.9e-05)
    Automatic origin fit: head of radius 91.0 mm
    Computing dot products for 59 EEG channels...
    Computing cross products for 59 â 59 EEG channels...
    Preparing the mapping matrix...
    Truncating at 56/59 components and regularizing with Î±=1.0e-01
    The map has an average electrode reference (59 channels)
</pre></div>
</div>
<p>Note that here the bias in the EEG and magnetometer channels is reduced by
the reconstruction. This suggests that the application of SSP has slightly
reduced the amplitude of our signals in sensor space, but that it should not
bias the amplitudes in source space.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id13">References</a><a class="headerlink" href="#references" title="Permalink to this headline">Â¶</a></h2>
<p><dl class="footnote brackets">
<dt class="label" id="uusitaloilmoniemi1997"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>MikkoÂ A. Uusitalo and RistoÂ J. Ilmoniemi. Signal-space projection method for separating MEG or EEG into components. <em>Medical &amp; Biological Engineering &amp; Computing</em>, 35(2):135â140, 1997. <a class="reference external" href="https://doi.org/10.1007/BF02534144">doi:10.1007/BF02534144</a>.</p>
</dd>
</dl>
</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  9.981 seconds)</p>
<p><strong>Estimated memory usage:</strong>  779 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-preprocessing-plot-50-artifact-correction-ssp-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/c74914b0c84c9d59b74214e27afeb632/plot_50_artifact_correction_ssp.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_50_artifact_correction_ssp.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/99730d9046b115c3e40e7e01cb975635/plot_50_artifact_correction_ssp.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_50_artifact_correction_ssp.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><div class="row">
    <div class="container col-md-12 institutions">
      <ul class="list-unstyled">
        <li><a href="https://www.massgeneral.org/"><img class="institution" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a></li>
        <li><a href="https://martinos.org/"><img class="institution" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a></li>
        <li><a href="https://hms.harvard.edu/"><img class="institution" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a></li>
        <li><a href="https://web.mit.edu/"><img class="institution" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a></li>
        <li><a href="https://www.nyu.edu/"><img class="institution" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a></li>
        <li><a href="http://www.cea.fr/"><img class="institution" src="../../_static/institution_logos/CEA.png" title="Commissariat Ã  lÂ´Ã©nergie atomique et aux Ã©nergies alternatives" alt="Commissariat Ã  lÂ´Ã©nergie atomique et aux Ã©nergies alternatives"/></a></li>
        <li><a href="https://sci.aalto.fi/"><img class="institution" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a></li>
        <li><a href="https://www.telecom-paris.fr/"><img class="institution" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="TÃ©lÃ©com ParisTech" alt="TÃ©lÃ©com ParisTech"/></a></li>
        <li><a href="https://www.washington.edu/"><img class="institution" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a></li>
        <li><a href="https://icm-institute.org/"><img class="institution" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle Ã©piniÃ¨re" alt="Institut du Cerveau et de la Moelle Ã©piniÃ¨re"/></a></li>
        <li><a href="https://www.bu.edu/"><img class="institution" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a></li>
        <li><a href="https://www.inserm.fr/"><img class="institution" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santÃ© et de la recherche mÃ©dicale" alt="Institut national de la santÃ© et de la recherche mÃ©dicale"/></a></li>
        <li><a href="https://www.fz-juelich.de/"><img class="institution" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum JÃ¼lich" alt="Forschungszentrum JÃ¼lich"/></a></li>
        <li><a href="https://www.tu-ilmenau.de/"><img class="institution" src="../../_static/institution_logos/Ilmenau.gif" title="Technische UniversitÃ¤t Ilmenau" alt="Technische UniversitÃ¤t Ilmenau"/></a></li>
        <li><a href="https://bids.berkeley.edu/"><img class="institution" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a></li>
        <li><a href="https://www.inria.fr/"><img class="institution" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a></li>
        <li><a href="https://www.au.dk/"><img class="institution" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a></li>
        <li><a href="https://www.uni-graz.at/"><img class="institution" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-UniversitÃ¤t Graz" alt="Karl-Franzens-UniversitÃ¤t Graz"/></a></li>
      </ul>
      <p class="text-center text-muted small">&copy; Copyright 2012-2021, MNE Developers. Last updated <time datetime="2021-04-02T17:37:54.428702+00:00" class="localized">2021-04-02 17:37 UTC</time>
<script type="text/javascript">$(function () { $("time.localized").each(function () { var el = $(this); el.text(new Date(el.attr("datetime")).toLocaleString([], {dateStyle: "medium", timeStyle: "long"})); }); } )</script></p>
    </div></div></div>
  </footer>
  <script src="https://mne.tools/versionwarning.js"></script>
  </body>
</html>