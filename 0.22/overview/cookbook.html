<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The typical M/EEG workflow &#8212; MNE 0.22.1 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap_divs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/bootstrap_divs.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <link rel="canonical" href="https://mne.tools/stable/index.html" />
    <script type="text/javascript" src="../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-source-code-pro.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-source-sans-pro.css" type="text/css" />
    <link rel="stylesheet" href="../_static/flag-icon.css" type="text/css" />


    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>



  </head><body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/mne_logo_small.svg"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.22.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../install/index.html">Install</a></li>
                <li><a href="index.html">Overview</a></li>
                <li><a href="../auto_tutorials/index.html">Tutorials</a></li>
                <li><a href="../auto_examples/index.html">Examples</a></li>
                <li><a href="../glossary.html">Glossary</a></li>
                <li><a href="../python_reference.html">API</a></li>
            
            
            <li class="dropdown globaltoc-container">
              <a role="button" id="dLabelGlobalToc" data-toggle="dropdown" data-target="#" href="#">More<b class="caret"></b></a>
              <ul class="dropdown-menu globaltoc" role="menu" aria-labelledby="dLabelGlobalToc">
                <li><a href="https://github.com/mne-tools/mne-python"><i class="fa fa-github"></i> GitHub</a></li>
                <li><a href="get_help.html"><i class="fa fa-question-circle"></i> Get help</a></li>
                <li><a href="../install/contributing.html"><i class="fa fa-code-fork"></i> Contribute</a></li>
                <li><a href="cite.html"><i class="fa fa-book"></i> Cite MNE</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="dLabelMore" data-toggle="dropdown" style="margin-left: 10px">
              v0.22.1
              <span class="caret"></span>
            </button>
              <ul class="dropdown-menu" aria-labelledby="dLabelMore">
                <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
                <li><a href="https://mne-tools.github.io/stable/index.html">v0.22 (stable)</a></li>
                <li><a href="https://mne-tools.github.io/0.21/index.html">v0.21</a></li>
                <li><a href="https://mne-tools.github.io/0.20/index.html">v0.20</a></li>
                <li><a href="https://mne-tools.github.io/0.19/index.html">v0.19</a></li>
                <li><a href="https://mne-tools.github.io/0.18/index.html">v0.18</a></li>
                <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
                <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
                <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
                <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
                <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
                <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
                <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
              </ul>
            </li>

            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="the-typical-m-eeg-workflow">
<span id="cookbook"></span><h1>The typical M/EEG workflow<a class="headerlink" href="#the-typical-m-eeg-workflow" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id5">Overview</a></p></li>
<li><p><a class="reference internal" href="#preprocessing" id="id6">Preprocessing</a></p>
<ul>
<li><p><a class="reference internal" href="#marking-bad-channels" id="id7">Marking bad channels</a></p></li>
<li><p><a class="reference internal" href="#artifact-suppression" id="id8">Artifact suppression</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#epoching-and-evoked-data" id="id9">Epoching and evoked data</a></p>
<ul>
<li><p><a class="reference internal" href="#rejection-using-annotations" id="id10">Rejection using annotations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#source-localization" id="id11">Source localization</a></p>
<ul>
<li><p><a class="reference internal" href="#anatomical-information" id="id12">Anatomical information</a></p></li>
<li><p><a class="reference internal" href="#aligning-coordinate-frames" id="id13">Aligning coordinate frames</a></p></li>
<li><p><a class="reference internal" href="#computing-the-forward-solution" id="id14">Computing the forward solution</a></p></li>
<li><p><a class="reference internal" href="#computing-the-noise-covariance-matrix" id="id15">Computing the noise-covariance matrix</a></p></li>
<li><p><a class="reference internal" href="#calculating-the-inverse-operator" id="id16">Calculating the inverse operator</a></p></li>
<li><p><a class="reference internal" href="#creating-source-estimates" id="id17">Creating source estimates</a></p></li>
<li><p><a class="reference internal" href="#group-analyses" id="id18">Group analyses</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id5">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This section describes a typical MEG/EEG workflow, eventually up to source
reconstruction. The workflow is summarized in <a class="reference internal" href="#flow-diagram"><span class="std std-ref">Workflow of the MNE software</span></a>.
References below refer to Python functions and objects.</p>
<figure class="align-center" id="id3">
<span id="flow-diagram"></span><img alt="MNE Workflow Flowchart" src="../_images/flow_diagram.svg" /><figcaption>
<p><span class="caption-text"><strong>Workflow of the MNE software</strong></span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="preprocessing">
<h2><a class="toc-backref" href="#id6">Preprocessing</a><a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h2>
<p>The following MEG and EEG data preprocessing steps are recommended:</p>
<ul class="simple">
<li><p>Bad channels in the MEG and EEG data must be identified, see <a class="reference internal" href="#marking-bad-channels"><span class="std std-ref">Marking bad channels</span></a>.</p></li>
<li><p>The data has to be filtered to the desired passband.</p></li>
<li><p>Artifacts should be suppressed (e.g., using ICA or SSP).</p></li>
</ul>
<section id="marking-bad-channels">
<span id="id1"></span><h3><a class="toc-backref" href="#id7">Marking bad channels</a><a class="headerlink" href="#marking-bad-channels" title="Permalink to this headline">¶</a></h3>
<p>Sometimes some MEG or EEG channels are not functioning properly
for various reasons. These channels should be excluded from
analysis by marking them bad as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MEG2443&#39;</span><span class="p">]</span>  
</pre></div>
</div>
<p>Especially if a channel does not show
a signal at all (flat) it is important to exclude it from the
analysis, since its noise estimate will be unrealistically low and
thus the current estimate calculations will give a strong weight
to the zero signal on the flat channels and will essentially vanish.
It is also important to exclude noisy channels because they can
possibly affect others when signal-space projections or EEG average electrode
reference is employed. Noisy bad channels can also adversely affect
averaging and noise-covariance matrix estimation by causing
unnecessary rejections of epochs.</p>
<p>Recommended ways to identify bad channels are:</p>
<ul class="simple">
<li><p>Observe the quality of data during data
acquisition and make notes of observed malfunctioning channels to
your measurement protocol sheet.</p></li>
<li><p>View the on-line averages and check the condition of the channels.</p></li>
<li><p>Compute preliminary off-line averages with artifact rejection,
SSP/ICA, and EEG average electrode reference computation
off and check the condition of the channels.</p></li>
<li><p>View raw data with <a class="reference internal" href="../generated/mne.io.Raw.html#mne.io.Raw.plot" title="mne.io.Raw.plot"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.io.Raw.plot()</span></code></a> without SSP/ICA
enabled and identify bad channels.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is strongly recommended that bad channels are identified and
marked in the original raw data files. If present in the raw data
files, the bad channel selections will be automatically transferred
to averaged files, noise-covariance matrices, forward solution
files, and inverse operator decompositions.</p>
</div>
</section>
<section id="artifact-suppression">
<h3><a class="toc-backref" href="#id8">Artifact suppression</a><a class="headerlink" href="#artifact-suppression" title="Permalink to this headline">¶</a></h3>
<section id="ssp">
<h4>SSP<a class="headerlink" href="#ssp" title="Permalink to this headline">¶</a></h4>
<p>The Signal-Space Projection (SSP) is one approach to rejection
of external disturbances in software. Unlike many other
noise-cancellation approaches, SSP does
not require additional reference sensors to record the disturbance
fields. Instead, SSP relies on the fact that the magnetic field
distributions generated by the sources in the brain have spatial
distributions sufficiently different from those generated by external
noise sources. Furthermore, it is implicitly assumed that the linear
space spanned by the significant external noise patters has a low
dimension.</p>
<p>SSP-based rejection is often done using the
<a class="reference internal" href="../generated/mne.preprocessing.compute_proj_ecg.html#mne.preprocessing.compute_proj_ecg" title="mne.preprocessing.compute_proj_ecg"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.preprocessing.compute_proj_ecg()</span></code></a> and
<a class="reference internal" href="../generated/mne.preprocessing.compute_proj_eog.html#mne.preprocessing.compute_proj_eog" title="mne.preprocessing.compute_proj_eog"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.preprocessing.compute_proj_eog()</span></code></a> methods, see
<a class="reference internal" href="../auto_tutorials/preprocessing/plot_45_projectors_background.html#tut-projectors-background"><span class="std std-ref">Background on projectors and projections</span></a> and <a class="reference internal" href="../auto_tutorials/preprocessing/plot_50_artifact_correction_ssp.html#tut-artifact-ssp"><span class="std std-ref">Repairing artifacts with SSP</span></a> for more
information.</p>
</section>
<section id="ica">
<h4>ICA<a class="headerlink" href="#ica" title="Permalink to this headline">¶</a></h4>
<p>Many M/EEG signals including biological artifacts reflect non-Gaussian
processes. Therefore PCA-based artifact rejection will likely perform worse at
separating the signal from noise sources.</p>
<p>ICA-based artifact rejection is done using the <a class="reference internal" href="../generated/mne.preprocessing.ICA.html#mne.preprocessing.ICA" title="mne.preprocessing.ICA"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.preprocessing.ICA</span></code></a>
class, see the <a class="reference internal" href="../auto_tutorials/discussions/plot_background_ica.html#ica"><span class="std std-ref">Background on Independent Component Analysis (ICA)</span></a> section for more information.</p>
</section>
</section>
</section>
<section id="epoching-and-evoked-data">
<h2><a class="toc-backref" href="#id9">Epoching and evoked data</a><a class="headerlink" href="#epoching-and-evoked-data" title="Permalink to this headline">¶</a></h2>
<p>Epoching of raw data is done using events, which define a <code class="docutils literal notranslate"><span class="pre">t=0</span></code> for your
data chunks. Event times stamped to the acquisition software can be extracted
using <a class="reference internal" href="../generated/mne.find_events.html#mne.find_events" title="mne.find_events"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.find_events()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">events</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">find_events</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>  
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">events</span></code> array can then be modified, extended, or changed if necessary.
If the original trigger codes and trigger times are correct for the analysis
of interest, <a class="reference internal" href="../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.Epochs</span></code></a> for the first event type (<code class="docutils literal notranslate"><span class="pre">1</span></code>) can be
constructed using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reject</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="mf">4e-12</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="mf">150e-6</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">epochs</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">proj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  
<span class="gp">&gt;&gt;&gt; </span>                    <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">)</span>  
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The rejection thresholds (set with argument <code class="docutils literal notranslate"><span class="pre">reject</span></code>) are defined
in T / m for gradiometers, T for magnetometers and V for EEG and EOG
channels.</p>
</div>
<section id="rejection-using-annotations">
<h3><a class="toc-backref" href="#id10">Rejection using annotations</a><a class="headerlink" href="#rejection-using-annotations" title="Permalink to this headline">¶</a></h3>
<p>The reject keyword of <a class="reference internal" href="../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.Epochs</span></code></a> is used for rejecting bad epochs
based on peak-to-peak thresholds. Bad segments of data can also be rejected
by marking segments of raw data with annotations. See
<a class="reference internal" href="../auto_tutorials/preprocessing/plot_20_rejecting_bad_data.html#tut-reject-data-spans"><span class="std std-ref">Rejecting bad data spans</span></a> and <a class="reference internal" href="../generated/mne.Annotations.html#mne.Annotations" title="mne.Annotations"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.Annotations</span></code></a> for more .</p>
<p>Once the <a class="reference internal" href="../generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.Epochs</span></code></a> are constructed, they can be averaged to obtain
<a class="reference internal" href="../generated/mne.Evoked.html#mne.Evoked" title="mne.Evoked"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.Evoked</span></code></a> data as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evoked</span> <span class="o">=</span> <span class="n">epochs</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>  
</pre></div>
</div>
</section>
</section>
<section id="source-localization">
<h2><a class="toc-backref" href="#id11">Source localization</a><a class="headerlink" href="#source-localization" title="Permalink to this headline">¶</a></h2>
<p>MNE makes extensive use of the FreeSurfer file structure for analysis.
Before starting data analysis, we recommend setting up the environment
variable <code class="docutils literal notranslate"><span class="pre">SUBJECTS_DIR</span></code> (or set it permanently using <a class="reference internal" href="../generated/mne.set_config.html#mne.set_config" title="mne.set_config"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.set_config()</span></code></a>)
to select the directory under which the anatomical MRI data are stored.
This makes it so that the <code class="docutils literal notranslate"><span class="pre">subjects_dir</span></code> argument does not need to
be passed to many functions.</p>
<section id="anatomical-information">
<h3><a class="toc-backref" href="#id12">Anatomical information</a><a class="headerlink" href="#anatomical-information" title="Permalink to this headline">¶</a></h3>
<section id="cortical-surface-reconstruction-with-freesurfer">
<span id="chdbbcej"></span><h4>Cortical surface reconstruction with FreeSurfer<a class="headerlink" href="#cortical-surface-reconstruction-with-freesurfer" title="Permalink to this headline">¶</a></h4>
<p>The first processing stage is the creation of various surface
reconstructions with FreeSurfer. The recommended FreeSurfer workflow
is summarized on the <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/RecommendedReconstruction">FreeSurfer wiki pages</a>. See
also this information <a class="reference internal" href="../auto_tutorials/source-modeling/plot_background_freesurfer.html#tut-freesurfer-reconstruction"><span class="std std-ref">FreeSurfer MRI reconstruction</span></a>.</p>
</section>
<section id="setting-up-the-source-space">
<span id="setting-up-source-space"></span><h4>Setting up the source space<a class="headerlink" href="#setting-up-the-source-space" title="Permalink to this headline">¶</a></h4>
<p>This stage consists of the following:</p>
<ul class="simple">
<li><p>Creating a suitable decimated dipole grid on the white matter surface.</p></li>
<li><p>Creating the source space file in fif format.</p></li>
</ul>
<p>This is accomplished with using <a class="reference internal" href="../generated/mne.setup_source_space.html#mne.setup_source_space" title="mne.setup_source_space"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.setup_source_space()</span></code></a> and
<a class="reference internal" href="../generated/mne.write_source_spaces.html#mne.write_source_spaces" title="mne.write_source_spaces"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.write_source_spaces()</span></code></a>. These assume that the anatomical MRI processing
has been completed as described in <a class="reference internal" href="#chdbbcej"><span class="std std-ref">Cortical surface reconstruction with FreeSurfer</span></a>.</p>
<span id="babgcdha"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-text">Recommended subdivisions of an icosahedron and an octahedron for
       the creation of source spaces. The approximate source spacing and
       corresponding surface area have been calculated assuming a
       1000-cm2 surface area per hemisphere.</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 27%" />
<col style="width: 23%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">spacing</span></code></p></th>
<th class="head"><p>Sources per hemisphere</p></th>
<th class="head"><p>Source spacing / mm</p></th>
<th class="head"><p>Surface area per source / mm2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'oct5'</span></code></p></td>
<td><p>1026</p></td>
<td><p>9.9</p></td>
<td><p>97</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'ico4'</span></code></p></td>
<td><p>2562</p></td>
<td><p>6.2</p></td>
<td><p>39</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'oct6'</span></code></p></td>
<td><p>4098</p></td>
<td><p>4.9</p></td>
<td><p>24</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'ico5'</span></code></p></td>
<td><p>10242</p></td>
<td><p>3.1</p></td>
<td><p>9.8</p></td>
</tr>
</tbody>
</table>
<p>For example, to create the reconstruction geometry for <code class="docutils literal notranslate"><span class="pre">subject='sample'</span></code>
with a ~5-mm spacing between the grid points, say:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="n">setup_source_space</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;oct6&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_source_spaces</span><span class="p">(</span><span class="s1">&#39;sample-oct6-src.fif&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>  
</pre></div>
</div>
<p>This creates the source spaces and writes them to disk.</p>
<p><a class="reference internal" href="../auto_tutorials/source-modeling/plot_forward.html#plot-forward-source-space"><span class="std std-ref">Compute Source Space</span></a> illustrates how the source space is used to
compute the forward model.</p>
</section>
<section id="creating-the-bem-model-meshes">
<span id="chdbjcia"></span><h4>Creating the BEM model meshes<a class="headerlink" href="#creating-the-bem-model-meshes" title="Permalink to this headline">¶</a></h4>
<p>Calculation of the forward solution using the boundary-element
model (BEM) requires that the surfaces separating regions of different
electrical conductivities are tessellated with suitable surface
elements. Our BEM software employs triangular tessellations. Therefore,
prerequisites for BEM calculations are the segmentation of the MRI
data and the triangulation of the relevant surfaces.</p>
<p>For MEG computations, a reasonably accurate solution can
be obtained by using a single-compartment BEM assuming the shape
of the intracranial volume. For EEG, the standard model contains
the intracranial space, the skull, and the scalp.</p>
<p>At present, no bulletproof method exists for creating the
triangulations. Feasible approaches are described in <a class="reference internal" href="implementation.html#bem-model"><span class="std std-ref">The Boundary Element Model (BEM)</span></a>.</p>
</section>
<section id="setting-up-the-head-surface-triangulation-files">
<span id="babdbbfc"></span><h4>Setting up the head surface triangulation files<a class="headerlink" href="#setting-up-the-head-surface-triangulation-files" title="Permalink to this headline">¶</a></h4>
<p>The segmentation algorithms described in <a class="reference internal" href="implementation.html#bem-model"><span class="std std-ref">The Boundary Element Model (BEM)</span></a> produce
either FreeSurfer surfaces or triangulation
data in text. Before proceeding to the creation of the boundary
element model, standard files for FreeSurfer surfaces must be present:</p>
<ol class="arabic simple">
<li><p><strong>inner_skull.surf</strong> contains the inner skull triangulation.</p></li>
<li><p><strong>outer_skull.surf</strong> contains the outer skull triangulation.</p></li>
<li><p><strong>outer_skin.surf</strong> contains the head surface triangulation.</p></li>
</ol>
</section>
<section id="setting-up-the-boundary-element-model">
<span id="cihdbfeg"></span><h4>Setting up the boundary-element model<a class="headerlink" href="#setting-up-the-boundary-element-model" title="Permalink to this headline">¶</a></h4>
<p>This stage sets up the subject-dependent data for computing
the forward solutions:”</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">make_bem_model</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_bem_surfaces</span><span class="p">(</span><span class="s1">&#39;sample-5120-5120-5120-bem.fif&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>  
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">surfaces</span></code> is a list of BEM surfaces that have each been read using
<a class="reference internal" href="../generated/mne.read_surface.html#mne.read_surface" title="mne.read_surface"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.read_surface()</span></code></a>. This step also checks that the input surfaces
are complete and that they are topologically correct, <em>i.e.</em>,
that the surfaces do not intersect and that the surfaces are correctly
ordered (outer skull surface inside the scalp and inner skull surface
inside the outer skull).</p>
<p>This step assigns the conductivity values to the BEM compartments.
For the scalp and the brain compartments, the default is 0.3 S/m.
The default skull conductivity is 50 times smaller, <em>i.e.</em>,
0.006 S/m. Recent publications, see <a class="reference internal" href="../references.html#cegegdei"><span class="std std-ref">Forward modeling</span></a>, report
a range of skull conductivity ratios ranging from 1:15 (Oostendorp <em>et
al.</em>, 2000) to 1:25 - 1:50 (Slew <em>et al.</em>,
2009, Conçalves <em>et al.</em>, 2003). The
MNE default ratio 1:50 is based on the typical values reported in
(Conçalves <em>et al.</em>, 2003), since their
approach is based comparison of SEF/SEP measurements in a BEM model.
The variability across publications may depend on individual variations
but, more importantly, on the precision of the skull compartment
segmentation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To produce single layer BEM models (–homog flag in the C command
line tools) pass a list with one single conductivity value,
e.g. <code class="docutils literal notranslate"><span class="pre">conductivities=[0.3]</span></code>.</p>
</div>
<p>Using this model, the BEM solution can be computed using
<a class="reference internal" href="../generated/mne.make_bem_solution.html#mne.make_bem_solution" title="mne.make_bem_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_bem_solution()</span></code></a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bem_sol</span> <span class="o">=</span> <span class="n">make_bem_solution</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">write_bem_solution</span><span class="p">(</span><span class="s1">&#39;sample-5120-5120-5120-bem-sol.fif&#39;</span><span class="p">,</span> <span class="n">bem_sol</span><span class="p">)</span>  
</pre></div>
</div>
<p>After the BEM is set up it is advisable to check that the
BEM model meshes are correctly positioned using <em>e.g.</em>
<a class="reference internal" href="../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="mne.viz.plot_alignment"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_alignment()</span></code></a> or <a class="reference internal" href="../generated/mne.Report.html#mne.Report" title="mne.Report"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.Report</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Up to this point all processing stages depend on the
anatomical (geometrical) information only and thus remain
identical across different MEG studies.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use custom head models you might need to set the <code class="docutils literal notranslate"><span class="pre">ico=None</span></code>
parameter to <code class="docutils literal notranslate"><span class="pre">None</span></code> and skip subsampling of the surface.</p>
</div>
</section>
</section>
<section id="aligning-coordinate-frames">
<span id="chdbehdc"></span><h3><a class="toc-backref" href="#id13">Aligning coordinate frames</a><a class="headerlink" href="#aligning-coordinate-frames" title="Permalink to this headline">¶</a></h3>
<p>The calculation of the forward solution requires knowledge
of the relative location and orientation of the MEG/EEG and MRI
coordinate systems (see <a class="reference internal" href="implementation.html#head-device-coords"><span class="std std-ref">The head and device coordinate systems</span></a>). The head coordinate
frame is defined by identifying the fiducial landmark locations,
making the origin and orientation of the head coordinate system
slightly user dependent. As a result, it is safest to reestablish
the definition of the coordinate transformation computation
for each experimental session, <em>i.e.</em>, each time when new head
digitization data are employed.</p>
<p>The corregistration is stored in <code class="docutils literal notranslate"><span class="pre">-trans.fif</span></code> file. If is present,
you can follow <a class="reference internal" href="../auto_tutorials/source-modeling/plot_source_alignment.html#plot-source-alignment"><span class="std std-ref">Source alignment and coordinate frames</span></a> to validate its correctness.
If the <code class="docutils literal notranslate"><span class="pre">-trans.fif</span></code> is not present or the alignment is not correct
you need to use <a class="reference internal" href="../generated/mne.gui.coregistration.html#mne.gui.coregistration" title="mne.gui.coregistration"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.gui.coregistration()</span></code></a> (or its convenient command line
equivalent <a class="reference internal" href="../generated/commands.html#mne-coreg"><span class="std std-ref">mne coreg</span></a>) to generate it.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This step is important. If the alignment of the
coordinate frames is inaccurate all subsequent processing
steps suffer from the error. Therefore, this step should be
performed by the person in charge of the study or by a trained
technician. Written or photographic documentation of the alignment
points employed during the MEG/EEG acquisition can also be
helpful.</p>
</div>
</section>
<section id="computing-the-forward-solution">
<span id="id2"></span><h3><a class="toc-backref" href="#id14">Computing the forward solution</a><a class="headerlink" href="#computing-the-forward-solution" title="Permalink to this headline">¶</a></h3>
<p>After the MRI-MEG/EEG alignment has been set, the forward
solution, <em>i.e.</em>, the magnetic fields and electric
potentials at the measurement sensors and electrodes due to dipole
sources located on the cortex, can be calculated with help of
<a class="reference internal" href="../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_forward_solution()</span></code></a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fwd</span> <span class="o">=</span> <span class="n">make_forward_solution</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">fname_trans</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">bem_sol</span><span class="p">)</span>  
</pre></div>
</div>
</section>
<section id="computing-the-noise-covariance-matrix">
<h3><a class="toc-backref" href="#id15">Computing the noise-covariance matrix</a><a class="headerlink" href="#computing-the-noise-covariance-matrix" title="Permalink to this headline">¶</a></h3>
<p>The MNE software employs an estimate of the noise-covariance
matrix to weight the channels correctly in the calculations. The
noise-covariance matrix provides information about field and potential
patterns representing uninteresting noise sources of either human
or environmental origin.</p>
<p>The noise covariance matrix can be calculated in several
ways:</p>
<ul>
<li><p>Employ the individual epochs during
off-line averaging to calculate the full noise covariance matrix.
This is the recommended approach for evoked responses, <em>e.g.</em> using
<a class="reference internal" href="../generated/mne.compute_covariance.html#mne.compute_covariance" title="mne.compute_covariance"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.compute_covariance()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_covariance</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>  
</pre></div>
</div>
</li>
<li><p>Employ empty room data (collected without the subject) to
calculate the full noise covariance matrix. This is recommended
for analyzing ongoing spontaneous activity. This can be done using
<a class="reference internal" href="../generated/mne.compute_raw_covariance.html#mne.compute_raw_covariance" title="mne.compute_raw_covariance"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.compute_raw_covariance()</span></code></a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_raw_covariance</span><span class="p">(</span><span class="n">raw_erm</span><span class="p">)</span>  
</pre></div>
</div>
</li>
<li><p>Employ a section of continuous raw data collected in the presence
of the subject to calculate the full noise covariance matrix. This
is the recommended approach for analyzing epileptic activity. The
data used for this purpose should be free of technical artifacts
and epileptic activity of interest. The length of the data segment
employed should be at least 20 seconds. One can also use a long
(<code class="docutils literal notranslate"><span class="pre">*&gt;</span> <span class="pre">200</span> <span class="pre">s</span></code>) segment of data with epileptic spikes present provided
that the spikes occur infrequently and that the segment is apparently
stationary with respect to background brain activity. This can also
use <a class="reference internal" href="../generated/mne.compute_raw_covariance.html#mne.compute_raw_covariance" title="mne.compute_raw_covariance"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.compute_raw_covariance()</span></code></a>.</p></li>
</ul>
</section>
<section id="calculating-the-inverse-operator">
<span id="cihcfjei"></span><h3><a class="toc-backref" href="#id16">Calculating the inverse operator</a><a class="headerlink" href="#calculating-the-inverse-operator" title="Permalink to this headline">¶</a></h3>
<p>The MNE software doesn’t calculate the inverse operator
explicitly but rather computes an SVD of a matrix composed of the
noise-covariance matrix, the result of the forward calculation,
and the source covariance matrix. This approach has the benefit
that the regularization parameter (‘SNR’) can
be adjusted easily when the final source estimates or dSPMs are
computed. For mathematical details of this approach,
please consult <a class="reference internal" href="implementation.html#minimum-norm-estimates"><span class="std std-ref">The minimum-norm current estimates</span></a>.</p>
<p>This computation stage can be done by using
<a class="reference internal" href="../generated/mne.minimum_norm.make_inverse_operator.html#mne.minimum_norm.make_inverse_operator" title="mne.minimum_norm.make_inverse_operator"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.minimum_norm.make_inverse_operator()</span></code></a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">inv</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">make_inverse_operator</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">fwd</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">loose</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>  
</pre></div>
</div>
</section>
<section id="creating-source-estimates">
<h3><a class="toc-backref" href="#id17">Creating source estimates</a><a class="headerlink" href="#creating-source-estimates" title="Permalink to this headline">¶</a></h3>
<p>Once all the preprocessing steps described above have been
completed, the inverse operator computed can be applied to the MEG
and EEG data as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stc</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">minimum_norm</span><span class="o">.</span><span class="n">apply_inverse</span><span class="p">(</span><span class="n">evoked</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">lambda2</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">9.</span><span class="p">)</span>  
</pre></div>
</div>
<p>And the results can be viewed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  
</pre></div>
</div>
</section>
<section id="group-analyses">
<h3><a class="toc-backref" href="#id18">Group analyses</a><a class="headerlink" href="#group-analyses" title="Permalink to this headline">¶</a></h3>
<p>Group analysis is facilitated by morphing source estimates, which can be
done <em>e.g.</em>, to <code class="docutils literal notranslate"><span class="pre">subject='fsaverage'</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">morph</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">compute_source_morph</span><span class="p">(</span><span class="n">stc</span><span class="p">,</span> <span class="n">subject_from</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">subject_to</span><span class="o">=</span><span class="s1">&#39;fsaverage&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">stc_fsaverage</span> <span class="o">=</span> <span class="n">morph</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">stc</span><span class="p">)</span>  
</pre></div>
</div>
<p>See <a class="reference internal" href="implementation.html#ch-morph"><span class="std std-ref">Morphing and averaging source estimates</span></a> for more information.</p>
</section>
</section>
</section>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><div class="row">
    <div class="container col-md-12 institutions">
      <ul class="list-unstyled">
        <li><a href="https://www.massgeneral.org/"><img class="institution" src="../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a></li>
        <li><a href="https://martinos.org/"><img class="institution" src="../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a></li>
        <li><a href="https://hms.harvard.edu/"><img class="institution" src="../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a></li>
        <li><a href="https://web.mit.edu/"><img class="institution" src="../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a></li>
        <li><a href="https://www.nyu.edu/"><img class="institution" src="../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a></li>
        <li><a href="http://www.cea.fr/"><img class="institution" src="../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a></li>
        <li><a href="https://sci.aalto.fi/"><img class="institution" src="../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a></li>
        <li><a href="https://www.telecom-paris.fr/"><img class="institution" src="../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a></li>
        <li><a href="https://www.washington.edu/"><img class="institution" src="../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a></li>
        <li><a href="https://icm-institute.org/"><img class="institution" src="../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a></li>
        <li><a href="https://www.bu.edu/"><img class="institution" src="../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a></li>
        <li><a href="https://www.inserm.fr/"><img class="institution" src="../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a></li>
        <li><a href="https://www.fz-juelich.de/"><img class="institution" src="../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a></li>
        <li><a href="https://www.tu-ilmenau.de/"><img class="institution" src="../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a></li>
        <li><a href="https://bids.berkeley.edu/"><img class="institution" src="../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a></li>
        <li><a href="https://www.inria.fr/"><img class="institution" src="../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a></li>
        <li><a href="https://www.au.dk/"><img class="institution" src="../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a></li>
        <li><a href="https://www.uni-graz.at/"><img class="institution" src="../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a></li>
      </ul>
      <p class="text-center text-muted small">&copy; Copyright 2012-2021, MNE Developers. Last updated <time datetime="2021-04-02T17:37:54.428702+00:00" class="localized">2021-04-02 17:37 UTC</time>
<script type="text/javascript">$(function () { $("time.localized").each(function () { var el = $(this); el.text(new Date(el.attr("datetime")).toLocaleString([], {dateStyle: "medium", timeStyle: "long"})); }); } )</script></p>
    </div></div></div>
  </footer>
  <script src="https://mne.tools/versionwarning.js"></script>
  </body>
</html>