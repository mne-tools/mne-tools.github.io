<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>The forward solution &#8212; MNE 0.18.2 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.18.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../getting_started.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-primary navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.18.2
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">The forward solution</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#meg-eeg-and-mri-coordinate-systems">MEG/EEG and MRI coordinate systems</a></li>
<li><a class="reference internal" href="#the-head-and-device-coordinate-systems">The head and device coordinate systems</a></li>
<li><a class="reference internal" href="#coil-geometry-information">Coil geometry information</a><ul>
<li><a class="reference internal" href="#the-sensor-coordinate-system">The sensor coordinate system</a></li>
<li><a class="reference internal" href="#calculation-of-the-magnetic-field">Calculation of the magnetic field</a></li>
</ul>
</li>
<li><a class="reference internal" href="#computing-the-forward-solution">Computing the forward solution</a><ul>
<li><a class="reference internal" href="#eeg-forward-solution-in-the-sphere-model">EEG forward solution in the sphere model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#averaging-forward-solutions">Averaging forward solutions</a><ul>
<li><a class="reference internal" href="#purpose">Purpose</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="the-forward-solution">
<span id="ch-forward"></span><h1>The forward solution<a class="headerlink" href="#the-forward-solution" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id5">Overview</a></p></li>
<li><p><a class="reference internal" href="#meg-eeg-and-mri-coordinate-systems" id="id6">MEG/EEG and MRI coordinate systems</a></p></li>
<li><p><a class="reference internal" href="#the-head-and-device-coordinate-systems" id="id7">The head and device coordinate systems</a></p></li>
<li><p><a class="reference internal" href="#coil-geometry-information" id="id8">Coil geometry information</a></p>
<ul>
<li><p><a class="reference internal" href="#the-sensor-coordinate-system" id="id9">The sensor coordinate system</a></p></li>
<li><p><a class="reference internal" href="#calculation-of-the-magnetic-field" id="id10">Calculation of the magnetic field</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#computing-the-forward-solution" id="id11">Computing the forward solution</a></p>
<ul>
<li><p><a class="reference internal" href="#eeg-forward-solution-in-the-sphere-model" id="id12">EEG forward solution in the sphere model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#averaging-forward-solutions" id="id13">Averaging forward solutions</a></p>
<ul>
<li><p><a class="reference internal" href="#purpose" id="id14">Purpose</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id5">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This page covers the definitions of different coordinate
systems employed in MNE software and FreeSurfer, the details of
the computation of the forward solutions, and the associated low-level
utilities.</p>
</div>
<div class="section" id="meg-eeg-and-mri-coordinate-systems">
<span id="chdedfib"></span><h2><a class="toc-backref" href="#id6">MEG/EEG and MRI coordinate systems</a><a class="headerlink" href="#meg-eeg-and-mri-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p>The coordinate systems used in MNE software (and FreeSurfer)
and their relationships are depicted in <a class="reference internal" href="#chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>.
Except for the <em>Sensor coordinates</em>, all of the
coordinate systems are Cartesian and have the “RAS” (Right-Anterior-Superior)
orientation, <em>i.e.</em>, the <span class="math notranslate nohighlight">\(x\)</span> axis
points to the right, the <span class="math notranslate nohighlight">\(y\)</span> axis
to the front, and the <span class="math notranslate nohighlight">\(z\)</span> axis up.</p>
<div class="figure align-default" id="id1">
<span id="chdffjij"></span><img alt="MEG/EEG and MRI coordinate systems" src="../../_images/CoordinateSystems.png" />
<p class="caption"><span class="caption-text">MEG/EEG and MRI coordinate systems</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
<div class="legend">
<p>The coordinate transforms present in the fif files in MNE and the FreeSurfer files as well as those set to fixed values are indicated with <span class="math notranslate nohighlight">\(T_x\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> identifies the transformation.</p>
</div>
</div>
<p>The coordinate systems related
to MEG/EEG data are:</p>
<p><strong>Head coordinates</strong></p>
<blockquote>
<div><p>This is a coordinate system defined with help of the fiducial landmarks
(nasion and the two auricular points). In fif files, EEG electrode
locations are given in this coordinate system. In addition, the head
digitization data acquired in the beginning of an MEG, MEG/EEG,
or EEG acquisition are expressed in head coordinates. For details,
see <a class="reference internal" href="#chdedfib"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>.</p>
</div></blockquote>
<p><strong>Device coordinates</strong></p>
<blockquote>
<div><p>This is a coordinate system tied to the MEG device. The relationship
of the Device and Head coordinates is determined during an MEG measurement
by feeding current to three to five head-position
indicator (HPI) coils and by determining their locations with respect
to the MEG sensor array from the magnetic fields they generate.</p>
</div></blockquote>
<p><strong>Sensor coordinates</strong></p>
<blockquote>
<div><p>Each MEG sensor has a local coordinate system defining the orientation
and location of the sensor. With help of this coordinate system,
the numerical integration data needed for the computation of the
magnetic field can be expressed conveniently as discussed in <a class="reference internal" href="#bjeiaeie"><span class="std std-ref">Coil geometry information</span></a>. The channel information data in the fif files
contain the information to specify the coordinate transformation
between the coordinates of each sensor and the MEG device coordinates.</p>
</div></blockquote>
<p>The coordinate systems related
to MRI data are:</p>
<p><strong>Surface RAS coordinates</strong></p>
<blockquote>
<div><p>The FreeSurfer surface data are expressed in this coordinate system. The
origin of this coordinate system is at the center of the conformed
FreeSurfer MRI volumes (usually 256 x 256 x 256 isotropic 1-mm3  voxels)
and the axes are oriented along the axes of this volume. The BEM
surface and the locations of the sources in the source space are
usually expressed in this coordinate system in the fif files. In
this manual, the <em>Surface RAS coordinates</em> are
usually referred to as <em>MRI coordinates</em> unless
there is need to specifically discuss the different MRI-related
coordinate systems.</p>
</div></blockquote>
<p><strong>RAS coordinates</strong></p>
<blockquote>
<div><p>This coordinate system has axes identical to the Surface RAS coordinates but the location of the origin
is different and defined by the original MRI data, i.e. ,
the origin is in a scanner-dependent location. There is hardly any
need to refer to this coordinate system explicitly in the analysis
with the MNE software. However, since the Talairach coordinates,
discussed below, are defined with respect to <em>RAS coordinates</em> rather
than the <em>Surface RAS coordinates</em>, the RAS coordinate
system is implicitly involved in the transformation between Surface RAS coordinates and the two <em>Talairach</em> coordinate
systems.</p>
</div></blockquote>
<p><strong>MNI Talairach coordinates</strong></p>
<blockquote>
<div><p>The definition of this coordinate system is discussed, e.g. ,
in  <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach">http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach</a>. This
transformation is determined during the FreeSurfer reconstruction
process.</p>
</div></blockquote>
<p><strong>FreeSurfer Talairach coordinates</strong></p>
<blockquote>
<div><p>The problem with the MNI Talairach coordinates is that the linear MNI
Talairach transform does matched the brains completely to the Talairach
brain. This is probably because the Talairach atlas brain is a rather
odd shape, and as a result, it is difficult to match a standard brain
to the atlas brain using an affine transform. As a result, the MNI
brains are slightly larger (in particular higher, deeper and longer)
than the Talairach brain. The differences are larger as you get
further from the middle of the brain, towards the outside. The FreeSurfer
Talairach coordinates mitigate this problem by additing a an additional
transformation, defined separately for negatice and positive MNI
Talairach <span class="math notranslate nohighlight">\(z\)</span> coordinates. These two
transformations, denoted by <span class="math notranslate nohighlight">\(T_-\)</span> and <span class="math notranslate nohighlight">\(T_+\)</span> in <a class="reference internal" href="#chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>, are fixed as discussed in <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach">http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach</a>
(<em>Approach 2</em>).</p>
</div></blockquote>
<p>The different coordinate systems are related by coordinate
transformations depicted in <a class="reference internal" href="#chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>. The arrows and
coordinate transformation symbols (<span class="math notranslate nohighlight">\(T_x\)</span>)
indicate the transformations actually present in the FreeSurfer
files. Generally,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
x_2 \\
y_2 \\
z_2 \\
1
\end{bmatrix} = T_{12} \begin{bmatrix}
x_1 \\
y_1 \\
z_1 \\
1
\end{bmatrix} = \begin{bmatrix}
R_{11} &amp; R_{12} &amp; R_{13} &amp; x_0 \\
R_{13} &amp; R_{13} &amp; R_{13} &amp; y_0 \\
R_{13} &amp; R_{13} &amp; R_{13} &amp; z_0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x_1 \\
y_1 \\
z_1 \\
1
\end{bmatrix}\ ,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_k\)</span>,:math:<em class="xref py py-obj">y_k</em>,and <span class="math notranslate nohighlight">\(z_k\)</span> are the location
coordinates in two coordinate systems, <span class="math notranslate nohighlight">\(T_{12}\)</span> is
the coordinate transformation from coordinate system “1” to “2”,
<span class="math notranslate nohighlight">\(x_0\)</span>, <span class="math notranslate nohighlight">\(y_0\)</span>,and <span class="math notranslate nohighlight">\(z_0\)</span> is the location of the origin
of coordinate system “1” in coordinate system “2”,
and <span class="math notranslate nohighlight">\(R_{jk}\)</span> are the elements of the rotation
matrix relating the two coordinate systems. The coordinate transformations
are present in different files produced by FreeSurfer and MNE as
summarized in <a class="reference internal" href="#chdjdedj"><span class="std std-ref">Coordinate transformations in FreeSurfer and MNE software packages.</span></a>. The fixed transformations <span class="math notranslate nohighlight">\(T_-\)</span> and <span class="math notranslate nohighlight">\(T_+\)</span> are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}T_{-} = \begin{bmatrix}
0.99 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0.9688 &amp; 0.042 &amp; 0 \\
0 &amp; -0.0485 &amp; 0.839 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}T_{+} = \begin{bmatrix}
0.99 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0.9688 &amp; 0.046 &amp; 0 \\
0 &amp; -0.0485 &amp; 0.9189 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section does not discuss the transformation    between the MRI voxel indices and the different MRI coordinates.    However, it is important to note that in FreeSurfer, MNE, as well    as in Neuromag software an integer voxel coordinate corresponds    to the location of the center of a voxel. Detailed information on    the FreeSurfer MRI systems can be found at  <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems">https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems</a>.</p>
</div>
<span id="chdjdedj"></span><table class="docutils align-default" id="id2">
<caption><span class="caption-text">Coordinate transformations in FreeSurfer and MNE software packages.</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Transformation</p></td>
<td><p>FreeSurfer</p></td>
<td><p>MNE</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T_1\)</span></p></td>
<td><p>Not present</p></td>
<td><div class="line-block">
<div class="line">Measurement data files</div>
<div class="line">Forward solution files (<em class="xref py py-obj">*fwd.fif</em>)</div>
<div class="line">Inverse operator files (<em class="xref py py-obj">*inv.fif</em>)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(T_{s_1}\dots T_{s_n}\)</span></p></td>
<td><p>Not present</p></td>
<td><p>Channel information in files
containing <span class="math notranslate nohighlight">\(T_1\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T_2\)</span></p></td>
<td><p>Not present</p></td>
<td><div class="line-block">
<div class="line">MRI description files Separate</div>
<div class="line">coordinate transformation files</div>
<div class="line">saved from mne_analyze</div>
<div class="line">Forward solution files</div>
<div class="line">Inverse operator files</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(T_3\)</span></p></td>
<td><p><em class="xref py py-obj">mri/*mgz</em> files</p></td>
<td><p>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T_4\)</span></p></td>
<td><p>mri/transforms/talairach.xfm</p></td>
<td><p>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(T_-\)</span></p></td>
<td><p>Hardcoded in software</p></td>
<td><p>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T_+\)</span></p></td>
<td><p>Hardcoded in software</p></td>
<td><p>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The symbols <span class="math notranslate nohighlight">\(T_x\)</span> are defined in <a class="reference internal" href="#chdffjij"><span class="std std-ref">MEG/EEG and MRI coordinate systems</span></a>. mne_make_cor_set /mne_setup_mri prior to release 2.6 did not include transformations <span class="math notranslate nohighlight">\(T_3\)</span>, <span class="math notranslate nohighlight">\(T_4\)</span>, <span class="math notranslate nohighlight">\(T_-\)</span>, and <span class="math notranslate nohighlight">\(T_+\)</span> in the fif files produced.</p>
</div>
</div>
<div class="section" id="the-head-and-device-coordinate-systems">
<span id="bjebibai"></span><h2><a class="toc-backref" href="#id7">The head and device coordinate systems</a><a class="headerlink" href="#the-head-and-device-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default" id="id3">
<img alt="Head coordinate system" src="../../_images/HeadCS.png" />
<p class="caption"><span class="caption-text">The head coordinate system</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The MEG/EEG head coordinate system employed in the MNE software
is a right-handed Cartesian coordinate system. The direction of <span class="math notranslate nohighlight">\(x\)</span> axis
is from left to right, that of <span class="math notranslate nohighlight">\(y\)</span> axis
to the front, and the <span class="math notranslate nohighlight">\(z\)</span> axis thus
points up.</p>
<p>The <span class="math notranslate nohighlight">\(x\)</span> axis of the head coordinate
system passes through the two periauricular or preauricular points
digitized before acquiring the data with positive direction to the
right. The <span class="math notranslate nohighlight">\(y\)</span> axis passes through
the nasion and is normal to the <span class="math notranslate nohighlight">\(x\)</span> axis.
The <span class="math notranslate nohighlight">\(z\)</span> axis points up according to
the right-hand rule and is normal to the <span class="math notranslate nohighlight">\(xy\)</span> plane.</p>
<p>The origin of the MEG device coordinate system is device
dependent. Its origin is located approximately at the center of
a sphere which fits the occipital section of the MEG helmet best
with <span class="math notranslate nohighlight">\(x\)</span> axis axis going from left to right
and <span class="math notranslate nohighlight">\(y\)</span> axis pointing front. The <span class="math notranslate nohighlight">\(z\)</span> axis
is, again, normal to the <span class="math notranslate nohighlight">\(xy\)</span> plane
with positive direction up.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above definition is identical to that of the Neuromag MEG/EEG
(head) coordinate system. However, in 4-D Neuroimaging and CTF MEG
systems the head coordinate frame definition is different. The origin
of the coordinate system is at the midpoint of the left and right
auricular points. The <span class="math notranslate nohighlight">\(x\)</span> axis passes through the nasion and the
origin with positive direction to the front. The <span class="math notranslate nohighlight">\(y\)</span> axis is
perpendicular to the <span class="math notranslate nohighlight">\(x\)</span> axis on the and lies in the plane
defined by the three fiducial landmarks, positive direction from right
to left. The <span class="math notranslate nohighlight">\(z\)</span> axis is normal to the plane of the landmarks,
pointing up. Note that in this convention the auricular points are not
necessarily located on <span class="math notranslate nohighlight">\(y\)</span> coordinate axis. The file conversion
utilities take care of these idiosyncrasies and convert all coordinate
information to the MNE software head coordinate frame.</p>
</div>
</div>
<div class="section" id="coil-geometry-information">
<span id="bjeiaeie"></span><h2><a class="toc-backref" href="#id8">Coil geometry information</a><a class="headerlink" href="#coil-geometry-information" title="Permalink to this headline">¶</a></h2>
<p>This Section explains the presentation of MEG detection coil
geometry information the approximations used for different detection
coils in MNE software. Two pieces of information are needed to characterize
the detectors:</p>
<ul class="simple">
<li><p>The location and orientation a local
coordinate system for each detector.</p></li>
<li><p>A unique identifier, which has an one-to-one correspondence
to the geometrical description of the coil.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MNE ships with several coil geometry configurations.
They can be found in <code class="docutils literal notranslate"><span class="pre">mne/data</span></code>.
See <a class="reference internal" href="../../auto_examples/visualization/plot_meg_sensors.html#sphx-glr-auto-examples-visualization-plot-meg-sensors-py"><span class="std std-ref">Plotting sensor layouts of MEG systems</span></a>
for a comparison between different coil geometries, and
<a class="reference internal" href="coil_geometries.html#implemented-coil-geometries"><span class="std std-ref">Implemented coil geometries</span></a> for detailed information regarding
the files describing Neuromag coil geometries.</p>
</div>
<div class="section" id="the-sensor-coordinate-system">
<h3><a class="toc-backref" href="#id9">The sensor coordinate system</a><a class="headerlink" href="#the-sensor-coordinate-system" title="Permalink to this headline">¶</a></h3>
<p>The sensor coordinate system is completely characterized
by the location of its origin and the direction cosines of three
orthogonal unit vectors pointing to the directions of the x, y,
and z axis. In fact, the unit vectors contain redundant information
because the orientation can be uniquely defined with three angles.
The measurement fif files list these data in MEG device coordinates.
Transformation to the MEG head coordinate frame can be easily accomplished
by applying the device-to-head coordinate transformation matrix
available in the data files provided that the head-position indicator
was used. Optionally, the MNE software forward calculation applies
another coordinate transformation to the head-coordinate data to
bring the coil locations and orientations to the MRI coordinate system.</p>
<p>If <span class="math notranslate nohighlight">\(r_0\)</span> is a row vector for
the origin of the local sensor coordinate system and <span class="math notranslate nohighlight">\(e_x\)</span>, <span class="math notranslate nohighlight">\(e_y\)</span>,
and <span class="math notranslate nohighlight">\(e_z\)</span> are the row vectors for the
three orthogonal unit vectors, all given in device coordinates,
a location of a point <span class="math notranslate nohighlight">\(r_C\)</span> in sensor coordinates
is transformed to device coordinates (<span class="math notranslate nohighlight">\(r_D\)</span>)
by</p>
<div class="math notranslate nohighlight">
\[[r_D 1] = [r_C 1] T_{CD}\ ,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}T = \begin{bmatrix}
e_x &amp; 0 \\
e_y &amp; 0 \\
e_z &amp; 0 \\
r_{0D} &amp; 1
\end{bmatrix}\ .\end{split}\]</div>
</div>
<div class="section" id="calculation-of-the-magnetic-field">
<h3><a class="toc-backref" href="#id10">Calculation of the magnetic field</a><a class="headerlink" href="#calculation-of-the-magnetic-field" title="Permalink to this headline">¶</a></h3>
<p>The forward calculation in the MNE software computes the
signals detected by each MEG sensor for three orthogonal dipoles
at each source space location. This requires specification of the
conductor model, the location and orientation of the dipoles, and
the location and orientation of each MEG sensor as well as its coil
geometry.</p>
<p>The output of each SQUID sensor is a weighted sum of the
magnetic fluxes threading the loops comprising the detection coil.
Since the flux threading a coil loop is an integral of the magnetic
field component normal to the coil plane, the output of the k <sup>th</sup>
MEG channel, <span class="math notranslate nohighlight">\(b_k\)</span> can be approximated by:</p>
<div class="math notranslate nohighlight">
\[b_k = \sum_{p = 1}^{N_k} {w_{kp} B(r_{kp}) \cdot n_{kp}}\]</div>
<p>where <span class="math notranslate nohighlight">\(r_{kp}\)</span> are a set of <span class="math notranslate nohighlight">\(N_k\)</span> integration
points covering the pickup coil loops of the sensor, <span class="math notranslate nohighlight">\(B(r_{kp})\)</span> is
the magnetic field due to the current sources calculated at <span class="math notranslate nohighlight">\(r_{kp}\)</span>,
<span class="math notranslate nohighlight">\(n_{kp}\)</span> are the coil normal directions at these points, and
<span class="math notranslate nohighlight">\(w_{kp}\)</span> are the weights associated to the integration points. This
formula essentially presents numerical integration of the magnetic field over
the pickup loops of sensor <span class="math notranslate nohighlight">\(k\)</span>.</p>
</div>
</div>
<div class="section" id="computing-the-forward-solution">
<span id="chddibah"></span><h2><a class="toc-backref" href="#id11">Computing the forward solution</a><a class="headerlink" href="#computing-the-forward-solution" title="Permalink to this headline">¶</a></h2>
<p>Examples on how to compute the forward solution using
<a class="reference internal" href="../../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_forward_solution()</span></code></a> can be found
<a class="reference internal" href="../../auto_tutorials/source-modeling/plot_forward.html#plot-forward-compute-forward-solution"><span class="std std-ref">Compute forward solution</span></a> and <a class="reference internal" href="../cookbook.html#babchejd"><span class="std std-ref">Computing the forward solution</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that systems such as CTF and 4D Neuroimaging
data may have been subjected to noise cancellation employing the
data from the reference sensor array. Even though these sensor are
rather far away from the brain sources, this can be taken into account
using <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.apply_gradient_compensation" title="mne.io.Raw.apply_gradient_compensation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mne.io.Raw.apply_gradient_compensation()</span></code></a>.
See <a class="reference internal" href="../../auto_tutorials/sample-datasets/plot_brainstorm_phantom_ctf.html#plot-brainstorm-phantom-ctf"><span class="std std-ref">Brainstorm CTF phantom dataset tutorial</span></a>.</p>
</div>
<div class="section" id="eeg-forward-solution-in-the-sphere-model">
<span id="ch-forward-spherical-model"></span><span id="chdiafig"></span><h3><a class="toc-backref" href="#id12">EEG forward solution in the sphere model</a><a class="headerlink" href="#eeg-forward-solution-in-the-sphere-model" title="Permalink to this headline">¶</a></h3>
<p>For the computation of the electric potential distribution
on the surface of the head (EEG) it is necessary to define the conductivities
(<span class="math notranslate nohighlight">\(\sigma\)</span>) and radiuses of the spherically
symmetric layers. Different sphere models can be specified with
through <a class="reference internal" href="../../generated/mne.make_sphere_model.html#mne.make_sphere_model" title="mne.make_sphere_model"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_sphere_model()</span></code></a>.
Here follows the default structure given when calling <code class="docutils literal notranslate"><span class="pre">sphere</span> <span class="pre">=</span> <span class="pre">mne.make_sphere_model()</span></code></p>
<span id="babebgda"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-text">Structure of the default EEG model</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 43%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Layer</p></th>
<th class="head"><p>Relative outer radius</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\sigma\)</span> (S/m)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Head</p></td>
<td><p>1.0</p></td>
<td><p>0.33</p></td>
</tr>
<tr class="row-odd"><td><p>Skull</p></td>
<td><p>0.97</p></td>
<td><p>0.04</p></td>
</tr>
<tr class="row-even"><td><p>CSF</p></td>
<td><p>0.92</p></td>
<td><p>1.0</p></td>
</tr>
<tr class="row-odd"><td><p>Brain</p></td>
<td><p>0.90</p></td>
<td><p>0.33</p></td>
</tr>
</tbody>
</table>
<p>Although it is not BEM model per se the <code class="docutils literal notranslate"><span class="pre">sphere</span></code> structure
describes the head geometry so it can be passed as <code class="docutils literal notranslate"><span class="pre">bem</span></code> parameter in
functions such as <a class="reference internal" href="../../generated/mne.fit_dipole.html#mne.fit_dipole" title="mne.fit_dipole"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.fit_dipole()</span></code></a>, <a class="reference internal" href="../../generated/mne.viz.plot_alignment.html#mne.viz.plot_alignment" title="mne.viz.plot_alignment"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.viz.plot_alignment()</span></code></a>
or <a class="reference internal" href="../../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_forward_solution()</span></code></a>.</p>
<p>When the sphere model is employed to compute the forward model using
<a class="reference internal" href="../../generated/mne.make_forward_solution.html#mne.make_forward_solution" title="mne.make_forward_solution"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.make_forward_solution()</span></code></a>, the computation of the
EEG solution can be substantially accelerated by using approximation
methods described by Mosher, Zhang, and Berg, see <a class="reference internal" href="../../references.html#cegegdei"><span class="std std-ref">Forward modeling</span></a> (Mosher <em>et
al.</em> and references therein). In such scenario, MNE approximates
the solution with three dipoles in a homogeneous sphere whose locations
and amplitudes are determined by minimizing the cost function:</p>
<div class="math notranslate nohighlight">
\[S(r_1,\dotsc,r_m\ ,\ \mu_1,\dotsc,\mu_m) = \int_{scalp} {(V_{true} - V_{approx})}\,dS\]</div>
<p>where <span class="math notranslate nohighlight">\(r_1,\dotsc,r_m\)</span> and <span class="math notranslate nohighlight">\(\mu_1,\dotsc,\mu_m\)</span> are
the locations and amplitudes of the approximating dipoles and
<span class="math notranslate nohighlight">\(V_{true}\)</span> and <span class="math notranslate nohighlight">\(V_{approx}\)</span> are
the potential distributions given by the true and approximative
formulas, respectively. It can be shown that this integral can be
expressed in closed form using an expansion of the potentials in
spherical harmonics. The formula is evaluated for the most superficial
dipoles, <em>i.e.</em>, those lying just inside the
inner skull surface.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="../../auto_tutorials/sample-datasets/plot_brainstorm_phantom_ctf.html#plt-brainstorm-phantom-ctf-eeg-sphere-geometry"><span class="std std-ref">Brainstorm CTF phantom dataset tutorial</span></a>,
<a class="reference internal" href="../../auto_tutorials/sample-datasets/plot_brainstorm_phantom_elekta.html#plt-brainstorm-phantom-elekta-eeg-sphere-geometry"><span class="std std-ref">Brainstorm Elekta phantom dataset tutorial</span></a>,
and <a class="reference internal" href="../../auto_tutorials/source-modeling/plot_source_alignment.html#plot-source-alignment-without-mri"><span class="std std-ref">Alignment without MRI</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="averaging-forward-solutions">
<span id="chdbbfca"></span><h2><a class="toc-backref" href="#id13">Averaging forward solutions</a><a class="headerlink" href="#averaging-forward-solutions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="purpose">
<h3><a class="toc-backref" href="#id14">Purpose</a><a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h3>
<p>One possibility to make a grand average over several runs
of a experiment is to average the data across runs and average the
forward solutions accordingly. For this purpose,
<a class="reference internal" href="../../generated/mne.average_forward_solutions.html#mne.average_forward_solutions" title="mne.average_forward_solutions"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.average_forward_solutions()</span></code></a> computes a weighted average of several
forward solutions. The function averages both MEG and EEG forward solutions.
Usually the EEG forward solution is identical across runs because the electrode
locations do not change.</p>
</div>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container institutions">
    <a href="https://www.massgeneral.org/"><img class="institution_lg" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a>
    <a href="https://martinos.org/"><img class="institution_lg" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a>
    <a href="https://hms.harvard.edu/"><img class="institution_lg" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a>
    <a href="https://web.mit.edu/"><img class="institution_sm" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a>
    <a href="https://www.nyu.edu/"><img class="institution_md" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a>
    <a href="http://www.cea.fr/"><img class="institution_md" src="../../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a>
    <a href="https://sci.aalto.fi/"><img class="institution_md" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a>
    <a href="https://www.telecom-paris.fr/"><img class="institution_md" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a>
    <a href="https://www.washington.edu/"><img class="institution_sm" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a>
    <a href="https://icm-institute.org/"><img class="institution_lg" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a>
    <a href="https://www.bu.edu/"><img class="institution_sm" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a>
    <a href="https://www.inserm.fr/"><img class="institution_xs" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a>
    <a href="https://www.fz-juelich.de/"><img class="institution_sm" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a>
    <a href="https://www.tu-ilmenau.de/"><img class="institution_sm" src="../../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a>
    <a href="https://bids.berkeley.edu/"><img class="institution_md" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a>
    <a href="https://www.inria.fr/"><img class="institution_sm" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a>
    <a href="https://www.au.dk/"><img class="institution_sm" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a>
    <a href="https://www.uni-graz.at/"><img class="institution_md" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a>
  </div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-07-11.</p>
  </div>
</footer>
  </body>
</html>