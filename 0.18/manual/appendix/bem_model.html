<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Creating the BEM meshes &#8212; MNE 0.18.2 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.18.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../getting_started.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-primary navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.18.2
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Creating the BEM meshes</a><ul>
<li><a class="reference internal" href="#using-the-watershed-algorithm">Using the watershed algorithm</a></li>
<li><a class="reference internal" href="#using-flash-images">Using FLASH images</a><ul>
<li><a class="reference internal" href="#organizing-mri-data-into-directories">Organizing MRI data into directories</a></li>
<li><a class="reference internal" href="#creating-the-surface-tessellations">Creating the surface tessellations</a></li>
<li><a class="reference internal" href="#inspecting-the-meshes">Inspecting the meshes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-seglab">Using seglab</a></li>
<li><a class="reference internal" href="#using-brainsuite">Using BrainSuite</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="creating-the-bem-meshes">
<span id="create-bem-model"></span><h1>Creating the BEM meshes<a class="headerlink" href="#creating-the-bem-meshes" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#using-the-watershed-algorithm" id="id1">Using the watershed algorithm</a></p></li>
<li><p><a class="reference internal" href="#using-flash-images" id="id2">Using FLASH images</a></p>
<ul>
<li><p><a class="reference internal" href="#organizing-mri-data-into-directories" id="id3">Organizing MRI data into directories</a></p></li>
<li><p><a class="reference internal" href="#creating-the-surface-tessellations" id="id4">Creating the surface tessellations</a></p></li>
<li><p><a class="reference internal" href="#inspecting-the-meshes" id="id5">Inspecting the meshes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-seglab" id="id6">Using seglab</a></p></li>
<li><p><a class="reference internal" href="#using-brainsuite" id="id7">Using BrainSuite</a></p></li>
</ul>
</div>
<div class="section" id="using-the-watershed-algorithm">
<span id="babbdhag"></span><h2><a class="toc-backref" href="#id1">Using the watershed algorithm</a><a class="headerlink" href="#using-the-watershed-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The watershed algorithm [Segonne <em>et al.</em>,
2004] is part of the FreeSurfer software.
The name of the program is mri_watershed .
Its use in the MNE environment is facilitated by the script <em class="xref py py-obj">mne_watershed_bem</em>.</p>
<p>After mne_watershed_bem has
completed, the following files appear in the subject’s <code class="docutils literal notranslate"><span class="pre">bem/watershed</span></code> directory:</p>
<p>** &lt;<em>subject</em>&gt; _brain_surface**</p>
<blockquote>
<div><p>Contains the brain surface triangulation.</p>
</div></blockquote>
<p>** &lt;<em>subject</em>&gt; _inner_skull_surface**</p>
<blockquote>
<div><p>Contains the inner skull triangulation.</p>
</div></blockquote>
<p>** &lt;<em>subject</em>&gt; _outer_skull_surface**</p>
<blockquote>
<div><p>Contains the outer skull triangulation.</p>
</div></blockquote>
<p>** &lt;<em>subject</em>&gt; _outer_skin_surface**</p>
<blockquote>
<div><p>Contains the scalp triangulation.</p>
</div></blockquote>
<p>All of these surfaces are in the FreeSurfer format. In addition,
there will be a directory called <code class="docutils literal notranslate"><span class="pre">bem/watershed/ws</span></code> which
contains the brain MRI volume. Furthermore, mne_watershed_bem script
converts the scalp surface to fif format and saves the result to <code class="docutils literal notranslate"><span class="pre">bem/</span></code>  &lt;<em>subject</em>&gt; <code class="docutils literal notranslate"><span class="pre">-head.fif</span></code> . The mne_analyze tool
described <a class="reference internal" href="../gui/analyze.html#c-legacy-ch-interactive-analysis"><span class="std std-ref">Interactive analysis with mne_analyze</span></a> looks for this file the visualizations
involving the scalp surface.</p>
</div>
<div class="section" id="using-flash-images">
<span id="babfcdjh"></span><h2><a class="toc-backref" href="#id2">Using FLASH images</a><a class="headerlink" href="#using-flash-images" title="Permalink to this headline">¶</a></h2>
<p>This method depends on the availablily of MRI data acquired
with a multi-echo FLASH sequence at two flip angles (5 and 30 degrees).
These data can be acquired separately from the MPRAGE data employed
in FreeSurfer cortical reconstructions but it is strongly recommended
that they are collected at the same time with the MPRAGEs or at
least with the same scanner. For easy co-registration, the images
should have FOV, matrix, slice thickness, gap, and slice orientation
as the MPRAGE data. For information on suitable pulse sequences,
see reference [B. Fischl <em>et al.</em> and J. Jovicich <em>et
al.</em>, 2006] in <a class="reference internal" href="../../references.html#cegegdei"><span class="std std-ref">Forward modeling</span></a>. At the Martinos
Center, use of the 1.5-T Avanto scanner (Bay 2) is recommended for
best results.</p>
<p>Creation of the BEM meshes using this method involves the
following steps:</p>
<ul class="simple">
<li><p>Organizing the MRI data. This is facilitated
by the script mne_organize_dicom ,
see <a class="reference internal" href="#babebjhi"><span class="std std-ref">Organizing MRI data into directories</span></a>.</p></li>
<li><p>Creating a synthetic 5-degree flip angle FLASH volume, register
it with the MPRAGE data, and run the segmentation and meshing program.
This step is accomplished by running the script mne_flash_bem , see <a class="reference internal" href="#babgicfe"><span class="std std-ref">Creating the surface tessellations</span></a>.</p></li>
<li><p>Inspecting the meshes with tkmedit, see <a class="reference internal" href="#babhjbed"><span class="std std-ref">Inspecting the meshes</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Different methods can be employed for the creation of the
individual surfaces. For example, it may turn out that the
watershed algorithm produces are better quality skin surface than
the segmentation approach based on the FLASH images. If this is
the case, <code class="docutils literal notranslate"><span class="pre">outer_skin.surf</span></code> can set to point to the corresponding
watershed output file while the other surfaces can be picked from
the FLASH segmentation data.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../c_reference.html#mne-convert-surface"><span class="std std-ref">mne_convert_surface</span></a> C utility can be used to convert
text format triangulation files into the FreeSurfer surface format.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following sections assume that you have run the appropriate
setup scripts to make both MNE and FreeSurfer software available.</p>
</div>
<div class="section" id="organizing-mri-data-into-directories">
<span id="babebjhi"></span><h3><a class="toc-backref" href="#id3">Organizing MRI data into directories</a><a class="headerlink" href="#organizing-mri-data-into-directories" title="Permalink to this headline">¶</a></h3>
<p>Since all images comprising the multi-echo FLASH data are
contained in a single series, it is necessary to organize the images
according to the echoes before proceeding to the BEM surface reconstruction.
This is accomplished by the mne_organize_dicom script,
which creates a directory tree with symbolic links to the original
DICOM image files. To run mne_organize_dicom ,
proceed as follows:</p>
<ul class="simple">
<li><p>Copy all of your images or create symbolic
links to them in a single directory. The images must be in DICOM
format. We will refer to this directory as  &lt;<em>source</em>&gt; .</p></li>
<li><p>Create another directory to hold the output of mne_organize_dicom . We
will refer to this directory as  &lt;<em>dest</em>&gt; .</p></li>
<li><p>Change the working directory to  &lt;<em>dest</em>&gt; .</p></li>
<li><p>Say <code class="docutils literal notranslate"><span class="pre">mne_organize_dicom</span></code>  &lt;<em>source</em>&gt; .
Depending on the total number of images in  &lt;<em>source</em>&gt; this
script may take quite a while to run. Progress is  indicated by
listing the number of images processed at 50-image intervals.</p></li>
</ul>
<p>As a result,  &lt;<em>dest</em>&gt; will
contain several directories named  &lt;<em>three-digit number</em>&gt; _ &lt;<em>protocol_name</em>&gt; corresponding
to the different series of images acquired. Spaces and parenthesis
in protocol names will be replaced by underscores. Under each of
these directories there are one or more directories named  &lt;<em>three-digit</em>&gt; number
corresponding to one or more subsets of images in this series (protocol).
The only subset division scheme implemented in mne_organize_dicom is
that according to different echoes, typically found in multi-echo
FLASH data. These second level directories will contain symbolic
links pointing to the original image data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>mne_organize_dicom was    developed specifically for Siemens DICOM data. Its correct behavior    with DICOM files originating from other MRI scanners has not been    verified at this time.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since mne_organize_dicom processes    all images, not only the FLASH data, it may be a useful preprocessing    step before FreeSurfer reconstruction process as well.</p>
</div>
</div>
<div class="section" id="creating-the-surface-tessellations">
<span id="babgicfe"></span><h3><a class="toc-backref" href="#id4">Creating the surface tessellations</a><a class="headerlink" href="#creating-the-surface-tessellations" title="Permalink to this headline">¶</a></h3>
<p>The BEM surface segmentation and tessellation is automated
with the script <a class="reference internal" href="../c_reference.html#mne-flash-bem"><span class="std std-ref">mne_flash_bem</span></a>.
It assumes that a FreeSurfer reconstruction for this subject is
already in place.</p>
<p>Before running mne_flash_bem do the following:</p>
<ul class="simple">
<li><p>Run mne_organize_dicom as
described above.</p></li>
<li><p>Change to the  &lt;<em>dest</em>&gt; directory
where mne_organize_dicom created the
image directory structure.</p></li>
<li><p>Create symbolic links from the directories containing the
5-degree and 30-degree flip angle FLASH series to <code class="docutils literal notranslate"><span class="pre">flash05</span></code> and <code class="docutils literal notranslate"><span class="pre">flash30</span></code> , respectively:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span></code>  &lt;<em>FLASH 5 series dir</em>&gt; <code class="docutils literal notranslate"><span class="pre">flash05</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span></code>  &lt;<em>FLASH 30 series dir</em>&gt; <code class="docutils literal notranslate"><span class="pre">flash30</span></code></p></li>
</ul>
</li>
<li><p>Some partition formats (e.g. FAT32) do not support symbolic links. In this case, copy the file to the appropriate series:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span></code> &lt;<em>FLASH 5 series dir</em>&gt; <code class="docutils literal notranslate"><span class="pre">flash05</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span></code> &lt;<em>FLASH 30 series dir</em>&gt; <code class="docutils literal notranslate"><span class="pre">flash30</span></code></p></li>
</ul>
</li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">SUBJECTS_DIR</span></code> and <code class="docutils literal notranslate"><span class="pre">SUBJECT</span></code> environment
variables</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If mne_flash_bem is    run with the <code class="docutils literal notranslate"><span class="pre">--noflash30</span></code> option, the flash30 directory is not needed, <em>i.e.</em>,    only the 5-degree flip angle flash data are employed.</p>
</div>
<p>It may take a while for mne_flash_bem to
complete. It uses the FreeSurfer directory structure under <code class="docutils literal notranslate"><span class="pre">$SUBJECTS_DIR/$SUBJECT</span></code> .
The script encapsulates the following processing steps:</p>
<ul class="simple">
<li><p>It creates an mgz file corresponding
to each of the eight echoes in each of the FLASH directories in <code class="docutils literal notranslate"><span class="pre">mri/flash</span></code> .
The files will be called <code class="docutils literal notranslate"><span class="pre">mef</span></code>  &lt;<em>flip-angle</em>&gt; _ &lt;<em>echo-number</em>&gt; <code class="docutils literal notranslate"><span class="pre">.mgz</span></code> .</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">--unwarp</span></code> option is specified, run grad_unwarp and produce
files <code class="docutils literal notranslate"><span class="pre">mef</span></code>  &lt;<em>flip-angle</em>&gt; _ &lt;<em>echo-number</em>&gt; <code class="docutils literal notranslate"><span class="pre">u.mgz</span></code> .
These files will be then used in the following steps.</p></li>
<li><p>It creates parameter maps in <code class="docutils literal notranslate"><span class="pre">mri/flash/parameter_maps</span></code> using mri_ms_fitparms .</p></li>
<li><p>It creates a synthetic 5-degree flip angle volume in <code class="docutils literal notranslate"><span class="pre">mri/flash/parameter_maps/flash5.mgz</span></code> using mri_synthesize .</p></li>
<li><p>Using fsl_rigid_register ,
it creates a registered 5-degree flip angle volume <code class="docutils literal notranslate"><span class="pre">mri/flash/parameter_maps/flash5_reg.mgz</span></code> by
registering <code class="docutils literal notranslate"><span class="pre">mri/flash/parameter_maps/flash5.mgz</span></code> to
the <em>T1</em> volume under <code class="docutils literal notranslate"><span class="pre">mri</span></code> .</p></li>
<li><p>Using mri_convert , it converts
the flash5_reg volume to COR
format under <code class="docutils literal notranslate"><span class="pre">mri/flash5</span></code> . If necessary, the T1 and brain volumes
are also converted into the COR format.</p></li>
<li><p>It runs mri_make_bem_surfaces to
create the BEM surface tessellations.</p></li>
<li><p>It creates the directory <code class="docutils literal notranslate"><span class="pre">bem/flash</span></code> , moves the
tri-format tringulations there and creates the corresponding FreeSurfer
surface files in the same directory.</p></li>
<li><p>The COR format volumes created by mne_flash_bem are
removed.</p></li>
</ul>
<p>If the <code class="docutils literal notranslate"><span class="pre">--noflash30</span></code> option is specified to mne_flash_bem ,
steps 3 and 4 in the above are replaced by averaging over the different
echo times in 5-degree flip angle data.</p>
</div>
<div class="section" id="inspecting-the-meshes">
<span id="babhjbed"></span><h3><a class="toc-backref" href="#id5">Inspecting the meshes</a><a class="headerlink" href="#inspecting-the-meshes" title="Permalink to this headline">¶</a></h3>
<p>It is advisable to check the validity of the BEM meshes before
using them. This can be done with help of tkmedit, see <a class="reference internal" href="../cookbook.html#cihdbfeg"><span class="std std-ref">Setting up the boundary-element model</span></a>.</p>
</div>
</div>
<div class="section" id="using-seglab">
<h2><a class="toc-backref" href="#id6">Using seglab</a><a class="headerlink" href="#using-seglab" title="Permalink to this headline">¶</a></h2>
<p>The brain segmentation provided by FreeSurfer in the directory <code class="docutils literal notranslate"><span class="pre">mri/brain</span></code> can
be employed to create the inner skull surface triangulation with
help of seglab, the Neuromag MRI segmentation tool. The description
below assumes that the user is familiar with the seglab tool. If
necessary, consult the seglab manual, Neuromag P/N NM20420A-A.</p>
<p>The data set mri/brain typically
contains tissues within or outside the skull, in particular around
the eyes. These must be removed manually before the inner skull
triangulation is created.The editing and triangulation can be accomplished
as outlined below</p>
<p><strong>1. Set up the MRIs for Neuromag software access</strong></p>
<blockquote>
<div><p>Run the mne_setup_mri too as described in <a class="reference internal" href="c_misc.html#babccehf"><span class="std std-ref">Setting up anatomical MR images for MRIlab</span></a>.
As a result, the directories mri/T1-neuromag and mri/brain-neuromag
are set up.</p>
</div></blockquote>
<p><strong>2. Load the MRI data</strong></p>
<blockquote>
<div><p>Open the file mri/brain-neuromag/sets/COR.fif and adjust the scaling
of the data.</p>
</div></blockquote>
<p><strong>3. Preparatory steps</strong></p>
<blockquote>
<div><p>Set the minimum data value to 1 using the min3D operator.
Make a backup of the data with the backup3D operator.</p>
</div></blockquote>
<p><strong>4. Manual editing</strong></p>
<blockquote>
<div><p>The maskDraw3D operation is recommended
for manual editing. To use it, first employ the grow3D operator
with threshold interval 2…255 and the seed point inside
the brain. Then do the editing in the slicer window as described
in Section 5.4.2 of the seglab manual. Note that it is enough to
remove the connectivity to the extracerebral tissues rather than
erasing them completely.</p>
</div></blockquote>
<p><strong>5. Grow again and mask</strong></p>
<blockquote>
<div><p>Once manual editing is complete, employ the grow3D operator again
and do mask3D with the backup
data to see whether the result is satisfactory. If not, undo mask3D and
continue manual editing. Otherwise, undo mask3D and
proceed to the next step.</p>
</div></blockquote>
<p><strong>6. Dilation</strong></p>
<blockquote>
<div><p>It is advisable to make the inner skull surface slightly bigger
than the brain envelope obtained in the previous step. Therefore,
apply the dilate3D operation
once or twice. Use the values 1 for nbours and 26 for nhood in the
first dilation and 1 and 18 in the second one, respectively.</p>
</div></blockquote>
<p><strong>7. Triangulation</strong></p>
<blockquote>
<div><p>Triangulate the resulting object with the triangulate3D operator. Use
a sidelength of 5 to 6 mm. Check that the triangulation looks reasonable
in the 3D viewing window.</p>
</div></blockquote>
<p><strong>8. Save the triangulation</strong></p>
<blockquote>
<div><p>Save the triangulated surface as a mesh into bem/inner_skull.tri. Select
unit of measure as millimeters and employ the MRI coordinate system.</p>
</div></blockquote>
</div>
<div class="section" id="using-brainsuite">
<h2><a class="toc-backref" href="#id7">Using BrainSuite</a><a class="headerlink" href="#using-brainsuite" title="Permalink to this headline">¶</a></h2>
<p>The BrainSuite software
running under the Windows operating system can also be used for
BEM mesh generation. This software, written by David W. Shattuck,
is distributed as a collaborative project between the Laboratory
of Neuro Imaging at the University of California Los Angeles (Director:
Dr. Arthur W. Toga) and the Biomedical Imaging Research Group at
the University of Southern California (Director: Dr. Richard M. Leahy).
For further information, see <a class="reference external" href="https://neuroimage.usc.edu/neuro/BrainSuite">https://neuroimage.usc.edu/neuro/BrainSuite</a>.</p>
<p>The conversion of BrainSuite tessellation
files to MNE software compatible formats is accomplished with the mne_convert_surface utility,
covered in <a class="reference internal" href="../c_reference.html#mne-convert-surface"><span class="std std-ref">mne_convert_surface</span></a>.</p>
<p>The workflow needed to employ the BrainSuite tessellations
is:</p>
<p><strong>Step 1</strong></p>
<blockquote>
<div><p>Using the mri_convert utility
available in FreeSurfer , convert
an MRI volume to the img (Analyze) format. This volume should be the
T1.mgz volume or a volume registered with T1.mgz in FreeSurfer :<code class="docutils literal notranslate"><span class="pre">mri_convert</span></code>  &lt;<em>volume</em>&gt; <code class="docutils literal notranslate"><span class="pre">.mgz</span></code>  &lt;<em>volume</em>&gt; <code class="docutils literal notranslate"><span class="pre">.img</span></code></p>
</div></blockquote>
<p><strong>Step 2</strong></p>
<blockquote>
<div><p>Transfer  &lt;<em>volume</em>&gt; <code class="docutils literal notranslate"><span class="pre">.mgz</span></code> to
a location accessible to BrainSuite , running
on Windows.</p>
</div></blockquote>
<p><strong>Step 3</strong></p>
<blockquote>
<div><p>Using  &lt;<em>volume</em>&gt; <code class="docutils literal notranslate"><span class="pre">.img</span></code> as
input, create the tessellations of scalp, outer skull, and inner
skull surfaces in BrainSuite .</p>
</div></blockquote>
<p><strong>Step 4</strong></p>
<blockquote>
<div><p>Transfer the dfs files containing the tessellations in the bem directory
of your subject’s FreeSurfer reconstruction.</p>
</div></blockquote>
<p><strong>Step 5</strong></p>
<blockquote>
<div><p>Go to the bem directory where you placed the two dfs files. Using mne_convert_surface ,
convert them to the FreeSurfer surface
format, <em>e,g.</em>:
<code class="docutils literal notranslate"><span class="pre">mne_convert_surface</span> <span class="pre">``</span> <span class="pre">``--dfs</span> <span class="pre">inner_skull.dfs</span> <span class="pre">``</span> <span class="pre">``--mghmri</span> <span class="pre">../mri/T1.mgz</span> <span class="pre">``</span> <span class="pre">``--surf</span> <span class="pre">inner_skull_dfs.surf</span></code></p>
</div></blockquote>
<p><strong>Step 6</strong></p>
<blockquote>
<div><p>Using tkmedit, check that the surfaces are correct, <em>e.g.</em>:
<code class="docutils literal notranslate"><span class="pre">tkmedit</span> <span class="pre">-f</span> <span class="pre">../mri/T1.mgz</span> <span class="pre">``</span> <span class="pre">``-surface</span> <span class="pre">inner_skull_dfs.surf</span></code></p>
</div></blockquote>
<p><strong>Step7</strong></p>
<blockquote>
<div><p>Using the mne_reduce_surface function
in Matlab, reduce the number of triangles on the surfaces to 10000
- 20000. Call the output files <code class="docutils literal notranslate"><span class="pre">outer_skin.surf</span></code> , <code class="docutils literal notranslate"><span class="pre">outer_skull.surf</span></code> ,
and <code class="docutils literal notranslate"><span class="pre">inner_skull.surf</span></code> .</p>
</div></blockquote>
<p><strong>Step 8</strong></p>
<blockquote>
<div><p>Proceed to mne_setup_forward_model .
Use the <code class="docutils literal notranslate"><span class="pre">--surf</span></code> and <code class="docutils literal notranslate"><span class="pre">--noswap</span></code> options.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If left and right are flipped in BrainSuite,    use the <code class="docutils literal notranslate"><span class="pre">--flip</span></code> option in mne_convert_surface to    set the coordinate transformation correctly.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The BrainSuite scalp    surface can be also used for visualization in mne_analyze ,    see <a class="reference internal" href="../gui/analyze.html#chdcghif"><span class="std std-ref">Using a high-resolution head surface tessellations</span></a>.</p>
</div>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container institutions">
    <a href="https://www.massgeneral.org/"><img class="institution_lg" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a>
    <a href="https://martinos.org/"><img class="institution_lg" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a>
    <a href="https://hms.harvard.edu/"><img class="institution_lg" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a>
    <a href="https://web.mit.edu/"><img class="institution_sm" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a>
    <a href="https://www.nyu.edu/"><img class="institution_md" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a>
    <a href="http://www.cea.fr/"><img class="institution_md" src="../../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a>
    <a href="https://sci.aalto.fi/"><img class="institution_md" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a>
    <a href="https://www.telecom-paris.fr/"><img class="institution_md" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a>
    <a href="https://www.washington.edu/"><img class="institution_sm" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a>
    <a href="https://icm-institute.org/"><img class="institution_lg" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a>
    <a href="https://www.bu.edu/"><img class="institution_sm" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a>
    <a href="https://www.inserm.fr/"><img class="institution_xs" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a>
    <a href="https://www.fz-juelich.de/"><img class="institution_sm" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a>
    <a href="https://www.tu-ilmenau.de/"><img class="institution_sm" src="../../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a>
    <a href="https://bids.berkeley.edu/"><img class="institution_md" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a>
    <a href="https://www.inria.fr/"><img class="institution_sm" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a>
    <a href="https://www.au.dk/"><img class="institution_sm" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a>
    <a href="https://www.uni-graz.at/"><img class="institution_md" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a>
  </div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-07-11.</p>
  </div>
</footer>
  </body>
</html>