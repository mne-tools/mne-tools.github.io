<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Background information on filtering &#8212; MNE 0.18.2 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" href="../../_static/reset-syntax.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap_divs.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.png"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.18.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../getting_started.html">Install</a></li>
                <li><a href="../../documentation.html">Documentation</a></li>
                <li><a href="../../python_reference.html">API</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../contributing.html">Contribute</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
<div class="navbar-form navbar-right navbar-btn dropdown btn-group-sm" style="margin-left: 20px; margin-top: 5px; margin-bottom: 5px">
  <button type="button" class="btn btn-primary navbar-btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">
    v0.18.2
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
    <li><a href="https://mne-tools.github.io/stable/index.html">v0.18 (stable)</a></li>
    <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
    <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
    <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
    <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
    <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
    <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
    <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
  </ul>
</div>


            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/mne_logo_small.png" alt="Logo"/>
            </a></p><ul>
<li><a class="reference internal" href="#">Background information on filtering</a><ul>
<li><a class="reference internal" href="#problem-statement">Problem statement</a></li>
<li><a class="reference internal" href="#filtering-basics">Filtering basics</a></li>
<li><a class="reference internal" href="#fir-filters">FIR Filters</a><ul>
<li><a class="reference internal" href="#designing-fir-filters">Designing FIR filters</a></li>
<li><a class="reference internal" href="#applying-fir-filters">Applying FIR filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iir-filters">IIR filters</a><ul>
<li><a class="reference internal" href="#designing-iir-filters">Designing IIR filters</a></li>
<li><a class="reference internal" href="#applying-iir-filters">Applying IIR filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#some-pitfalls-of-filtering">Some pitfalls of filtering</a><ul>
<li><a class="reference internal" href="#low-pass-problems">Low-pass problems</a></li>
<li><a class="reference internal" href="#high-pass-problems">High-pass problems</a></li>
<li><a class="reference internal" href="#baseline-problems-or-solutions">Baseline problems (or solutions?)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#filtering-defaults">Filtering defaults</a><ul>
<li><a class="reference internal" href="#defaults-in-mne-python">Defaults in MNE-Python</a></li>
<li><a class="reference internal" href="#defaults-in-mne-c">Defaults in MNE-C</a></li>
<li><a class="reference internal" href="#defaults-in-other-software">Defaults in other software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reporting-filters">Reporting Filters</a><ul>
<li><a class="reference internal" href="#filter-type">Filter type</a></li>
<li><a class="reference internal" href="#cutoff-frequency">Cutoff frequency</a></li>
<li><a class="reference internal" href="#filter-length-order-and-transition-bandwidth-roll-off">Filter length (order) and transition bandwidth (roll-off)</a></li>
<li><a class="reference internal" href="#passband-ripple-and-stopband-attenuation">Passband ripple and stopband attenuation</a></li>
<li><a class="reference internal" href="#filter-delay-and-direction-of-computation">Filter delay and direction of computation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-discussions-plot-background-filtering-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="background-information-on-filtering">
<span id="disc-filtering"></span><span id="sphx-glr-auto-tutorials-discussions-plot-background-filtering-py"></span><h1>Background information on filtering<a class="headerlink" href="#background-information-on-filtering" title="Permalink to this headline">¶</a></h1>
<p>Here we give some background information on filtering in general,
and how it is done in MNE-Python in particular.
Recommended reading for practical applications of digital
filter design can be found in Parks &amp; Burrus (1987) <a class="footnote-reference brackets" href="#id27" id="id1">1</a> and
Ifeachor &amp; Jervis (2002) <a class="footnote-reference brackets" href="#id28" id="id2">2</a>, and for filtering in an
M/EEG context we recommend reading Widmann <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id33" id="id3">7</a>.
To see how to use the default filters in MNE-Python on actual data, see
the <a class="reference internal" href="../preprocessing/plot_artifacts_correction_filtering.html#tut-filter-resample"><span class="std std-ref">Filtering and resampling data</span></a> tutorial.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#problem-statement" id="id39">Problem statement</a></p></li>
<li><p><a class="reference internal" href="#filtering-basics" id="id40">Filtering basics</a></p></li>
<li><p><a class="reference internal" href="#fir-filters" id="id41">FIR Filters</a></p>
<ul>
<li><p><a class="reference internal" href="#designing-fir-filters" id="id42">Designing FIR filters</a></p></li>
<li><p><a class="reference internal" href="#applying-fir-filters" id="id43">Applying FIR filters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#iir-filters" id="id44">IIR filters</a></p>
<ul>
<li><p><a class="reference internal" href="#designing-iir-filters" id="id45">Designing IIR filters</a></p></li>
<li><p><a class="reference internal" href="#applying-iir-filters" id="id46">Applying IIR filters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#some-pitfalls-of-filtering" id="id47">Some pitfalls of filtering</a></p>
<ul>
<li><p><a class="reference internal" href="#low-pass-problems" id="id48">Low-pass problems</a></p></li>
<li><p><a class="reference internal" href="#high-pass-problems" id="id49">High-pass problems</a></p></li>
<li><p><a class="reference internal" href="#baseline-problems-or-solutions" id="id50">Baseline problems (or solutions?)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#filtering-defaults" id="id51">Filtering defaults</a></p>
<ul>
<li><p><a class="reference internal" href="#defaults-in-mne-python" id="id52">Defaults in MNE-Python</a></p></li>
<li><p><a class="reference internal" href="#defaults-in-mne-c" id="id53">Defaults in MNE-C</a></p></li>
<li><p><a class="reference internal" href="#defaults-in-other-software" id="id54">Defaults in other software</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reporting-filters" id="id55">Reporting Filters</a></p>
<ul>
<li><p><a class="reference internal" href="#filter-type" id="id56">Filter type</a></p></li>
<li><p><a class="reference internal" href="#cutoff-frequency" id="id57">Cutoff frequency</a></p></li>
<li><p><a class="reference internal" href="#filter-length-order-and-transition-bandwidth-roll-off" id="id58">Filter length (order) and transition bandwidth (roll-off)</a></p></li>
<li><p><a class="reference internal" href="#passband-ripple-and-stopband-attenuation" id="id59">Passband ripple and stopband attenuation</a></p></li>
<li><p><a class="reference internal" href="#filter-delay-and-direction-of-computation" id="id60">Filter delay and direction of computation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id61">Summary</a></p></li>
<li><p><a class="reference internal" href="#references" id="id62">References</a></p></li>
</ul>
</div>
<div class="section" id="problem-statement">
<h2><a class="toc-backref" href="#id39">Problem statement</a><a class="headerlink" href="#problem-statement" title="Permalink to this headline">¶</a></h2>
<p>Practical issues with filtering electrophysiological data are covered
in Widmann <em>et al.</em> (2012) <a class="footnote-reference brackets" href="#id32" id="id4">6</a>, where they conclude with this statement:</p>
<blockquote>
<div><p>Filtering can result in considerable distortions of the time course
(and amplitude) of a signal as demonstrated by VanRullen (2011) [<a class="footnote-reference brackets" href="#id29" id="id5">3</a>].
Thus, filtering should not be used lightly. However, if effects of
filtering are cautiously considered and filter artifacts are minimized,
a valid interpretation of the temporal dynamics of filtered
electrophysiological data is possible and signals missed otherwise
can be detected with filtering.</p>
</div></blockquote>
<p>In other words, filtering can increase signal-to-noise ratio (SNR), but if it
is not used carefully, it can distort data. Here we hope to cover some
filtering basics so users can better understand filtering trade-offs and why
MNE-Python has chosen particular defaults.</p>
</div>
<div class="section" id="filtering-basics">
<span id="tut-filtering-basics"></span><h2><a class="toc-backref" href="#id40">Filtering basics</a><a class="headerlink" href="#filtering-basics" title="Permalink to this headline">¶</a></h2>
<p>Let’s get some of the basic math down. In the frequency domain, digital
filters have a transfer function that is given by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}H(z) &amp;= \frac{b_0 + b_1 z^{-1} + b_2 z^{-2} + \ldots + b_M z^{-M}}
             {1 + a_1 z^{-1} + a_2 z^{-2} + \ldots + a_N z^{-M}} \\
     &amp;= \frac{\sum_{k=0}^Mb_kz^{-k}}{\sum_{k=1}^Na_kz^{-k}}\end{split}\]</div>
<p>In the time domain, the numerator coefficients <span class="math notranslate nohighlight">\(b_k\)</span> and denominator
coefficients <span class="math notranslate nohighlight">\(a_k\)</span> can be used to obtain our output data
<span class="math notranslate nohighlight">\(y(n)\)</span> in terms of our input data <span class="math notranslate nohighlight">\(x(n)\)</span> as:</p>
<div class="math notranslate nohighlight" id="equation-summations">
<span class="eqno">(1)<a class="headerlink" href="#equation-summations" title="Permalink to this equation">¶</a></span>\[\begin{split} y(n) &amp;= b_0 x(n) + b_1 x(n-1) + \ldots + b_M x(n-M)
         - a_1 y(n-1) - a_2 y(n - 2) - \ldots - a_N y(n - N)\\
      &amp;= \sum_{k=0}^M b_k x(n-k) - \sum_{k=1}^N a_k y(n-k)\end{split}\]</div>
<p>In other words, the output at time <span class="math notranslate nohighlight">\(n\)</span> is determined by a sum over</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>the numerator coefficients <span class="math notranslate nohighlight">\(b_k\)</span>, which get multiplied by
the previous input values <span class="math notranslate nohighlight">\(x(n-k)\)</span>, and</p></li>
<li><p>the denominator coefficients <span class="math notranslate nohighlight">\(a_k\)</span>, which get multiplied by
the previous output values <span class="math notranslate nohighlight">\(y(n-k)\)</span>.</p></li>
</ol>
</div></blockquote>
<p>Note that these summations correspond to (1) a weighted <a class="reference external" href="https://en.wikipedia.org/wiki/Moving_average">moving average</a> and
(2) an <a class="reference external" href="https://en.wikipedia.org/wiki/Autoregressive_model">autoregression</a>.</p>
<p>Filters are broken into two classes: <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_impulse_response">FIR</a> (finite impulse response) and
<a class="reference external" href="https://en.wikipedia.org/wiki/Infinite_impulse_response">IIR</a> (infinite impulse response) based on these coefficients.
FIR filters use a finite number of numerator
coefficients <span class="math notranslate nohighlight">\(b_k\)</span> (<span class="math notranslate nohighlight">\(\forall k, a_k=0\)</span>), and thus each output
value of <span class="math notranslate nohighlight">\(y(n)\)</span> depends only on the <span class="math notranslate nohighlight">\(M\)</span> previous input values.
IIR filters depend on the previous input and output values, and thus can have
effectively infinite impulse responses.</p>
<p>As outlined in Parks &amp; Burrus (1987) <a class="footnote-reference brackets" href="#id27" id="id6">1</a>, FIR and IIR have different
trade-offs:</p>
<blockquote>
<div><ul class="simple">
<li><p>A causal FIR filter can be linear-phase – i.e., the same time delay
across all frequencies – whereas a causal IIR filter cannot. The phase
and group delay characteristics are also usually better for FIR filters.</p></li>
<li><p>IIR filters can generally have a steeper cutoff than an FIR filter of
equivalent order.</p></li>
<li><p>IIR filters are generally less numerically stable, in part due to
accumulating error (due to its recursive calculations).</p></li>
</ul>
</div></blockquote>
<p>In MNE-Python we default to using FIR filtering. As noted in Widmann <em>et al.</em>
(2015) <a class="footnote-reference brackets" href="#id33" id="id7">7</a>:</p>
<blockquote>
<div><p>Despite IIR filters often being considered as computationally more
efficient, they are recommended only when high throughput and sharp
cutoffs are required (Ifeachor and Jervis, 2002 [<a class="footnote-reference brackets" href="#id28" id="id8">2</a>], p. 321)…
FIR filters are easier to control, are always stable, have a
well-defined passband, can be corrected to zero-phase without
additional computations, and can be converted to minimum-phase.
We therefore recommend FIR filters for most purposes in
electrophysiological data analysis.</p>
</div></blockquote>
<p>When designing a filter (FIR or IIR), there are always trade-offs that
need to be considered, including but not limited to:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Ripple in the pass-band</p></li>
<li><p>Attenuation of the stop-band</p></li>
<li><p>Steepness of roll-off</p></li>
<li><p>Filter order (i.e., length for FIR filters)</p></li>
<li><p>Time-domain ringing</p></li>
</ol>
</div></blockquote>
<p>In general, the sharper something is in frequency, the broader it is in time,
and vice-versa. This is a fundamental time-frequency trade-off, and it will
show up below.</p>
</div>
<div class="section" id="fir-filters">
<h2><a class="toc-backref" href="#id41">FIR Filters</a><a class="headerlink" href="#fir-filters" title="Permalink to this headline">¶</a></h2>
<p>First, we will focus on FIR filters, which are the default filters used by
MNE-Python.</p>
<div class="section" id="designing-fir-filters">
<h3><a class="toc-backref" href="#id42">Designing FIR filters</a><a class="headerlink" href="#designing-fir-filters" title="Permalink to this headline">¶</a></h3>
<p>Here we’ll try to design a low-pass filter and look at trade-offs in terms
of time- and frequency-domain filter characteristics. Later, in
<a class="reference internal" href="#tut-effect-on-signals"><span class="std std-ref">Applying FIR filters</span></a>, we’ll look at how such filters can affect
signals when they are used.</p>
<p>First let’s import some useful tools for filtering, and set some default
values for our data that are reasonable for M/EEG.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">signal</span><span class="p">,</span> <span class="n">fftpack</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">mne.time_frequency.tfr</span> <span class="k">import</span> <a href="../../generated/mne.time_frequency.morlet.html#mne.time_frequency.morlet" title="View documentation for mne.time_frequency.tfr.morlet"><span class="n">morlet</span></a>
<span class="kn">from</span> <span class="nn">mne.viz</span> <span class="k">import</span> <a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">,</span> <a href="../../generated/mne.viz.plot_ideal_filter.html#mne.viz.plot_ideal_filter" title="View documentation for mne.viz.plot_ideal_filter"><span class="n">plot_ideal_filter</span></a>

<span class="kn">import</span> <span class="nn">mne</span>

<span class="n">sfreq</span> <span class="o">=</span> <span class="mf">1000.</span>
<span class="n">f_p</span> <span class="o">=</span> <span class="mf">40.</span>
<span class="n">flim</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>  <span class="c1"># limits for plotting</span>
</pre></div>
</div>
<p>Take for example an ideal low-pass filter, which would give a magnitude
response of 1 in the pass-band (up to frequency <span class="math notranslate nohighlight">\(f_p\)</span>) and a magnitude
response of 0 in the stop-band (down to frequency <span class="math notranslate nohighlight">\(f_s\)</span>) such that
<span class="math notranslate nohighlight">\(f_p=f_s=40\)</span> Hz here (shown to a lower limit of -60 dB for simplicity):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nyq</span> <span class="o">=</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="c1"># the Nyquist frequency is half our sample rate</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">nyq</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">third_height</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.array.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">third_height</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a href="../../generated/mne.viz.plot_ideal_filter.html#mne.viz.plot_ideal_filter" title="View documentation for mne.viz.plot_ideal_filter"><span class="n">plot_ideal_filter</span></a><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ideal </span><span class="si">%s</span><span class="s1"> Hz lowpass&#39;</span> <span class="o">%</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_001.png" />
<p>This filter hypothetically achieves zero ripple in the frequency domain,
perfect attenuation, and perfect steepness. However, due to the discontinuity
in the frequency response, the filter would require infinite ringing in the
time domain (i.e., infinite order) to be realized. Another way to think of
this is that a rectangular window in the frequency domain is actually a <a class="reference external" href="https://en.wikipedia.org/wiki/Sinc_function">sinc</a>
function in the time domain, which requires an infinite number of samples
(and thus infinite time) to represent. So although this filter has ideal
frequency suppression, it has poor time-domain characteristics.</p>
<p>Let’s try to naïvely make a brick-wall filter of length 0.1 s, and look
at the filter itself in the time domain and the frequency domain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">))</span>
<span class="n">n</span> <span class="o">-=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># make it odd</span>
<span class="n">t</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">sfreq</span>  <span class="c1"># center our sinc</span>
<span class="n">h</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.sinc.html#numpy.sinc" title="View documentation for numpy.sinc"><span class="n">np</span><span class="o">.</span><span class="n">sinc</span></a><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f_p</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Sinc (0.1 s)&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_002.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_002.png" />
<p>This is not so good! Making the filter 10 times longer (1 s) gets us a
slightly better stop-band suppression, but still has a lot of ringing in
the time domain. Note the x-axis is an order of magnitude longer here,
and the filter has a correspondingly much longer group delay (again equal
to half the filter length, or 0.5 seconds):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">))</span>
<span class="n">n</span> <span class="o">-=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># make it odd</span>
<span class="n">t</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">sfreq</span>
<span class="n">h</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.sinc.html#numpy.sinc" title="View documentation for numpy.sinc"><span class="n">np</span><span class="o">.</span><span class="n">sinc</span></a><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f_p</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Sinc (1.0 s)&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_003.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_003.png" />
<p>Let’s make the stop-band tighter still with a longer filter (10 s),
with a resulting larger x-axis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">10.</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">))</span>
<span class="n">n</span> <span class="o">-=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># make it odd</span>
<span class="n">t</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">sfreq</span>
<span class="n">h</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.sinc.html#numpy.sinc" title="View documentation for numpy.sinc"><span class="n">np</span><span class="o">.</span><span class="n">sinc</span></a><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f_p</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Sinc (10.0 s)&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_004.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_004.png" />
<p>Now we have very sharp frequency suppression, but our filter rings for the
entire 10 seconds. So this naïve method is probably not a good way to build
our low-pass filter.</p>
<p>Fortunately, there are multiple established methods to design FIR filters
based on desired response characteristics. These include:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Remez_algorithm">Remez</a> algorithm (<a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.remez.html#scipy.signal.remez" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.remez()</span></code></a>, <a class="reference external" href="https://www.mathworks.com/help/signal/ref/firpm.html">MATLAB firpm</a>)</p></li>
<li><p>Windowed FIR design (<a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firwin2()</span></code></a>,
<a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firwin()</span></code></a>, and <a class="reference external" href="https://www.mathworks.com/help/signal/ref/fir2.html">MATLAB fir2</a>)</p></li>
<li><p>Least squares designs (<a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firls.html#scipy.signal.firls" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firls()</span></code></a>, <a class="reference external" href="https://www.mathworks.com/help/signal/ref/firls.html">MATLAB firls</a>)</p></li>
<li><p>Frequency-domain design (construct filter in Fourier
domain and use an <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.fftpack.ifft.html#scipy.fftpack.ifft" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">IFFT</span></code></a> to invert it)</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remez and least squares designs have advantages when there are
“do not care” regions in our frequency response. However, we want
well controlled responses in all frequency regions.
Frequency-domain construction is good when an arbitrary response
is desired, but generally less clean (due to sampling issues) than
a windowed approach for more straightforward filter applications.
Since our filters (low-pass, high-pass, band-pass, band-stop)
are fairly simple and we require precise control of all frequency
regions, we will primarily use and explore windowed FIR design.</p>
</div>
<p>If we relax our frequency-domain filter requirements a little bit, we can
use these functions to construct a lowpass filter that instead has a
<em>transition band</em>, or a region between the pass frequency <span class="math notranslate nohighlight">\(f_p\)</span>
and stop frequency <span class="math notranslate nohighlight">\(f_s\)</span>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans_bandwidth</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 10 Hz transition band</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">trans_bandwidth</span>  <span class="c1"># = 50 Hz</span>

<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">nyq</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">third_height</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Hz lowpass with a </span><span class="si">%s</span><span class="s1"> Hz transition&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f_p</span><span class="p">,</span> <span class="n">trans_bandwidth</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_ideal_filter.html#mne.viz.plot_ideal_filter" title="View documentation for mne.viz.plot_ideal_filter"><span class="n">plot_ideal_filter</span></a><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_005.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_005.png" />
<p>Accepting a shallower roll-off of the filter in the frequency domain makes
our time-domain response potentially much better. We end up with a more
gradual slope through the transition region, but a <em>much</em> cleaner time
domain signal. Here again for the 1 s filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="View documentation for scipy.signal.firwin2"><span class="n">signal</span><span class="o">.</span><span class="n">firwin2</span></a><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">nyq</span><span class="o">=</span><span class="n">nyq</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Windowed 10 Hz transition (1.0 s)&#39;</span><span class="p">,</span>
            <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_006.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_006.png" />
<p>Since our lowpass is around 40 Hz with a 10 Hz transition, we can actually
use a shorter filter (5 cycles at 10 Hz = 0.5 s) and still get acceptable
stop-band attenuation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sfreq</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">h</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="View documentation for scipy.signal.firwin2"><span class="n">signal</span><span class="o">.</span><span class="n">firwin2</span></a><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">nyq</span><span class="o">=</span><span class="n">nyq</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Windowed 10 Hz transition (0.5 s)&#39;</span><span class="p">,</span>
            <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_007.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_007.png" />
<p>But if we shorten the filter too much (2 cycles of 10 Hz = 0.2 s),
our effective stop frequency gets pushed out past 60 Hz:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sfreq</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">h</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="View documentation for scipy.signal.firwin2"><span class="n">signal</span><span class="o">.</span><span class="n">firwin2</span></a><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">nyq</span><span class="o">=</span><span class="n">nyq</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Windowed 10 Hz transition (0.2 s)&#39;</span><span class="p">,</span>
            <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_008.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_008.png" />
<p>If we want a filter that is only 0.1 seconds long, we should probably use
something more like a 25 Hz transition band (0.2 s = 5 cycles &#64; 25 Hz):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans_bandwidth</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">trans_bandwidth</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">nyq</span><span class="p">]</span>
<span class="n">h</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="View documentation for scipy.signal.firwin2"><span class="n">signal</span><span class="o">.</span><span class="n">firwin2</span></a><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">nyq</span><span class="o">=</span><span class="n">nyq</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Windowed 50 Hz transition (0.2 s)&#39;</span><span class="p">,</span>
            <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_009.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_009.png" />
<p>So far, we have only discussed <em>non-causal</em> filtering, which means that each
sample at each time point <span class="math notranslate nohighlight">\(t\)</span> is filtered using samples that come
after (<span class="math notranslate nohighlight">\(t + \Delta t\)</span>) <em>and</em> before (<span class="math notranslate nohighlight">\(t - \Delta t\)</span>) the current
time point <span class="math notranslate nohighlight">\(t\)</span>.
In this sense, each sample is influenced by samples that come both before
and after it. This is useful in many cases, especially because it does not
delay the timing of events.</p>
<p>However, sometimes it can be beneficial to use <em>causal</em> filtering,
whereby each sample <span class="math notranslate nohighlight">\(t\)</span> is filtered only using time points that came
after it.</p>
<p>Note that the delay is variable (whereas for linear/zero-phase filters it
is constant) but small in the pass-band. Unlike zero-phase filters, which
require time-shifting backward the output of a linear-phase filtering stage
(and thus becoming non-causal), minimum-phase filters do not require any
compensation to achieve small delays in the pass-band. Note that as an
artifact of the minimum phase filter construction step, the filter does
not end up being as steep as the linear/zero-phase version.</p>
<p>We can construct a minimum-phase filter from our existing linear-phase
filter with the <code class="docutils literal notranslate"><span class="pre">minimum_phase</span></code> function in <a class="reference external" href="https://scipy.github.io/devdocs/signal.html#module-scipy.signal" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.signal</span></code></a>, and note
that the falloff is not as steep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_min</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">fixes</span><span class="o">.</span><span class="n">minimum_phase</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h_min</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Minimum-phase&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_010.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_010.png" />
</div>
<div class="section" id="applying-fir-filters">
<span id="tut-effect-on-signals"></span><h3><a class="toc-backref" href="#id43">Applying FIR filters</a><a class="headerlink" href="#applying-fir-filters" title="Permalink to this headline">¶</a></h3>
<p>Now lets look at some practical effects of these filters by applying
them to some data.</p>
<p>Let’s construct a Gaussian-windowed sinusoid (i.e., Morlet imaginary part)
plus noise (random and line). Note that the original clean signal contains
frequency content in both the pass band and transition bands of our
low-pass filter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dur</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="n">center</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">morlet_freq</span> <span class="o">=</span> <span class="n">f_p</span>
<span class="n">tlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="n">tticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">,</span> <span class="n">tlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">flim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.zeros.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sfreq</span> <span class="o">*</span> <span class="n">dur</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">blip</span> <span class="o">=</span> <a href="../../generated/mne.time_frequency.morlet.html#mne.time_frequency.morlet" title="View documentation for mne.time_frequency.tfr.morlet"><span class="n">morlet</span></a><span class="p">(</span><span class="n">sfreq</span><span class="p">,</span> <span class="p">[</span><span class="n">morlet_freq</span><span class="p">],</span> <span class="n">n_cycles</span><span class="o">=</span><span class="mi">7</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="mf">20.</span>
<span class="n">n_onset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">blip</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">x</span><span class="p">[</span><span class="n">n_onset</span><span class="p">:</span><span class="n">n_onset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">blip</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">blip</span>
<span class="n">x_orig</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="mf">1000.</span>
<span class="n">x</span> <span class="o">+=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.sin.html#numpy.sin" title="View documentation for numpy.sin"><span class="n">np</span><span class="o">.</span><span class="n">sin</span></a><span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a> <span class="o">*</span> <span class="mf">60.</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2000.</span>
</pre></div>
</div>
<p>Filter it with a shallow cutoff, linear-phase FIR (which allows us to
compensate for the constant filter delay):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transition_band</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">f_p</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">transition_band</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="c1"># This would be equivalent:</span>
<span class="n">h</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                             <span class="n">fir_design</span><span class="o">=</span><span class="s1">&#39;firwin&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_v16</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="c1"># this is the linear-&gt;zero phase, causal-to-non-causal conversion / shift</span>
<span class="n">x_v16</span> <span class="o">=</span> <span class="n">x_v16</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>

<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;MNE-Python 0.16 default&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span>
            <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_011.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_011.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal lowpass filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Upper passband edge: 40.00 Hz
- Upper transition bandwidth: 10.00 Hz (-6 dB cutoff frequency: 45.00 Hz)
- Filter length: 331 samples (0.331 sec)
</pre></div>
</div>
<p>Filter it with a different design method <code class="docutils literal notranslate"><span class="pre">fir_design=&quot;firwin2&quot;</span></code>, and also
compensate for the constant filter delay. This method does not produce
quite as sharp a transition compared to <code class="docutils literal notranslate"><span class="pre">fir_design=&quot;firwin&quot;</span></code>, despite
being twice as long:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transition_band</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">f_p</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">transition_band</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="c1"># This would be equivalent:</span>
<span class="c1"># filter_dur = 6.6 / transition_band  # sec</span>
<span class="c1"># n = int(sfreq * filter_dur)</span>
<span class="c1"># h = signal.firwin2(n, freq, gain, nyq=sfreq / 2.)</span>
<span class="n">h</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                             <span class="n">fir_design</span><span class="o">=</span><span class="s1">&#39;firwin2&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_v14</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>

<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;MNE-Python 0.14 default&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span>
            <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_012.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_012.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal lowpass filter:
- Windowed frequency-domain design (firwin2) method
- Hamming window
- Upper passband edge: 40.00 Hz
- Upper transition bandwidth: 10.00 Hz (-6 dB cutoff frequency: 45.00 Hz)
- Filter length: 660 samples (0.660 sec)
</pre></div>
</div>
<p>Let’s also filter with the MNE-Python 0.13 default, which is a
long-duration, steep cutoff FIR that gets applied twice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transition_band</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Hz</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">transition_band</span>
<span class="n">filter_dur</span> <span class="o">=</span> <span class="mf">10.</span>  <span class="c1"># sec</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="c1"># This would be equivalent</span>
<span class="c1"># n = int(sfreq * filter_dur)</span>
<span class="c1"># h = signal.firwin2(n, freq, gain, nyq=sfreq / 2.)</span>
<span class="n">h</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                             <span class="n">h_trans_bandwidth</span><span class="o">=</span><span class="n">transition_band</span><span class="p">,</span>
                             <span class="n">filter_length</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="n">filter_dur</span><span class="p">,</span>
                             <span class="n">fir_design</span><span class="o">=</span><span class="s1">&#39;firwin2&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_v13</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">h</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1"># the effective h is one that is applied to the time-reversed version of itself</span>
<span class="n">h_eff</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h_eff</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;MNE-Python 0.13 default&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span>
            <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_013.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_013.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal lowpass filter:
- Windowed frequency-domain design (firwin2) method
- Hamming window
- Upper passband edge: 40.00 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 40.25 Hz)
- Filter length: 10000 samples (10.000 sec)
</pre></div>
</div>
<p>Let’s also filter it with the MNE-C default, which is a long-duration
steep-slope FIR filter designed using frequency-domain techniques:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">design_mne_c_filter</span><span class="p">(</span><span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span> <span class="o">+</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">x_mne_c</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>

<span class="n">transition_band</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Hz (default in MNE-C)</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">transition_band</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;MNE-C default&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_014.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_014.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>filter :   0.000 ...   42.5 Hz   bins : 0 ... 348 of 4097 hpw : 3 lpw : 20
</pre></div>
</div>
<p>And now an example of a minimum-phase filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                             <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="n">fir_design</span><span class="o">=</span><span class="s1">&#39;firwin&#39;</span><span class="p">,</span>
                             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_min</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="View documentation for numpy.convolve"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">transition_band</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">f_p</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="n">f_p</span> <span class="o">+</span> <span class="n">transition_band</span>
<span class="n">filter_dur</span> <span class="o">=</span> <span class="mf">6.6</span> <span class="o">/</span> <span class="n">transition_band</span>  <span class="c1"># sec</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sfreq</span> <span class="o">*</span> <span class="n">filter_dur</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">f_s</span><span class="p">,</span> <span class="n">sfreq</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">]</span>
<span class="n">gain</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Minimum-phase filter&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_015.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_015.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

FIR filter parameters
---------------------
Designing a one-pass, non-linear phase, causal lowpass filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Upper transition bandwidth: 10.00 Hz
- Filter length: 331 samples (0.331 sec)
</pre></div>
</div>
<p>Both the MNE-Python 0.13 and MNE-C filters have excellent frequency
attenuation, but it comes at a cost of potential
ringing (long-lasting ripples) in the time domain. Ringing can occur with
steep filters, especially in signals with frequency content around the
transition band. Our Morlet wavelet signal has power in our transition band,
and the time-domain ringing is thus more pronounced for the steep-slope,
long-duration filter than the shorter, shallower-slope filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">axes</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">plot_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a signal.&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">sfreq</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">t</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">X</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.fftpack.fft.html#scipy.fftpack.fft" title="View documentation for scipy.fftpack.fft"><span class="n">fftpack</span><span class="o">.</span><span class="n">fft</span></a><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.fftpack.fftfreq.html#scipy.fftpack.fftfreq" title="View documentation for scipy.fftpack.fftfreq"><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">freqs</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.log10.html#numpy.log10" title="View documentation for numpy.log10"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><a href="https://www.numpy.org/devdocs/reference/generated/numpy.maximum.html#numpy.maximum" title="View documentation for numpy.maximum"><span class="n">np</span><span class="o">.</span><span class="n">maximum</span></a><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mf">1e-16</span><span class="p">)))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">flim</span><span class="p">)</span>


<span class="n">yscale</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">yticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="s1">&#39;Noisy&#39;</span><span class="p">,</span> <span class="s1">&#39;FIR-firwin (0.16)&#39;</span><span class="p">,</span> <span class="s1">&#39;FIR-firwin2 (0.14)&#39;</span><span class="p">,</span>
               <span class="s1">&#39;FIR-steep (0.13)&#39;</span><span class="p">,</span> <span class="s1">&#39;FIR-steep (MNE-C)&#39;</span><span class="p">,</span> <span class="s1">&#39;Minimum-phase&#39;</span><span class="p">]</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="o">-</span><a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">))</span> <span class="o">/</span> <span class="n">yscale</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_v16</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_v14</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_v13</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_mne_c</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">tlim</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;FIR, Lowpass=</span><span class="si">%d</span><span class="s1"> Hz&#39;</span> <span class="o">%</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">tticks</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span> <span class="o">/</span> <span class="n">yscale</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">yscale</span><span class="p">],</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">)</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_016.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_016.png" />
</div>
</div>
<div class="section" id="iir-filters">
<h2><a class="toc-backref" href="#id44">IIR filters</a><a class="headerlink" href="#iir-filters" title="Permalink to this headline">¶</a></h2>
<p>MNE-Python also offers IIR filtering functionality that is based on the
methods from <a class="reference external" href="https://scipy.github.io/devdocs/signal.html#module-scipy.signal" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.signal</span></code></a>. Specifically, we use the general-purpose
functions <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.iirfilter()</span></code></a> and <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.iirdesign.html#scipy.signal.iirdesign" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.iirdesign()</span></code></a>,
which provide unified interfaces to IIR filter design.</p>
<div class="section" id="designing-iir-filters">
<h3><a class="toc-backref" href="#id45">Designing IIR filters</a><a class="headerlink" href="#designing-iir-filters" title="Permalink to this headline">¶</a></h3>
<p>Let’s continue with our design of a 40 Hz low-pass filter and look at
some trade-offs of different IIR filters.</p>
<p>Often the default IIR filter is a <a class="reference external" href="https://en.wikipedia.org/wiki/Butterworth_filter">Butterworth filter</a>, which is designed
to have a <em>maximally flat pass-band</em>. Let’s look at a few filter orders,
i.e., a few different number of coefficients used and therefore steepness
of the filter:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that the group delay (which is related to the phase) of
the IIR filters below are not constant. In the FIR case, we can
design so-called linear-phase filters that have a constant group
delay, and thus compensate for the delay (making the filter
non-causal) if necessary. This cannot be done with IIR filters, as
they have a non-linear phase (non-constant group delay). As the
filter order increases, the phase distortion near and in the
transition band worsens. However, if non-causal (forward-backward)
filtering can be used, e.g. with <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.filtfilt.html#scipy.signal.filtfilt" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.filtfilt()</span></code></a>,
these phase issues can theoretically be mitigated.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sos</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="View documentation for scipy.signal.iirfilter"><span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">f_p</span> <span class="o">/</span> <span class="n">nyq</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;butter&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">sos</span><span class="o">=</span><span class="n">sos</span><span class="p">),</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Butterworth order=2&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span>
            <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_shallow</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.sosfiltfilt.html#scipy.signal.sosfiltfilt" title="View documentation for scipy.signal.sosfiltfilt"><span class="n">signal</span><span class="o">.</span><span class="n">sosfiltfilt</span></a><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="k">del</span> <span class="n">sos</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_017.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_017.png" />
<p>The falloff of this filter is not very steep.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we have made use of second-order sections (SOS)
by using <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.sosfilt.html#scipy.signal.sosfilt" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.sosfilt()</span></code></a> and, under the
hood, <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.zpk2sos.html#scipy.signal.zpk2sos" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.zpk2sos()</span></code></a> when passing the
<code class="docutils literal notranslate"><span class="pre">output='sos'</span></code> keyword argument to
<a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.iirfilter()</span></code></a>. The filter definitions
given <a class="reference internal" href="#tut-filtering-basics"><span class="std std-ref">above</span></a> use the polynomial
numerator/denominator (sometimes called “tf”) form <code class="docutils literal notranslate"><span class="pre">(b,</span> <span class="pre">a)</span></code>,
which are theoretically equivalent to the SOS form used here.
In practice, however, the SOS form can give much better results
due to issues with numerical precision (see
<a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.sosfilt.html#scipy.signal.sosfilt" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.sosfilt()</span></code></a> for an example), so SOS should be
used whenever possible.</p>
</div>
<p>Let’s increase the order, and note that now we have better attenuation,
with a longer impulse response. Let’s also switch to using the MNE filter
design function, which simplifies a few things and gives us some information
about the resulting filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iir_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;butter&#39;</span><span class="p">)</span>
<span class="n">filt</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iir&#39;</span><span class="p">,</span> <span class="n">iir_params</span><span class="o">=</span><span class="n">iir_params</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="s1">&#39;Butterworth order=8&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span>
            <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_steep</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.sosfiltfilt.html#scipy.signal.sosfiltfilt" title="View documentation for scipy.signal.sosfiltfilt"><span class="n">signal</span><span class="o">.</span><span class="n">sosfiltfilt</span></a><span class="p">(</span><span class="n">filt</span><span class="p">[</span><span class="s1">&#39;sos&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_018.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_018.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

IIR filter parameters
---------------------
Butterworth lowpass zero-phase (two-pass forward and reverse) non-causal filter:
- Filter order 16 (effective, after forward-backward)
- Cutoff at 40.00 Hz: -6.02 dB
</pre></div>
</div>
<p>There are other types of IIR filters that we can use. For a complete list,
check out the documentation for <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.iirdesign.html#scipy.signal.iirdesign" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.iirdesign()</span></code></a>. Let’s
try a Chebychev (type I) filter, which trades off ripple in the pass-band
to get better attenuation in the stop-band:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iir_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;cheby1&#39;</span><span class="p">,</span>
                  <span class="n">rp</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>  <span class="c1"># dB of acceptable pass-band ripple</span>
                  <span class="p">)</span>
<span class="n">filt</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iir&#39;</span><span class="p">,</span> <span class="n">iir_params</span><span class="o">=</span><span class="n">iir_params</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span>
            <span class="s1">&#39;Chebychev-1 order=8, ripple=1 dB&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_019.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_019.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

IIR filter parameters
---------------------
Chebyshev I lowpass zero-phase (two-pass forward and reverse) non-causal filter:
- Filter order 16 (effective, after forward-backward)
- Cutoff at 40.00 Hz: -2.00 dB
</pre></div>
</div>
<p>If we can live with even more ripple, we can get it slightly steeper,
but the impulse response begins to ring substantially longer (note the
different x-axis scale):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iir_params</span><span class="p">[</span><span class="s1">&#39;rp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.</span>
<span class="n">filt</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_freq</span><span class="o">=</span><span class="n">f_p</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;iir&#39;</span><span class="p">,</span> <span class="n">iir_params</span><span class="o">=</span><span class="n">iir_params</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="../../generated/mne.viz.plot_filter.html#mne.viz.plot_filter" title="View documentation for mne.viz.plot_filter"><span class="n">plot_filter</span></a><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span>
            <span class="s1">&#39;Chebychev-1 order=8, ripple=6 dB&#39;</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span>
            <span class="n">compensate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_020.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_020.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Setting up low-pass filter at 40 Hz

IIR filter parameters
---------------------
Chebyshev I lowpass zero-phase (two-pass forward and reverse) non-causal filter:
- Filter order 16 (effective, after forward-backward)
- Cutoff at 40.00 Hz: -12.00 dB
</pre></div>
</div>
</div>
<div class="section" id="applying-iir-filters">
<h3><a class="toc-backref" href="#id46">Applying IIR filters</a><a class="headerlink" href="#applying-iir-filters" title="Permalink to this headline">¶</a></h3>
<p>Now let’s look at how our shallow and steep Butterworth IIR filters
perform on our Morlet signal from before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">axes</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">yticks</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="o">-</span><span class="mf">30.</span>
<span class="n">yticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="s1">&#39;Noisy&#39;</span><span class="p">,</span> <span class="s1">&#39;Butterworth-2&#39;</span><span class="p">,</span> <span class="s1">&#39;Butterworth-8&#39;</span><span class="p">]</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_shallow</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plot_signal</span><span class="p">(</span><span class="n">x_steep</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">tlim</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;IIR, Lowpass=</span><span class="si">%d</span><span class="s1"> Hz&#39;</span> <span class="o">%</span> <span class="n">f_p</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">tticks</span><span class="p">,</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">],</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,)</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
    <span class="n">text</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">flim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Magnitude (dB)&#39;</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">adjust_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_021.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_021.png" />
</div>
</div>
<div class="section" id="some-pitfalls-of-filtering">
<h2><a class="toc-backref" href="#id47">Some pitfalls of filtering</a><a class="headerlink" href="#some-pitfalls-of-filtering" title="Permalink to this headline">¶</a></h2>
<p>Multiple recent papers have noted potential risks of drawing
errant inferences due to misapplication of filters.</p>
<div class="section" id="low-pass-problems">
<h3><a class="toc-backref" href="#id48">Low-pass problems</a><a class="headerlink" href="#low-pass-problems" title="Permalink to this headline">¶</a></h3>
<p>Filters in general, especially those that are non-causal (zero-phase), can
make activity appear to occur earlier or later than it truly did. As
mentioned in VanRullen (2011) <a class="footnote-reference brackets" href="#id29" id="id9">3</a>, investigations of commonly (at the time)
used low-pass filters created artifacts when they were applied to simulated
data. However, such deleterious effects were minimal in many real-world
examples in Rousselet (2012) <a class="footnote-reference brackets" href="#id31" id="id10">5</a>.</p>
<p>Perhaps more revealing, it was noted in Widmann &amp; Schröger (2012) <a class="footnote-reference brackets" href="#id32" id="id11">6</a> that
the problematic low-pass filters from VanRullen (2011) <a class="footnote-reference brackets" href="#id29" id="id12">3</a>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Used a least-squares design (like <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firls.html#scipy.signal.firls" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firls()</span></code></a>) that
included “do-not-care” transition regions, which can lead to
uncontrolled behavior.</p></li>
<li><p>Had a filter length that was independent of the transition bandwidth,
which can cause excessive ringing and signal distortion.</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="high-pass-problems">
<span id="tut-filtering-hp-problems"></span><h3><a class="toc-backref" href="#id49">High-pass problems</a><a class="headerlink" href="#high-pass-problems" title="Permalink to this headline">¶</a></h3>
<p>When it comes to high-pass filtering, using corner frequencies above 0.1 Hz
were found in Acunzo <em>et al.</em> (2012) <a class="footnote-reference brackets" href="#id30" id="id13">4</a> to:</p>
<blockquote>
<div><p>“… generate a systematic bias easily leading to misinterpretations of
neural activity.”</p>
</div></blockquote>
<p>In a related paper, Widmann <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id33" id="id14">7</a> also came to suggest a
0.1 Hz highpass. More evidence followed in Tanner <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id34" id="id15">8</a> of
such distortions. Using data from language ERP studies of semantic and
syntactic processing (i.e., N400 and P600), using a high-pass above 0.3 Hz
caused significant effects to be introduced implausibly early when compared
to the unfiltered data. From this, the authors suggested the optimal
high-pass value for language processing to be 0.1 Hz.</p>
<p>We can recreate a problematic simulation from Tanner <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id34" id="id16">8</a>:</p>
<blockquote>
<div><p>“The simulated component is a single-cycle cosine wave with an amplitude
of 5µV [sic], onset of 500 ms poststimulus, and duration of 800 ms. The
simulated component was embedded in 20 s of zero values to avoid
filtering edge effects… Distortions [were] caused by 2 Hz low-pass
and high-pass filters… No visible distortion to the original
waveform [occurred] with 30 Hz low-pass and 0.01 Hz high-pass filters…
Filter frequencies correspond to the half-amplitude (-6 dB) cutoff
(12 dB/octave roll-off).”</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This simulated signal contains energy not just within the
pass-band, but also within the transition and stop-bands – perhaps
most easily understood because the signal has a non-zero DC value,
but also because it is a shifted cosine that has been
<em>windowed</em> (here multiplied by a rectangular window), which
makes the cosine and DC frequencies spread to other frequencies
(multiplication in time is convolution in frequency, so multiplying
by a rectangular window in the time domain means convolving a sinc
function with the impulses at DC and the cosine frequency in the
frequency domain).</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.zeros.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sfreq</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">sfreq</span> <span class="o">-</span> <span class="mf">0.2</span>
<span class="n">onset</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.where.html#numpy.where" title="View documentation for numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">t</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cos_t</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sfreq</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="n">sfreq</span>
<span class="n">sig</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">-</span> <span class="mf">2.5</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.cos.html#numpy.cos" title="View documentation for numpy.cos"><span class="n">np</span><span class="o">.</span><span class="n">cos</span></a><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos_t</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="n">onset</span><span class="p">:</span><span class="n">onset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sig</span>

<span class="n">iir_lp_30</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="View documentation for scipy.signal.iirfilter"><span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">30.</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;lowpass&#39;</span><span class="p">)</span>
<span class="n">iir_hp_p1</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="View documentation for scipy.signal.iirfilter"><span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;highpass&#39;</span><span class="p">)</span>
<span class="n">iir_lp_2</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="View documentation for scipy.signal.iirfilter"><span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;lowpass&#39;</span><span class="p">)</span>
<span class="n">iir_hp_2</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="View documentation for scipy.signal.iirfilter"><span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;highpass&#39;</span><span class="p">)</span>
<span class="n">x_lp_30</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.filtfilt.html#scipy.signal.filtfilt" title="View documentation for scipy.signal.filtfilt"><span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span></a><span class="p">(</span><span class="n">iir_lp_30</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iir_lp_30</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x_hp_p1</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.filtfilt.html#scipy.signal.filtfilt" title="View documentation for scipy.signal.filtfilt"><span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span></a><span class="p">(</span><span class="n">iir_hp_p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iir_hp_p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x_lp_2</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.filtfilt.html#scipy.signal.filtfilt" title="View documentation for scipy.signal.filtfilt"><span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span></a><span class="p">(</span><span class="n">iir_lp_2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iir_lp_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x_hp_2</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.filtfilt.html#scipy.signal.filtfilt" title="View documentation for scipy.signal.filtfilt"><span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span></a><span class="p">(</span><span class="n">iir_hp_2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iir_hp_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">xlim</span> <span class="o">=</span> <span class="n">t</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Time (sec)&#39;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Amplitude ($\mu$V)&#39;</span>
<span class="n">tticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">axes</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x_f</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="n">x_lp_2</span><span class="p">,</span> <span class="n">x_lp_30</span><span class="p">,</span> <span class="n">x_hp_2</span><span class="p">,</span> <span class="n">x_hp_p1</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;LP$_2$&#39;</span><span class="p">,</span> <span class="s1">&#39;LP$_</span><span class="si">{30}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;HP$_2$&#39;</span><span class="p">,</span> <span class="s1">&#39;LP$_</span><span class="si">{0.1}</span><span class="s1">$&#39;</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x_f</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">tticks</span><span class="p">,</span>
           <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">adjust_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_022.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_022.png" />
<p>Similarly, in a P300 paradigm reported by Kappenman &amp; Luck (2010) <a class="footnote-reference brackets" href="#id38" id="id17">12</a>,
they found that applying a 1 Hz high-pass decreased the probability of
finding a significant difference in the N100 response, likely because
the P300 response was smeared (and inverted) in time by the high-pass
filter such that it tended to cancel out the increased N100. However,
they nonetheless note that some high-passing can still be useful to deal
with drifts in the data.</p>
<p>Even though these papers generally advise a 0.1 Hz or lower frequency for
a high-pass, it is important to keep in mind (as most authors note) that
filtering choices should depend on the frequency content of both the
signal(s) of interest and the noise to be suppressed. For example, in
some of the MNE-Python examples involving <a class="reference internal" href="../../manual/sample_dataset.html#ch-sample-data"><span class="std std-ref">The sample data set</span></a>,
high-pass values of around 1 Hz are used when looking at auditory
or visual N100 responses, because we analyze standard (not deviant) trials
and thus expect that contamination by later or slower components will
be limited.</p>
</div>
<div class="section" id="baseline-problems-or-solutions">
<h3><a class="toc-backref" href="#id50">Baseline problems (or solutions?)</a><a class="headerlink" href="#baseline-problems-or-solutions" title="Permalink to this headline">¶</a></h3>
<p>In an evolving discussion, Tanner <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id34" id="id18">8</a> suggest using baseline
correction to remove slow drifts in data. However, Maess <em>et al.</em> (2016) <a class="footnote-reference brackets" href="#id35" id="id19">9</a>
suggest that baseline correction, which is a form of high-passing, does
not offer substantial advantages over standard high-pass filtering.
Tanner <em>et al.</em> (2016) <a class="footnote-reference brackets" href="#id36" id="id20">10</a> rebutted that baseline correction can correct
for problems with filtering.</p>
<p>To see what they mean, consider again our old simulated signal <code class="docutils literal notranslate"><span class="pre">x</span></code> from
before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">baseline_plot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">all_axes</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="View documentation for matplotlib.pyplot.subplots"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ri</span><span class="p">,</span> <span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">all_axes</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])):</span>
        <span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ci</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iir_hp</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.iirfilter.html#scipy.signal.iirfilter" title="View documentation for scipy.signal.iirfilter"><span class="n">signal</span><span class="o">.</span><span class="n">iirfilter</span></a><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">sfreq</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;highpass&#39;</span><span class="p">,</span>
                                          <span class="n">output</span><span class="o">=</span><span class="s1">&#39;sos&#39;</span><span class="p">)</span>
                <span class="n">x_hp</span> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.signal.sosfiltfilt.html#scipy.signal.sosfiltfilt" title="View documentation for scipy.signal.sosfiltfilt"><span class="n">signal</span><span class="o">.</span><span class="n">sosfiltfilt</span></a><span class="p">(</span><span class="n">iir_hp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_hp</span> <span class="o">-=</span> <span class="n">x_hp</span><span class="p">[</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x_hp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ri</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;No &#39;</span> <span class="k">if</span> <span class="n">ci</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
                       <span class="s1">&#39;Baseline Correction&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">tticks</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1"> Hz&#39;</span> <span class="o">%</span> <span class="n">freq</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">adjust_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
    <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.suptitle.html#matplotlib.pyplot.suptitle" title="View documentation for matplotlib.pyplot.suptitle"><span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span></a><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>


<span class="n">baseline_plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_023.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_023.png" />
<p>In response, Maess <em>et al.</em> (2016) <a class="footnote-reference brackets" href="#id37" id="id21">11</a> note that these simulations do not
address cases of pre-stimulus activity that is shared across conditions, as
applying baseline correction will effectively copy the topology outside the
baseline period. We can see this if we give our signal <code class="docutils literal notranslate"><span class="pre">x</span></code> with some
consistent pre-stimulus activity, which makes everything look bad.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An important thing to keep in mind with these plots is that they
are for a single simulated sensor. In multi-electrode recordings
the topology (i.e., spatial pattern) of the pre-stimulus activity
will leak into the post-stimulus period. This will likely create a
spatially varying distortion of the time-domain signals, as the
averaged pre-stimulus spatial pattern gets subtracted from the
sensor time courses.</p>
</div>
<p>Putting some activity in the baseline period:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_pre</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sig_pre</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.cos.html#numpy.cos" title="View documentation for numpy.cos"><span class="n">np</span><span class="o">.</span><span class="n">cos</span></a><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.pi" title="View documentation for numpy.pi"><span class="n">np</span><span class="o">.</span><span class="n">pi</span></a> <span class="o">*</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="View documentation for numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="n">n_pre</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">n_pre</span><span class="p">))</span>
<span class="n">x</span><span class="p">[:</span><span class="n">n_pre</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sig_pre</span>
<span class="n">baseline_plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_background_filtering_024.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_filtering_024.png" />
<p>Both groups seem to acknowledge that the choices of filtering cutoffs, and
perhaps even the application of baseline correction, depend on the
characteristics of the data being investigated, especially when it comes to:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The frequency content of the underlying evoked activity relative
to the filtering parameters.</p></li>
<li><p>The validity of the assumption of no consistent evoked activity
in the baseline period.</p></li>
</ol>
</div></blockquote>
<p>We thus recommend carefully applying baseline correction and/or high-pass
values based on the characteristics of the data to be analyzed.</p>
</div>
</div>
<div class="section" id="filtering-defaults">
<h2><a class="toc-backref" href="#id51">Filtering defaults</a><a class="headerlink" href="#filtering-defaults" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defaults-in-mne-python">
<span id="tut-filtering-in-python"></span><h3><a class="toc-backref" href="#id52">Defaults in MNE-Python</a><a class="headerlink" href="#defaults-in-mne-python" title="Permalink to this headline">¶</a></h3>
<p>Most often, filtering in MNE-Python is done at the <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw" title="mne.io.Raw"><code class="xref py py-class docutils literal notranslate"><span class="pre">mne.io.Raw</span></code></a> level,
and thus <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.filter" title="mne.io.Raw.filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.io.Raw.filter()</span></code></a> is used. This function under the hood
(among other things) calls <a class="reference internal" href="../../generated/mne.filter.filter_data.html#mne.filter.filter_data" title="mne.filter.filter_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.filter.filter_data()</span></code></a> to actually
filter the data, which by default applies a zero-phase FIR filter designed
using <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firwin()</span></code></a>. In Widmann <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id33" id="id22">7</a>, they
suggest a specific set of parameters to use for high-pass filtering,
including:</p>
<blockquote>
<div><p>“… providing a transition bandwidth of 25% of the lower passband
edge but, where possible, not lower than 2 Hz and otherwise the
distance from the passband edge to the critical frequency.”</p>
</div></blockquote>
<p>In practice, this means that for each high-pass value <code class="docutils literal notranslate"><span class="pre">l_freq</span></code> or
low-pass value <code class="docutils literal notranslate"><span class="pre">h_freq</span></code> below, you would get this corresponding
<code class="docutils literal notranslate"><span class="pre">l_trans_bandwidth</span></code> or <code class="docutils literal notranslate"><span class="pre">h_trans_bandwidth</span></code>, respectively,
if the sample rate were 100 Hz (i.e., Nyquist frequency of 50 Hz):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>l_freq or h_freq</p></th>
<th class="head"><p>l_trans_bandwidth</p></th>
<th class="head"><p>h_trans_bandwidth</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.01</p></td>
<td><p>0.01</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-odd"><td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-even"><td><p>1.0</p></td>
<td><p>1.0</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-odd"><td><p>2.0</p></td>
<td><p>2.0</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-even"><td><p>4.0</p></td>
<td><p>2.0</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-odd"><td><p>8.0</p></td>
<td><p>2.0</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-even"><td><p>10.0</p></td>
<td><p>2.5</p></td>
<td><p>2.5</p></td>
</tr>
<tr class="row-odd"><td><p>20.0</p></td>
<td><p>5.0</p></td>
<td><p>5.0</p></td>
</tr>
<tr class="row-even"><td><p>40.0</p></td>
<td><p>10.0</p></td>
<td><p>10.0</p></td>
</tr>
<tr class="row-odd"><td><p>45.0</p></td>
<td><p>11.25</p></td>
<td><p>5.0</p></td>
</tr>
<tr class="row-even"><td><p>48.0</p></td>
<td><p>12.0</p></td>
<td><p>2.0</p></td>
</tr>
</tbody>
</table>
<p>MNE-Python has adopted this definition for its high-pass (and low-pass)
transition bandwidth choices when using <code class="docutils literal notranslate"><span class="pre">l_trans_bandwidth='auto'</span></code> and
<code class="docutils literal notranslate"><span class="pre">h_trans_bandwidth='auto'</span></code>.</p>
<p>To choose the filter length automatically with <code class="docutils literal notranslate"><span class="pre">filter_length='auto'</span></code>,
the reciprocal of the shortest transition bandwidth is used to ensure
decent attenuation at the stop frequency. Specifically, the reciprocal
(in samples) is multiplied by 3.1, 3.3, or 5.0 for the Hann, Hamming,
or Blackman windows, respectively, as selected by the <code class="docutils literal notranslate"><span class="pre">fir_window</span></code>
argument for <code class="docutils literal notranslate"><span class="pre">fir_design='firwin'</span></code>, and double these for
<code class="docutils literal notranslate"><span class="pre">fir_design='firwin2'</span></code> mode.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code class="docutils literal notranslate"><span class="pre">fir_design='firwin2'</span></code>, the multiplicative factors are
doubled compared to what is given in Ifeachor &amp; Jervis (2002) <a class="footnote-reference brackets" href="#id28" id="id23">2</a>
(p. 357), as <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin2.html#scipy.signal.firwin2" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firwin2()</span></code></a> has a smearing effect
on the frequency response, which we compensate for by
increasing the filter length. This is why
<code class="docutils literal notranslate"><span class="pre">fir_desgin='firwin'</span></code> is preferred to <code class="docutils literal notranslate"><span class="pre">fir_design='firwin2'</span></code>.</p>
</div>
<p>In 0.14, we default to using a Hamming window in filter design, as it
provides up to 53 dB of stop-band attenuation with small pass-band ripple.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In band-pass applications, often a low-pass filter can operate
effectively with fewer samples than the high-pass filter, so
it is advisable to apply the high-pass and low-pass separately
when using <code class="docutils literal notranslate"><span class="pre">fir_design='firwin2'</span></code>. For design mode
<code class="docutils literal notranslate"><span class="pre">fir_design='firwin'</span></code>, there is no need to separate the
operations, as the lowpass and highpass elements are constructed
separately to meet the transition band requirements.</p>
</div>
<p>For more information on how to use the
MNE-Python filtering functions with real data, consult the preprocessing
tutorial on <a class="reference internal" href="../preprocessing/plot_artifacts_correction_filtering.html#tut-filter-resample"><span class="std std-ref">Filtering and resampling data</span></a>.</p>
</div>
<div class="section" id="defaults-in-mne-c">
<h3><a class="toc-backref" href="#id53">Defaults in MNE-C</a><a class="headerlink" href="#defaults-in-mne-c" title="Permalink to this headline">¶</a></h3>
<p>MNE-C by default uses:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>5 Hz transition band for low-pass filters.</p></li>
<li><p>3-sample transition band for high-pass filters.</p></li>
<li><p>Filter length of 8197 samples.</p></li>
</ol>
</div></blockquote>
<p>The filter is designed in the frequency domain, creating a linear-phase
filter such that the delay is compensated for as is done with the MNE-Python
<code class="docutils literal notranslate"><span class="pre">phase='zero'</span></code> filtering option.</p>
<p>Squared-cosine ramps are used in the transition regions. Because these
are used in place of more gradual (e.g., linear) transitions,
a given transition width will result in more temporal ringing but also more
rapid attenuation than the same transition width in windowed FIR designs.</p>
<p>The default filter length will generally have excellent attenuation
but long ringing for the sample rates typically encountered in M/EEG data
(e.g. 500-2000 Hz).</p>
</div>
<div class="section" id="defaults-in-other-software">
<h3><a class="toc-backref" href="#id54">Defaults in other software</a><a class="headerlink" href="#defaults-in-other-software" title="Permalink to this headline">¶</a></h3>
<p>A good but possibly outdated comparison of filtering in various software
packages is available in Widmann <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id33" id="id24">7</a>. Briefly:</p>
<ul class="simple">
<li><dl class="simple">
<dt>EEGLAB</dt><dd><p>MNE-Python 0.14 defaults to behavior very similar to that of EEGLAB
(see the <a class="reference external" href="https://sccn.ucsd.edu/wiki/Firfilt_FAQ">EEGLAB filtering FAQ</a> for more information).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>FieldTrip</dt><dd><p>By default FieldTrip applies a forward-backward Butterworth IIR filter
of order 4 (band-pass and band-stop filters) or 2 (for low-pass and
high-pass filters). Similar filters can be achieved in MNE-Python when
filtering with <a class="reference internal" href="../../generated/mne.io.Raw.html#mne.io.Raw.filter" title="mne.io.Raw.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">raw.filter(...,</span> <span class="pre">method='iir')</span></code></a>
(see also <a class="reference internal" href="../../generated/mne.filter.construct_iir_filter.html#mne.filter.construct_iir_filter" title="mne.filter.construct_iir_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.filter.construct_iir_filter()</span></code></a> for options).
For more information, see e.g. the
<a class="reference external" href="http://www.fieldtriptoolbox.org/reference/ft_preproc_bandpassfilter">FieldTrip band-pass documentation</a>.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="reporting-filters">
<h2><a class="toc-backref" href="#id55">Reporting Filters</a><a class="headerlink" href="#reporting-filters" title="Permalink to this headline">¶</a></h2>
<p>On page 45 in Widmann <em>et al.</em> (2015) <a class="footnote-reference brackets" href="#id33" id="id25">7</a>, there is a convenient list of
important filter parameters that should be reported with each publication:</p>
<ol class="arabic simple">
<li><p>Filter type (high-pass, low-pass, band-pass, band-stop, FIR, IIR)</p></li>
<li><p>Cutoff frequency (including definition)</p></li>
<li><p>Filter order (or length)</p></li>
<li><p>Roll-off or transition bandwidth</p></li>
<li><p>Passband ripple and stopband attenuation</p></li>
<li><p>Filter delay (zero-phase, linear-phase, non-linear phase) and causality</p></li>
<li><p>Direction of computation (one-pass forward/reverse, or two-pass forward
and reverse)</p></li>
</ol>
<p>In the following, we will address how to deal with these parameters in MNE:</p>
<div class="section" id="filter-type">
<h3><a class="toc-backref" href="#id56">Filter type</a><a class="headerlink" href="#filter-type" title="Permalink to this headline">¶</a></h3>
<p>Depending on the function or method used, the filter type can be specified.
To name an example, in <a class="reference internal" href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="mne.filter.create_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.filter.create_filter()</span></code></a>, the relevant
arguments would be <em class="xref py py-obj">l_freq</em>, <em class="xref py py-obj">h_freg</em>, <em class="xref py py-obj">method</em>, and if the method is FIR
<em class="xref py py-obj">fir_window</em> and <em class="xref py py-obj">fir_design</em>.</p>
</div>
<div class="section" id="cutoff-frequency">
<h3><a class="toc-backref" href="#id57">Cutoff frequency</a><a class="headerlink" href="#cutoff-frequency" title="Permalink to this headline">¶</a></h3>
<p>The cutoff of FIR filters in MNE is defined as half-amplitude cutoff in the
middle of the transition band. That is, if you construct a lowpass FIR filter
with <code class="docutils literal notranslate"><span class="pre">h_freq</span> <span class="pre">=</span> <span class="pre">40</span></code>, the filter function will provide a transition
bandwidth that depends on the <em class="xref py py-obj">h_trans_bandwidth</em> argument. The desired
half-amplitude  cutoff of the lowpass FIR filter is then at
<code class="docutils literal notranslate"><span class="pre">h_freq</span> <span class="pre">+</span> <span class="pre">transition_bandwidth/2.</span></code>.</p>
</div>
<div class="section" id="filter-length-order-and-transition-bandwidth-roll-off">
<h3><a class="toc-backref" href="#id58">Filter length (order) and transition bandwidth (roll-off)</a><a class="headerlink" href="#filter-length-order-and-transition-bandwidth-roll-off" title="Permalink to this headline">¶</a></h3>
<p>In the <a class="reference internal" href="#tut-filtering-in-python"><span class="std std-ref">Defaults in MNE-Python</span></a> section, we have already talked about
the default filter lengths and transition bandwidths that are used when no
custom values are specified using the respective filter function’s arguments.</p>
<p>If you want to find out about the filter length and transition bandwidth that
were used through the ‘auto’ setting, you can use
<a class="reference internal" href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="mne.filter.create_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.filter.create_filter()</span></code></a> to print out the settings once more:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the same settings as when calling e.g., `raw.filter()`</span>
<span class="n">fir_coefs</span> <span class="o">=</span> <a href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="View documentation for mne.filter.create_filter"><span class="n">mne</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">create_filter</span></a><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># data is only used for sanity checking, not strictly needed</span>
    <span class="n">sfreq</span><span class="o">=</span><span class="mf">1000.</span><span class="p">,</span>  <span class="c1"># sfreq of your data in Hz</span>
    <span class="n">l_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">h_freq</span><span class="o">=</span><span class="mf">40.</span><span class="p">,</span>  <span class="c1"># assuming a lowpass of 40 Hz</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fir&#39;</span><span class="p">,</span>
    <span class="n">fir_window</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">,</span>
    <span class="n">fir_design</span><span class="o">=</span><span class="s1">&#39;firwin&#39;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># See the printed log for the transition bandwidth and filter length.</span>
<span class="c1"># Alternatively, get the filter length through:</span>
<span class="n">filter_length</span> <span class="o">=</span> <span class="n">fir_coefs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>No data specified. Sanity checks related to the length of the signal relative to the filter order will be skipped.
Setting up low-pass filter at 40 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal lowpass filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Upper passband edge: 40.00 Hz
- Upper transition bandwidth: 10.00 Hz (-6 dB cutoff frequency: 45.00 Hz)
- Filter length: 331 samples (0.331 sec)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using an IIR filter, <a class="reference internal" href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="mne.filter.create_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.filter.create_filter()</span></code></a>
will not print a filter length and transition bandwidth to the log.
Instead, you can specify the roll-off with the <em class="xref py py-obj">iir_params</em>
argument or stay with the default, which is a fourth order
(Butterworth) filter.</p>
</div>
</div>
<div class="section" id="passband-ripple-and-stopband-attenuation">
<h3><a class="toc-backref" href="#id59">Passband ripple and stopband attenuation</a><a class="headerlink" href="#passband-ripple-and-stopband-attenuation" title="Permalink to this headline">¶</a></h3>
<p>When use standard <a class="reference external" href="https://scipy.github.io/devdocs/generated/scipy.signal.firwin.html#scipy.signal.firwin" title="(in SciPy v1.4.0.dev0+492e7f8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.firwin()</span></code></a> design (as for FIR filters in
MNE), the passband ripple and stopband attenuation are dependent upon the
window used in design. For standard windows the values are listed in this
table (see Ifeachor &amp; Jervis (2002) <a class="footnote-reference brackets" href="#id28" id="id26">2</a>, p. 357):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 27%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name of window function</p></th>
<th class="head"><p>Passband ripple</p></th>
<th class="head"><p>Stopband attenuation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Hann</p></td>
<td><p>0.0545 dB</p></td>
<td><p>44 dB</p></td>
</tr>
<tr class="row-odd"><td><p>Hamming</p></td>
<td><p>0.0194 dB</p></td>
<td><p>53 dB</p></td>
</tr>
<tr class="row-even"><td><p>Blackman</p></td>
<td><p>0.0017 dB</p></td>
<td><p>74 dB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="filter-delay-and-direction-of-computation">
<h3><a class="toc-backref" href="#id60">Filter delay and direction of computation</a><a class="headerlink" href="#filter-delay-and-direction-of-computation" title="Permalink to this headline">¶</a></h3>
<p>For reporting this information, it might be sufficient to read the docstring
of the filter function or method that you apply. For example in the
docstring of <a class="reference internal" href="../../generated/mne.filter.create_filter.html#mne.filter.create_filter" title="mne.filter.create_filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mne.filter.create_filter</span></code></a>, for the phase parameter it says:</p>
<blockquote>
<div><p>Phase of the filter, only used if <code class="docutils literal notranslate"><span class="pre">method='fir'</span></code>.
By default, a symmetric linear-phase FIR filter is constructed.
If <code class="docutils literal notranslate"><span class="pre">phase='zero'</span></code> (default), the delay of this filter
is compensated for. If <code class="docutils literal notranslate"><span class="pre">phase=='zero-double'</span></code>, then this filter
is applied twice, once forward, and once backward. If ‘minimum’,
then a minimum-phase, causal filter will be used.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id61">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>When filtering, there are always trade-offs that should be considered.
One important trade-off is between time-domain characteristics (like ringing)
and frequency-domain attenuation characteristics (like effective transition
bandwidth). Filters with sharp frequency cutoffs can produce outputs that
ring for a long time when they operate on signals with frequency content
in the transition band. In general, therefore, the wider a transition band
that can be tolerated, the better behaved the filter will be in the time
domain.</p>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id62">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id27"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id6">2</a>)</span></dt>
<dd><p>Parks TW, Burrus CS (1987). Digital Filter Design.
New York: Wiley-Interscience.</p>
</dd>
<dt class="label" id="id28"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id8">2</a>,<a href="#id23">3</a>,<a href="#id26">4</a>)</span></dt>
<dd><p>Ifeachor, E. C., &amp; Jervis, B. W. (2002). Digital Signal Processing:
A Practical Approach. Prentice Hall.</p>
</dd>
<dt class="label" id="id29"><span class="brackets">3</span><span class="fn-backref">(<a href="#id5">1</a>,<a href="#id9">2</a>,<a href="#id12">3</a>)</span></dt>
<dd><p>Vanrullen, R. (2011). Four common conceptual fallacies in mapping
the time course of recognition. Perception Science, 2, 365.</p>
</dd>
<dt class="label" id="id30"><span class="brackets"><a class="fn-backref" href="#id13">4</a></span></dt>
<dd><p>Acunzo, D. J., MacKenzie, G., &amp; van Rossum, M. C. W. (2012).
Systematic biases in early ERP and ERF components as a result
of high-pass filtering. Journal of Neuroscience Methods,
209(1), 212–218. <a class="reference external" href="https://doi.org/10.1016/j.jneumeth.2012.06.011">https://doi.org/10.1016/j.jneumeth.2012.06.011</a></p>
</dd>
<dt class="label" id="id31"><span class="brackets"><a class="fn-backref" href="#id10">5</a></span></dt>
<dd><p>Rousselet, G. A. (2012). Does filtering preclude us from studying
ERP time-courses? Frontiers in Psychology, 3(131)</p>
</dd>
<dt class="label" id="id32"><span class="brackets">6</span><span class="fn-backref">(<a href="#id4">1</a>,<a href="#id11">2</a>)</span></dt>
<dd><p>Widmann, A., &amp; Schröger, E. (2012). Filter effects and filter
artifacts in the analysis of electrophysiological data.
Perception Science, 233.</p>
</dd>
<dt class="label" id="id33"><span class="brackets">7</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id7">2</a>,<a href="#id14">3</a>,<a href="#id22">4</a>,<a href="#id24">5</a>,<a href="#id25">6</a>)</span></dt>
<dd><p>Widmann, A., Schröger, E., &amp; Maess, B. (2015). Digital filter
design for electrophysiological data – a practical approach.
Journal of Neuroscience Methods, 250, 34–46.
<a class="reference external" href="https://doi.org/10.1016/j.jneumeth.2014.08.002">https://doi.org/10.1016/j.jneumeth.2014.08.002</a></p>
</dd>
<dt class="label" id="id34"><span class="brackets">8</span><span class="fn-backref">(<a href="#id15">1</a>,<a href="#id16">2</a>,<a href="#id18">3</a>)</span></dt>
<dd><p>Tanner, D., Morgan-Short, K., &amp; Luck, S. J. (2015).
How inappropriate high-pass filters can produce artifactual effects
and incorrect conclusions in ERP studies of language and cognition.
Psychophysiology, 52(8), 997–1009. <a class="reference external" href="https://doi.org/10.1111/psyp.12437">https://doi.org/10.1111/psyp.12437</a></p>
</dd>
<dt class="label" id="id35"><span class="brackets"><a class="fn-backref" href="#id19">9</a></span></dt>
<dd><p>Maess, B., Schröger, E., &amp; Widmann, A. (2016).
High-pass filters and baseline correction in M/EEG analysis.
Commentary on: “How inappropriate high-pass filters can produce
artifacts and incorrect conclusions in ERP studies of language
and cognition.” Journal of Neuroscience Methods, 266, 164–165.</p>
</dd>
<dt class="label" id="id36"><span class="brackets"><a class="fn-backref" href="#id20">10</a></span></dt>
<dd><p>Tanner, D., Norton, J. J. S., Morgan-Short, K., &amp; Luck, S. J. (2016).
On high-pass filter artifacts (they’re real) and baseline correction
(it’s a good idea) in ERP/ERMF analysis.</p>
</dd>
<dt class="label" id="id37"><span class="brackets"><a class="fn-backref" href="#id21">11</a></span></dt>
<dd><p>Maess, B., Schröger, E., &amp; Widmann, A. (2016).
High-pass filters and baseline correction in M/EEG analysis-continued
discussion. Journal of Neuroscience Methods, 266, 171–172.
Journal of Neuroscience Methods, 266, 166–170.</p>
</dd>
<dt class="label" id="id38"><span class="brackets"><a class="fn-backref" href="#id17">12</a></span></dt>
<dd><p>Kappenman E. &amp; Luck, S. (2010). The effects of impedance on data
quality and statistical significance in ERP recordings.
Psychophysiology, 47, 888-904.</p>
</dd>
</dl>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  16.704 seconds)</p>
<p><strong>Estimated memory usage:</strong>  9 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-discussions-plot-background-filtering-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/50ca168736a7f5e0ade7d4d0af520755/plot_background_filtering.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_background_filtering.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/051be2c17b4d6dee1d8a987371a4f0e6/plot_background_filtering.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_background_filtering.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container institutions">
    <a href="https://www.massgeneral.org/"><img class="institution_lg" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a>
    <a href="https://martinos.org/"><img class="institution_lg" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a>
    <a href="https://hms.harvard.edu/"><img class="institution_lg" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a>
    <a href="https://web.mit.edu/"><img class="institution_sm" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a>
    <a href="https://www.nyu.edu/"><img class="institution_md" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a>
    <a href="http://www.cea.fr/"><img class="institution_md" src="../../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a>
    <a href="https://sci.aalto.fi/"><img class="institution_md" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a>
    <a href="https://www.telecom-paris.fr/"><img class="institution_md" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a>
    <a href="https://www.washington.edu/"><img class="institution_sm" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a>
    <a href="https://icm-institute.org/"><img class="institution_lg" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a>
    <a href="https://www.bu.edu/"><img class="institution_sm" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a>
    <a href="https://www.inserm.fr/"><img class="institution_xs" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a>
    <a href="https://www.fz-juelich.de/"><img class="institution_sm" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a>
    <a href="https://www.tu-ilmenau.de/"><img class="institution_sm" src="../../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a>
    <a href="https://bids.berkeley.edu/"><img class="institution_md" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a>
    <a href="https://www.inria.fr/"><img class="institution_sm" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a>
    <a href="https://www.au.dk/"><img class="institution_sm" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a>
    <a href="https://www.uni-graz.at/"><img class="institution_md" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a>
  </div>
  <div class="container">
    <ul class="list-inline">
      <li><a href="https://github.com/mne-tools/mne-python">GitHub</a></li>
      <li>·</li>
      <li><a href="https://mail.nmr.mgh.harvard.edu/mailman/listinfo/mne_analysis">Mailing list</a></li>
      <li>·</li>
      <li><a href="https://gitter.im/mne-tools/mne-python">Gitter</a></li>
      <li>·</li>
      <li><a href="whats_new.html">What's new</a></li>
      <li>·</li>
      <li><a href="faq.html#cite">Cite MNE</a></li>
      <li class="pull-right"><a href="#">Back to top</a></li>
    </ul>
    <p>&copy; Copyright 2012-2019, MNE Developers. Last updated on 2019-07-11.</p>
  </div>
</footer>
  </body>
</html>